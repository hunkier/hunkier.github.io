<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>AI Studio基本操作(二) Debug篇</title>
    <url>/AiStudio-basic-use-debug/</url>
    <content><![CDATA[<p>本文主要介绍如何使用PDB来进行代码调试, 可以打印变量和单步执行</p>
<p>Python自带一个调试器, 在Python 3.7之后甚至成为内置调试器. 这就是PDB. 这是使用Python的用户需要掌握的基本技能.</p>
<p>下面我们看一下基本演示(GIF循环播放):</p>
<p><img src="https://ai.bdstatic.com/file/368702F4ACC64CF59009A3EE348F9765" alt="img"></p>
 <span id="more"></span>

<p>对应代码如下, 大家可以运行起来试一下.</p>
<p>In [1]</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> pdb</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyScrapy</span>:</span></span><br><span class="line">    urls = []</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">start_url</span>(<span class="params">self, urls</span>):</span></span><br><span class="line">        pdb.set_trace()</span><br><span class="line">        <span class="keyword">for</span> url <span class="keyword">in</span> urls:</span><br><span class="line">            <span class="built_in">print</span>(url)</span><br><span class="line">            self.urls.append(url)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">parse</span>(<span class="params">self</span>):</span></span><br><span class="line">        pdb.set_trace()</span><br><span class="line">        <span class="keyword">for</span> url <span class="keyword">in</span> self.urls:</span><br><span class="line">            result = self.request_something(url)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">request_something</span>(<span class="params">self, url</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;requesting...&#x27;</span>)</span><br><span class="line">        data = <span class="string">&#x27;&#x27;&#x27;&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="string">&lt;html lang=&quot;en&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;head&gt;</span></span><br><span class="line"><span class="string">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span></span><br><span class="line"><span class="string">    &lt;title&gt;Title&lt;/title&gt;</span></span><br><span class="line"><span class="string">&lt;/head&gt;</span></span><br><span class="line"><span class="string">&lt;body&gt;</span></span><br><span class="line"><span class="string">&lt;/body&gt;</span></span><br><span class="line"><span class="string">&lt;/html&gt;&#x27;&#x27;&#x27;</span></span><br><span class="line">        <span class="keyword">return</span> data</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">scrapy= MyScrapy()</span><br><span class="line">scrapy.start_url([<span class="string">&quot;http://www.zone7.cn&quot;</span>, <span class="string">&quot;http://www.zone7.cn&quot;</span>, <span class="string">&quot;http://www.zone7.cn&quot;</span>, <span class="string">&quot;http://www.zone7.cn&quot;</span>, ])</span><br><span class="line">scrapy.parse()</span><br></pre></td></tr></table></figure>

<p>下面是详细使用说明, 主要内容参考 <a href="https://howchoo.com/g/zgi2y2iwyze/debugging-your-python-code">howchoo</a></p>
<p><img src="https://ai-studio-static-online.cdn.bcebos.com/adb216d833604fff86cec8d7aa68b5b512e3a6b10d204198a2b37903bd29dcb1" alt="img"></p>
<p>Python具有一个整洁的调试功能（像大多数其他语言一样），在这种情况下非常方便。本指南是快速教程，希望能让您的生活更轻松</p>
<h1 id="1-一个混乱的程序"><a href="#1-一个混乱的程序" class="headerlink" title="1. 一个混乱的程序"></a>1. 一个混乱的程序</h1><p>为了本教程的目的，让我们考虑下面的简单程序。</p>
<p>该程序采用两个命令行参数并执行加法和减法操作。</p>
<p>（让我们假设用户输入有效值，因此我们不是错误处理）。</p>
<p>In [2]</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params">num1=<span class="number">0</span>, num2=<span class="number">0</span></span>):</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">int</span>(num1) + <span class="built_in">int</span>(num2)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sub</span>(<span class="params">num1=<span class="number">0</span>, num2=<span class="number">0</span></span>):</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">int</span>(num1) - <span class="built_in">int</span>(num2)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">    <span class="comment">#Assuming our inputs are valid numbers</span></span><br><span class="line">    num1 = <span class="number">0</span></span><br><span class="line">    num2 = <span class="number">2</span></span><br><span class="line">    </span><br><span class="line">    addition = add(num1, num2)</span><br><span class="line">    <span class="built_in">print</span> (addition)</span><br><span class="line">    </span><br><span class="line">    subtraction = sub(num1, num2)</span><br><span class="line">    <span class="built_in">print</span> (subtraction)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br><span class="line"><span class="number">2</span></span><br><span class="line">-<span class="number">2</span></span><br></pre></td></tr></table></figure>

<h1 id="2-pdb来了"><a href="#2-pdb来了" class="headerlink" title="2. pdb来了"></a>2. pdb来了</h1><p>Python附带了一个名为pdb的有用模块，它基本上是一个交互式源代码调试器。</p>
<p>您需要以下几行来实际使用此模块</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">import pdb</span><br><span class="line">pdb.set_trace()</span><br></pre></td></tr></table></figure>

<p>In [3]</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> pdb</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params">num1=<span class="number">0</span>, num2=<span class="number">0</span></span>):</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">int</span>(num1) + <span class="built_in">int</span>(num2)</span><br><span class="line">    </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sub</span>(<span class="params">num1=<span class="number">0</span>, num2=<span class="number">0</span></span>):</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">int</span>(num1) - <span class="built_in">int</span>(num2)</span><br><span class="line">    </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">    <span class="comment">#Assuming our inputs are valid numbers</span></span><br><span class="line">    num1 = <span class="number">33</span></span><br><span class="line">    num2 = <span class="number">44</span></span><br><span class="line">    pdb.set_trace() <span class="comment"># &lt;-- 这个表示添加断点</span></span><br><span class="line">    addition = add(num1, num2)</span><br><span class="line">    <span class="built_in">print</span> (addition)</span><br><span class="line">    subtraction = sub(num1, num2)</span><br><span class="line">    <span class="built_in">print</span> (subtraction)</span><br><span class="line">    </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>

<p>一旦开始运行, 会出现交互框</p>
<p>如下图所示:</p>
<p><img src="https://ai-studio-static-online.cdn.bcebos.com/6e50855df42e478898e8d34f8048d01d9d3c9b3a17e04ed4a432ec032130907d" alt="img"></p>
<p>在这个输入框里敲入命令, 即可开始调试.</p>
<p>通常这些命令都是一个字母, 因此毋庸担心.</p>
<h1 id="3-下一行-gt-n"><a href="#3-下一行-gt-n" class="headerlink" title="3. 下一行 - &gt; n"></a>3. 下一行 - &gt; n</h1><p>在输入框里, 输入n, 可转到下一行</p>
<p><img src="https://ai-studio-static-online.cdn.bcebos.com/08a9fb56feb44f41999fd9b7e1f42b02df264b48ccc4495e8a12d11da5a6c2db" alt="img"></p>
<p>这将执行当前代码行，现在可以执行下一行。</p>
<p><img src="https://ai-studio-static-online.cdn.bcebos.com/545d1fd617c148b0afb5325c06a34fa00f945b06e5f54ae0aab144eed28e2ac8" alt="img"></p>
<p>我们可以使用n逐行遍历整个程序，但这不会非常有用。</p>
<p>另外你可能已经注意到pdb实际上没有进入我们的add函数。让我们看看更多选项，使调试更有趣。</p>
<p>注意： 另一个很酷的功能是点击’返回键’执行你以前的命令（在这种情况下只是n）。</p>
<h1 id="4-打印-gt-p"><a href="#4-打印-gt-p" class="headerlink" title="4. 打印 - &gt; p"></a>4. 打印 - &gt; p</h1><p>让我们再次开始调试我们的程序。（你可以点击c使pdb跳到最后或直到下一个断点。由于我们没有任何程序将完成执行）。</p>
<p>现在，如果我们想知道num1或num2包含什么，我们可以在输入框里输入：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">p num1</span><br></pre></td></tr></table></figure>

<p>如截图所示:</p>
<p><img src="https://ai-studio-static-online.cdn.bcebos.com/684676cd8e5346e0bc7ba08004a47d882d6f134ab8d147628245f497e84bc0f5" alt="img"></p>
<p>回车</p>
<p><img src="https://ai-studio-static-online.cdn.bcebos.com/2e950c54bdf149d89ad0f802261246186e0c652eeefa4b34b5ef801c4d60936e" alt="img"></p>
<p>这非常方便查看我们的变量实际存储的值。</p>
<p>现在让我们进入添加功能。</p>
<h1 id="5-动态添加断点-gt-b"><a href="#5-动态添加断点-gt-b" class="headerlink" title="5. 动态添加断点 - &gt; b"></a>5. 动态添加断点 - &gt; b</h1><p>我们在运行程序之前使用了pdb.set_trace（）来设置断点。</p>
<p>我们通常希望在调试会话开始后在程序的特定位置添加断点。</p>
<p>这个时候可以考虑输入b. 可以亲自试一下.</p>
<h1 id="6-动态分配变量"><a href="#6-动态分配变量" class="headerlink" title="6. 动态分配变量"></a>6. 动态分配变量</h1><p>知道在调试会话期间可以分配变量以帮助调试也很有用。考虑：</p>
<p><img src="https://ai-studio-static-online.cdn.bcebos.com/fa65a33c9d4e49bc9e53d385dc04312ebbb2015698744ea8b0659d6da516edb1" alt="img"></p>
<p>输入后运行</p>
<p><img src="https://ai-studio-static-online.cdn.bcebos.com/ca3a74f79ae14aad87baee29a613307d4ce917c5bbb5404fb90ec2ecbde7dd3a" alt="img"></p>
<h1 id="7-退出-gt-q"><a href="#7-退出-gt-q" class="headerlink" title="7. 退出 - &gt; q"></a>7. 退出 - &gt; q</h1><p>最后，如果你想在任何时候退出，你可以使用q。正在执行的程序被中止。</p>
<h1 id="8-其他"><a href="#8-其他" class="headerlink" title="8. 其他"></a>8. 其他</h1><p>还有一种更好的方式, 叫ipdb. 用法和PDB很相似. 不过返回的输出是彩色的.</p>
<ul>
<li>ENTER (重复上次命令)</li>
<li>c (继续)</li>
<li>l (查找当前位于哪里)</li>
<li>s (进入子程序,如果当前有一个函数调用，那么 s 会进入被调用的函数体)</li>
<li>n(ext) 让程序运行下一行，如果当前语句有一个函数调用，用 n 是不会进入被调用的函数体中的</li>
<li>r (运行直到子程序结束)</li>
<li>!&lt;python 命令&gt;</li>
<li>h (帮助)</li>
<li>a(rgs) 打印当前函数的参数</li>
<li>j(ump) 让程序跳转到指定的行数</li>
<li>l(ist) 可以列出当前将要运行的代码块</li>
<li>p(rint) 最有用的命令之一，打印某个变量</li>
<li>q(uit) 退出调试</li>
<li>r(eturn) 继续执行，直到函数体返回</li>
</ul>
<p>In [14]</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#如发现环境中未安装, 可以运行下方代码来安装ipdb</span></span><br><span class="line"></span><br><span class="line">!pip install ipdb -i https://pypi.tuna.tsinghua.edu.cn/simple</span><br></pre></td></tr></table></figure>



<p>原文地址：<a href="https://aistudio.baidu.com/aistudio/projectdetail/69987">https://aistudio.baidu.com/aistudio/projectdetail/69987</a></p>
]]></content>
      <categories>
        <category>Debug</category>
        <category>AiStudio</category>
        <category>Python</category>
      </categories>
      <tags>
        <tag>centos</tag>
        <tag>PaddleOCR</tag>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>CentOS 7 修改ssh 端口</title>
    <url>/CentOS-7-Modify-sshd-port/</url>
    <content><![CDATA[<h2 id="修改-etc-ssh-sshd-config"><a href="#修改-etc-ssh-sshd-config" class="headerlink" title="修改/etc/ssh/sshd_config"></a>修改/etc/ssh/sshd_config</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">vi /etc/ssh/sshd_config</span><br><span class="line">Port 22         //这行去掉#号，防止配置不好以后不能远程登录，还得去机房修改，等修改以后的端口能使用以后在注释掉</span><br><span class="line"></span><br><span class="line">Port 33378      //下面添加这一行</span><br></pre></td></tr></table></figure>

<span id="more"></span>

<h2 id="修改firewall配置"><a href="#修改firewall配置" class="headerlink" title="修改firewall配置"></a>修改firewall配置</h2><p>firewall添加想要修改的ssh端口：</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line">添加到防火墙：</span><br><span class="line">firewall-cmd <span class="attr">--zone</span>=public --add-port=<span class="number">33378</span>/tcp --permanent (permanent是保存配置，不然下次重启以后这次修改无效)</span><br><span class="line">重启：</span><br><span class="line">firewall-cmd --reload</span><br><span class="line">查看添加端口是否成功，如果添加成功则会显示yes，否则no</span><br><span class="line">firewall-cmd <span class="attr">--zone</span>=public --query-port=<span class="number">33378</span>/tcp</span><br></pre></td></tr></table></figure>

<h2 id="修改SELinux"><a href="#修改SELinux" class="headerlink" title="修改SELinux"></a>修改SELinux</h2><p>使用以下命令查看当前SElinux 允许的ssh端口：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">semanage port -l | grep ssh</span><br></pre></td></tr></table></figure>

<p>添加33378端口到 SELinux</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">semanage port -a -t ssh_port_t -p tcp 33378</span><br></pre></td></tr></table></figure>


<p>然后确认一下是否添加进去</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">semanage port -l | grep ssh</span><br></pre></td></tr></table></figure>


<p>如果成功会输出</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ssh_port_t                    tcp    33378, 22</span><br></pre></td></tr></table></figure>

<p>重启ssh</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">systemctl restart sshd.service</span><br></pre></td></tr></table></figure>

<p>测试新端口的ssh连接<br>测试修改端口以后的ssh连接，如果成功则将step1里面的port 22 重新注释掉</p>
<p>测试新端口的ssh连接<br>测试修改端口以后的ssh连接，如果成功则将step1里面的port 22 重新注释掉</p>
<h1 id="解决CentOS7-下-SSH登录慢的问题"><a href="#解决CentOS7-下-SSH登录慢的问题" class="headerlink" title="解决CentOS7 下 SSH登录慢的问题"></a>解决CentOS7 下 SSH登录慢的问题</h1><p>登陆SSH时 输入完用户名后要等一会才能输入密码，经总结下面方案可解决此问题。</p>
<p>修改sshd_config以下两处，重启ssh即可。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> vi /etc/ssh/sshd_config</span></span><br><span class="line">GSSAPIAuthentication no</span><br><span class="line">UseDNS no</span><br></pre></td></tr></table></figure>

<p>重启 ssh</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> systemctl restart sshd</span></span><br></pre></td></tr></table></figure>



]]></content>
      <categories>
        <category>centos</category>
        <category>sshd</category>
      </categories>
      <tags>
        <tag>centos</tag>
        <tag>sshd</tag>
      </tags>
  </entry>
  <entry>
    <title>Github安装hexo博客</title>
    <url>/Blog-Hexo-Install/</url>
    <content><![CDATA[<ul>
<li><strong>写在开头</strong></li>
</ul>
<p>什么是Hexo？</p>
<blockquote>
<p>Hexo是一个轻量级的Node.js博客框架，由一位台湾的在校大学生开发完成！</p>
</blockquote>
<blockquote>
<p>Hexo的配置文件_config.yml分为两种，一种是站点配置文件，也就是站点根目录下的_config.yml配置文件，另一个是主题配置文件，位于theme文件夹中对应主题的文件夹下的_config.yml。</p>
</blockquote>
<p><strong>在后续的网站配置中需要多次使用站点配置文件和主题配置文件，需要注意辨析。</strong></p>
<span id="more"></span> 

<hr>
<h1 id="安装node-js"><a href="#安装node-js" class="headerlink" title="安装node.js"></a>安装node.js</h1><h2 id="Windows下安装"><a href="#Windows下安装" class="headerlink" title="Windows下安装"></a>Windows下安装</h2><p>在<a href="https://nodejs.org/en/">nodejs官网</a>上下载最新的Windows安装包，直接安装即可。</p>
<h2 id="ubuntu下安装"><a href="#ubuntu下安装" class="headerlink" title="ubuntu下安装"></a>ubuntu下安装</h2><h3 id="命令行方式安装："><a href="#命令行方式安装：" class="headerlink" title="命令行方式安装："></a>命令行方式安装：</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get install nodejs</span><br></pre></td></tr></table></figure>

<h3 id="编译源码方式安装："><a href="#编译源码方式安装：" class="headerlink" title="编译源码方式安装："></a>编译源码方式安装：</h3><p>在<a href="https://nodejs.org/en/">nodejs官网</a>上找到需要下载的源码（不是二进制文件），解压之后进入目录，执行：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> ./configure</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> make &amp;&amp; make install</span></span><br></pre></td></tr></table></figure>



<blockquote>
<p>注意如果需要sudo的话， make和make install 要分开，因为sudo不能传递到&amp;&amp;后面的指令。</p>
</blockquote>
<h3 id="安装npm"><a href="#安装npm" class="headerlink" title="安装npm"></a>安装npm</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get install npm</span><br></pre></td></tr></table></figure>


<p>查看node和npm版本</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">node -v</span><br><span class="line">npm -v</span><br></pre></td></tr></table></figure>



<ul>
<li>安装cnpm</li>
</ul>
<p>因为防火墙的缘故，很多境外网站被墙了，所以使用node.js的原生工具npm是无法正常安装模块的，建议使用<a href="http://npm.taobao.org/">淘宝前端组的国内镜像</a>，使用他们定制的 cnpm (gzip 压缩支持) 命令行工具代替默认的 npm:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">npm install -g cnpm --registry=https://registry.npm.taobao.org	</span><br></pre></td></tr></table></figure>


<p>使用方法如下：</p>
<p>从registry.npm.taobao.org 安装所有模块. 当安装的时候发现安装的模块还没有同步过来, 淘宝 NPM 会自动在后台进行同步, 并且会让你从官方 NPM registry.npmjs.org 进行安装. 下次你再安装这个模块的时候, 就会直接从 淘宝 NPM 安装了.</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cnpm install [name]</span><br></pre></td></tr></table></figure>



<h1 id="Hexo的安装与使用"><a href="#Hexo的安装与使用" class="headerlink" title="Hexo的安装与使用"></a>Hexo的安装与使用</h1><h2 id="安装Hexo"><a href="#安装Hexo" class="headerlink" title="安装Hexo"></a>安装Hexo</h2><p>安转了node之后，就可以使用以下命令来安装hexo：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">npm install -g hexo-cli</span><br></pre></td></tr></table></figure>

<h2 id="使用Hexo"><a href="#使用Hexo" class="headerlink" title="使用Hexo"></a>使用Hexo</h2><p>安装 Hexo 完成后，请执行下列命令，Hexo 将会在指定文件夹中新建所需要的文件。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">hexo init &lt;folder&gt;</span><br><span class="line">cd &lt;folder&gt;</span><br><span class="line">npm install</span><br></pre></td></tr></table></figure>





<p>新建完成后，指定文件夹的目录如下：</p>
<p>├── _config.yml<br>├── package.json<br>├── scaffolds<br>├── source<br> |   ├── _drafts<br> |   └── _posts<br>└── themes</p>
<blockquote>
<p>_config.yml 网站的 配置 信息</p>
</blockquote>
<p>您可以在此配置网站大部分的参数。</p>
<blockquote>
<p>package.json 应用程序的信息。EJS, Stylus 和 Markdown renderer 已默认安装，您可以自由移除。</p>
</blockquote>
<p>package.json</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;hexo-site&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;version&quot;</span>: <span class="string">&quot;0.0.0&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;private&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">&quot;hexo&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;version&quot;</span>: <span class="string">&quot;&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;dependencies&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;hexo&quot;</span>: <span class="string">&quot;^3.0.0&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;hexo-generator-archive&quot;</span>: <span class="string">&quot;^0.1.0&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;hexo-generator-category&quot;</span>: <span class="string">&quot;^0.1.0&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;hexo-generator-index&quot;</span>: <span class="string">&quot;^0.1.0&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;hexo-generator-tag&quot;</span>: <span class="string">&quot;^0.1.0&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;hexo-renderer-ejs&quot;</span>: <span class="string">&quot;^0.1.0&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;hexo-renderer-stylus&quot;</span>: <span class="string">&quot;^0.2.0&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;hexo-renderer-marked&quot;</span>: <span class="string">&quot;^0.2.4&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;hexo-server&quot;</span>: <span class="string">&quot;^0.1.2&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<blockquote>
<p>scaffolds模版 文件夹。当您新建文章时，Hexo 会根据 scaffold 来建立文件。</p>
</blockquote>
<p>Hexo的模板是指在新建的markdown文件中默认填充的内容。例如，<strong>如果您修改scaffold/post.md中的Front-matter内容，那么每次新建一篇文章时都会包含这个修改。</strong></p>
<blockquote>
<p>source资源文件夹是存放用户资源的地方。</p>
</blockquote>
<p>除 _posts 文件夹之外，开头命名为 _(下划线)的文件 / 文件夹和隐藏的文件将会被忽略。Markdown 和 HTML 文件会被解析并放到 public 文件夹，而其他文件会被拷贝过去。</p>
<blockquote>
<p>themes主题 文件夹。</p>
</blockquote>
<p>Hexo 会根据主题来生成静态页面。</p>
<hr>
<h1 id="安装hexo插件"><a href="#安装hexo插件" class="headerlink" title="安装hexo插件"></a>安装hexo插件</h1><h2 id="在hexo中实现可视化编辑博客（hexo-admin）"><a href="#在hexo中实现可视化编辑博客（hexo-admin）" class="headerlink" title="在hexo中实现可视化编辑博客（hexo-admin）"></a>在hexo中实现可视化编辑博客（hexo-admin）</h2><p><strong><a href="https://github.com/jaredly/hexo-admin">hexo-admin-github</a></strong></p>
<h3 id="安装并使用hexo-admin"><a href="#安装并使用hexo-admin" class="headerlink" title="安装并使用hexo-admin"></a>安装并使用hexo-admin</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">npm install --save hexo-admin</span><br><span class="line">hexo server -d</span><br><span class="line">open http://localhost:4000/admin/</span><br></pre></td></tr></table></figure>

<h3 id="设置后台密码"><a href="#设置后台密码" class="headerlink" title="设置后台密码"></a>设置后台密码</h3><p>修改站点配置文件，就是网站根目录下的 _config.yml文件:</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">admin:</span></span><br><span class="line">  <span class="attr">username:</span> <span class="string">myfavoritename</span></span><br><span class="line">  <span class="attr">password_hash:</span> <span class="string">be121740bf988b2225a313fa1f107ca1</span></span><br><span class="line">  <span class="attr">secret:</span> <span class="string">a</span> <span class="string">secret</span> <span class="string">something</span></span><br></pre></td></tr></table></figure>

<ul>
<li><p>username是用户名</p>
</li>
<li><p>password_hash是密码的哈希映射值，由于不同版本的node.js的哈希算法是不一样的，所有用以下方法来产生有效的密码哈希值。</p>
</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash">  node</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> const bcrypt = require(<span class="string">&#x27;bcrypt-nodejs&#x27;</span>)</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> bcrypt.hashSync(<span class="string">&#x27;your password secret here!&#x27;</span>)</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> //=&gt; <span class="string">&#x27;2a10$8f0CO288aEgpb0BQk0mAEOIDwPS.s6nl703xL6PLTVzM.758x8xsi&#x27;</span></span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> </span></span><br></pre></td></tr></table></figure>

<ul>
<li>secret是用于产生cookie值的。</li>
</ul>
<p>在站点配置文件中设置好以下三个值之后，登录 <a href="http://localhost:4000/admin/">http://localhost:4000/admin/</a> 就会提示输入账号密码。</p>
<h2 id="在hexo中实现RRS功能（-hexo-generator-feed-）"><a href="#在hexo中实现RRS功能（-hexo-generator-feed-）" class="headerlink" title="在hexo中实现RRS功能（ hexo-generator-feed ）"></a>在hexo中实现RRS功能（<a href="https://github.com/hexojs/hexo-generator-feed"> hexo-generator-feed </a>）</h2><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">npm install hexo-generator-feed --save</span><br></pre></td></tr></table></figure>



<h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><p>在网站的根目中的_config.yml文件设置</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">feed:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">atom</span></span><br><span class="line">  <span class="attr">path:</span> <span class="string">atom.xml</span></span><br><span class="line">  <span class="attr">limit:</span> <span class="number">20</span></span><br><span class="line">  <span class="attr">hub:</span></span><br><span class="line">  <span class="attr">content:</span></span><br></pre></td></tr></table></figure>



<p>type - Feed type. (atom/rss2) <br>path - Feed path. (Default: atom.xml/rss2.xml) <br>limit - Maximum number of posts in the feed (Use 0 or false to show all posts) <br>hub - URL of the PubSubHubbub hubs (Leave it empty if you don’t use it) <br>content - (optional) set to ‘true’ to include the contents of the entire post in the feed.</p>
<h2 id="在hexo中实现本地搜索功能（hexo-generator-searchdb）"><a href="#在hexo中实现本地搜索功能（hexo-generator-searchdb）" class="headerlink" title="在hexo中实现本地搜索功能（hexo-generator-searchdb）"></a>在hexo中实现本地搜索功能（<a href="https://github.com/PaicHyperionDev/hexo-generator-search">hexo-generator-searchdb</a>）</h2><p>安装 hexo-generator-searchdb，在站点的根目录下执行以下命令：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">npm install hexo-generator-searchdb --save</span><br></pre></td></tr></table></figure>

<p>编辑 站点配置文件，新增以下内容到任意位置：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">search:</span><br><span class="line">  path: search.xml</span><br><span class="line">  field: post</span><br><span class="line">  format: html</span><br><span class="line">  limit: 10000</span><br></pre></td></tr></table></figure>



<p>除了安装本地搜索，还可以考虑 <em>* <a href="https://swiftype.com/">swiftype</a> *</em> 的搜索。</p>
<hr>
<h1 id="更换hexo主题"><a href="#更换hexo主题" class="headerlink" title="更换hexo主题"></a>更换hexo主题</h1><p>Hexo有很多主题，可以在 _* <a href="https://hexo.io/themes/">Hexo官网的主题页面</a> <em>_选择自己喜欢。 <br>以</em>*<a href="http://theme-next.iissnan.com/">Next</a>**为例，本站使用的就是Next主题。</p>
<blockquote>
<p>使用Git来获取主题文件</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git clone https://github.com/iissnan/hexo-theme-next themes/next</span><br></pre></td></tr></table></figure>


<blockquote>
<p>直接在Next的 <strong><a href="https://github.com/iissnan/hexo-theme-next">GitHub主页</a></strong> 下载主题文件</p>
</blockquote>
<p>将Next文件夹放到theme文件夹中，修改站点配置文件，也就是网站根目录下的_config.yml文件中的theme：</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Extensions</span></span><br><span class="line"><span class="comment">## Plugins: https://hexo.io/plugins/</span></span><br><span class="line"><span class="comment">## Themes: https://hexo.io/themes/</span></span><br><span class="line"><span class="attr">theme:</span> <span class="string">next</span></span><br></pre></td></tr></table></figure>

<h2 id="上传到github"><a href="#上传到github" class="headerlink" title="上传到github"></a>上传到github</h2><p>如果你一切都配置好了，发布上传很容易，一句<code>hexo d</code>就搞定，当然关键还是你要把所有东西配置好。</p>
<p>首先，<code>ssh key</code>肯定要配置好。</p>
<p>创建SSH<br>在gitbash中输入：<code>ssh-keygen -t rsa -C &quot;youremail@example.com</code>，生成ssh。然后按下面的方式找到<code>id_rsa.pub</code>文件的内容。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">cd</span> ~/.ssh/</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> ls</span></span><br><span class="line">id_rsa  id_rsa.pub  known_hosts</span><br><span class="line"><span class="meta">$</span><span class="bash"> cat id_rsa.pub</span></span><br><span class="line">ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQC0avsgprEOmpE1yVnbU4hjireV3Ozxb5vFLl4KXgkVY9X3O78E5y10rSa9CHs4lFao/Gij3G/VuXAC/id0pY7ti/BD6CmY8etFlZun9Zw+7Z41gRRrFxreXGwFhzfJeu6CVGYSQgPMjgu1TCCO9wM1hwU41T/Nof3F2kDlRn0pxvmIAkGNy/E8dtB9alY7ObNyrMuACZX8k42STttlte6MlelBVckFyks5IwQ+WdBc0giZTlfXbrL455HiEXitN20FQDznFoX96+iBlAa/WTE2fqVlKY22t5rmyU//JQkFG9ttxAOinADzTLskysE3eWaiupvA0gAjRc4rr8Sg83gJ huangkuier@gmail.com</span><br></pre></td></tr></table></figure>

<p>把<code>id_rsa.pub</code>文件的内容添加到github的ssh key中。</p>
<p>其次，配置<code>_config.yml</code>中有关deploy的部分：</p>
<p>正确写法：</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">deploy:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">git</span></span><br><span class="line">  <span class="attr">repository:</span> <span class="string">git@github.com:hunkier/hunkier.github.io.git</span></span><br><span class="line">  <span class="attr">branch:</span> <span class="string">master</span></span><br></pre></td></tr></table></figure>

<p>错误写法：</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">deploy:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">github</span></span><br><span class="line">  <span class="attr">repository:</span> <span class="string">https://github.com/hunkier/hunkier.github.io.git</span></span><br><span class="line">  <span class="attr">branch:</span> <span class="string">master</span></span><br></pre></td></tr></table></figure>

<p>后面一种写法是hexo2.x的写法，现在已经不行了，无论是哪种写法，此时直接执行<code>hexo d</code>的话一般会报如下错误：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">Deployer not found: github 或者 Deployer not found: git</span><br></pre></td></tr></table></figure>

<p>原因是还需要安装一个插件：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">npm install hexo-deployer-git --save</span><br></pre></td></tr></table></figure>

<p>其它命令不确定，部署这个命令一定要用git bash，否则会提示<code>Permission denied (publickey).</code></p>
<p>打开你的git bash，输入<code>hexo d</code>就会将本次有改动的代码全部提交，没有改动的不会：</p>
<h2 id="常用hexo命令"><a href="#常用hexo命令" class="headerlink" title="常用hexo命令"></a>常用hexo命令</h2><p>常见命令</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">hexo new &quot;postName&quot; #新建文章</span><br><span class="line">hexo new page &quot;pageName&quot; #新建页面</span><br><span class="line">hexo generate #生成静态页面至public目录</span><br><span class="line">hexo server #开启预览访问端口（默认端口4000，&#x27;ctrl + c&#x27;关闭server）</span><br><span class="line">hexo deploy #部署到GitHub</span><br><span class="line">hexo help  # 查看帮助</span><br><span class="line">hexo version  #查看Hexo的版本</span><br></pre></td></tr></table></figure>

<p>缩写：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">hexo n == hexo new</span><br><span class="line">hexo g == hexo generate</span><br><span class="line">hexo s == hexo server</span><br><span class="line">hexo d == hexo deploy</span><br></pre></td></tr></table></figure>

<p>组合命令：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">hexo s -g #生成并本地预览</span><br><span class="line">hexo d -g #生成并上传</span><br></pre></td></tr></table></figure>

<p>使用其他端口命令：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">hexo s -p 5000</span><br><span class="line">(node:13224) [DEP0061] DeprecationWarning: fs.SyncWriteStream is deprecated.</span><br><span class="line">INFO  Start processing</span><br><span class="line">INFO  Hexo is running at http://localhost:5000/.</span><br></pre></td></tr></table></figure>

<h2 id="4-11-config-yml"><a href="#4-11-config-yml" class="headerlink" title="4.11. _config.yml"></a>4.11. _config.yml</h2><p>这里面都是一些全局配置，每个参数的意思都比较简单明了，所以就不作详细介绍了。</p>
<p>需要特别注意的地方是，冒号后面必须有一个空格，否则可能会出问题。</p>
<h2 id="4-12-写博客"><a href="#4-12-写博客" class="headerlink" title="4.12. 写博客"></a>4.12. 写博客</h2><p>定位到我们的hexo根目录，执行命令：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">hexo new &#x27;my-first-blog&#x27;</span><br></pre></td></tr></table></figure>

<p>hexo会帮我们在<code>_posts</code>下生成相关md文件</p>
<p>当然你也可以直接自己新建md文件，用这个命令的好处是帮我们自动生成了时间。</p>
<p>一般完整格式如下：</p>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">---</span><br><span class="line">title: postName #文章页面上的显示名称，一般是中文</span><br><span class="line">date: 2013-12-02 15:30:16 #文章生成时间，一般不改，当然也可以任意修改</span><br><span class="line">categories: 默认分类 #分类</span><br><span class="line">tags: [tag1,tag2,tag3] #文章标签，可空，多标签请用格式，注意:后面有个空格</span><br><span class="line"><span class="section">description: 附加一段文章摘要，字数最好在140字以内，会出现在meta的description里面</span></span><br><span class="line"><span class="section">---</span></span><br><span class="line"></span><br><span class="line">以下是正文</span><br></pre></td></tr></table></figure>

<p>那么<code>hexo new page &#39;postName&#39;</code>命令和<code>hexo new &#39;postName&#39;</code>有什么区别呢？</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">hexo new page &quot;my-second-blog&quot;</span><br></pre></td></tr></table></figure>



<p>最终部署时生成：<code>hexo\public\my-second-blog\index.html</code>，但是它不会作为文章出现在博文目录。</p>
<h3 id="写博客工具"><a href="#写博客工具" class="headerlink" title="写博客工具"></a>写博客工具</h3><p>那么用什么工具写博客呢？这个我还没去找，以前自己使用editor.md简单弄了个，大家有好用的hexo写博客工具可以推荐个。</p>
<p><a href="https://www.typora.io/">https://www.typora.io</a></p>
<h3 id="如何让博文列表不显示全部内容"><a href="#如何让博文列表不显示全部内容" class="headerlink" title="如何让博文列表不显示全部内容"></a>如何让博文列表不显示全部内容</h3><p>默认情况下，生成的博文目录会显示全部的文章内容，如何设置文章摘要的长度呢？</p>
<p>答案是在合适的位置加上<code>&lt;!--more--&gt;</code>即可，例如：</p>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line"><span class="section"># 前言</span></span><br><span class="line"></span><br><span class="line">使用github pages服务搭建博客的好处有：</span><br><span class="line"></span><br><span class="line"><span class="bullet">1.</span> 全是静态文件，访问速度快；</span><br><span class="line"><span class="bullet">2.</span> 免费方便，不用花一分钱就可以搭建一个自由的个人博客，不需要服务器不需要后台；</span><br><span class="line"><span class="bullet">3.</span> 可以随意绑定自己的域名，不仔细看的话根本看不出来你的网站是基于github的；</span><br><span class="line"></span><br><span class="line">&lt;!--more--&gt;</span><br><span class="line"></span><br><span class="line"><span class="bullet">4.</span> 数据绝对安全，基于github的版本管理，想恢复到哪个历史版本都行；</span><br><span class="line"><span class="bullet">5.</span> 博客内容可以轻松打包、转移、发布到其它平台；</span><br><span class="line"><span class="bullet">6.</span> 等等；</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>github</category>
        <category>blog</category>
        <category>hexo</category>
      </categories>
      <tags>
        <tag>github</tag>
        <tag>blog</tag>
        <tag>hexo</tag>
      </tags>
  </entry>
  <entry>
    <title>CentOS 7 设置DNS服务器</title>
    <url>/CentOS-7-Seting-DNS-Server/</url>
    <content><![CDATA[<p>CentOS 7需要使用全新的命令行工具 nmcli 来设置</p>
<h5 id="显示当前网络连接"><a href="#显示当前网络连接" class="headerlink" title="显示当前网络连接"></a>显示当前网络连接</h5><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@bogon ~]# nmcli connection show</span><br><span class="line">NAME     UUID                                  TYPE      DEVICE</span><br><span class="line">cni0     b2b8f5f9-acd2-42fd-9ec9-a76282425cd9  bridge    cni0</span><br><span class="line">docker0  33ebd49e-fd1b-4a2c-8261-c0463f4f4146  bridge    docker0</span><br><span class="line">enp2s0   b6579214-0ba6-4bf0-9319-2e0e4f584afd  ethernet  enp2s0</span><br><span class="line">virbr0   976717ae-c3ae-4582-aa09-039c26bef80d  bridge    virbr0</span><br></pre></td></tr></table></figure>

<span id="more"></span>

<h5 id="修改当前网络连接对应的DNS服务器，这里的网络连接可以用名称或者UUID来标识"><a href="#修改当前网络连接对应的DNS服务器，这里的网络连接可以用名称或者UUID来标识" class="headerlink" title="修改当前网络连接对应的DNS服务器，这里的网络连接可以用名称或者UUID来标识"></a>修改当前网络连接对应的DNS服务器，这里的网络连接可以用名称或者UUID来标识</h5><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@bogon ~]# nmcli con mod enp2s0  ipv4.dns &quot;114.114.114.114 8.8.8.8&quot;</span><br><span class="line">[root@bogon ~]#</span><br></pre></td></tr></table></figure>

<h5 id="将dns配置生效"><a href="#将dns配置生效" class="headerlink" title="将dns配置生效"></a>将dns配置生效</h5><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@bogon ~]# nmcli con up enp2s0</span><br><span class="line">Connection successfully activated (D-Bus active path: /org/freedesktop/NetworkManager/ActiveConnection/7)</span><br></pre></td></tr></table></figure>

<h5 id="测试网络"><a href="#测试网络" class="headerlink" title="测试网络"></a>测试网络</h5><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@bogon ~]# ping www.baidu.com</span><br><span class="line">PING www.a.shifen.com (14.215.177.39) 56(84) bytes of data.</span><br><span class="line">64 bytes from 14.215.177.39 (14.215.177.39): icmp_seq=1 ttl=53 time=5.48 ms</span><br><span class="line">64 bytes from 14.215.177.39 (14.215.177.39): icmp_seq=2 ttl=53 time=5.60 ms</span><br><span class="line">64 bytes from 14.215.177.39 (14.215.177.39): icmp_seq=3 ttl=53 time=5.48 ms</span><br><span class="line">64 bytes from 14.215.177.39 (14.215.177.39): icmp_seq=4 ttl=53 time=8.57 ms</span><br><span class="line">64 bytes from 14.215.177.39 (14.215.177.39): icmp_seq=5 ttl=53 time=5.54 ms</span><br><span class="line">^C</span><br><span class="line">--- www.a.shifen.com ping statistics ---</span><br><span class="line">5 packets transmitted, 5 received, 0% packet loss, time 4005ms</span><br><span class="line">rtt min/avg/max/mdev = 5.485/6.138/8.575/1.222 ms</span><br><span class="line">[root@bogon ~]#</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>centos</category>
        <category>linux</category>
      </categories>
      <tags>
        <tag>centos</tag>
        <tag>DNS</tag>
      </tags>
  </entry>
  <entry>
    <title>CentOS  firewall添加开放端口</title>
    <url>/CentOS-7-firewall/</url>
    <content><![CDATA[<p>添加</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">firewall-cmd --zone=public --add-port=80/tcp --permanent  </span><br></pre></td></tr></table></figure>


<p>  （ <code>–permanent</code> 永久生效，没有此参数重启后失效）</p>
<p>查看</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">firewall-cmd --zone=public --query-port=80/tcp</span><br></pre></td></tr></table></figure>

<p>删除</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">firewall-cmd --zone=public --remove-port=80/tcp --permanent</span><br></pre></td></tr></table></figure>

<p>重新载入</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">firewall-cmd --reload</span><br></pre></td></tr></table></figure>

<span id="more"></span>

<p>1、firewalld的基本使用</p>
<p>启动： <code>systemctl start firewalld</code></p>
<p>查看状态： <code>systemctl status firewalld</code></p>
<p>停止： <code>systemctl disable firewalld</code></p>
<p>禁用： <code>systemctl stop firewalld</code></p>
<p>2.<code>systemctl</code>是 <code>CentOS 7</code> 的服务管理工具中主要的工具，它融合之前 <code>service</code> 和 <code>chkconfig</code> 的功能于一体。</p>
<p>启动一个服务：<code>systemctl start firewalld.service</code><br>关闭一个服务：<code>systemctl stop firewalld.service</code><br>重启一个服务：<code>systemctl restart firewalld.service</code><br>显示一个服务的状态：<code>systemctl status firewalld.service</code><br>在开机时启用一个服务：<code>systemctl enable firewalld.service</code><br>在开机时禁用一个服务：<code>systemctl disable firewalld.service</code><br>查看服务是否开机启动：<code>systemctl is-enabled firewalld.service</code><br>查看已启动的服务列表：<code>systemctl list-unit-files|grep enabled</code><br>查看启动失败的服务列表：<code>systemctl --failed</code></p>
<p>3.配置firewalld-cmd</p>
<p>查看版本： <code>firewall-cmd --version</code></p>
<p>查看帮助： <code>firewall-cmd --help</code></p>
<p>显示状态： <code>firewall-cmd --state</code></p>
<p>查看所有打开的端口： <code>firewall-cmd --zone=public --list-ports</code></p>
<p>更新防火墙规则： <code>firewall-cmd --reload</code></p>
<p>查看区域信息:  <code>firewall-cmd --get-active-zones</code></p>
<p>查看指定接口所属区域： <code>firewall-cmd --get-zone-of-interface=eth0</code></p>
<p>拒绝所有包：<code>firewall-cmd --panic-on</code></p>
<p>取消拒绝状态： <code>firewall-cmd --panic-off</code></p>
<p>查看是否拒绝： <code>firewall-cmd --query-panic</code></p>
<p>那怎么开启一个端口呢<br>接下来通过以下命令开放http 80 端口：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo firewall-cmd --add-service=http --permanent</span><br><span class="line">sudo firewall-cmd --add-port=80/tcp --permanent</span><br></pre></td></tr></table></figure>


<p>命令末尾的 <code>—permanent</code> 表示用久有效，不加这句的话重启后刚才开放的端口就又失效了。</p>
<p>然后重启防火墙：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo firewall-cmd --reload</span><br></pre></td></tr></table></figure>


<p>再次查看端口的开放情况：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo firewall-cmd --list-all</span><br></pre></td></tr></table></figure>

<p>查看</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">firewall-cmd --zone=public --query-service=http</span><br><span class="line">firewall-cmd --zone=public --query-port=80/tcp</span><br></pre></td></tr></table></figure>

<p>删除</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">firewall-cmd --zone=public --remove-service=http --permanent</span><br><span class="line">firewall-cmd --zone=public --remove-port=80/tcp --permanent</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>centos firewall</category>
      </categories>
      <tags>
        <tag>centos firewall</tag>
      </tags>
  </entry>
  <entry>
    <title>CentOS 7 安装 go-fastdfs</title>
    <url>/CentOS-7-install-GoFastdfs/</url>
    <content><![CDATA[<p>CentOS 7 安装go-fastdfs文件服务</p>
<p>参照官网描述（<a href="https://github.com/sjqzhang/go-fastdfs">https://github.com/sjqzhang/go-fastdfs</a>），linux下go-fastdfs安装步骤如下：</p>
 <span id="more"></span>

<h1 id="下载文件"><a href="#下载文件" class="headerlink" title="下载文件"></a>下载文件</h1><h2 id="下载相关文件并赋予执行权限"><a href="#下载相关文件并赋予执行权限" class="headerlink" title="下载相关文件并赋予执行权限"></a>下载相关文件并赋予执行权限</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> wget https://github.com/sjqzhang/go-fastdfs/releases/download/v1.3.0/fileserver</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> wget  https://raw.githubusercontent.com/sjqzhang/go-fastdfs/master/control</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> chmod 755 fileserver</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> chmod 755 control</span></span><br></pre></td></tr></table></figure>

<h1 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h1><p>启动/停止/重启/查看状态/查看日志 <code>./control start|stop|restart|status|tail</code></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ ./control start</span><br><span class="line">fileserver started..., pid=20599</span><br><span class="line">$ ./control status</span><br><span class="line">fileserver now is running, pid=1080</span><br><span class="line">$ ./control stop</span><br><span class="line">fileserver stoped...</span><br><span class="line">$ ./control tail</span><br><span class="line">Listen on :28088</span><br></pre></td></tr></table></figure>

<h1 id="测试上传"><a href="#测试上传" class="headerlink" title="测试上传"></a>测试上传</h1><h2 id="启动后可以使用命令体验上传"><a href="#启动后可以使用命令体验上传" class="headerlink" title="启动后可以使用命令体验上传"></a>启动后可以使用命令体验上传</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">curl -F file=@http-index-fs http://10.1.xx.60:8080/upload</span><br></pre></td></tr></table></figure>

<h2 id="web上传"><a href="#web上传" class="headerlink" title="web上传"></a>web上传</h2><p>使用浏览器打开<code>http://yourserver ip:8080/upload.html</code>，注意不要使用<code>127.0.0.1</code>上传</p>
<h1 id="修改配置"><a href="#修改配置" class="headerlink" title="修改配置"></a>修改配置</h1><p>在<code>fileserver</code>同目录下会自动生成配置文件，存放在 <code>conf/cfg.json</code>，需要修改几个参数，其他参数按需求修改。</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line">&quot;绑定端号&quot;: &quot;端口&quot;,</span><br><span class="line">&quot;addr&quot;: &quot;:28088&quot;,</span><br><span class="line">&quot;本主机地址&quot;: &quot;本机http地址,默认自动生成(注意端口必须与addr中的端口一致），必段为内网，自动生成不为内网请自行修改，下同&quot;,</span><br><span class="line">&quot;host&quot;: &quot;http://172.20.8.31:28088&quot;,</span><br><span class="line">&quot;集群&quot;: &quot;集群列表,注意为了高可用，IP必须不能是同一个,同一不会自动备份，且不能为127.0.0.1,且必须为内网IP，默认自动生成&quot;,</span><br><span class="line">&quot;peers&quot;: <span class="section">[&quot;http://172.20.8.31:28088&quot;]</span>,</span><br><span class="line">&quot;是否自动重命名&quot;: &quot;默认不自动重命名,使用原文件名&quot;,</span><br><span class="line">&quot;rename_file&quot;: true,</span><br><span class="line">&quot;下载域名&quot;: &quot;用于外网下载文件的域名,不包含http://&quot;,</span><br><span class="line">&quot;download_domain&quot;: &quot;172.20.8.31:28088&quot;,</span><br></pre></td></tr></table></figure>

<p>修改完后需要重启服务</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> ./control restart</span></span><br><span class="line">fileserver stoped...</span><br><span class="line">fileserver started..., pid=21038</span><br></pre></td></tr></table></figure>

<p>测试文件上传</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> curl -F file=@test.jpeg http://172.20.8.31:28088/upload</span></span><br><span class="line">http://172.20.8.31:28088/group1/default/20190604/16/22/6/7d6ef01d71af04dc61cb388955478121.jpeg#   </span><br></pre></td></tr></table></figure>



<h1 id="加入系统服务"><a href="#加入系统服务" class="headerlink" title="加入系统服务"></a>加入系统服务</h1><p>新建文件<code>gofastdfs</code></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">vi  /etc/rc.d/init.d/gofastdfs</span><br></pre></td></tr></table></figure>

<p>文件内容为</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/sh</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> chkconfig: 2345 80 90</span>  </span><br><span class="line"><span class="meta">#</span><span class="bash"></span></span><br><span class="line"><span class="bash"><span class="comment"># Simple go-fastdfs init.d script conceived to work on Linux systems</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> as it does use of the /proc filesystem.</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">## BEGIN INIT INFO</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Provides:     gofastdfs_28088</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Default-Start:        2 3 4 5</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Default-Stop:         0 1 6</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Short-Description:    go-fastdfs file server</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Description:          go-fastdfs file  server. See https://github.com/sjqzhang/go-fastdfs</span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">## END INIT INFO</span></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> WORKSPACE=$(<span class="built_in">cd</span> $(dirname <span class="variable">$0</span>)/; <span class="built_in">pwd</span>)</span></span><br><span class="line">WORKSPACE=/data1/webserver/gofastdfs/</span><br><span class="line">cd $WORKSPACE</span><br><span class="line"></span><br><span class="line">mkdir -p log conf</span><br><span class="line"></span><br><span class="line">module=</span><br><span class="line">app=fileserver</span><br><span class="line">conf=conf/cfg.json</span><br><span class="line">pidfile=conf/app.pid</span><br><span class="line">logfile=log/app.log</span><br><span class="line"></span><br><span class="line">function check_pid() &#123;</span><br><span class="line">    if [ -f $pidfile ];then</span><br><span class="line">        pid=`cat $pidfile`</span><br><span class="line">        if [ -n $pid ]; then</span><br><span class="line">            running=`ps -p $pid|grep -v &quot;PID TTY&quot; |wc -l`</span><br><span class="line">            return $running</span><br><span class="line">        fi</span><br><span class="line">    fi</span><br><span class="line">    return 0</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function start() &#123;</span><br><span class="line">    check_pid</span><br><span class="line">    running=$?</span><br><span class="line">    if [ $running -gt 0 ];then</span><br><span class="line">        echo -n &quot;$app now is running already, pid=&quot;</span><br><span class="line">        cat $pidfile</span><br><span class="line">        return 1</span><br><span class="line">    fi</span><br><span class="line"></span><br><span class="line">    nohup ./$app   &amp;&gt; $logfile &amp;</span><br><span class="line">    echo $! &gt; $pidfile</span><br><span class="line">    echo &quot;$app started..., pid=$!&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function stop() &#123;</span><br><span class="line">    pid=`cat $pidfile`</span><br><span class="line">    kill $pid</span><br><span class="line">    echo &quot;$app stoped...&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function restart() &#123;</span><br><span class="line">    stop</span><br><span class="line">    sleep 1</span><br><span class="line">    start</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function status() &#123;</span><br><span class="line">    check_pid</span><br><span class="line">    running=$?</span><br><span class="line">    if [ $running -gt 0 ];then</span><br><span class="line">        echo -n &quot;$app now is running, pid=&quot;</span><br><span class="line">        cat $pidfile</span><br><span class="line">    else</span><br><span class="line">        echo &quot;$app is stoped&quot;</span><br><span class="line">    fi</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function tailf() &#123;</span><br><span class="line">    tail -f $logfile</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function build() &#123;</span><br><span class="line">    go build</span><br><span class="line">    if [ $? -ne 0 ]; then</span><br><span class="line">        exit $?</span><br><span class="line">    fi</span><br><span class="line">    mv $module $app</span><br><span class="line">    ./$app -v | grep -v &quot;config&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function pack() &#123;</span><br><span class="line">    build</span><br><span class="line">    git log -1 --pretty=%h &gt; gitversion</span><br><span class="line">    version=`./$app -v|grep -v config`</span><br><span class="line">    file_list=&quot;control cfg.example.json $app&quot;</span><br><span class="line">    tar zcf $app-$version.tar.gz gitversion $file_list</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function packbin() &#123;</span><br><span class="line">    build</span><br><span class="line">    git log -1 --pretty=%h &gt; gitversion</span><br><span class="line">    version=`./$app -v|grep -v config`</span><br><span class="line">    tar zcvf $app-bin-$version.tar.gz $app gitversion</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function help() &#123;</span><br><span class="line">    echo &quot;$0 start|stop|restart|status|tail&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">if [ &quot;$1&quot; == &quot;&quot; ]; then</span><br><span class="line">    help</span><br><span class="line">elif [ &quot;$1&quot; == &quot;stop&quot; ];then</span><br><span class="line">    stop</span><br><span class="line">elif [ &quot;$1&quot; == &quot;start&quot; ];then</span><br><span class="line">    start</span><br><span class="line">elif [ &quot;$1&quot; == &quot;restart&quot; ];then</span><br><span class="line">    restart</span><br><span class="line">elif [ &quot;$1&quot; == &quot;status&quot; ];then</span><br><span class="line">    status</span><br><span class="line">elif [ &quot;$1&quot; == &quot;tail&quot; ];then</span><br><span class="line">    tailf</span><br><span class="line">else</span><br><span class="line">    help</span><br><span class="line">fi</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>修改文件权限</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">chmod 755 /etc/rc.d/init.d/gofastdfs</span><br></pre></td></tr></table></figure>

<p>设置开机启动</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">chkconfig gofastdfs on</span><br></pre></td></tr></table></figure>

<p>启动、停止、重启、查看状态等命令</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">service gofastdfs start/stop/restart/status/tail</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>centos</category>
        <category>go-fastdfs</category>
      </categories>
      <tags>
        <tag>centos</tag>
        <tag>go-fastdfs</tag>
      </tags>
  </entry>
  <entry>
    <title>CentOS 7 安装 Nginx</title>
    <url>/CentOS-7-install-Nginx/</url>
    <content><![CDATA[<h1 id="安装所需环境"><a href="#安装所需环境" class="headerlink" title="安装所需环境"></a>安装所需环境</h1><p>Nginx 是 C语言 开发，建议在 Linux 上运行，当然，也可以安装 Windows 版本，本篇则使用 CentOS 7 作为安装环境。</p>
 <span id="more"></span>

<h2 id="一-gcc-安装"><a href="#一-gcc-安装" class="headerlink" title="一. gcc 安装"></a>一. gcc 安装</h2><p>安装 nginx 需要先将官网下载的源码进行编译，编译依赖 gcc 环境，如果没有 gcc 环境，则需要安装：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">yum install gcc-c++</span><br></pre></td></tr></table></figure>

<h2 id="二-PCRE-pcre-devel-安装"><a href="#二-PCRE-pcre-devel-安装" class="headerlink" title="二. PCRE pcre-devel 安装"></a>二. PCRE pcre-devel 安装</h2><p>PCRE(Perl Compatible Regular Expressions) 是一个Perl库，包括 perl 兼容的正则表达式库。nginx 的 http 模块使用 pcre 来解析正则表达式，所以需要在 linux 上安装 pcre 库，pcre-devel 是使用 pcre 开发的一个二次开发库。nginx也需要此库。命令：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">yum install -y pcre pcre-devel</span><br></pre></td></tr></table></figure>

<h2 id="三-zlib-安装"><a href="#三-zlib-安装" class="headerlink" title="三. zlib 安装"></a>三. zlib 安装</h2><p>zlib 库提供了很多种压缩和解压缩的方式， nginx 使用 zlib 对 http 包的内容进行 gzip ，所以需要在 Centos 上安装 zlib 库。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">yum install -y zlib zlib-devel</span><br></pre></td></tr></table></figure>

<h2 id="四-OpenSSL-安装"><a href="#四-OpenSSL-安装" class="headerlink" title="四. OpenSSL 安装"></a>四. OpenSSL 安装</h2><p>OpenSSL 是一个强大的安全套接字层密码库，囊括主要的密码算法、常用的密钥和证书封装管理功能及 SSL 协议，并提供丰富的应用程序供测试或其它目的使用。<br>nginx 不仅支持 http 协议，还支持 https（即在ssl协议上传输http），所以需要在 Centos 安装 OpenSSL 库。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">yum install -y openssl openssl-devel</span><br></pre></td></tr></table></figure>

<p>所有工具和依赖一起安装</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">yum install -y openssl openssl-devel zlib zlib-devel pcre pcre-devel gcc-c++</span><br></pre></td></tr></table></figure>

<h3 id="官网下载"><a href="#官网下载" class="headerlink" title="官网下载"></a>官网下载</h3><ol>
<li><p>直接下载<code>.tar.gz</code>安装包，地址：<a href="https://nginx.org/en/download.html">https://nginx.org/en/download.html</a></p>
</li>
<li><p>使用<code>wget</code>命令下载（推荐）。确保系统已经安装了wget，如果没有安装，执行 yum install wget 安装。</p>
</li>
</ol>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">wget -c https://nginx.org/download/nginx-1.15.12.tar.gz</span><br></pre></td></tr></table></figure>

<p>我下载的是1.12.0版本，这个是目前的稳定版。</p>
<h2 id="解压"><a href="#解压" class="headerlink" title="解压"></a>解压</h2><p>依然是直接命令：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">tar -zxvf nginx-1.15.12.tar.gz</span><br><span class="line">cd nginx-1.15.12</span><br></pre></td></tr></table></figure>

<h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2><p>其实在 nginx-1.15.12 版本中你就不需要去配置相关东西，默认就可以了。当然，如果你要自己配置目录也是可以的。</p>
<ol>
<li>使用默认配置</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">./configure</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>自定义配置（不推荐）</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">./configure \</span><br><span class="line">--prefix=/usr/<span class="built_in">local</span>/nginx \</span><br><span class="line">--conf-path=/usr/<span class="built_in">local</span>/nginx/conf/nginx.conf \</span><br><span class="line">--pid-path=/usr/<span class="built_in">local</span>/nginx/conf/nginx.pid \</span><br><span class="line">--lock-path=/var/lock/nginx.lock \</span><br><span class="line">--error-log-path=/var/<span class="built_in">log</span>/nginx/error.log \</span><br><span class="line">--http-log-path=/var/<span class="built_in">log</span>/nginx/access.log \</span><br><span class="line">--with-http_gzip_static_module \</span><br><span class="line">--with-http_ssl_module \</span><br><span class="line">--with-stream \</span><br><span class="line">--http-client-body-temp-path=/var/temp/nginx/client \</span><br><span class="line">--http-proxy-temp-path=/var/temp/nginx/proxy \</span><br><span class="line">--http-fastcgi-temp-path=/var/temp/nginx/fastcgi \</span><br><span class="line">--http-uwsgi-temp-path=/var/temp/nginx/uwsgi \</span><br><span class="line">--http-scgi-temp-path=/var/temp/nginx/scgi</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注：将临时文件目录指定为<code>/var/temp/nginx</code>，需要在/var下创建temp及nginx目录</p>
</blockquote>
<h3 id="编译安装"><a href="#编译安装" class="headerlink" title="编译安装"></a>编译安装</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">make</span><br><span class="line">make install</span><br></pre></td></tr></table></figure>

<p>查找安装路径：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">whereis nginx</span><br></pre></td></tr></table></figure>

<h3 id="启动、停止nginx"><a href="#启动、停止nginx" class="headerlink" title="启动、停止nginx"></a>启动、停止nginx</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> /usr/<span class="built_in">local</span>/nginx/sbin/</span><br><span class="line">./nginx </span><br><span class="line">./nginx -s stop</span><br><span class="line">./nginx -s quit</span><br><span class="line">./nginx -s reload</span><br><span class="line">启动时报80端口被占用:</span><br><span class="line">nginx: [emerg] <span class="built_in">bind</span>() to 0.0.0.0:80 failed (98: Address already <span class="keyword">in</span> use)</span><br></pre></td></tr></table></figure>

<p>解决办法，查看占用端口的进程</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">➜  ~ lsof -i:80</span><br><span class="line">COMMAND  PID USER   FD   TYPE DEVICE SIZE/OFF NODE NAME</span><br><span class="line">nginx   4214 root    6u  IPv4  46826      0t0  TCP *:http (LISTEN)</span><br><span class="line">nginx   4216 root    6u  IPv4  46826      0t0  TCP *:http (LISTEN)</span><br><span class="line">➜  ~ ps -ef|grep nginx</span><br><span class="line">root       4214      1  0 4月27 ?       00:00:00 nginx: master process /usr/bin/nginx</span><br><span class="line">root       4216   4214  0 4月27 ?       00:00:00 nginx: worker process</span><br><span class="line">root     122099 121530  0 22:06 pts/0    00:00:00 grep --color=auto --exclude-dir=.bzr --exclude-dir=CVS --exclude-dir=.git --exclude-dir=.hg --exclude-dir=.svn nginx</span><br><span class="line">➜  ~ </span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>./nginx -s quit</code>:此方式停止步骤是待nginx进程处理任务完毕进行停止。<br><code>./nginx -s stop</code>:此方式相当于先查出nginx进程id再使用kill命令强制杀掉进程。</p>
</blockquote>
<p>查询nginx进程：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ps aux|grep nginx</span><br></pre></td></tr></table></figure>

<h3 id="重启-nginx"><a href="#重启-nginx" class="headerlink" title="重启 nginx"></a>重启 nginx</h3><p>1.先停止再启动（推荐）：<br>对 nginx 进行重启相当于先停止再启动，即先执行停止命令再执行启动命令。如下：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">./nginx -s quit</span><br><span class="line">./nginx</span><br></pre></td></tr></table></figure>

<p>2.重新加载配置文件：<br>当 ngin x的配置文件 nginx.conf 修改后，要想让配置生效需要重启 nginx，使用<code>-s reload</code>不用先停止 ngin x再启动 nginx 即可将配置信息在 nginx 中生效，如下：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">./nginx -s reload</span><br></pre></td></tr></table></figure>

<p>启动成功后，在浏览器可以打开页面了</p>
<h3 id="开机自启动"><a href="#开机自启动" class="headerlink" title="开机自启动"></a>开机自启动</h3><p>即在<code>rc.local</code>增加启动代码就可以了。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">vi /etc/rc.local</span><br></pre></td></tr></table></figure>

<p>增加一行 <code>/usr/local/nginx/sbin/nginx</code><br>设置执行权限：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">chmod 755 rc.local</span><br></pre></td></tr></table></figure>

<p>到这里，nginx就安装完毕了，启动、停止、重启操作也都完成了，当然，你也可以添加为系统服务。</p>
<h1 id="添加系统服务"><a href="#添加系统服务" class="headerlink" title="添加系统服务"></a>添加系统服务</h1><h3 id="Centos-6-添加系统服务"><a href="#Centos-6-添加系统服务" class="headerlink" title="Centos 6 添加系统服务"></a>Centos 6 添加系统服务</h3><p>nginx源码安装完成后默认不会注册为系统服务，所以需要手工添加系统服务脚本。在/etc/init.d目录下新建nginx文件，并更改权限其即可。</p>
<h3 id="新建nginx文件"><a href="#新建nginx文件" class="headerlink" title="新建nginx文件"></a>新建nginx文件</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">vim /etc/init.d/nginx </span><br></pre></td></tr></table></figure>


<p>填写以下内容(根据自己的实际目录修改):</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> !/bin/bash</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> nginx Startup script <span class="keyword">for</span> the Nginx HTTP Server</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> this script create it by caffreyxin at 2007.10.15.</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> it is v.0.0.1 version.</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="keyword">if</span> you find any errors on this scripts, please contact caffreyxin.</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> and send mail to xinyflove at sina dot com.</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"></span></span><br><span class="line"><span class="bash"></span><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> chkconfig: - 85 15</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> description: Nginx is a high-performance web and proxy server.</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> It has a lot of features, but it<span class="string">&#x27;s not for everyone.</span></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="string"> processname: nginx</span></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="string"> pidfile: /usr/local/nginx/logs/nginx.pid</span></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="string"> config: /usr/local/nginx/conf/nginx.conf</span></span></span><br><span class="line"></span><br><span class="line">nginxd=/usr/local/nginx/sbin/nginx</span><br><span class="line">nginx_config=/usr/local/nginx/conf/nginx.conf</span><br><span class="line">nginx_pid=/usr/local/nginx/logs/nginx.pid</span><br><span class="line"></span><br><span class="line">RETVAL=0</span><br><span class="line">prog=&quot;nginx&quot;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="string"> Source function library.</span></span></span><br><span class="line"></span><br><span class="line">. /etc/rc.d/init.d/functions</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="string"> Source networking configuration.</span></span></span><br><span class="line"></span><br><span class="line">. /etc/sysconfig/network</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="string"> Check that networking is up.</span></span></span><br><span class="line"></span><br><span class="line">[ $&#123;NETWORKING&#125; = &quot;no&quot; ] &amp;&amp; exit 0</span><br><span class="line"></span><br><span class="line">[ -x $nginxd ] || exit 0</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="string"> Start nginx daemons functions.</span></span></span><br><span class="line"></span><br><span class="line">start() &#123;</span><br><span class="line"></span><br><span class="line">if [ -e $nginx_pid ];then</span><br><span class="line">    echo &quot;nginx already running....&quot;</span><br><span class="line">    exit 1</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">echo -n $&quot;Starting $prog: &quot;</span><br><span class="line">daemon $nginxd -c $&#123;nginx_config&#125;</span><br><span class="line">RETVAL=$?</span><br><span class="line">echo</span><br><span class="line">[ $RETVAL = 0 ] &amp;&amp; touch /var/lock/subsys/nginx</span><br><span class="line">return $RETVAL</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="string"> Stop nginx daemons functions.</span></span></span><br><span class="line"></span><br><span class="line">stop() &#123;</span><br><span class="line">    echo -n $&quot;Stopping $prog: &quot;</span><br><span class="line">    killproc $nginxd</span><br><span class="line">    RETVAL=$?</span><br><span class="line">    echo</span><br><span class="line">    [ $RETVAL = 0 ] &amp;&amp; rm -f /var/lock/subsys/nginx /var/run/nginx.pid</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="string"> reload nginx service functions.</span></span></span><br><span class="line"></span><br><span class="line">reload() &#123;</span><br><span class="line"></span><br><span class="line">echo -n $&quot;Reloading $prog: &quot;</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="string">kill -HUP `cat $&#123;nginx_pid&#125;`</span></span></span><br><span class="line">killproc $nginxd -HUP</span><br><span class="line">RETVAL=$?</span><br><span class="line">echo</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="string"> See how we were called.</span></span></span><br><span class="line"></span><br><span class="line">case &quot;$1&quot; in</span><br><span class="line">start)</span><br><span class="line">        start</span><br><span class="line">        ;;</span><br><span class="line"></span><br><span class="line">stop)</span><br><span class="line">        stop</span><br><span class="line">        ;;</span><br><span class="line"></span><br><span class="line">reload)</span><br><span class="line">        reload</span><br><span class="line">        ;;</span><br><span class="line"></span><br><span class="line">restart)</span><br><span class="line">        stop</span><br><span class="line">        start</span><br><span class="line">        ;;</span><br><span class="line"></span><br><span class="line">status)</span><br><span class="line">        status $prog</span><br><span class="line">        RETVAL=$?</span><br><span class="line">        ;;</span><br><span class="line">*)</span><br><span class="line">        echo $&quot;Usage: $prog &#123;start|stop|restart|reload|status|help&#125;&quot;</span><br><span class="line">        exit 1</span><br><span class="line">esac</span><br><span class="line"></span><br><span class="line">exit $RETVAL</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<p>或<a href="https://github.com/xinyflove/MyDocument/blob/master/Nginx/nginx">https://github.com/xinyflove/MyDocument/blob/master/Nginx/nginx</a><br>tip:<br>根据自己实际安装目录，修改这两行:</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line">nginxd=/usr/local/nginx/sbin/<span class="attribute">nginx</span></span><br><span class="line">nginx_config=/usr/local/nginx/conf/nginx.conf</span><br></pre></td></tr></table></figure>



<h3 id="修改文件权限"><a href="#修改文件权限" class="headerlink" title="修改文件权限"></a>修改文件权限</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">chmod 755 /etc/init.d/nginx</span><br></pre></td></tr></table></figure>



<h3 id="设置开机启动"><a href="#设置开机启动" class="headerlink" title="设置开机启动"></a>设置开机启动</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">chkconfig nginx on</span><br></pre></td></tr></table></figure>



<h3 id="查看开机启动的服务"><a href="#查看开机启动的服务" class="headerlink" title="查看开机启动的服务"></a>查看开机启动的服务</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">chkconfig --list</span><br></pre></td></tr></table></figure>



<h2 id="命令"><a href="#命令" class="headerlink" title="命令"></a>命令</h2><p>启动服务：<code>service nginx start</code></p>
<p>停止服务：<code>service nginx stop</code></p>
<p>重启服务：<code>service nginx reload</code></p>
<p>CentOS 7 添加系统服务</p>
<p>新建 nginx.server文件</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">vi /usr/lib/systemd/system/nginx.service</span><br></pre></td></tr></table></figure>

<p>填写以下内容</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="comment">#nginx服务配置到该文件中</span></span><br><span class="line"><span class="comment"># cat /usr/lib/systemd/system/nginx.service</span></span><br><span class="line"><span class="comment">#服务描述性的配置</span></span><br><span class="line">[Unit]</span><br><span class="line">Description=<span class="attribute">nginx</span> - high performance web server</span><br><span class="line">Documentation=http://nginx.org/en/docs/</span><br><span class="line">After=network.target remote-fs.target nss-lookup.target</span><br><span class="line"><span class="comment">#服务关键配置</span></span><br><span class="line">[Service]</span><br><span class="line">Type=forking</span><br><span class="line"><span class="comment">#pid文件位置</span></span><br><span class="line"><span class="comment">#要与nginx配置文件中的pid配置路径一致，这个很重要，否则会服务启动失败</span></span><br><span class="line">PIDFile=/usr/local/nginx/logs/nginx.pid</span><br><span class="line"><span class="comment">#启动前检测 nginx配置文件 是否正确</span></span><br><span class="line">ExecStartPre=/usr/local/nginx/sbin/nginx -t -c /usr/local/nginx/conf/nginx.conf</span><br><span class="line"><span class="comment">#启动</span></span><br><span class="line">ExecStart=/usr/local/nginx/sbin/nginx -c /usr/local/nginx/conf/nginx.conf</span><br><span class="line"><span class="comment">#重启</span></span><br><span class="line">ExecReload=/bin/kill -s HUP $MAINPID</span><br><span class="line"><span class="comment">#关闭</span></span><br><span class="line">ExecStop=/bin/kill -s QUIT $MAINPID</span><br><span class="line">PrivateTmp=<span class="literal">true</span></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure>

<p>启动nginx服务</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">systemctl start nginx.service  </span><br></pre></td></tr></table></figure>

<p>设置开机自启动</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">systemctl enable nginx.service  </span><br></pre></td></tr></table></figure>

<p>停止开机自启动</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">systemctl disable nginx.service  </span><br></pre></td></tr></table></figure>

<p>查看服务当前状态 </p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">systemctl status nginx.service</span><br></pre></td></tr></table></figure>

<p>重新启动服务</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">systemctl restart nginx.service </span><br></pre></td></tr></table></figure>

<p>查看所有已启动的服务</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">systemctl list-units --type=service  </span><br></pre></td></tr></table></figure>

<p>如下出现<code>Failed to execute operation: Access denied</code>无权限错误，则需关闭<code>selinux</code>，操作如下：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> vi /etc/sysconfig/selinux</span></span><br><span class="line">…</span><br><span class="line">SELINUX=disabled</span><br><span class="line">…</span><br><span class="line"><span class="meta">#</span><span class="bash"> setenforce</span> </span><br><span class="line">0</span><br><span class="line"><span class="meta">#</span><span class="bash"> getenforce</span></span><br><span class="line">Permissive</span><br></pre></td></tr></table></figure>

<p>新旧系统服务命令对比</p>
<table>
<thead>
<tr>
<th>任务</th>
<th>旧指令</th>
<th>新指令</th>
</tr>
</thead>
<tbody><tr>
<td>使某服务自动启动</td>
<td>chkconfig –level 3 nignx  on</td>
<td>systemctl enable nignx.service</td>
</tr>
<tr>
<td>使某服务不自动启动</td>
<td>chkconfig –level 3 nignx off</td>
<td>systemctl disable nignx.service</td>
</tr>
<tr>
<td>检查服务状态</td>
<td>service nignx status</td>
<td>systemctl status nignx.service （服务详细信息）   systemctl is-active nignx.service （仅显示是否 Active)</td>
</tr>
<tr>
<td>显示所有已启动的服务</td>
<td>chkconfig –list</td>
<td>systemctl list-units –type=service</td>
</tr>
<tr>
<td>启动某服务</td>
<td>service nignx start</td>
<td>systemctl start nignx.service</td>
</tr>
<tr>
<td>停止某服务</td>
<td>service nignx stop</td>
<td>systemctl stop nignx.service</td>
</tr>
<tr>
<td>重启某服务</td>
<td>service nignx restart</td>
<td>systemctl restart nignx.service</td>
</tr>
</tbody></table>
]]></content>
      <categories>
        <category>centos</category>
        <category>nginx</category>
      </categories>
      <tags>
        <tag>centos</tag>
        <tag>nginx</tag>
      </tags>
  </entry>
  <entry>
    <title>CentOS 7 安装 PaddleOCR HubServing</title>
    <url>/CentOS-7-install-PaddleOCR-hubserving/</url>
    <content><![CDATA[<h1 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h1><p>  <a href="https://github.com/PaddlePaddle/PaddleOCR">PaddleOCR</a>旨在打造一套丰富、领先、且实用的OCR工具库，助力使用者训练出更好的模型，并应用落地。</p>
 <span id="more"></span>

<h2 id="查看本机的操作系统和位数信息"><a href="#查看本机的操作系统和位数信息" class="headerlink" title="查看本机的操作系统和位数信息"></a>查看本机的操作系统和位数信息</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">uname -m &amp;&amp; cat /etc/*release</span><br></pre></td></tr></table></figure>


<p>确认需要安装 PaddlePaddle 的 Python 是您预期的位置，因为您计算机可能有多个 Python</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">which</span> python3</span><br></pre></td></tr></table></figure>

<p>如果您是使用 Python 3，使用以下命令确认是 3.5.1+/3.6/3.7</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">python3 --version</span><br></pre></td></tr></table></figure>

<p>需要确认pip的版本是否满足要求，要求pip版本为9.0.1+</p>
<p>如果您是使用 Python 3</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">python3 -m ensurepip</span><br><span class="line"></span><br><span class="line">python3 -m pip --version</span><br></pre></td></tr></table></figure>


<p>需要确认Python和pip是64bit，并且处理器架构是x86_64（或称作x64、Intel 64、AMD64）架构，目前PaddlePaddle不支持arm64架构。下面的第一行输出的是”64bit”，第二行输出的是”x86_64”、”x64”或”AMD64”即可：</p>
<p>使用 Python 3</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">python3 -c <span class="string">&quot;import platform;print(platform.architecture()[0]);print(platform.machine())&quot;</span></span><br></pre></td></tr></table></figure>

<p>若没有安装 安装 python3 和 pip3 则使用下面命令安装</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">yum install python3 python3-pip -y</span><br></pre></td></tr></table></figure>

<h2 id="更新-pip3"><a href="#更新-pip3" class="headerlink" title="更新 pip3"></a>更新 pip3</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">pip3 install --upgrade pip -i https://pypi.tuna.tsinghua.edu.cn/simple</span><br><span class="line"><span class="comment"># 或者使用百度源</span></span><br><span class="line">pip3 install --upgrade pip -i https://mirror.baidu.com/pypi/simple</span><br></pre></td></tr></table></figure>

<h2 id="安装-paddlepaddle"><a href="#安装-paddlepaddle" class="headerlink" title="安装 paddlepaddle"></a>安装 paddlepaddle</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">python3 -m pip install paddlepaddle==1.8.5 -i https://pypi.tuna.tsinghua.edu.cn/simple</span><br></pre></td></tr></table></figure>

<h2 id="安装-paddlehub"><a href="#安装-paddlehub" class="headerlink" title="安装 paddlehub"></a>安装 paddlehub</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">pip3 install paddlehub --upgrade -i https://pypi.tuna.tsinghua.edu.cn/simple</span><br></pre></td></tr></table></figure>
<p>若安装过程没有报错，则安装成功。</p>
<p>若提升 timeout 超时，重新运行安装命令，或者更换源后再次运行命令</p>
<p>若出现版本不匹配错误，如下：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ERROR: After October 2020 you may experience errors when installing or updating packages. This is because pip will change the way that it resolves dependency conflicts.</span><br><span class="line"></span><br><span class="line">We recommend you use --use-feature=2020-resolver to <span class="built_in">test</span> your packages with the new resolver before it becomes the default.</span><br><span class="line"></span><br><span class="line">paddlepaddle 1.7.2 requires matplotlib&lt;=2.2.4, but you<span class="string">&#x27;ll have matplotlib 3.3.2 which is incompatible.</span></span><br></pre></td></tr></table></figure>
<p>手动安装指定版本依赖，命令如下</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">pip3 install matplotlib==2.2.4 -i https://pypi.tuna.tsinghua.edu.cn/simple</span><br></pre></td></tr></table></figure>
<p>解决依赖错误后，重新运行响应安装命令则可安装成功</p>
<h2 id="下载源码"><a href="#下载源码" class="headerlink" title="下载源码"></a>下载源码</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://gitee.com/PaddlePaddle/PaddleOCR</span><br></pre></td></tr></table></figure>

<p>移动到指定路径</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">mv PaddleOCR /PaddleOCR</span><br></pre></td></tr></table></figure>

<h2 id="安装依赖"><a href="#安装依赖" class="headerlink" title="安装依赖"></a>安装依赖</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> /PaddleOCR </span><br><span class="line">pip3 install -r requirments.txt -i https://pypi.tuna.tsinghua.edu.cn/simple</span><br></pre></td></tr></table></figure>

<h2 id="下载模型"><a href="#下载模型" class="headerlink" title="下载模型"></a>下载模型</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">mkdir -p /PaddleOCR/inference &amp;&amp;  <span class="built_in">cd</span> /PaddleOCR/inference &amp;&amp;  \</span><br><span class="line">wget -c https://paddleocr.bj.bcebos.com/20-09-22/mobile/det/ch_ppocr_mobile_v1.1_det_infer.tar &amp;&amp;  \</span><br><span class="line">tar xf /PaddleOCR/inference/ch_ppocr_mobile_v1.1_det_infer.tar -C /PaddleOCR/inference  &amp;&amp;  \</span><br><span class="line">wget -c https://paddleocr.bj.bcebos.com/20-09-22/cls/ch_ppocr_mobile_v1.1_cls_infer.tar &amp;&amp;  \</span><br><span class="line">tar xf /PaddleOCR/inference/ch_ppocr_mobile_v1.1_cls_infer.tar -C /PaddleOCR/inference  &amp;&amp;  \</span><br><span class="line">wget -c https://paddleocr.bj.bcebos.com/20-09-22/mobile/rec/ch_ppocr_mobile_v1.1_rec_infer.tar &amp;&amp;  \</span><br><span class="line">tar xf /PaddleOCR/inference/ch_ppocr_mobile_v1.1_rec_infer.tar -C /PaddleOCR/inference </span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="安装模型"><a href="#安装模型" class="headerlink" title="安装模型"></a>安装模型</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> /PaddleOCR &amp;&amp;  <span class="built_in">export</span> PYTHONPATH=. &amp;&amp; \</span><br><span class="line">hub install deploy/hubserving/ocr_system/</span><br></pre></td></tr></table></figure>

<p>出现：<code>Successfully installed ocr_system</code> 则安装成功</p>
<h2 id="启动服务"><a href="#启动服务" class="headerlink" title="启动服务"></a>启动服务</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> /PaddleOCR &amp;&amp; <span class="built_in">export</span> PYTHONPATH=. &amp;&amp;  \</span><br><span class="line">hub serving start -m ocr_system</span><br></pre></td></tr></table></figure>
<p>出现 <code>Running on http://0.0.0.0:8866/</code> 等信息，表示运行成功</p>
<p>若要在后台一直运行，运行如下命令</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> /PaddleOCR &amp;&amp; <span class="built_in">export</span> PYTHONPATH=. &amp;&amp;  \</span><br><span class="line">nohup hub serving start -m ocr_system &gt;&gt; /PaddleOCR/hub.log  2&gt;&amp;1 &amp;</span><br></pre></td></tr></table></figure>
<h2 id="测试服务"><a href="#测试服务" class="headerlink" title="测试服务"></a>测试服务</h2><p>a. 计算待识别图片的Base64编码</p>
<p>b. 发送服务请求</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">curl -H <span class="string">&quot;Content-Type:application/json&quot;</span> -X POST --data <span class="string">&quot;&#123;\&quot;images\&quot;: [\&quot;填入图片Base64编码(需要删除&#x27;data:image/jpg;base64,&#x27;）\&quot;]&#125;&quot;</span> http://localhost:8866/predict/ocr_system</span><br></pre></td></tr></table></figure>
<p>c. 返回结果（如果调用成功，会返回如下结果）</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&#123;<span class="string">&quot;msg&quot;</span>:<span class="string">&quot;&quot;</span>,<span class="string">&quot;results&quot;</span>:[[&#123;<span class="string">&quot;confidence&quot;</span>:0.8403433561325073,<span class="string">&quot;text&quot;</span>:<span class="string">&quot;约定&quot;</span>,<span class="string">&quot;text_region&quot;</span>:[[345,377],[641,390],[634,540],[339,528]]&#125;,&#123;<span class="string">&quot;confidence&quot;</span>:0.8131805658340454,<span class="string">&quot;text&quot;</span>:<span class="string">&quot;最终相遇&quot;</span>,<span class="string">&quot;text_region&quot;</span>:[[356,532],[624,530],[624,596],[356,598]]&#125;]],<span class="string">&quot;status&quot;</span>:<span class="string">&quot;0&quot;</span>&#125;</span><br></pre></td></tr></table></figure>











]]></content>
      <categories>
        <category>centos</category>
        <category>PaddleOCR</category>
        <category>Python</category>
      </categories>
      <tags>
        <tag>centos</tag>
        <tag>PaddleOCR</tag>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>CentOS 7 安装 Redis</title>
    <url>/CentOS-7-install-Redis/</url>
    <content><![CDATA[<p>CentOS 7 安装Redis</p>
<p>参照官网描述（<a href="https://redis.io/download">https://redis.io/download</a>），linux下redis安装步骤如下：</p>
 <span id="more"></span>
<p>所有工具和依赖一起安装</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">yum install -y tcl gcc-c++</span><br></pre></td></tr></table></figure>


<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> wget http://download.redis.io/releases/redis-5.0.5.tar.gz</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> tar -zxvf redis-5.0.5.tar.gz</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">cd</span> redis-5.0.5</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> mkdir -p /data1/databases/redis  /var/<span class="built_in">log</span>/redis/</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> make &amp;&amp; make install PREFIX=/data1/databases/redis</span></span><br></pre></td></tr></table></figure>

<p>上述流程依次代表，下载redis –&gt; 解压 –&gt; 进入解压目录 –&gt; 编译源码</p>
<p>多数情况下，执行make时，可能会出现如下错误：</p>
<p>异常一：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">make[2]: cc: Command not found</span><br></pre></td></tr></table></figure>

<p>异常原因：没有安装gcc</p>
<p>解决方案：<code>yum install gcc-c++</code></p>
<p>异常二：</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">zmalloc.h:<span class="number">51</span>:<span class="number">31</span>: error: jemalloc/jemalloc.h: No such file <span class="keyword">or</span> directory</span><br></pre></td></tr></table></figure>

<p>异常原因：一些编译依赖或原来编译遗留出现的问题</p>
<p>解决方案：<code>make distclean</code>。清理一下，然后再<code>make</code>。</p>
<p>在make成功以后，需要make test。在make test出现异常。</p>
<p>异常一：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">couldn&#x27;t execute &quot;tclsh8.5&quot;: no such file or directory</span><br></pre></td></tr></table></figure>

<p>异常原因：没有安装tcl</p>
<p>解决方案：<code>yum install -y tcl</code>。</p>
<p>到此，redis安装完成。</p>
<p>若是通过：<code>make install PREFIX=安装目录</code>， 完成安装的，会在安装目录下生成一个bin目录，bin目录下包含如下可执行文件：</p>
<p><code>redis-benchmark</code> ： 用于测试redis的性能。</p>
<p><code>redis-check-aof</code> : 当aof备份文件被损坏，可通过该工具对aof文件进行修复，使用方式：<code>redis-check-aof --fix 要修复的aof文件</code>。</p>
<p><code>redis-check-rdb</code> : 修复损坏的rdb备份文件。</p>
<p><code>redis-cli</code> : redis客户端，用于连接服务端。</p>
<p><code>redis-server</code> ： redis服务器端，用于启动redis服务器。</p>
<p><code>redis-sentinel</code> : 哨兵模式（实际使用较多） 在master-slave模式下（slave默认不支持写），当master出现异常时，自动在slave中选择一台作为master。</p>
<p>连接上redis服务器后，可通过指令“<strong>info</strong>”查看redis服务器信息，也可查看服务器知道内容信息，例如：<strong>info replication</strong> 查看主从相关信息</p>
<p>下面介绍几个redis常用配置项（redis.cnf配置文件中配置）<br>1、<code>bind 127.0.0.1</code> 配置redis服务器接受链接的网卡（非客户端ip，而是服务器端ip，服务器可能包含多个网卡）</p>
<p>2、<code>protected-mode yes</code> redis以保护模式运行，只接受本地链接，不能外网访问</p>
<p>3、<code>port 6379</code>  redis接受链接端口</p>
<p>4、<code>daemonize no</code>  redis是否后台运行，若为yes，客户端窗口将被锁定<br>重要配置项<br>5、<code>maxmemory</code> redis最大使用内存<br>6、<code>maxmemory-policy</code>  内存达到最大值时的驱逐策略</p>
<p>redis数据持久化支持两种模式：RDB和AOF<br>RDB：rdb方式的持久化是通过快照完成的，当符合一定条件时redis会自动将内存中的所有数据执行快照操作并存储到硬盘上。默认存储在redis根目录的dump.rdb文件中。(文件名在配置文件中dbfilename)</p>
<p>　redis进行快照的时机（在配置文件<strong>redis.conf</strong>中）</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">save 900 1：表示900秒内至少一个键被更改则进行快照。</span><br><span class="line">save 300 10</span><br><span class="line">save 60 10000</span><br><span class="line">dbfilename dump.rdb   快照保存文件名</span><br><span class="line">dir ./                快照保存地址</span><br></pre></td></tr></table></figure>

<p>也可通过redis客服端执行命令save或者bgsave保存快照：</p>
<p>　两个命令的区别在于，save是由主进程进行快照操作，会阻塞其它请求。bgsave是由redis执行fork函数复制出一个子进程来进行快照操作。</p>
<p>文件修复<strong>：redis-check-dump</strong></p>
<p><strong>rdb的优缺点</strong></p>
<p>优点：由于存储的有数据快照文件，恢复数据很方便。</p>
<p>缺点：会丢失最后一次快照以后更改的所有数据。</p>
<p>AOF:aof方式的持久化是通过日志文件的方式，记录下redis服务器的每一条修改指令。默认情况下redis没有开启aof，可以通过参数appendonly参数开启。</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="attribute">appendonly</span> <span class="literal">yes</span></span><br></pre></td></tr></table></figure>

<p>  aof文件的保存位置和rdb文件的位置相同，都是dir参数设置的，默认的文件名是<code>appendonly.aof</code>，可以通过      <code>appendfilename</code>参数修改</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line">appendfilename appendonly.aof</span><br></pre></td></tr></table></figure>

<p>  redis写命令同步的时机：</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="attribute">appendfsync</span> always 每次都会执行</span><br><span class="line">appendfsync everysec 默认 每秒执行一次同步操作（推荐，默认）</span><br><span class="line">appendfsync <span class="literal">no</span>不主动进行同步，由操作系统来做，<span class="number">30</span>秒一次</span><br></pre></td></tr></table></figure>

<p>redis服务器启动时会读取appendonly.aof中的指令，进行执行，这样便保证了重启后数据不会丢失。</p>
<p><strong>注意：当redis启动时，如果rdb持久化和aof持久化都打开了，那么程序会优先使用aof方式来恢复数据集，因为aof方式所保存的数据通常是最完整的。</strong></p>
<p>最后记录下redis服务器的启动与关闭指令：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@localhost src]# ./redis-server ../redis.conf                启动redis</span><br><span class="line">[root@localhost src]# ./redis-cli shutdown                          关闭redis</span><br></pre></td></tr></table></figure>

<p>Redis 加入系统服务</p>
<p>新建文件</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">vi /etc/rc.d/init.d/redis </span><br></pre></td></tr></table></figure>

<p>文件内容</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/sh</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> chkconfig: 2345 80 90</span></span><br><span class="line"><span class="meta">#</span><span class="bash"></span></span><br><span class="line"><span class="bash"><span class="comment"># Simple Redis init.d script conceived to work on Linux systems</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> as it does use of the /proc filesystem.</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">## BEGIN INIT INFO</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Provides:     redis_6379</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Default-Start:        2 3 4 5</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Default-Stop:         0 1 6</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Short-Description:    Redis data structure server</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Description:          Redis data structure server. See https://redis.io</span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">## END INIT INFO</span></span></span><br><span class="line"></span><br><span class="line">REDISPORT=6379</span><br><span class="line">EXEC=/data1/databases/redis/bin/redis-server</span><br><span class="line">CLIEXEC=/data1/databases/redis/bin/redis-cli</span><br><span class="line"></span><br><span class="line">PIDFILE=/var/run/redis_$&#123;REDISPORT&#125;.pid</span><br><span class="line">CONF=&quot;/etc/redis/$&#123;REDISPORT&#125;.conf&quot;</span><br><span class="line"></span><br><span class="line">function check_pid() &#123;</span><br><span class="line">    if [ -f $PIDFILE ];then</span><br><span class="line">        pid=`cat $PIDFILE`</span><br><span class="line">        if [ -n $pid ]; then</span><br><span class="line">            running=`ps -p $pid|grep -v &quot;PID TTY&quot; |wc -l`</span><br><span class="line">            return $running</span><br><span class="line">        fi</span><br><span class="line">    fi</span><br><span class="line">    return 0</span><br><span class="line">&#125;</span><br><span class="line">function start() &#123;</span><br><span class="line">    check_pid</span><br><span class="line">            running=$?</span><br><span class="line">            if [ $running -gt 0 ];then</span><br><span class="line">                echo -n &quot;Redis server now is running, pid=&quot;</span><br><span class="line">                cat $PIDFILE</span><br><span class="line">            else</span><br><span class="line">                 echo &quot;Starting Redis server...&quot;</span><br><span class="line">                 $EXEC $CONF &amp;</span><br><span class="line">                 echo $! &gt; $PIDFILE</span><br><span class="line">                 echo &quot;Redis started..., pid=$!&quot;</span><br><span class="line">            fi</span><br><span class="line">    return 0</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function stop() &#123;</span><br><span class="line">    check_pid</span><br><span class="line">            running=$?</span><br><span class="line">            if [ $running -gt 0 ];then</span><br><span class="line">                echo &quot;Stopping ...&quot;</span><br><span class="line">                PID=$(cat $PIDFILE)</span><br><span class="line">                $CLIEXEC -p $REDISPORT shutdown</span><br><span class="line">                while [ -x /proc/$&#123;PID&#125; ]</span><br><span class="line">                do</span><br><span class="line">                   echo &quot;Waiting for Redis to shutdown ...&quot;</span><br><span class="line">                   sleep 1</span><br><span class="line">                done</span><br><span class="line">            fi</span><br><span class="line">    echo &quot;Redis stopped&quot;</span><br><span class="line">    return 0</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">function status() &#123;</span><br><span class="line">     check_pid</span><br><span class="line">                running=$?</span><br><span class="line">                if [ $running -gt 0 ];then</span><br><span class="line">                    echo -n &quot;Redis server now is running, pid=&quot;</span><br><span class="line">                    cat $PIDFILE</span><br><span class="line">                else</span><br><span class="line">                    echo &quot;Redis server is stoped&quot;</span><br><span class="line">                fi</span><br><span class="line">    return 0</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">case &quot;$1&quot; in</span><br><span class="line">    start)</span><br><span class="line">        start</span><br><span class="line">        ;;</span><br><span class="line">    stop)</span><br><span class="line">        stop</span><br><span class="line">        ;;</span><br><span class="line">    status)</span><br><span class="line">        status</span><br><span class="line">        ;;</span><br><span class="line">    restart)</span><br><span class="line">        stop</span><br><span class="line">        start</span><br><span class="line">        ;;</span><br><span class="line">    *)</span><br><span class="line">        echo &quot;Please use start / stop / status / restart as first argument&quot;</span><br><span class="line">        ;;</span><br><span class="line">esac</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>修改文件权限</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">chmod 755 /etc/rc.d/init.d/redis</span><br></pre></td></tr></table></figure>

<p>设置开机启动</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">chkconfig redis on</span><br></pre></td></tr></table></figure>

<p>启动、停止命令</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">service redis start/stop</span><br></pre></td></tr></table></figure>

<p>centos 7 加入系统服务</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> cat /usr/lib/systemd/system/redis.service</span></span><br><span class="line">[Unit]</span><br><span class="line">Description=Redis persistent key-value database</span><br><span class="line">After=network.target</span><br><span class="line">After=network-online.target</span><br><span class="line">Wants=network-online.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">ExecStart=/data/redis/bin/redis-server /etc/redis/6379.conf --supervised systemd</span><br><span class="line"><span class="meta">#</span><span class="bash">ExecStop=/usr/libexec/redis-shutdown</span></span><br><span class="line">ExecStop=kill -9 $(ps -ef|grep /data/redis/bin/redis-server | grep 6379 |awk &#x27;&#123;print $2&#125;&#x27;)</span><br><span class="line">Type=notify</span><br><span class="line"><span class="meta">#</span><span class="bash">User=redis</span></span><br><span class="line"><span class="meta">#</span><span class="bash">Group=redis</span></span><br><span class="line">RuntimeDirectory=redis</span><br><span class="line">RuntimeDirectoryMode=0755</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>设置开机启动</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">systemctl enable redis </span><br></pre></td></tr></table></figure>

<p>启动、停止、状态命令</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">systemctl start/stop/status  redis </span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>centos</category>
        <category>redis</category>
      </categories>
      <tags>
        <tag>centos</tag>
        <tag>redis</tag>
      </tags>
  </entry>
  <entry>
    <title>CentOS 7 安装 RabbitMQ</title>
    <url>/CentOS-7-install-RqbbitMQ/</url>
    <content><![CDATA[<h1 id="一、系统环境"><a href="#一、系统环境" class="headerlink" title="一、系统环境"></a>一、系统环境</h1><p>1、Centos7-64位</p>
<p><strong>二、配置Erlang安装环境</strong></p>
<p>1）<a href="https://packagecloud.io/rabbitmq/erlang/install#bash-rpm">完成erlang的前置条件配置</a></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">curl -s https://packagecloud.io/install/repositories/rabbitmq/erlang/script.rpm.sh | sudo bash</span><br></pre></td></tr></table></figure>

<p>没有报错则一切正常</p>
 <span id="more"></span>


<p><strong>三、配置RabbitMQ安装环境</strong></p>
<p><strong>1、先导入两个key</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">rpm --import https://packagecloud.io/rabbitmq/rabbitmq-server/gpgkey</span><br><span class="line">rpm --import https://packagecloud.io/gpg.key</span><br></pre></td></tr></table></figure>

<p>没报错就表示正常。</p>
<p><strong>2、<a href="https://packagecloud.io/rabbitmq/rabbitmq-server/install#bash-rpm">完成RabbitMQ的前置条件配置</a></strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">curl -s https://packagecloud.io/install/repositories/rabbitmq/rabbitmq-server/script.rpm.sh | sudo bash</span><br></pre></td></tr></table></figure>

<p>没有报错则一切正常</p>
<p><strong>四、配置RabbitMQ安装环境</strong></p>
<p><strong>1、通过 yum 安装 RabbitMQ 以及相关依赖</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">yum install erlang socat logrotate rabbitmq-server -y</span><br></pre></td></tr></table></figure>

<p>没报错就表示正常安装完成。</p>
<p><strong>五、配置RabbitMQ</strong></p>
<p><strong>1、启用管理平台插件，启用插件后，可以可视化管理RabbitMQ。</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">rabbitmq-plugins <span class="built_in">enable</span> rabbitmq_management</span><br></pre></td></tr></table></figure>

<p><strong>2、启动RabbitMQ</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">systemctl start rabbitmq-server</span><br></pre></td></tr></table></figure>

<p><strong>3、访问地址</strong><br><a href="http://172.20.8.146:15672/">http://172.20.8.146:15672</a></p>
<p>注意：172.20.8.146 是安装RabbitMQ的服务器IP地址。如果访问不了，确认是否开启端口5672和15672。开启方法参考：<a href="https://hunkier.cn/CentOS-7-firewall/">CentOS firewall添加开放端口</a></p>
<p><strong>4、创建用户</strong><br>创建用户名admin，密码aaaaaa的用户：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">rabbitmqctl add_user admin aaaaaa</span><br></pre></td></tr></table></figure>

<p>设置admin为超级管理员</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">rabbitmqctl set_user_tags admin administrator</span><br></pre></td></tr></table></figure>

<p>授权远程访问（也可以登录后，可视化配置）</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">rabbitmqctl set_permissions -p / admin <span class="string">&quot;.&quot;</span> <span class="string">&quot;.&quot;</span> <span class="string">&quot;.*&quot;</span></span><br></pre></td></tr></table></figure>

<p>创建完成后，重启RabbitMQ</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">systemctl restart rabbitmq-server</span><br></pre></td></tr></table></figure>

<p><strong>5、修改端口和远程启用 guest用户</strong></p>
<p>编辑配置文件  <code>/etc/rabbitmq/rabbitmq.conf</code></p>
<p>内容如下：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 默认为 true，不启用远程 guest 用户。远程启用 guest 用户，密码也为 guest，生成环境最好不用启用</span></span><br><span class="line">loopback_users.guest = <span class="literal">false</span></span><br><span class="line"><span class="comment"># 工作端口，默认 5672 ，不建议修改</span></span><br><span class="line">listeners.tcp.default = 5672</span><br><span class="line"><span class="comment"># web 管理页面端口，默认 15672， 不建议修改</span></span><br><span class="line">management.tcp.port = 15672</span><br></pre></td></tr></table></figure>

<p>修改后重启服务</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">systemctl restart rabbitmq-server</span><br></pre></td></tr></table></figure>

<p>RabbitMQ 加入系统开机自启动</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">systemctl <span class="built_in">enable</span> rabbitmq-server</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>centos</category>
        <category>RabbitMq</category>
      </categories>
      <tags>
        <tag>centos</tag>
        <tag>RabbitMq</tag>
      </tags>
  </entry>
  <entry>
    <title>CentOS 用户相关操作</title>
    <url>/CentOS-Users/</url>
    <content><![CDATA[<p>Centos 用户相关操作</p>
<p>查看centos中的用户和用户组<br>1、用户列表文件：<code>/etc/passwd/</code></p>
<p>2、用户组列表文件：<code>/etc/group</code></p>
<p>3、查看系统中有哪些用户：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">cut -d : -f 1 /etc/passwd</span><br></pre></td></tr></table></figure>

<span id="more"></span>

<p>4、查看可以登录系统的用户：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">cat /etc/passwd | grep -v /sbin/nologin | cut -d : -f 1</span><br></pre></td></tr></table></figure>

<p>5、查看用户操作：<code>w命令(需要root权限)</code></p>
<p>6、查看某一用户：<code>w 用户名</code></p>
<p>7、查看登录用户：<code>who</code></p>
<p>8、查看用户登录历史记录：<code>last</code></p>
<p>9、修改root用户密码：</p>
<p><code>passwd</code></p>
<p>10、root用户修改其他用户密码：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">passwd &lt;user_name&gt;</span><br></pre></td></tr></table></figure>

<p>11、查看系统版本：<code>cat /etc/redhat-release</code></p>
<p>12、删除用户 <code>userdel 用户名</code></p>
<p>13、查看组 <code>cat /etc/group</code></p>
<p>14、删除组 <code>groupdel 组名</code></p>
]]></content>
      <tags>
        <tag>CentOS Linux Users</tag>
      </tags>
  </entry>
  <entry>
    <title>CentOS 7 安装 google chrome</title>
    <url>/CentOS-7-install-google-chrome/</url>
    <content><![CDATA[<p>第一步： 执行如下命令：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cd /etc/yum.repos.d/</span><br></pre></td></tr></table></figure>

 <span id="more"></span>
<p>第二步：命令如下：</p>
<p>创建一个repo文档</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">vi google-chrome.repo</span><br></pre></td></tr></table></figure>

<p>第三步：命令如下：</p>
<p>把下列代码粘贴即可</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[google-chrome]</span><br><span class="line">name=google-chrome</span><br><span class="line">baseurl=http://dl.google.com/linux/chrome/rpm/stable/x86_64</span><br><span class="line">enabled=1</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=https://dl.google.com/linux/linux_signing_key.pub</span><br></pre></td></tr></table></figure>

<p>第四步：命令如下：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">yum -y install google-chrome-stable</span><br></pre></td></tr></table></figure>

<p>由于墙的存在，有可能执行不成功，请使用如下命令替换上述命令：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">yum -y install google-chrome-stable --nogpgcheck</span><br></pre></td></tr></table></figure>

<p>上述安装方式，是目前安装 Chrome最为快捷的方式，避免了下载 Chrome安装包的麻烦。</p>
]]></content>
      <categories>
        <category>centos</category>
        <category>chrome</category>
      </categories>
      <tags>
        <tag>centos</tag>
        <tag>chrome</tag>
      </tags>
  </entry>
  <entry>
    <title>CentOS 7上部署vnc服务器并实现远程桌面</title>
    <url>/CentOS-VNCserver/</url>
    <content><![CDATA[<h2 id="一、安装X-Window-System"><a href="#一、安装X-Window-System" class="headerlink" title="一、安装X Window System"></a>一、安装X Window System</h2><p>注：若已经安装GUI则可跳过</p>
<p>1、切换到root用户，执行 <code>yum groupinstall &quot;X Window System&quot;</code><br>2、执行 <code>yum install gnome-classic-session gnome-terminal nautilus-open-terminal control-center liberation-mono-fonts dejavu-lgc-sans-fonts -y</code> 安装相关组件<br>3、设置默认启动图形界面</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">yum groupinstall -y <span class="string">&quot;Fonts&quot;</span></span><br></pre></td></tr></table></figure>
<p>4、设置默认启动图形界面</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> unlink /etc/systemd/system/default.target</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ln -sf /lib/systemd/system/graphical.target  /etc/systemd/system/default.target</span></span><br></pre></td></tr></table></figure>
<p>5、重启系统生效</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> reboot</span></span><br></pre></td></tr></table></figure>
<span id="more"></span>

<h2 id="二、安装vnc服务"><a href="#二、安装vnc服务" class="headerlink" title="二、安装vnc服务"></a>二、安装vnc服务</h2><h3 id="1、执行yum-install-tigervnc-server-y安装VNC服务器软件"><a href="#1、执行yum-install-tigervnc-server-y安装VNC服务器软件" class="headerlink" title="1、执行yum install tigervnc-server -y安装VNC服务器软件"></a>1、执行yum install tigervnc-server -y安装VNC服务器软件</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> yum install tigervnc-server -y</span></span><br><span class="line">Loaded plugins: fastestmirror, langpacks</span><br><span class="line">Loading mirror speeds from cached hostfile</span><br><span class="line"> * base: mirrors.aliyun.com</span><br><span class="line"> * extras: mirrors.aliyun.com</span><br><span class="line"> * updates: mirror.lzu.edu.cn</span><br><span class="line">base                                                                                                                                                                                        | 3.6 kB  00:00:00     </span><br><span class="line">extras                                                                                                                                                                                      | 3.4 kB  00:00:00     </span><br><span class="line">updates                                                                                                                                                                                     | 3.4 kB  00:00:00     </span><br><span class="line">Resolving Dependencies</span><br><span class="line"><span class="meta">--&gt;</span><span class="bash"> Running transaction check</span></span><br><span class="line"><span class="meta">---&gt;</span><span class="bash"> Package tigervnc-server.x86_64 0:1.8.0-13.el7 will be installed</span></span><br><span class="line"><span class="meta">--&gt;</span><span class="bash"> Finished Dependency Resolution</span></span><br><span class="line"></span><br><span class="line">Dependencies Resolved</span><br><span class="line"></span><br><span class="line">===================================================================================================================================================================================================================</span><br><span class="line"> Package                                                 Arch                                           Version                                                 Repository                                    Size</span><br><span class="line">===================================================================================================================================================================================================================</span><br><span class="line">Installing:</span><br><span class="line"> tigervnc-server                                         x86_64                                         1.8.0-13.el7                                            base                                         215 k</span><br><span class="line"></span><br><span class="line">Transaction Summary</span><br><span class="line">===================================================================================================================================================================================================================</span><br><span class="line">Install  1 Package</span><br><span class="line"></span><br><span class="line">Total download size: 215 k</span><br><span class="line">Installed size: 509 k</span><br><span class="line">Downloading packages:</span><br><span class="line">tigervnc-server-1.8.0-13.el7.x86_64.rpm                                                                                                                                                     | 215 kB  00:00:00     </span><br><span class="line">Running transaction check</span><br><span class="line">Running transaction test</span><br><span class="line">Transaction test succeeded</span><br><span class="line">Running transaction</span><br><span class="line">  Installing : tigervnc-server-1.8.0-13.el7.x86_64                                                                                                                                                             1/1 </span><br><span class="line">  Verifying  : tigervnc-server-1.8.0-13.el7.x86_64                                                                                                                                                             1/1 </span><br><span class="line"></span><br><span class="line">Installed:</span><br><span class="line">  tigervnc-server.x86_64 0:1.8.0-13.el7                                                                                                                                                                            </span><br><span class="line"></span><br><span class="line">Complete!</span><br></pre></td></tr></table></figure>



<h3 id="2、配置VNC"><a href="#2、配置VNC" class="headerlink" title="2、配置VNC"></a>2、配置VNC</h3><p>在/etc/systemd/system目录里创建一个配置文件（可以将/lib/systemd/system/vncserver@.service拷贝一份配置文件范例过来）</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cp /lib/systemd/system/vncserver@.service /etc/systemd/system/vncserver@:1.service</span><br></pre></td></tr></table></figure>

<p>使用文本编辑器打开 <code>/etc/systemd/system/vncserver@:1.service</code> ，找到下面这几行，用自己的用户名替换掉 <code>&lt;USER&gt;</code></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">User=&lt;USER&gt;</span><br><span class="line">PIDFile=/home/&lt;USER&gt;/.vnc/%H%i.pid</span><br><span class="line">替换成</span><br><span class="line">User=root</span><br><span class="line">PIDFile=/home/root/.vnc/%H%i.pid</span><br></pre></td></tr></table></figure>

<p>重启systemd</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">systemctl daemon-reload</span><br></pre></td></tr></table></figure>

<p>vncpasswd设置VNC登录密码</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">vncpasswd</span><br></pre></td></tr></table></figure>

<p>执行vncserver开启一个VNC窗口</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> vncserver</span></span><br><span class="line"></span><br><span class="line">You will require a password to access your desktops.</span><br><span class="line"></span><br><span class="line">Password:</span><br><span class="line">Verify:</span><br><span class="line">Would you like to enter a view-only password (y/n)? n</span><br><span class="line">A view-only password is not used</span><br><span class="line">xauth:  file /root/.Xauthority does not exist</span><br><span class="line"></span><br><span class="line">New &#x27;server:1 (root)&#x27; desktop is server:1</span><br><span class="line"></span><br><span class="line">Creating default startup script /root/.vnc/xstartup</span><br><span class="line">Creating default config /root/.vnc/config</span><br><span class="line">Starting applications specified in /root/.vnc/xstartup</span><br><span class="line">Log file is /root/.vnc/server:1.log</span><br></pre></td></tr></table></figure>

<p>开启远程端口</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> vncserver :1</span></span><br><span class="line">A VNC server is already running as :1</span><br><span class="line"></span><br><span class="line">New &#x27;server:2 (root)&#x27; desktop is server:2</span><br><span class="line"></span><br><span class="line">Starting applications specified in /root/.vnc/xstartup</span><br><span class="line">Log file is /root/.vnc/server:2.log</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>设置防火墙规则，允许访问VNC-SERVER的流量通过，并重启firewall服务使之生效</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> firewall-cmd --permanent --add-service vnc-server</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> systemctl restart firewalld.service</span></span><br></pre></td></tr></table></figure>

<h1 id="三、客户端连接-VNC-server"><a href="#三、客户端连接-VNC-server" class="headerlink" title="三、客户端连接 VNC server"></a>三、客户端连接 VNC server</h1><p>客户端可以使用官方，直接去 <a href="https://www.realvnc.com/en/connect/download/viewer/">官网</a> 下载，推荐使用 <code>MobaXterm</code>，集成常用 ssh，sftp 等功能。</p>
<p>地址栏填写：<code>ip::5901</code>。例如：<code>172.20.8.31::5901</code></p>
<p>我们开启的是<code>vncserver :1</code>，而 vncserver 默认从5900开始，所以我们使用 <code>5900+1 = 5901</code>，注意需要两个 <code>::</code></p>
<p>接下来输入服务端设置的 vncserver 的密码就可以了。</p>
<p><strong>注意关闭防火墙和selinux</strong></p>
<p>其他设置参考：<a href="https://blog.csdn.net/yxc2959/article/details/79100724">https://blog.csdn.net/yxc2959/article/details/79100724</a></p>
]]></content>
      <categories>
        <category>centos vnc</category>
      </categories>
      <tags>
        <tag>centos vnc</tag>
      </tags>
  </entry>
  <entry>
    <title>CentOS 修改时区、设置时间</title>
    <url>/CentOS-chanage-date-zone/</url>
    <content><![CDATA[<p>一、修改时区：</p>
<p>  方法1:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cp  /usr/share/zoneinfo/Asia/Shanghai  /etc/localtime</span><br></pre></td></tr></table></figure>

<span id="more"></span>

<p>  方法2：    </p>
<p>列出时区：  </p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">timedatectl list-timezones</span><br></pre></td></tr></table></figure>

<p>设置时区：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">timedatectl set-timezone Asia/Shanghai</span><br></pre></td></tr></table></figure>


<p>  方法3：使用  tzselect</p>
<p>  查看是否修改成功：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">date</span><br><span class="line">Fri Dec 14 10:48:05 CST 2018</span><br></pre></td></tr></table></figure>

<p>如果显示CST则说明时区设置成功</p>
<p>CST：中国标准时间（China Standard Time），这个解释可能是针对RedHat Linux。</p>
<p>UTC：协调世界时，又称世界标准时间，简称UTC，从英文国际时间/法文协调时间”Universal Time/Temps Cordonn&eacute;”而来。中国大陆、香港、澳门、台湾、蒙古国、新加坡、马来西亚、菲律宾、澳洲西部的时间与UTC的时差均为+8，也就是UTC+8。</p>
<p>GMT：格林尼治标准时间（旧译格林威治平均时间或格林威治标准时间；英语：Greenwich Mean Time，GMT）是指位于英国伦敦郊区的皇家格林尼治天文台的标准时间，因为本初子午线被定义在通过那里的经线。</p>
<p>设置完系统时间后,还需要同步到硬件时钟上</p>
<p>二、查看和修改时间</p>
<p>   1.显示时间 ：  </p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">date</span><br></pre></td></tr></table></figure>

<p>   2.修改时间  date -s  时间</p>
<pre><code>如：设置当前时间为：2018年12月10点50分

date -s  ‘2018-12-14 10:50:00’
</code></pre>
<p>   3.根据网络同步时间</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">使用ntp同步标准时间，ntp：网络时间协议（network time protol）</span><br><span class="line"></span><br><span class="line">安装：yum install ntp</span><br><span class="line"></span><br><span class="line">同步：ntpdate pool.ntp.org</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>centos</category>
        <category>date</category>
        <category>timezone</category>
      </categories>
      <tags>
        <tag>centos</tag>
        <tag>date</tag>
        <tag>timezone</tag>
      </tags>
  </entry>
  <entry>
    <title>CentOS 安装 cockpit 管理系统</title>
    <url>/CentOS-install-mamager-cockpit/</url>
    <content><![CDATA[<p> <a href="https://cockpit-project.org/">Cockpit</a> 是一个基于 Web 界面的应用，它提供了对系统的图形化管理。</p>
<p>拥有如下功能：</p>
<ol>
<li>监控系统活动（CPU、内存、磁盘 IO 和网络流量） —— 系统</li>
<li>查看系统日志条目 —— 日志</li>
<li>查看磁盘分区的容量 —— 存储</li>
<li>查看网络活动（发送和接收） —— 网络<span id="more"></span></li>
<li>查看用户帐户 —— 帐户</li>
<li>检查系统服务的状态 —— 服务</li>
<li>提取已安装应用的信息 —— 应用</li>
<li>查看和安装可用更新（如果以 root 身份登录）并在需要时重新启动系统 —— 软件更新</li>
<li>打开并使用终端窗口 —— 终端</li>
</ol>
<p>安装cockpit</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">yum -y install cockpit</span><br><span class="line">yum install cockpit* -y	#所有cockpit模块安装</span><br></pre></td></tr></table></figure>

<p>修改默认端口9090</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">vi /usr/lib/systemd/system/cockpit.socket</span><br></pre></td></tr></table></figure>

<p>启动cockpit</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">systemctl start cockpit</span><br></pre></td></tr></table></figure>

<p>开机自启动</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">vi /usr/lib/systemd/system/cockpit.service </span><br><span class="line"><span class="meta">#</span><span class="bash"> 在最后加上下面两行</span></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 退出编辑，加入系统启动</span></span><br><span class="line">systemctl enable cockpit</span><br></pre></td></tr></table></figure>

<p>防火墙配置</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">firewall-cmd --add-port=9090/tcp --permanent</span><br><span class="line">firewall-cmd --reload	</span><br></pre></td></tr></table></figure>

<p>登录<br>在任意浏览器输入IP地址+端口号（<a href="https://ip:9090）">https://ip:9090）</a></p>
]]></content>
      <categories>
        <category>Linux</category>
        <category>cockpit</category>
      </categories>
      <tags>
        <tag>Linux</tag>
        <tag>cockpit</tag>
      </tags>
  </entry>
  <entry>
    <title>清除Kubernetes环境</title>
    <url>/Clean-Kubernetes-Environment/</url>
    <content><![CDATA[<p>在学习过程中可能有机器加入Kubernetes时设置出错，可以从Kubernetes集群中移除并清理，然后再重新加入</p>
<h5 id="清理kubelet挂载的磁盘和设置"><a href="#清理kubelet挂载的磁盘和设置" class="headerlink" title="清理kubelet挂载的磁盘和设置"></a>清理kubelet挂载的磁盘和设置</h5><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">df -h|grep kubelet |awk -F % &#x27;&#123;print $2&#125;&#x27;|xargs umount</span><br><span class="line">rm /var/lib/kubelet/* -rf</span><br></pre></td></tr></table></figure>

<span id="more"></span>
<h5 id="清理kubernetes设置"><a href="#清理kubernetes设置" class="headerlink" title="清理kubernetes设置"></a>清理kubernetes设置</h5><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">rm /etc/kubernetes/* -rf</span><br></pre></td></tr></table></figure>

<h5 id="清理rancher设置"><a href="#清理rancher设置" class="headerlink" title="清理rancher设置"></a>清理rancher设置</h5> <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">rm /var/lib/rancher/* -rf</span><br></pre></td></tr></table></figure>

<h5 id="清理etc设置"><a href="#清理etc设置" class="headerlink" title="清理etc设置"></a>清理etc设置</h5> <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">rm /var/lib/etcd/* -rf</span><br></pre></td></tr></table></figure>

<h5 id="清理cni设置"><a href="#清理cni设置" class="headerlink" title="清理cni设置"></a>清理cni设置</h5> <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">rm /var/lib/cni/* -rf</span><br></pre></td></tr></table></figure>

<h5 id="清理iptable设置"><a href="#清理iptable设置" class="headerlink" title="清理iptable设置"></a>清理iptable设置</h5> <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">iptables -F &amp;&amp; iptables -t nat –F</span><br></pre></td></tr></table></figure>

<h5 id="清理flannel设置"><a href="#清理flannel设置" class="headerlink" title="清理flannel设置"></a>清理flannel设置</h5> <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ip link del flannel.1</span><br></pre></td></tr></table></figure>

<h5 id="清理docker-container"><a href="#清理docker-container" class="headerlink" title="清理docker container"></a>清理docker container</h5> <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker ps -a|awk &#x27;&#123;print $1&#125;&#x27;|xargs docker rm -f</span><br></pre></td></tr></table></figure>

<h5 id="清理docker挂载的磁盘"><a href="#清理docker挂载的磁盘" class="headerlink" title="清理docker挂载的磁盘"></a>清理docker挂载的磁盘</h5> <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker volume ls|awk &#x27;&#123;print $2&#125;&#x27;|xargs docker volume rm</span><br></pre></td></tr></table></figure>


<h5 id="合并在一起"><a href="#合并在一起" class="headerlink" title="合并在一起"></a>合并在一起</h5><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">df -h|grep kubelet |awk -F % &#x27;&#123;print $2&#125;&#x27;|xargs umount</span><br><span class="line">rm /var/lib/kubelet/* -rf</span><br><span class="line">rm /etc/kubernetes/* -rf</span><br><span class="line">rm /var/lib/rancher/* -rf</span><br><span class="line">rm /var/lib/etcd/* -rf</span><br><span class="line">rm /var/lib/cni/* -rf</span><br><span class="line">iptables -F &amp;&amp; iptables -t nat –F</span><br><span class="line">ip link del flannel.1</span><br><span class="line">docker ps -a|awk &#x27;&#123;print $1&#125;&#x27;|xargs docker rm -f</span><br><span class="line">docker volume ls|awk &#x27;&#123;print $2&#125;&#x27;|xargs docker volume rm</span><br></pre></td></tr></table></figure>



]]></content>
      <categories>
        <category>kubernetes</category>
        <category>docker</category>
        <category>rancher</category>
        <category>linux</category>
      </categories>
      <tags>
        <tag>kubernetes</tag>
        <tag>docker</tag>
        <tag>rancher</tag>
        <tag>linux</tag>
      </tags>
  </entry>
  <entry>
    <title>设计模式七大原则</title>
    <url>/Design-patter-7-principle/</url>
    <content><![CDATA[<h1 id="一、设计模式的目的"><a href="#一、设计模式的目的" class="headerlink" title="一、设计模式的目的"></a>一、设计模式的目的</h1><p>​    编写软件过程中，程序员面临着来自耦合性、内聚性以及可维护性，可扩展性，重用性，灵活性等多方面的挑战，设计模式是为了让程序(软件)，具有更好的</p>
<span id="more"></span>

<p>1） 代码重用性 （即：相同功能的代码，不用多次编写）</p>
<p>2）可读性（即：编程规范性，便于其他程序员的阅读和理解）</p>
<p>3）可扩展性（即：当我们要增加新的功能时，非常的方便，称为可维护）</p>
<p>4）可靠性（即：当我们增加新的功能后，对原来的功能没有影响）</p>
<p>5）使程序呈现高内聚，低耦合的特性</p>
<p>设计模式包含了面向对象的精髓，“懂了设计模式，你就懂了面向对象分析和设计（OOA/D）的精要”</p>
<h1 id="二、设计模式七大原则"><a href="#二、设计模式七大原则" class="headerlink" title="二、设计模式七大原则"></a>二、设计模式七大原则</h1><p>​        设计模式原则，其实就是程序员在编程时，应当遵守的原则，也是各种设计模式的基础（即：设计模式为什么这样设计的依据）</p>
<p>设计模式常用的七大原则有：</p>
<p>1）单一职责原则</p>
<p>2）接口隔离原则</p>
<p>3）依赖倒转（倒置）原则</p>
<p>4）里氏替换原则</p>
<p>5）开闭原则</p>
<p>6）迪米特法则</p>
<p>7）合成复用原则</p>
<h1 id="三、单一职责原则"><a href="#三、单一职责原则" class="headerlink" title="三、单一职责原则"></a>三、单一职责原则</h1><h2 id="3-1-基本介绍"><a href="#3-1-基本介绍" class="headerlink" title="3.1. 基本介绍"></a>3.1. 基本介绍</h2><p>​        对类来说，即一个类应该只负责一项职责。如果类 A 负责两个不同的职责：职责 1，职责 2 。当职责 1 需要变更改变 A 时，可能造成职责 2 执行错误，所以需要将类 A 的粒度分解为 A1，A2 。</p>
<h2 id="3-2-应用实例"><a href="#3-2-应用实例" class="headerlink" title="3.2. 应用实例"></a>3.2. 应用实例</h2><p>​        以交通工具案例讲解</p>
<h3 id="1）方案-1-【分析说明】"><a href="#1）方案-1-【分析说明】" class="headerlink" title="1）方案 1 【分析说明】"></a>1）方案 1 【分析说明】</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.hunkier.principle.singleresponsibility;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SingleResponsibility1</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    Vehicle vehicle = <span class="keyword">new</span> Vehicle();</span><br><span class="line">    vehicle.run(<span class="string">&quot;摩托车&quot;</span>);</span><br><span class="line">    vehicle.run(<span class="string">&quot;汽车&quot;</span>);</span><br><span class="line">    vehicle.run(<span class="string">&quot;飞机&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 交通工具类</span></span><br><span class="line"><span class="comment">// 方式 1</span></span><br><span class="line"><span class="comment">// 1. 在方式 1 的 run 方法中，违反了单一职责原则</span></span><br><span class="line"><span class="comment">// 2. 解决的方案非常的简单，根据交通工具运行方法不同，分解成不同类即可</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Vehicle</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">(String vehicle)</span> </span>&#123;</span><br><span class="line">    System.out.println(vehicle + <span class="string">&quot;在公路上运行...&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-方案-2-【分析说明】"><a href="#2-方案-2-【分析说明】" class="headerlink" title="2) 方案 2 【分析说明】"></a>2) 方案 2 【分析说明】</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.hunkier.principle.singleresponsibility;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SingleResponsibility2</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    RoadVehicle roadVehicle = <span class="keyword">new</span> RoadVehicle();</span><br><span class="line">    roadVehicle.run(<span class="string">&quot;摩托车&quot;</span>);</span><br><span class="line">    roadVehicle.run(<span class="string">&quot;汽车&quot;</span>);</span><br><span class="line">    </span><br><span class="line">    AirVehicle airVehicle = <span class="keyword">new</span> AirVehicle();</span><br><span class="line">    airVehicle.run(<span class="string">&quot;飞机&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 方案 2 的分析</span></span><br><span class="line"><span class="comment">// 1. 遵守单一职责原则</span></span><br><span class="line"><span class="comment">// 2. 但是这样做的改动很大，即将类分解，同时修改客户端</span></span><br><span class="line"><span class="comment">// 3. 改进：直接修改 Vehicle 类，改动的代码会比较少 =&gt; 方案3</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RoadVehicle</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">(String vehicle)</span> </span>&#123;</span><br><span class="line">    System.out.println(vehicle + <span class="string">&quot;公路运行&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AirVehicle</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">(String vehicle)</span> </span>&#123;</span><br><span class="line">    System.out.println(vehicle + <span class="string">&quot;天空运行&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">WaterVehicle</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">(String vehicle)</span></span>&#123;</span><br><span class="line">    System.out.println(vehicle + <span class="string">&quot;水中运行&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-方案-3-【分析说明】"><a href="#3-方案-3-【分析说明】" class="headerlink" title="3) 方案 3 【分析说明】"></a>3) 方案 3 【分析说明】</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.hunkier.principle.singleresponsibility;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SingleResponsibility3</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    Vehicle2 vehicle2 = <span class="keyword">new</span> Vehicle2();</span><br><span class="line">    vehicle2.run(<span class="string">&quot;汽车&quot;</span>);</span><br><span class="line">    vehicle2.runWater(<span class="string">&quot;轮船&quot;</span>);</span><br><span class="line">    vehicle2.runAir(<span class="string">&quot;飞机&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 方案 3 的分析</span></span><br><span class="line"><span class="comment">// 1. 这种修改方法没有对原来的类做大的修改，只是增加方法</span></span><br><span class="line"><span class="comment">// 2. 这里虽然没有在类这个级别上遵守单一职责原则，但是在方法级别上，仍然是遵守单一职责</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Vehicle2</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">(String vehicle)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 处理</span></span><br><span class="line">    System.out.println(vehicle + <span class="string">&quot; 在公路上运行...&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">runAir</span><span class="params">(String vehicle)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 处理</span></span><br><span class="line">    System.out.println(vehicle + <span class="string">&quot; 在天空上运行...&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">runWater</span><span class="params">(String vehicle)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 处理</span></span><br><span class="line">    System.out.println(vehicle + <span class="string">&quot; 在水中运行...&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="3-3-单一职责原则注意事项和细节"><a href="#3-3-单一职责原则注意事项和细节" class="headerlink" title="3.3. 单一职责原则注意事项和细节"></a>3.3. 单一职责原则注意事项和细节</h3><ol>
<li>降低类的复杂度，一个类只负责一项职责。</li>
<li>提高类的可读性，可维护性</li>
<li>降低变更引起的风险</li>
<li>通常情况下，我们应该遵守单一职责原则，只有逻辑足够简单，才可以在代码级别违反单一职责原则：只有类中方法数量足够少，可以在方法级别保持单一职责原则</li>
</ol>
<h1 id="四、-接口隔离原则"><a href="#四、-接口隔离原则" class="headerlink" title="四、 接口隔离原则"></a>四、 接口隔离原则</h1><h2 id="4-1-基本介绍"><a href="#4-1-基本介绍" class="headerlink" title="4.1. 基本介绍"></a>4.1. 基本介绍</h2><p>1）客户端不应该依赖它不需要的接口，即一个类对另一个类的依赖应该建立在最小的接口上</p>
<p>2）类 A 通过接口 Interface1 依赖类 B，类 C 通过接口 Interface1 依赖类 D，如果接口 Interface1 对于类 A 和类 C 来说不是最小接口，那么类 B 和类 D 必须去实现他们不需要的方法。</p>
<p>3）按隔离原则应当这样处理：</p>
<p>将接口 Interface1 拆分为独立的几个接口（这里我们拆分为 3 个接口），类 A 和 类 C 分别与他们需要的接口建立依赖关系。也就是采用接口隔离原则</p>
<h2 id="4-2-应用实例"><a href="#4-2-应用实例" class="headerlink" title="4.2. 应用实例"></a>4.2. 应用实例</h2><p>1）类 A 通过接口 Interface1 依赖类 B，类 C 通过接口 Interface1 依赖类 D，请编写代码完成此应用实例。</p>
<p>2）没有使用接口隔离原则代码</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.hunkier.principle.segregation;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Segregation1</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">    </span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 接口</span></span><br><span class="line">Interface Interface1&#123;</span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">operation1</span><span class="params">()</span></span>;</span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">operation2</span><span class="params">()</span></span>;</span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">operation3</span><span class="params">()</span></span>;</span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">operation4</span><span class="params">()</span></span>;</span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">operation5</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span> <span class="keyword">implements</span> <span class="title">Interface1</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">operation1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;B 实现了 operation1&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">operation2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;B 实现了 operation2 &quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">operation3</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;B 实现了 operation3 &quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">operation4</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;B 实现了 operation4 &quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">operation5</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;B 实现了 operation5 &quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">D</span> <span class="keyword">implements</span> <span class="title">Interface1</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">operation1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;D 实现了 operation1&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">operation2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;D 实现了 operation2 &quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">operation3</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;D 实现了 operation3 &quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">operation4</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;D 实现了 operation4 &quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">operation5</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;D 实现了 operation5 &quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span></span>&#123; <span class="comment">// A 类通过接口 Interface1 依赖（使用）B 类，但是只会用到 1，2，3 方法</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">depend1</span><span class="params">(Interface1 i)</span></span>&#123;</span><br><span class="line">    i.operation1();</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">depend2</span><span class="params">(Interface1 i)</span></span>&#123;</span><br><span class="line">    i.operation2();</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">depend3</span><span class="params">(Interface1 i)</span></span>&#123;</span><br><span class="line">    i.operation3();</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span> </span>&#123; <span class="comment">// C 类通过接口 Interface1 依赖（使用）D 类，但是只会用到 1，4，5 方法</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">depend1</span><span class="params">(Interface1 i)</span></span>&#123;</span><br><span class="line">    i.operation1();</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">depend4</span><span class="params">(Interface1 i)</span></span>&#123;</span><br><span class="line">    i.operation5();</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">depend5</span><span class="params">(Interface1 i)</span></span>&#123;</span><br><span class="line">    i.operation5();</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="4-3-使用传统方法的问题和使用接口隔离原则改进"><a href="#4-3-使用传统方法的问题和使用接口隔离原则改进" class="headerlink" title="4.3.  使用传统方法的问题和使用接口隔离原则改进"></a>4.3.  使用传统方法的问题和使用接口隔离原则改进</h2><p>1）类 A 通过接口 Ingerface1 依赖类 B，类 C 通过接口 Interface1 依赖类 D，如果接口 Interface1 对于类 A 和 类 C来说不是最小接口，那么类 B 和类 D 必须去实现他们不需要的方法</p>
<p>2）将接口 Interface1 拆分为独立的几个接口，类 A 和类 C 分别与他们需要的接口建立依赖关系。也就是采用接口隔离原则</p>
<p>3）接口 Interface1 中出现的方法，根据实际情况拆分为三个接口：接口 Interface1 包含方法 operation1，Interface2 包含方法 operation2、operation3，接口 Interface3 包含方法 operation4、operation5</p>
<p>4）代码实现</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.hunkier.principle.segregation.improve;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Segregation1</span> </span>&#123;</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">  	<span class="comment">// 使用</span></span><br><span class="line">  	A a = <span class="keyword">new</span> A();</span><br><span class="line">  	a.depend1(<span class="keyword">new</span> B()); <span class="comment">// A 类通过接口去依赖 B 类</span></span><br><span class="line">  	a.depend2(<span class="keyword">new</span> B());</span><br><span class="line">  	a.depend3(<span class="keyword">new</span> B());</span><br><span class="line">  </span><br><span class="line">  	C c = <span class="keyword">new</span> C();</span><br><span class="line">  </span><br><span class="line">  	c.depend1(<span class="keyword">new</span> D()); <span class="comment">// C 类通过接口去依赖（使用）D 类</span></span><br><span class="line">  	c.depend4(<span class="keyword">new</span> D());</span><br><span class="line">  	c.depend5(<span class="keyword">new</span> D());</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 接口 1</span></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Interface1</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">operation1</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 接口 2</span></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Interface2</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">operation2</span><span class="params">()</span></span>;</span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">operation3</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 接口 3</span></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Interface3</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">operation4</span><span class="params">()</span></span>;</span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">operation5</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span> <span class="keyword">implements</span> <span class="title">Interface1</span>, <span class="title">Interface2</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">operation1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;B 实现了 operation1 &quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">operation2</span><span class="params">()</span></span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;B 实现了 operation2 &quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">operation3</span><span class="params">()</span></span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;B 实现了 operation3 &quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">D</span> <span class="keyword">implements</span> <span class="title">Interface1</span>, <span class="title">Interface2</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">operation1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;D 实现了 operation1 &quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">operation4</span><span class="params">()</span></span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;D 实现了 operation4 &quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">operation5</span><span class="params">()</span></span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;D 实现了 operation5 &quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span> </span>&#123; <span class="comment">// A 类通过接口 Interface1、Interface2 依赖（使用）B 类，但是只会用到 1，2，3 方法</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">depend1</span><span class="params">(Interface1 i)</span></span>&#123;</span><br><span class="line">    i.operation1();</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">depend2</span><span class="params">(Interface2 i)</span></span>&#123;</span><br><span class="line">    i.operation2();</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">depend3</span><span class="params">(Interface2 i)</span></span>&#123;</span><br><span class="line">    i.operation3();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span> </span>&#123; <span class="comment">// C 类通过接口 Interface1，Interface3 依赖（使用）D 类，但是只会用到方法 1，4，5 </span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">depend1</span><span class="params">(Interface1 i)</span></span>&#123;</span><br><span class="line">    i.operation1();</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">depend4</span><span class="params">(Interface3 i)</span></span>&#123;</span><br><span class="line">    i.operation4();</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">depend5</span><span class="params">(Interface3 i)</span></span>&#123;</span><br><span class="line">    i.operation5();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h1 id="5-依赖倒转原则"><a href="#5-依赖倒转原则" class="headerlink" title="5. 依赖倒转原则"></a>5. 依赖倒转原则</h1><h2 id="5-1-基本介绍"><a href="#5-1-基本介绍" class="headerlink" title="5.1.  基本介绍"></a>5.1.  基本介绍</h2><p>依赖倒转原则（Dependence Inversion Principle）是指：</p>
<p>1）高层模块不应该依赖底层模块，二者都应该依赖器抽象</p>
<p>2）抽象不应该依赖细节，细节应该依赖抽象</p>
<p>3）依赖倒转（倒置）的中心思想是面向接口编程</p>
<p>4）依赖倒转原则是基于这样的设计理念：相对于细节的多变性，抽象的东西要稳定的多。以抽象为基础搭建的架构比以细节为基础的架构要稳定的多。在 Java 中，抽象指的是接口或者抽象类，细节就是具体的实现类</p>
<p>5）使用接口或者抽象类的目的是制定好规范，而不涉及任何具体的操作，把展现细节的任务交给实现类去完成</p>
<h2 id="5-2-应用实例"><a href="#5-2-应用实例" class="headerlink" title="5.2. 应用实例"></a>5.2. 应用实例</h2><p>请编程完成 Person 接收消息的功能。</p>
<p>1）实现方案 1 + 分析说明</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.hunkier.principle.inversion;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DependecyInversion</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> stativ <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    Person person = <span class="keyword">new</span> Person();</span><br><span class="line">    person.receive(<span class="keyword">new</span> Email());</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Email</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> String <span class="title">getInfo</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;电子邮件信息：hello，world&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//  完成 Person 接收消息的功能</span></span><br><span class="line"><span class="comment">// 方式 1 分析</span></span><br><span class="line"><span class="comment">// 1. 简单，比较容易想到</span></span><br><span class="line"><span class="comment">// 2. 如果我们获取的对象是 微信、短信 等，则新增类，同时 Person 也要增加相应的接收方法</span></span><br><span class="line"><span class="comment">// 3. 解决思路：引入一个抽象的接口 IReceiver，表示接收者，这样 Person 类与接口 IReceiver 发生依赖</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 因为 Emaill，WeiXin 等属于接收的范围，他们各自实现 IReceiver 接口就 ok，这样我们就符合依赖倒转原则</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">receive</span><span class="params">(Email email)</span> </span>&#123;</span><br><span class="line">    System.out.println(email.getInfo());</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>实现方案 2 （依赖倒转）+ 分析说明</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.hunkier.principle.inversion.improve;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DependecyInversion</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">    <span class="comment">// 客户端无需改变</span></span><br><span class="line">    Person person = <span class="keyword">new</span> Person();</span><br><span class="line">    person.receive(<span class="keyword">new</span> Email());</span><br><span class="line">    person.receive(<span class="keyword">new</span> Weixin());</span><br><span class="line">    </span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义接口</span></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">IReceiver</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> String <span class="title">getInfo</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Email</span> <span class="keyword">implements</span> <span class="title">IReceiver</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> String <span class="title">getInfo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;电子邮件信息：hello，world&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 增加微信</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Weixin</span> <span class="keyword">implements</span> <span class="title">IReceiver</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> String <span class="title">getInfo</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;微信消息：hello，ok&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 方式 2</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">  <span class="comment">// 这里我们是对接口的依赖</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">receive</span><span class="params">(IReceiver receiver)</span></span>&#123;</span><br><span class="line">    System.out.println(receiver.getInfo());</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="5-3-依赖关系传递的三种方式和应用案例"><a href="#5-3-依赖关系传递的三种方式和应用案例" class="headerlink" title="5.3. 依赖关系传递的三种方式和应用案例"></a>5.3. 依赖关系传递的三种方式和应用案例</h2><p>1）接口传递</p>
<p>​    应用案例代码</p>
<p>2）构造方法传递</p>
<p>​    应用案例代码</p>
<p>3） setter 方式传递</p>
<p>​    应用案例代码</p>
<p>4）代码演示</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.hunkier.principle.inversion.improve;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DependencyPass</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    ChangHong changhong = <span class="keyword">new</span> ChangHong();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 接口传递</span></span><br><span class="line">    <span class="comment">// OpenAndClose openAndClose = new OpenAndClose();</span></span><br><span class="line">    <span class="comment">// openAndClose.open(changHong);</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 通过构造器进行依赖传递</span></span><br><span class="line">    <span class="comment">// OpenAndClose openAndClose = new OpenAndClose(changHong);</span></span><br><span class="line">    <span class="comment">// openAndClose.open();</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 通过 setter 方法进行依赖传递</span></span><br><span class="line">    OpenAndClose openAndClose = <span class="keyword">new</span> OpenAndClose();</span><br><span class="line">    openAndClose.setTv(changHong);</span><br><span class="line">    openAndClose.open();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 方式 1：通过接口传递实现依赖</span></span><br><span class="line"><span class="comment">// 开关的接口</span></span><br><span class="line"><span class="comment">// interface IOpenAndClose &#123;</span></span><br><span class="line"><span class="comment">//    public void open(ITV tv);// 抽象方法，接收接口	</span></span><br><span class="line"><span class="comment">//&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// interface ITV &#123; // ITV 接口</span></span><br><span class="line"><span class="comment">//  public void play();</span></span><br><span class="line"><span class="comment">//&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// class ChongHong implements ITV &#123;</span></span><br><span class="line"><span class="comment">//   @Override</span></span><br><span class="line"><span class="comment">//   public void play() &#123;</span></span><br><span class="line"><span class="comment">//     System.out.println(&quot;长虹电视机，打开&quot;);</span></span><br><span class="line"><span class="comment">//  &#125;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 实现接口</span></span><br><span class="line"><span class="comment">// class OpenAndClose implements IOpenAndClose &#123;</span></span><br><span class="line"><span class="comment">//     public void open(ITV tv)&#123;</span></span><br><span class="line"><span class="comment">//        tv.play();</span></span><br><span class="line"><span class="comment">//    &#125;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 方式 2：通过构造方法依赖传递</span></span><br><span class="line"><span class="comment">// interface IOpenAndClose &#123;</span></span><br><span class="line"><span class="comment">//  	public void open(); // 抽象方法</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// interface ITV &#123; // ITV 接口</span></span><br><span class="line"><span class="comment">//     public void play();</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// class OpenAndClose Implements IOpenAndClose &#123;</span></span><br><span class="line"><span class="comment">//    public ITV iv; // 成员</span></span><br><span class="line"><span class="comment">//  	public OpenAndClose(ITV tv) &#123;</span></span><br><span class="line"><span class="comment">//     		this.tv = tv ;</span></span><br><span class="line"><span class="comment">//   &#125;</span></span><br><span class="line"><span class="comment">//   public void open() &#123;</span></span><br><span class="line"><span class="comment">//      this.tv.play();</span></span><br><span class="line"><span class="comment">// 		&#125;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//  方法 3，通过 setter 方法传递</span></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">IOpenAndClose</span> </span>&#123;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>设计模式</category>
        <category>七大原则</category>
      </categories>
      <tags>
        <tag>设计模式</tag>
        <tag>七大原则</tag>
      </tags>
  </entry>
  <entry>
    <title>常用的Shell脚本和Linux命令</title>
    <url>/Common-shell-script/</url>
    <content><![CDATA[<p>收集工作中经常用的Linux命令和shell脚本</p>
<h5 id="zip-压缩和解压缩"><a href="#zip-压缩和解压缩" class="headerlink" title="zip 压缩和解压缩"></a>zip 压缩和解压缩</h5><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 压缩文件夹</span></span><br><span class="line">zip -r data.zip  data</span><br><span class="line"><span class="meta">#</span><span class="bash"> 解压缩文件,默认解压到当前路径</span></span><br><span class="line">unzip data.zip</span><br><span class="line"><span class="meta">#</span><span class="bash"> 解压到指定路径</span></span><br><span class="line">unzip data.zip -d destDir</span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看帮助</span></span><br><span class="line">unzip -h</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<span id="more"></span>

<h5 id="tar-压缩和解压缩"><a href="#tar-压缩和解压缩" class="headerlink" title="tar 压缩和解压缩"></a>tar 压缩和解压缩</h5><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 压缩文件夹</span></span><br><span class="line">tar -czf data.tar.gz data</span><br><span class="line"><span class="meta">#</span><span class="bash"> 解压缩到当前路径</span></span><br><span class="line">tar -xzf data.tar.gz -C /destDir</span><br></pre></td></tr></table></figure>

<h5 id="tail查看和过滤日志文件"><a href="#tail查看和过滤日志文件" class="headerlink" title="tail查看和过滤日志文件"></a>tail查看和过滤日志文件</h5><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 动态输出Tomcat日志到控制台</span></span><br><span class="line">tail -1000f catalina.out</span><br><span class="line"><span class="meta">#</span><span class="bash"> 按字段过滤日志</span></span><br><span class="line">tail -1000f catalina.out | grap -A 20 &#x27;ERROR&#x27;</span><br></pre></td></tr></table></figure>

<h5 id="netstat-查看监听端口的进程"><a href="#netstat-查看监听端口的进程" class="headerlink" title="netstat 查看监听端口的进程"></a>netstat 查看监听端口的进程</h5><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 查看监听端口为1600的进程</span></span><br><span class="line">netstat -tlpn | grep &quot;\b16000\b&quot;</span><br></pre></td></tr></table></figure>

<h5 id="kill停止指定进程"><a href="#kill停止指定进程" class="headerlink" title="kill停止指定进程"></a>kill停止指定进程</h5><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 停止当前路径下的应用进程</span></span><br><span class="line">kill -9 $(ps -ef|grep $(pwd)|grep -v grep|awk &#x27;&#123;print $2&#125;&#x27;)</span><br><span class="line"><span class="meta">#</span><span class="bash"> 停止监听端口为1600的进程</span></span><br><span class="line">kill -9 $(netstat -tlpn | grep &quot;\b16000\b&quot; | awk &#x27;&#123;print $7&#125;&#x27; | cut -d &#x27;/&#x27; -f 1)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h5 id="sed替换文件内容"><a href="#sed替换文件内容" class="headerlink" title="sed替换文件内容"></a>sed替换文件内容</h5><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 替换Tomcat默认端口</span></span><br><span class="line">sed -i &quot;s|&lt;Connector port=\&quot;8080\&quot;|&lt;Connector port=\&quot;51000\&quot;|g&quot; server.xml &amp;&amp; \</span><br><span class="line">sed -i &quot;s|&lt;Connector port=\&quot;8009\&quot;|&lt;Connector port=\&quot;51080\&quot;|g&quot; server.xml</span><br></pre></td></tr></table></figure>

<h5 id="shell-判断文件夹或文件是否存在"><a href="#shell-判断文件夹或文件是否存在" class="headerlink" title="shell 判断文件夹或文件是否存在"></a>shell 判断文件夹或文件是否存在</h5><p>文件夹不存在则创建</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> [ ! -d <span class="string">&quot;/data/&quot;</span> ];<span class="keyword">then</span></span><br><span class="line">mkdir /data</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;文件夹已经存在&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>

<p>文件存在则删除</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> [ ! -f <span class="string">&quot;/data/filename&quot;</span> ];<span class="keyword">then</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;文件不存在&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">rm -f /data/filename</span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>

<p>判断文件夹是否存在</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> [ -d <span class="string">&quot;/data/&quot;</span> ];<span class="keyword">then</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;文件夹存在&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;文件夹不存在&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>

<p>判断文件是否存在</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> [ -f <span class="string">&quot;/data/filename&quot;</span> ];<span class="keyword">then</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;文件存在&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;文件不存在&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>

<p>文件比较符</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">-e 判断对象是否存在</span><br><span class="line">-d 判断对象是否存在，并且为目录</span><br><span class="line">-f 判断对象是否存在，并且为常规文件</span><br><span class="line">-L 判断对象是否存在，并且为符号链接</span><br><span class="line">-h 判断对象是否存在，并且为软链接</span><br><span class="line">-s 判断对象是否存在，并且长度不为0</span><br><span class="line">-r 判断对象是否存在，并且可读</span><br><span class="line">-w 判断对象是否存在，并且可写</span><br><span class="line">-x 判断对象是否存在，并且可执行</span><br><span class="line">-O 判断对象是否存在，并且属于当前用户</span><br><span class="line">-G 判断对象是否存在，并且属于当前用户组</span><br><span class="line">-nt 判断file1是否比file2新  [ <span class="string">&quot;/data/file1&quot;</span> -nt <span class="string">&quot;/data/file2&quot;</span> ]</span><br><span class="line">-ot 判断file1是否比file2旧  [ <span class="string">&quot;/data/file1&quot;</span> -ot <span class="string">&quot;/data/file2&quot;</span> ]</span><br></pre></td></tr></table></figure>

<h5 id="判断某个变量是否包含字符串-变量的方法"><a href="#判断某个变量是否包含字符串-变量的方法" class="headerlink" title="判断某个变量是否包含字符串/变量的方法"></a>判断某个变量是否包含字符串/变量的方法</h5><p>尝试了有3种方法：</p>
<ol>
<li>使用“=~”符号，注意前后必须要有空格！</li>
</ol>
<p><strong>可以输出正确结果,被匹配的字符串必须要有引号括起来！</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">➜  ~ a1=<span class="string">&#x27;hello.world&#x27;</span></span><br><span class="line">➜  ~ a2=<span class="string">&#x27;helloworld&#x27;</span></span><br><span class="line">➜  ~ b=<span class="string">&#x27;.&#x27;</span></span><br><span class="line">➜  ~ <span class="keyword">if</span> [[ <span class="variable">$&#123;a1&#125;</span> =~ <span class="string">&#x27;.&#x27;</span> ]];<span class="keyword">then</span> <span class="built_in">echo</span> <span class="string">&quot;yes&quot;</span>;<span class="keyword">else</span> <span class="built_in">echo</span> <span class="string">&quot;no&quot;</span>;<span class="keyword">fi</span></span><br><span class="line">yes</span><br><span class="line">➜  ~ <span class="keyword">if</span> [[ <span class="variable">$&#123;a2&#125;</span> =~ <span class="string">&#x27;.&#x27;</span> ]];<span class="keyword">then</span> <span class="built_in">echo</span> <span class="string">&quot;yes&quot;</span>;<span class="keyword">else</span> <span class="built_in">echo</span> <span class="string">&quot;no&quot;</span>;<span class="keyword">fi</span></span><br><span class="line">yes</span><br><span class="line">➜  ~ <span class="keyword">if</span> [[ <span class="variable">$&#123;a1&#125;</span> =~ <span class="string">&quot;.&quot;</span> ]];<span class="keyword">then</span> <span class="built_in">echo</span> <span class="string">&quot;yes&quot;</span>;<span class="keyword">else</span> <span class="built_in">echo</span> <span class="string">&quot;no&quot;</span>;<span class="keyword">fi</span></span><br><span class="line">yes</span><br><span class="line">➜  ~ <span class="keyword">if</span> [[ <span class="variable">$&#123;a2&#125;</span> =~ <span class="string">&quot;.&quot;</span> ]];<span class="keyword">then</span> <span class="built_in">echo</span> <span class="string">&quot;yes&quot;</span>;<span class="keyword">else</span> <span class="built_in">echo</span> <span class="string">&quot;no&quot;</span>;<span class="keyword">fi</span></span><br><span class="line">yes</span><br><span class="line">➜  ~ <span class="keyword">if</span> [[ <span class="variable">$&#123;a1&#125;</span> =~ <span class="string">&quot;<span class="variable">$&#123;b&#125;</span>&quot;</span> ]];<span class="keyword">then</span> <span class="built_in">echo</span> <span class="string">&quot;yes&quot;</span>;<span class="keyword">else</span> <span class="built_in">echo</span> <span class="string">&quot;no&quot;</span>;<span class="keyword">fi</span></span><br><span class="line">yes</span><br><span class="line">➜  ~ <span class="keyword">if</span> [[ <span class="variable">$&#123;a2&#125;</span> =~ <span class="string">&quot;<span class="variable">$&#123;b&#125;</span>&quot;</span> ]];<span class="keyword">then</span> <span class="built_in">echo</span> <span class="string">&quot;yes&quot;</span>;<span class="keyword">else</span> <span class="built_in">echo</span> <span class="string">&quot;no&quot;</span>;<span class="keyword">fi</span></span><br><span class="line">yes</span><br><span class="line">➜  ~ </span><br></pre></td></tr></table></figure>

<p><strong>不能输出正确结果</strong> </p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">➜  ~  a1=<span class="string">&#x27;hello.world&#x27;</span></span><br><span class="line">➜  ~ <span class="string">&#x27;</span></span><br><span class="line"><span class="string">➜  ~  b=&#x27;</span>.<span class="string">&#x27;</span></span><br><span class="line"><span class="string">➜  ~  if [[ $&#123;a1&#125; =~ . ]];then echo &quot;yes&quot;;else echo &quot;no&quot;;fi</span></span><br><span class="line"><span class="string">yes</span></span><br><span class="line"><span class="string">➜  ~  if [[ $&#123;a2&#125; =~ . ]];then echo &quot;yes&quot;;else echo &quot;no&quot;;fi</span></span><br><span class="line"><span class="string">yes</span></span><br><span class="line"><span class="string">➜  ~  if [[ $&#123;a1&#125; =~ $&#123;b&#125; ]];then echo &quot;yes&quot;;else echo &quot;no&quot;;fi</span></span><br><span class="line"><span class="string">yes</span></span><br><span class="line"><span class="string">➜  ~  if [[ $&#123;a2&#125; =~ $&#123;b&#125; ]];then echo &quot;yes&quot;;else echo &quot;no&quot;;fi</span></span><br><span class="line"><span class="string">yes</span></span><br><span class="line"><span class="string">➜  ~  if [[ $&#123;a1&#125; =~ &#x27;</span><span class="variable">$&#123;b&#125;</span><span class="string">&#x27; ]];then echo &quot;yes&quot;;else echo &quot;no&quot;;fi</span></span><br><span class="line"><span class="string">no</span></span><br><span class="line"><span class="string">➜  ~  if [[ $&#123;a2&#125; =~ &#x27;</span><span class="variable">$&#123;b&#125;</span><span class="string">&#x27; ]];then echo &quot;yes&quot;;else echo &quot;no&quot;;fi</span></span><br><span class="line"><span class="string">no</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>使用”==“加通配符wildcard，注意等号前后必须有空格，注意，通配符跟正则表达式有所区别，*表示匹配 0 或多个字符</li>
</ol>
<p> <strong>可以输出正确结果</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">➜  ~  a1=&#x27;hello.world&#x27;</span><br><span class="line">➜  ~  a2=&#x27;helloworld&#x27;</span><br><span class="line">➜  ~  if [[ $&#123;a1&#125; == *.* ]];then echo &quot;yes&quot;;else echo &quot;no&quot;;fi</span><br><span class="line">yes</span><br><span class="line">➜  ~  if [[ $&#123;a2&#125; == *.* ]];then echo &quot;yes&quot;;else echo &quot;no&quot;;fi</span><br><span class="line">no</span><br></pre></td></tr></table></figure>

<p><strong>不能输出正确结果 ，通配符不能用括号括起来！</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">➜  ~  a1=&#x27;hello.world&#x27;</span><br><span class="line">➜  ~  a2=&#x27;helloworld&#x27;</span><br><span class="line">➜  ~  if [[ $&#123;a2&#125; == &quot;*.*&quot; ]];then echo &quot;yes&quot;;else echo &quot;no&quot;;fi</span><br><span class="line">no</span><br><span class="line">➜  ~  if [[ $&#123;a1&#125; == &quot;*.*&quot; ]];then echo &quot;yes&quot;;else echo &quot;no&quot;;fi</span><br><span class="line">no</span><br><span class="line">➜  ~  if [[ $&#123;a1&#125; == &#x27;*.*&#x27; ]];then echo &quot;yes&quot;;else echo &quot;no&quot;;fi</span><br><span class="line">no</span><br><span class="line">➜  ~  if [[ $&#123;a2&#125; == &#x27;*.*&#x27; ]];then echo &quot;yes&quot;;else echo &quot;no&quot;;fi</span><br><span class="line">no</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>使用echo + grep -q 选项</li>
</ol>
<p><strong>使用这种方法时匹配是否有”.”会不正常，所以我们换成匹配普通字符，有没有括号都可以</strong> </p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">➜  ~  a1=&#x27;hello.world&#x27;</span><br><span class="line">➜  ~  a2=&#x27;helloworld&#x27;</span><br><span class="line">➜  ~  a3=&quot;helloworlda&quot;</span><br><span class="line">➜  ~  if ( echo $&#123;a1&#125; |grep -q a );then echo &quot;yes&quot;;else echo &quot;no&quot;;fi</span><br><span class="line">no</span><br><span class="line">➜  ~  if ( echo $&#123;a2&#125; |grep -q a );then echo &quot;yes&quot;;else echo &quot;no&quot;;fi</span><br><span class="line">no</span><br><span class="line">➜  ~  if ( echo $&#123;a3&#125; |grep -q a );then echo &quot;yes&quot;;else echo &quot;no&quot;;fi</span><br><span class="line">yes</span><br><span class="line">➜  ~  if ( echo $&#123;a1&#125; |grep -q &#x27;a&#x27; );then echo &quot;yes&quot;;else echo &quot;no&quot;;fi</span><br><span class="line">no</span><br><span class="line">➜  ~  if ( echo $&#123;a2&#125; |grep -q &#x27;a&#x27; );then echo &quot;yes&quot;;else echo &quot;no&quot;;fi</span><br><span class="line">no</span><br><span class="line">➜  ~  if ( echo $&#123;a3&#125; |grep -q &#x27;a&#x27; );then echo &quot;yes&quot;;else echo &quot;no&quot;;fi</span><br><span class="line">yes</span><br><span class="line">➜  ~  if ( echo $&#123;a1&#125; |grep -q &quot;a&quot; );then echo &quot;yes&quot;;else echo &quot;no&quot;;fi</span><br><span class="line">no</span><br><span class="line">➜  ~  if ( echo $&#123;a2&#125; |grep -q &quot;a&quot; );then echo &quot;yes&quot;;else echo &quot;no&quot;;fi</span><br><span class="line">no</span><br><span class="line">➜  ~  if ( echo $&#123;a3&#125; |grep -q &quot;a&quot; );then echo &quot;yes&quot;;else echo &quot;no&quot;;fi</span><br><span class="line">yes</span><br></pre></td></tr></table></figure>



<h5 id="crontab定时任务"><a href="#crontab定时任务" class="headerlink" title="crontab定时任务"></a>crontab定时任务</h5><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">crontab -e</span><br><span class="line"><span class="meta">#</span><span class="bash"> 每分钟执行一次monitor.sh脚步</span></span><br><span class="line">*/1 * * * * /usr/java/monitor.sh</span><br><span class="line"><span class="meta">#</span><span class="bash"> 数据库备份</span></span><br><span class="line">0 3 * * *  /bin/sh /data1/script/databak.sh &amp;</span><br><span class="line">0 4 * * * find /data1/databak -type f -mtime +3 -exec rm &#123;&#125; \;</span><br></pre></td></tr></table></figure>

<h5 id="databak-sh内容"><a href="#databak-sh内容" class="headerlink" title="databak.sh内容"></a><code>databak.sh</code>内容</h5><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line">/usr/bin/mysqldump -uroot -p123456 test &gt;/data1/databak/`date +%Y%m%d`test.sql 2&gt;/dev/null</span><br></pre></td></tr></table></figure>

<h5 id="监控Tomcat是否正常启动"><a href="#监控Tomcat是否正常启动" class="headerlink" title="监控Tomcat是否正常启动"></a>监控Tomcat是否正常启动</h5><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">!/bin/sh</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 定义环境变量（要改成自己的jdk相关地址）</span></span><br><span class="line">PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin</span><br><span class="line">export JAVA_HOME=/usr/lib/jvm/jdk1.8.0_191-oraclejdk</span><br><span class="line">export CLASSPATH=$JAVA_HOME/lib:$JAVA_HOME/lib/tools.jar</span><br><span class="line">export PATH=$PATH:$JAVA_HOME/bin</span><br><span class="line">TomcatHome=/opt/webserver/pf-platform</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">获取tomcat进程ID（这里注意tomcat7要改成自己的tomcat目录名）</span></span><br><span class="line">TomcatID=$(ps -ef |grep tomcat |grep -w $TomcatHome|grep -v &#x27;grep&#x27;|awk &#x27;&#123;print $2&#125;&#x27;)</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">tomcat启动程序(这里注意要改成自己tomcat实际安装的路径)</span></span><br><span class="line"></span><br><span class="line">StartTomcat=$TomcatHome/bin/startup.sh</span><br><span class="line">TomcatCache=$TomcatHome/work</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">自己定义要监控的页面地址，页面越简单越好，比如：页面上写个success即可</span></span><br><span class="line">WebUrl=http://172.20.8.5:41000/pf-platform/login/login</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">日志输出 （自己定义地址，用于输出监控日志和监控报错日志）</span></span><br><span class="line"><span class="meta">#</span><span class="bash">TomcatMonitorLog=<span class="variable">$TomcatHome</span>/TomcatMonitor-$(date <span class="string">&#x27;+%Y%m%d%H%M%S&#x27;</span>).<span class="built_in">log</span></span></span><br><span class="line">TomcatMonitorLog=$TomcatHome/logs/TomcatMonitor-$(date &#x27;+%Y-%m-%d&#x27;).log</span><br><span class="line">GetPageInfo=$TomcatHome/logs/PageInfo-$(date &#x27;+%Y-%m-%d&#x27;).log</span><br><span class="line">if [ ! -d $TomcatHome/logs ]; then mkdir -p $TomcatHome/logs ; fi</span><br><span class="line">Monitor()</span><br><span class="line">&#123;</span><br><span class="line">echo &quot;[info]开始监控tomcat...[$(date +&#x27;%F %H:%M:%S&#x27;)]&quot;</span><br><span class="line">if [[ $TomcatID ]];then # 这里判断TOMCAT进程是否存在</span><br><span class="line">                echo &quot;[info]当前tomcat进程ID为:$TomcatID,继续检测页面...&quot;</span><br><span class="line">                # 检测是否启动成功(成功的话页面会返回状态&quot;302&quot;)</span><br><span class="line">                TomcatServiceCode=$(curl -s -o $GetPageInfo -m 10 --connect-timeout 10 $WebUrl -w %&#123;http_code&#125;)</span><br><span class="line">                if [ $TomcatServiceCode -eq 302 ];then</span><br><span class="line">                                echo &quot;[info]页面返回码为$TomcatServiceCode,tomcat启动成功,测试页面正常......&quot;</span><br><span class="line">                        else</span><br><span class="line">                                echo &quot;[error]tomcat页面出错,请注意......状态码为$TomcatServiceCode,错误日志已输出到$GetPageInfo&quot;</span><br><span class="line">                                echo &quot;[error]页面访问出错,开始重启tomcat&quot;</span><br><span class="line">                                kill -9 $TomcatID # 杀掉原tomcat进程</span><br><span class="line">                                sleep 3</span><br><span class="line">                                #rm -rf $TomcatCache # 清理tomcat缓存</span><br><span class="line">                                $StartTomcat</span><br><span class="line">                fi</span><br><span class="line">        else</span><br><span class="line">                echo &quot;[error]tomcat进程不存在!tomcat开始自动重启...&quot;</span><br><span class="line">                echo &quot;[info]$StartTomcat,请稍候......&quot;</span><br><span class="line">                #rm -rf $TomcatCache</span><br><span class="line">                $StartTomcat</span><br><span class="line">fi</span><br><span class="line">echo &quot;------------------------------&quot;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">Monitor&gt;</span><span class="bash">&gt;<span class="variable">$TomcatMonitorLog</span></span></span><br><span class="line"></span><br></pre></td></tr></table></figure>





<h5 id="监控netty服务是否正常开启端口"><a href="#监控netty服务是否正常开启端口" class="headerlink" title="监控netty服务是否正常开启端口"></a>监控netty服务是否正常开启端口</h5><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/sh</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 定义环境变量（要改成自己的jdk相关地址）</span></span><br><span class="line">PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin</span><br><span class="line">export JAVA_HOME=/usr/lib/jvm/jdk1.8.0_191-oraclejdk</span><br><span class="line">export CLASSPATH=$JAVA_HOME/lib:$JAVA_HOME/lib/tools.jar</span><br><span class="line">export PATH=$PATH:$JAVA_HOME/bin</span><br><span class="line">NettyServerHome=/opt/webserver/mtech-cloud-netty-server</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">获取netty-server进程ID（这里注意netty-server7要改成自己的netty-server目录名）</span></span><br><span class="line">NettyServerID=$(ps -ef |grep netty-server |grep -w $NettyServerHome |grep -w java |grep -v &#x27;grep&#x27;|awk &#x27;&#123;print $2&#125;&#x27;)</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">netty-server启动程序(这里注意要改成自己netty-server实际安装的路径)</span></span><br><span class="line">StartNettyServer=$NettyServerHome/bin/start.sh</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">netty监听端口</span></span><br><span class="line">NettyPort=16000</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">日志输出 （自己定义地址，用于输出监控日志和监控报错日志）</span></span><br><span class="line">NettyServerMonitorLog=$NettyServerHome/logs/NettyServerMonitor-$(date +&#x27;%F&#x27;).log</span><br><span class="line">GetPageInfo=$NettyServerHome/logs/PortInfo-$(date +&#x27;%F&#x27;).log</span><br><span class="line">if [ ! -d $NettyServerHome/logs ]; then mkdir -p $NettyServerHome/logs ; fi</span><br><span class="line">Monitor()</span><br><span class="line">&#123;</span><br><span class="line">echo &quot;[info]开始监控netty-server...[$(date +&#x27;%F %H:%M:%S&#x27;)]&quot;</span><br><span class="line">if [[ $NettyServerID ]];then # 这里判断netty-server进程是否存在</span><br><span class="line">	</span><br><span class="line">		echo &quot;[info]当前netty-server进程ID为:$NettyServerID,继续检测端口...&quot;</span><br><span class="line"><span class="meta">		#</span><span class="bash"> 检测是否启动成功(成功的话会返回端口信息)</span></span><br><span class="line">		NettyServerPort=$(checkPort $NettyPort)</span><br><span class="line">		echo &quot;端口检测结果：$NettyServerPort &quot;</span><br><span class="line">		if [ $NettyServerPort -eq 0 ];then</span><br><span class="line">				echo &quot;[info]返回码为$NettyServerPort,netty-server启动成功,测试端口正常......&quot;</span><br><span class="line">			else</span><br><span class="line">				echo &quot;[error]netty-server启动出错,请注意......, 错误日志已输出到$GetPageInfo&quot;</span><br><span class="line">				echo &quot;[error]端口$NettyPort检测出错,开始重启netty-server&quot;</span><br><span class="line">				kill -9 $NettyServerID # 杀掉原netty-server进程</span><br><span class="line">				sleep 3</span><br><span class="line">				#rm -rf $netty-serverCache # 清理netty-server缓存</span><br><span class="line">				$StartNettyServer  &gt;&gt; $NettyServerHome/logs/nohub.out &amp; &gt;&gt; /dev/null</span><br><span class="line">		fi</span><br><span class="line">	else</span><br><span class="line">		echo &quot;[error]netty-server进程不存在!netty-server开始自动重启...&quot;</span><br><span class="line">		echo &quot;[info]$StartNettyServer,请稍候......&quot;</span><br><span class="line"><span class="meta">		#</span><span class="bash">rm -rf <span class="variable">$netty</span>-serverCache</span></span><br><span class="line"><span class="meta">		#</span><span class="bash"> <span class="variable">$StartNettyServer</span>  &gt;&gt; /dev/null &amp;</span></span><br><span class="line"><span class="meta">		$</span><span class="bash">StartNettyServer  &gt;&gt; <span class="variable">$NettyServerHome</span>/logs/nohub.out &amp; &gt;&gt; /dev/null</span></span><br><span class="line">fi</span><br><span class="line">echo &quot;------------------------------&quot;</span><br><span class="line">&#125;</span><br><span class="line">checkPort() &#123;</span><br><span class="line">		echo &quot;------------------------------&quot; &gt;&gt; $GetPageInfo</span><br><span class="line">        echo &quot;$(date +&#x27;%F %H:%M:%S&#x27;)  &quot; &gt;&gt; $GetPageInfo</span><br><span class="line">        echo $(netstat -tlpn | grep &quot;\b$1\b&quot;) &gt;&gt; $GetPageInfo</span><br><span class="line">        netstat -tlpn | grep &quot;\b$1\b&quot; | awk &#x27;&#123;print $2&#125;&#x27;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">Monitor&gt;</span><span class="bash">&gt;<span class="variable">$NettyServerMonitorLog</span> &amp;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h5 id="部署war包到tomcat"><a href="#部署war包到tomcat" class="headerlink" title="部署war包到tomcat"></a>部署war包到tomcat</h5><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">➜  web cat start.sh </span><br><span class="line">WORKDIR=/data1/webserver/mt_chs/web</span><br><span class="line">cd $WORKDIR</span><br><span class="line">kill -9 $(netstat -tlpn | grep &quot;\b18080\b&quot; | awk &#x27;&#123;print $7&#125;&#x27; | cut -d &#x27;/&#x27; -f 1)</span><br><span class="line">echo &#x27;&#x27; &gt; $WORKDIR/logs/catalina.out </span><br><span class="line"><span class="meta">$</span><span class="bash">WORKDIR/bin/startup.sh</span> </span><br><span class="line"></span><br><span class="line">➜  web cat tailf.sh </span><br><span class="line">WORKDIR=/data1/webserver/mt_chs/web</span><br><span class="line">tail -f $WORKDIR/logs/catalina.out</span><br><span class="line"></span><br><span class="line">➜  web cat stop.sh </span><br><span class="line">WORKDIR=/data1/webserver/mt_chs/web</span><br><span class="line">cd $WORKDIR</span><br><span class="line">kill -9 $(netstat -tlpn | grep &quot;\b18080\b&quot; | awk &#x27;&#123;print $7&#125;&#x27; | cut -d &#x27;/&#x27; -f 1)</span><br><span class="line"></span><br><span class="line">➜  ~ cat deploy_web.sh </span><br><span class="line">WEB_DIR=/data1/webserver/mt_chs/web</span><br><span class="line">APP_DIR=$WEB_DIR/webapps/chs_web</span><br><span class="line">HOME_DIR=/home/ledmon</span><br><span class="line">WAR_FILE=$HOME_DIR/$1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">function deploy()&#123;</span><br><span class="line">    echo &quot;停止tomcat...&quot;</span><br><span class="line">    $WEB_DIR/stop.sh</span><br><span class="line">    mkdir -p $APP_DIR</span><br><span class="line">    echo &quot;更新应用...&quot;</span><br><span class="line">    rm -rf $APP_DIR/*</span><br><span class="line">    unzip $WAR_FILE -d $APP_DIR &gt;&gt; /dev/null</span><br><span class="line">    echo &quot;启动tomcat...&quot;</span><br><span class="line">    $WEB_DIR/start.sh</span><br><span class="line">    echo &quot;查看启动日志&quot;</span><br><span class="line">    $WEB_DIR/tailf.sh</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">if [ ! -f &quot;$WAR_FILE&quot; ];then</span><br><span class="line">    echo &quot;文件不存在，路径: $WAR_FILE&quot;</span><br><span class="line">elif (! echo $&#123;WAR_FILE&#125; |grep -q &quot;.war&quot; );then</span><br><span class="line">    echo &quot;文件不合法，路径：$WAR_FILE&quot;</span><br><span class="line">    echo &quot;请选择war文件&quot;</span><br><span class="line">elif (! echo $&#123;WAR_FILE&#125; |grep -q &quot;web_product&quot; );then</span><br><span class="line">    echo &quot;文件不合法，路径：$WAR_FILE&quot;</span><br><span class="line">    echo &quot;请选择web_proeuct*.war文件&quot;</span><br><span class="line">else</span><br><span class="line">    deploy</span><br><span class="line">fi</span><br></pre></td></tr></table></figure>

<h5 id="部署springboot的jar包应用"><a href="#部署springboot的jar包应用" class="headerlink" title="部署springboot的jar包应用"></a>部署springboot的jar包应用</h5><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">➜  appint cat start.sh </span><br><span class="line">WORKDIR=/data1/webserver/mt_chs/appint</span><br><span class="line">cd $WORKDIR</span><br><span class="line">kill -9 $(netstat -tlpn | grep &quot;\b18083\b&quot; | awk &#x27;&#123;print $7&#125;&#x27; | cut -d &#x27;/&#x27; -f 1)</span><br><span class="line">echo &#x27;&#x27; &gt; $WORKDIR/out.log</span><br><span class="line">nohup java -jar $WORKDIR/appint_*.jar &gt; $WORKDIR/out.log &amp; </span><br><span class="line"></span><br><span class="line">➜  appint cat tailf.sh </span><br><span class="line">WORKDIR=/data1/webserver/mt_chs/appint</span><br><span class="line">tail -f $WORKDIR/out.log</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">➜  ~ cat deploy_appint.sh </span><br><span class="line">APP_DIR=/data1/webserver/mt_chs/appint</span><br><span class="line">HOME_DIR=/home/ledmon</span><br><span class="line">JAR_FILE=$HOME_DIR/$1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">function deploy()&#123;</span><br><span class="line">    echo &quot;停止应用...&quot;</span><br><span class="line">    kill -9 $(netstat -tlpn | grep &quot;\b18083\b&quot; | awk &#x27;&#123;print $7&#125;&#x27; | cut -d &#x27;/&#x27; -f 1)</span><br><span class="line">    mkdir -p $APP_DIR</span><br><span class="line">    echo &quot;更新应用...&quot;</span><br><span class="line">    rm -rf $APP_DIR/*.jar</span><br><span class="line">    cp $JAR_FILE $APP_DIR</span><br><span class="line">    echo &quot;启动应用...&quot;</span><br><span class="line">    $APP_DIR/start.sh</span><br><span class="line">    echo &quot;查看启动日志&quot;</span><br><span class="line">    $APP_DIR/tailf.sh</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">if [ ! -f &quot;$JAR_FILE&quot; ];then</span><br><span class="line">    echo &quot;文件不存在，路径: $JAR_FILE&quot;</span><br><span class="line">elif (! echo $&#123;JAR_FILE&#125; |grep -q &quot;.jar&quot; );then</span><br><span class="line">    echo &quot;文件不合法，路径：$JAR_FILE&quot;</span><br><span class="line">    echo &quot;请选择*.jar文件&quot;</span><br><span class="line">elif (! echo $&#123;JAR_FILE&#125; |grep -q &quot;appint_product&quot; );then</span><br><span class="line">    echo &quot;文件不合法，路径：$JAR_FILE&quot;</span><br><span class="line">    echo &quot;请选择appint_product*.jar文件&quot;</span><br><span class="line">else</span><br><span class="line">    deploy</span><br><span class="line">fi</span><br><span class="line"></span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>linux</category>
        <category>shell</category>
      </categories>
      <tags>
        <tag>linux</tag>
        <tag>shell</tag>
      </tags>
  </entry>
  <entry>
    <title>解决NVIDIA驱动程序安装和加载问题</title>
    <url>/Hackintosh-Nvidia-Driver/</url>
    <content><![CDATA[<p>问题6：您在菜单栏或Nvidia驱动程序管理器首选项面板中选择了Nvidia Web Drivers，但是当您选择时重启OS X默认图形驱动程序已选中。</p>
<p>当您的主板没有本机NVRAM支持（例如技嘉100系列主板）时会导致这种情况。</p>
<span id="more"></span> 


<p>修复：</p>
<p>设置模拟NVRAM以在boot-args中存储nvda_drv = 1引导标志。</p>
<p>在</p>
<p>此处</p>
<p>下载最新的Clover安装程序pkg ，启动安装程序并在此处选择自定义：</p>
<p><img src="https://www.tonymacx86.com/attachments/screen-20shot-202016-06-17-20at-204-17-27-20pm_zpsyyxgcist-png.268544/" alt="屏幕％20Shot％202016-06-17％20AT％204.17.27％20 PM_zpsyyxgcist.PNG"></p>
<p>之后确保您选择了EmuVariableUefi-64：</p>
<p><img src="https://www.tonymacx86.com/attachments/screen-20shot-202016-06-17-20at-204-16-21-20pm_zpstrh5la5r-png.268545/" alt="屏幕％20Shot％202016-06-17％20AT％204.16.21％20 PM_zpstrh5la5r.PNG"></p>
<p>继续完成Clover升级安装并重新启动。重新启动后打开系统首选项并转到Nvidia驱动程序管理器。确保您拥有最新的驱动程序是个好主意，因此请转到更新选项卡并单击立即检查按钮。如果有更新，请执行更新并在它告诉您时重新启动。你应该在这一点上完成。如果没有更新，请继续执行下一步。</p>
<p><img src="https://www.tonymacx86.com/attachments/screen-20shot-202016-06-17-20at-204-22-24-20pm_zpss1tshhyz-png.268546/" alt="屏幕％20Shot％202016-06-17％20AT％204.22.24％20 PM_zpss1tshhyz.PNG"></p>
<p>如果没有升级，请单击“图形驱动程序”选项卡，然后选择NVIDIA Web Drive旁边的单选按钮。重启。</p>
<p><img src="https://www.tonymacx86.com/attachments/screen-20shot-202016-06-17-20at-204-21-54-20pm_zpstmrfmdvy-png.268547/" alt="屏幕％20Shot％202016-06-17％20AT％204.21.54％20 PM_zpstmrfmdvy.PNG"></p>
<p>重新启动后，应该说您使用的是NVIDIA网络驱动程序。如果它仍然不起作用，那么您可能需要重新运行Clover安装程序并选择“在目标卷上安装RC脚本”。</p>
<p><img src="https://www.tonymacx86.com/attachments/screen-20shot-202016-06-17-20at-204-27-24-20pm_zpszwpp1ven-png.268548/" alt="屏幕％20Shot％202016-06-17％20AT％204.27.24％20 PM_zpszwpp1ven.PNG"></p>
<p>-————————— </p>
<p>如果您遇到任何其他错误，请告知我们，我将使用解决方案更新此帖子。</p>
<p><strong>nvidia显卡驱动</strong> <a href="https://www.tonymacx86.com/nvidia-drivers/">https://www.tonymacx86.com/nvidia-drivers/</a><br><a href="https://www.tonymacx86.com/threads/nvidia-releases-alternate-graphics-drivers-for-macos-sierra-10-12-6-378-05-05-25.227494/">https://www.tonymacx86.com/threads/nvidia-releases-alternate-graphics-drivers-for-macos-sierra-10-12-6-378-05-05-25.227494/</a></p>
<p>** 解决NVIDIA驱动程序安装和加载问题 ** <a href="https://www.tonymacx86.com/threads/solving-nvidia-driver-install-loading-problems.161256/">https://www.tonymacx86.com/threads/solving-nvidia-driver-install-loading-problems.161256/</a></p>
]]></content>
      <categories>
        <category>Mac osx</category>
        <category>Hackintosh</category>
        <category>Nvidia</category>
      </categories>
      <tags>
        <tag>Mac osx</tag>
        <tag>Hackintosh</tag>
        <tag>Nvidia</tag>
      </tags>
  </entry>
  <entry>
    <title>Docker常用命令</title>
    <url>/Docker-common/</url>
    <content><![CDATA[<p>Docker使用比较频繁的命令</p>
<h5 id="查看docker-版本"><a href="#查看docker-版本" class="headerlink" title="查看docker 版本"></a>查看docker 版本</h5><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> docker version</span></span><br><span class="line">Client:</span><br><span class="line"> Version:      18.03.1-ce</span><br><span class="line"> API version:  1.37</span><br><span class="line"> Go version:   go1.9.5</span><br><span class="line"> Git commit:   9ee9f40</span><br><span class="line"> Built:        Thu Apr 26 07:12:48 2018</span><br><span class="line"> OS/Arch:      windows/amd64</span><br><span class="line"> Experimental: false</span><br><span class="line"> Orchestrator: swarm</span><br><span class="line"></span><br><span class="line">Server:</span><br><span class="line"> Engine:</span><br><span class="line">  Version:      18.06.1-ce</span><br><span class="line">  API version:  1.38 (minimum version 1.12)</span><br><span class="line">  Go version:   go1.10.3</span><br><span class="line">  Git commit:   e68fc7a</span><br><span class="line">  Built:        Tue Aug 21 17:25:29 2018</span><br><span class="line">  OS/Arch:      linux/amd64</span><br><span class="line">  Experimental: true</span><br></pre></td></tr></table></figure>

<span id="more"></span>
<h5 id="docker-配置信息"><a href="#docker-配置信息" class="headerlink" title="docker 配置信息"></a>docker 配置信息</h5><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> docker info</span></span><br><span class="line">Containers: 128</span><br><span class="line"> Running: 62</span><br><span class="line"> Paused: 0</span><br><span class="line"> Stopped: 66</span><br><span class="line">Images: 256</span><br><span class="line">Server Version: 18.06.1-ce</span><br><span class="line">Storage Driver: overlay2</span><br><span class="line"> Backing Filesystem: xfs</span><br><span class="line"> Supports d_type: true</span><br><span class="line"> Native Overlay Diff: true</span><br><span class="line">Logging Driver: json-file</span><br><span class="line">Cgroup Driver: cgroupfs</span><br><span class="line">Plugins:</span><br><span class="line"> Volume: local</span><br><span class="line"> Network: bridge host ipvlan macvlan null overlay</span><br><span class="line"> Log: awslogs fluentd gcplogs gelf journald json-file logentries splunk syslog</span><br><span class="line">Swarm: inactive</span><br><span class="line">Runtimes: runc</span><br><span class="line">Default Runtime: runc</span><br><span class="line">Init Binary: docker-init</span><br><span class="line">containerd version: 468a545b9edcd5932818eb9de8e72413e616e86e</span><br><span class="line">runc version: 69663f0bd4b60df09991c08812a60108003fa340</span><br><span class="line">init version: fec3683</span><br><span class="line">Security Options:</span><br><span class="line"> seccomp</span><br><span class="line">  Profile: default</span><br><span class="line">Kernel Version: 3.10.0-862.el7.x86_64</span><br><span class="line">Operating System: CentOS Linux 7 (Core)</span><br><span class="line">OSType: linux</span><br><span class="line">Architecture: x86_64</span><br><span class="line">CPUs: 3</span><br><span class="line">Total Memory: 15.02GiB</span><br><span class="line">Name: bogon</span><br><span class="line">ID: CAI4:PHBY:FKFP:5BI6:LWUG:L3XF:OVU6:OGDF:IS5J:IPF4:3JKZ:KTUZ</span><br><span class="line">Docker Root Dir: /var/lib/docker</span><br><span class="line">Debug Mode (client): false</span><br><span class="line">Debug Mode (server): true</span><br><span class="line"> File Descriptors: 312</span><br><span class="line"> Goroutines: 273</span><br><span class="line"> System Time: 2018-12-19T11:26:00.704470694+08:00</span><br><span class="line"> EventsListeners: 0</span><br><span class="line">Registry: https://index.docker.io/v1/</span><br><span class="line">Labels:</span><br><span class="line"> name=docker</span><br><span class="line">Experimental: true</span><br><span class="line">Insecure Registries:</span><br><span class="line"> loclhost:5000</span><br><span class="line"> 172.20.8.5:5000</span><br><span class="line"> 172.20.8.5:8888</span><br><span class="line"> 127.0.0.0/8</span><br><span class="line">Registry Mirrors:</span><br><span class="line"> https://registry.docker-cn.com/</span><br><span class="line"> https://container-registry.oracle.com/</span><br><span class="line"> https://dhcl9iu5.mirror.aliyuncs.com/</span><br><span class="line"> https://docker.mirrors.ustc.edu.cn/</span><br><span class="line"> http://29bd46d3.m.daocloud.io/</span><br><span class="line"> http://hub-mirror.c.163.com/</span><br><span class="line">Live Restore Enabled: false</span><br></pre></td></tr></table></figure>

<h5 id="拉取镜像"><a href="#拉取镜像" class="headerlink" title="拉取镜像"></a>拉取镜像</h5> <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> docker pull tomcat</span></span><br><span class="line">Using default tag: latest</span><br><span class="line">latest: Pulling from library/tomcat</span><br><span class="line">54f7e8ac135a: Downloading [===========&gt;                                       ]   9.98MB/45.32MB</span><br><span class="line">d6341e30912f: Downloading [============================&gt;                      ]  6.038MB/10.74MB</span><br><span class="line">087a57faf949: Download complete</span><br><span class="line">95065f220961: Download complete</span><br><span class="line">0887630ce576: Download complete</span><br><span class="line">c375d1959fab: Download complete</span><br><span class="line">e00a5e6055cc: Waiting</span><br><span class="line">8319f5fb56cf: Waiting</span><br><span class="line">258c74eb25ab: Waiting</span><br><span class="line">5c135322994c: Waiting</span><br><span class="line">b2cc25ec4861: Waiting</span><br><span class="line">40140bebba00: Waiting</span><br><span class="line">d1786b40ed4f: Waiting</span><br><span class="line"></span><br><span class="line">Digest: sha256:d6f67aacce64010880a1e9ea6f0ace9fe9e20d39aae0489c8e88b4c14effe3a0</span><br><span class="line">Status: Downloaded newer image for tomcat:latest</span><br></pre></td></tr></table></figure>

<h5 id="运行容器"><a href="#运行容器" class="headerlink" title="运行容器"></a>运行容器</h5> <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> docker run --name tomcat -p 8080:8080 -v /data:/usr/<span class="built_in">local</span>/tomcat/webapps/data -idt tomcat</span></span><br><span class="line">bf0c6f766a2ceec0cdd06ae1b5556bf53bb14c7a0205d9531b259f72ca6698c1</span><br></pre></td></tr></table></figure>

<h5 id="查看运行中的容器"><a href="#查看运行中的容器" class="headerlink" title="查看运行中的容器"></a>查看运行中的容器</h5><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> docker ps | grep tomcat</span></span><br><span class="line">CONTAINER ID        IMAGE                                                COMMAND                  CREATED              STATUS                 PORTS                                                                NAMES</span><br><span class="line">bf0c6f766a2c        tomcat                                               &quot;catalina.sh run&quot;        47 seconds ago      Up 45 seconds          0.0.0.0:8080-&gt;8080/tcp                                               tomcat</span><br></pre></td></tr></table></figure>

<h5 id="查看容器日志"><a href="#查看容器日志" class="headerlink" title="查看容器日志"></a>查看容器日志</h5><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> docker logs tomcat</span></span><br><span class="line">Using CATALINA_BASE:   /usr/local/tomcat</span><br><span class="line">Using CATALINA_HOME:   /usr/local/tomcat</span><br><span class="line">Using CATALINA_TMPDIR: /usr/local/tomcat/temp</span><br><span class="line">Using JRE_HOME:        /docker-java-home/jre</span><br><span class="line">Using CLASSPATH:       /usr/local/tomcat/bin/bootstrap.jar:/usr/local/tomcat/bin/tomcat-juli.jar</span><br><span class="line">21-Dec-2018 08:39:43.621 INFO [main] org.apache.catalina.startup.VersionLoggerListener.log Server version:        Apache Tomcat/8.5.35</span><br><span class="line">21-Dec-2018 08:39:43.624 INFO [main] org.apache.catalina.startup.VersionLoggerListener.log Server built:          Nov 3 2018 17:39:20 UTC</span><br><span class="line">21-Dec-2018 08:39:43.625 INFO [main] org.apache.catalina.startup.VersionLoggerListener.log Server number:         8.5.35.0</span><br><span class="line">21-Dec-2018 08:39:43.625 INFO [main] org.apache.catalina.startup.VersionLoggerListener.log OS Name:               Linux</span><br><span class="line">21-Dec-2018 08:39:43.625 INFO [main] org.apache.catalina.startup.VersionLoggerListener.log OS Version:            3.10.0-862.el7.x86_64</span><br><span class="line">21-Dec-2018 08:39:43.625 INFO [main] org.apache.catalina.startup.VersionLoggerListener.log Architecture:          amd64</span><br><span class="line">21-Dec-2018 08:39:43.625 INFO [main] org.apache.catalina.startup.VersionLoggerListener.log Java Home:             /usr/lib/jvm/java-8-openjdk-amd64/jre</span><br><span class="line">21-Dec-2018 08:39:43.625 INFO [main] org.apache.catalina.startup.VersionLoggerListener.log JVM Version:           1.8.0_181-8u181-b13-2~deb9u1-b13</span><br><span class="line">21-Dec-2018 08:39:43.626 INFO [main] org.apache.catalina.startup.VersionLoggerListener.log JVM Vendor:            Oracle Corporation</span><br><span class="line">21-Dec-2018 08:39:43.626 INFO [main] org.apache.catalina.startup.VersionLoggerListener.log CATALINA_BASE:         /usr/local/tomcat</span><br><span class="line">21-Dec-2018 08:39:43.626 INFO [main] org.apache.catalina.startup.VersionLoggerListener.log CATALINA_HOME:         /usr/local/tomcat</span><br><span class="line">21-Dec-2018 08:39:43.626 INFO [main] org.apache.catalina.startup.VersionLoggerListener.log Command line argument: -Djava.util.logging.config.file=/usr/local/tomcat/conf/logging.properties</span><br><span class="line">21-Dec-2018 08:39:43.627 INFO [main] org.apache.catalina.startup.VersionLoggerListener.log Command line argument: -Djava.util.logging.manager=org.apache.juli.ClassLoaderLogManager</span><br><span class="line">21-Dec-2018 08:39:43.627 INFO [main] org.apache.catalina.startup.VersionLoggerListener.log Command line argument: -Djdk.tls.ephemeralDHKeySize=2048</span><br><span class="line">21-Dec-2018 08:39:43.628 INFO [main] org.apache.catalina.startup.VersionLoggerListener.log Command line argument: -Djava.protocol.handler.pkgs=org.apache.catalina.webresources</span><br><span class="line">21-Dec-2018 08:39:43.629 INFO [main] org.apache.catalina.startup.VersionLoggerListener.log Command line argument: -Dorg.apache.catalina.security.SecurityListener.UMASK=0027</span><br><span class="line">21-Dec-2018 08:39:43.629 INFO [main] org.apache.catalina.startup.VersionLoggerListener.log Command line argument: -Dignore.endorsed.dirs=</span><br><span class="line">21-Dec-2018 08:39:43.629 INFO [main] org.apache.catalina.startup.VersionLoggerListener.log Command line argument: -Dcatalina.base=/usr/local/tomcat</span><br><span class="line">21-Dec-2018 08:39:43.631 INFO [main] org.apache.catalina.startup.VersionLoggerListener.log Command line argument: -Dcatalina.home=/usr/local/tomcat</span><br><span class="line">21-Dec-2018 08:39:43.631 INFO [main] org.apache.catalina.startup.VersionLoggerListener.log Command line argument: -Djava.io.tmpdir=/usr/local/tomcat/temp</span><br><span class="line">21-Dec-2018 08:39:43.631 INFO [main] org.apache.catalina.core.AprLifecycleListener.lifecycleEvent Loaded APR based Apache Tomcat Native library [1.2.18] using APR version [1.5.2].</span><br><span class="line">21-Dec-2018 08:39:43.631 INFO [main] org.apache.catalina.core.AprLifecycleListener.lifecycleEvent APR capabilities: IPv6 [true], sendfile [true], accept filters [false], random [true].</span><br><span class="line">21-Dec-2018 08:39:43.632 INFO [main] org.apache.catalina.core.AprLifecycleListener.lifecycleEvent APR/OpenSSL configuration: useAprConnector [false], useOpenSSL [true]</span><br><span class="line">21-Dec-2018 08:39:43.637 INFO [main] org.apache.catalina.core.AprLifecycleListener.initializeSSL OpenSSL successfully initialized [OpenSSL 1.1.0j  20 Nov 2018]</span><br><span class="line">21-Dec-2018 08:39:43.784 INFO [main] org.apache.coyote.AbstractProtocol.init Initializing ProtocolHandler [&quot;http-nio-8080&quot;]</span><br><span class="line">21-Dec-2018 08:39:43.800 INFO [main] org.apache.tomcat.util.net.NioSelectorPool.getSharedSelector Using a shared selector for servlet write/read</span><br><span class="line">21-Dec-2018 08:39:43.819 INFO [main] org.apache.coyote.AbstractProtocol.init Initializing ProtocolHandler [&quot;ajp-nio-8009&quot;]</span><br><span class="line">21-Dec-2018 08:39:43.821 INFO [main] org.apache.tomcat.util.net.NioSelectorPool.getSharedSelector Using a shared selector for servlet write/read</span><br><span class="line">21-Dec-2018 08:39:43.823 INFO [main] org.apache.catalina.startup.Catalina.load Initialization processed in 858 ms</span><br><span class="line">21-Dec-2018 08:39:43.861 INFO [main] org.apache.catalina.core.StandardService.startInternal Starting service [Catalina]</span><br><span class="line">21-Dec-2018 08:39:43.861 INFO [main] org.apache.catalina.core.StandardEngine.startInternal Starting Servlet Engine: Apache Tomcat/8.5.35</span><br><span class="line">21-Dec-2018 08:39:43.879 INFO [localhost-startStop-1] org.apache.catalina.startup.HostConfig.deployDirectory Deploying web application directory [/usr/local/tomcat/webapps/ROOT]</span><br><span class="line">21-Dec-2018 08:39:44.378 INFO [localhost-startStop-1] org.apache.catalina.startup.HostConfig.deployDirectory Deployment of web application directory [/usr/local/tomcat/webapps/ROOT] has finished in [499] ms</span><br><span class="line">21-Dec-2018 08:39:44.379 INFO [localhost-startStop-1] org.apache.catalina.startup.HostConfig.deployDirectory Deploying web application directory [/usr/local/tomcat/webapps/docs]</span><br><span class="line">21-Dec-2018 08:39:44.436 INFO [localhost-startStop-1] org.apache.catalina.startup.HostConfig.deployDirectory Deployment of web application directory [/usr/local/tomcat/webapps/docs] has finished in [57] ms</span><br><span class="line">21-Dec-2018 08:39:44.436 INFO [localhost-startStop-1] org.apache.catalina.startup.HostConfig.deployDirectory Deploying web application directory [/usr/local/tomcat/webapps/examples]</span><br><span class="line">21-Dec-2018 08:39:45.443 INFO [localhost-startStop-1] org.apache.catalina.startup.HostConfig.deployDirectory Deployment of web application directory [/usr/local/tomcat/webapps/examples] has finished in [1,006] ms</span><br><span class="line">21-Dec-2018 08:39:45.443 INFO [localhost-startStop-1] org.apache.catalina.startup.HostConfig.deployDirectory Deploying web application directory [/usr/local/tomcat/webapps/host-manager]</span><br><span class="line">21-Dec-2018 08:39:46.070 INFO [localhost-startStop-1] org.apache.catalina.startup.HostConfig.deployDirectory Deployment of web application directory [/usr/local/tomcat/webapps/host-manager] has finished in [626] ms</span><br><span class="line">21-Dec-2018 08:39:46.071 INFO [localhost-startStop-1] org.apache.catalina.startup.HostConfig.deployDirectory Deploying web application directory [/usr/local/tomcat/webapps/manager]</span><br><span class="line">21-Dec-2018 08:39:46.204 INFO [localhost-startStop-1] org.apache.catalina.startup.HostConfig.deployDirectory Deployment of web application directory [/usr/local/tomcat/webapps/manager] has finished in [133] ms</span><br><span class="line">21-Dec-2018 08:39:46.207 INFO [localhost-startStop-1] org.apache.catalina.startup.HostConfig.deployDirectory Deploying web application directory [/usr/local/tomcat/webapps/data]</span><br><span class="line">21-Dec-2018 08:39:46.282 INFO [localhost-startStop-1] org.apache.catalina.startup.HostConfig.deployDirectory Deployment of web application directory [/usr/local/tomcat/webapps/data] has finished in [75] ms</span><br><span class="line">21-Dec-2018 08:39:46.289 INFO [main] org.apache.coyote.AbstractProtocol.start Starting ProtocolHandler [&quot;http-nio-8080&quot;]</span><br><span class="line">21-Dec-2018 08:39:46.315 INFO [main] org.apache.coyote.AbstractProtocol.start Starting ProtocolHandler [&quot;ajp-nio-8009&quot;]</span><br><span class="line">21-Dec-2018 08:39:46.345 INFO [main] org.apache.catalina.startup.Catalina.start Server startup in 2520 ms</span><br></pre></td></tr></table></figure>

<h5 id="停止运行中的容器"><a href="#停止运行中的容器" class="headerlink" title="停止运行中的容器"></a>停止运行中的容器</h5><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> docker stop tomcat</span></span><br><span class="line">tomcat</span><br></pre></td></tr></table></figure>

<h5 id="重新运行停止的容器"><a href="#重新运行停止的容器" class="headerlink" title="重新运行停止的容器"></a>重新运行停止的容器</h5><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> docker start tomcat</span></span><br><span class="line">tomcat</span><br></pre></td></tr></table></figure>

<h5 id="重启容器"><a href="#重启容器" class="headerlink" title="重启容器"></a>重启容器</h5><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> docker restart tomcat</span></span><br><span class="line">tomcat</span><br></pre></td></tr></table></figure>

<h5 id="强制删除运行中的容器"><a href="#强制删除运行中的容器" class="headerlink" title="强制删除运行中的容器"></a>强制删除运行中的容器</h5><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> docker rm tomcat -f</span></span><br><span class="line">tomcat</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>docker</category>
      </categories>
      <tags>
        <tag>docker</tag>
      </tags>
  </entry>
  <entry>
    <title>黑苹果</title>
    <url>/Hackintosh/</url>
    <content><![CDATA[<ul>
<li><strong>写在开头</strong></li>
</ul>
<h1 id="什么是黑苹果？"><a href="#什么是黑苹果？" class="headerlink" title="什么是黑苹果？"></a>什么是黑苹果？</h1><blockquote>
<p>自从苹果采用Intel的处理器，OSX被黑客破解后可以安装在Intel CPU与部分AMDCPU的机器上。从而出现了一大批非苹果设备而使用苹果操作系统的机器，被称为黑苹果(Hackintosh)；在Mac苹果机上面安装原版Mac系统的被称为白苹果（Macintosh），与黑苹果相对。</p>
</blockquote>
<span id="more"></span> 

<h1 id="MAC系统"><a href="#MAC系统" class="headerlink" title="MAC系统"></a>MAC系统</h1><blockquote>
<p>OS X 是全球领先的操作系统。基于坚如磐石的 UNIX ，设计简单直观，让处处充满创新的Mac 安全易用，高度兼容，出类拔萃。UNIX 之威力，iMac 之简单让Mac OS X 既简单易用且功能强大。所有的一切 - 从启动 Mac 后所看到的桌面，到你日常使用的应用程序，都设计得简约精致。无论是浏览网页、查看邮件和与外地朋友视频聊天，所有事情都简单高效、趣味盎然。当然，简化复杂任务要求尖端科技，而 Mac OS X 正拥有这些尖端科技。它不仅使用基础坚实、久经考验的 UNIX 系统提供空前的稳定性，还提供超强性能、超炫图形并支持互联网标准。</p>
</blockquote>
<h1 id="参考资料："><a href="#参考资料：" class="headerlink" title="参考资料："></a>参考资料：</h1><p><strong>High Sierra 以及 Mojave 镜像集合贴</strong> <a href="http://bbs.pcbeta.com/viewthread-1753062-1-1.html">http://bbs.pcbeta.com/viewthread-1753062-1-1.html</a></p>
<p><strong>High Sierra 和 Mojave 镜像大全</strong> <a href="https://blog.iamzhl.top/High-Sierra-and-Mojave-Images-update.html">https://blog.iamzhl.top/High-Sierra-and-Mojave-Images-update.html</a></p>
<p><strong>笔记本黑果安装向导</strong> <a href="http://bbs.pcbeta.com/viewthread-1779539-1-7.html">http://bbs.pcbeta.com/viewthread-1779539-1-7.html</a></p>
<p><strong>UEFI+GPT+Clover macOS原版单、双系统双版教程(正式版)</strong> <a href="https://alansachin.github.io/2017/05/07/UEFI+GPT+Clover-macOS%E5%8E%9F%E7%89%88%E5%8D%95-%E5%8F%8C%E7%B3%BB%E7%BB%9F%E5%8F%8C%E7%89%88%E6%95%99%E7%A8%8B(%E6%AD%A3%E5%BC%8F%E7%89%88)">https://alansachin.github.io/2017/05/07/UEFI+GPT+Clover-macOS%E5%8E%9F%E7%89%88%E5%8D%95-%E5%8F%8C%E7%B3%BB%E7%BB%9F%E5%8F%8C%E7%89%88%E6%95%99%E7%A8%8B(%E6%AD%A3%E5%BC%8F%E7%89%88)</a></p>
<p><strong>黑苹果安装</strong> <a href="https://mp.weixin.qq.com/s/oYIrNOy8Co-SbKTPlGOlLw">https://mp.weixin.qq.com/s/oYIrNOy8Co-SbKTPlGOlLw</a></p>
<p><strong>增强型 macOS 维护系统</strong><a href="https://pe.firewolf.app/cn/">https://pe.firewolf.app/cn/</a></p>
<p><strong>黑苹果EFI</strong> <a href="https://zhih.me/hackintosh">https://zhih.me/hackintosh</a></p>
<p><strong>clover-configurator</strong> <a href="https://mackie100projects.altervista.org/download-clover-configurator/">https://mackie100projects.altervista.org/download-clover-configurator/</a></p>
<p><strong>7700hq 微星GS63VR 安装10.12，除声卡外基本完美</strong> <a href="http://bbs.pcbeta.com/forum.php?mod=viewthread&amp;tid=1736121&amp;highlight=gs63">http://bbs.pcbeta.com/forum.php?mod=viewthread&amp;tid=1736121&amp;highlight=gs63</a></p>
<p><strong>黑果小兵的部落阁</strong> <a href="https://blog.daliansky.net/">https://blog.daliansky.net/</a></p>
<p><strong>Hackintosh黑苹果长期维护机型整理清单</strong> <a href="https://blog.daliansky.net/Hackintosh-long-term-maintenance-model-checklist.html">https://blog.daliansky.net/Hackintosh-long-term-maintenance-model-checklist.html</a></p>
<p><strong>黑苹果安装从0开始—-clover优盘引导改硬盘引导篇</strong> <a href="http://bbs.pcbeta.com/viewthread-1683571-1-1.html">http://bbs.pcbeta.com/viewthread-1683571-1-1.html</a></p>
<p><strong>Mac High Sierra外接显示器设置（解决字体模糊问题，开启high dpi）</strong> <a href="https://yanke.info/?id=74">https://yanke.info/?id=74</a></p>
<p>** 一键开启MacOS HiDPI** <a href="https://zhih.me/one-key-hidpi/">https://zhih.me/one-key-hidpi/</a></p>
<p>** mac 10.14 Mojave 外接屏幕字体发虚 ** <a href="https://www.cnblogs.com/mooniitt/p/9753112.html">https://www.cnblogs.com/mooniitt/p/9753112.html</a></p>
<p><strong>nvidia显卡驱动</strong> <a href="https://www.tonymacx86.com/nvidia-drivers/">https://www.tonymacx86.com/nvidia-drivers/</a><br><a href="https://www.tonymacx86.com/threads/nvidia-releases-alternate-graphics-drivers-for-macos-sierra-10-12-6-378-05-05-25.227494/">https://www.tonymacx86.com/threads/nvidia-releases-alternate-graphics-drivers-for-macos-sierra-10-12-6-378-05-05-25.227494/</a></p>
<p>** 黑苹果从sierra升级到high sierra ** <a href="https://www.tonymacx86.com/threads/update-directly-to-macos-high-sierra.232707/">https://www.tonymacx86.com/threads/update-directly-to-macos-high-sierra.232707/</a></p>
<p>** Broadcom BCM94352z/DW1560驱动新姿势[新方法] ** <a href="https://blog.daliansky.net/Broadcom-BCM94352z-DW1560-drive-new-posture.html">https://blog.daliansky.net/Broadcom-BCM94352z-DW1560-drive-new-posture.html</a></p>
<p>** 黑苹果乐园 ** <a href="https://heipg.cn/">https://heipg.cn/</a></p>
<p>** Android 手机 USB 网络共享 ** <a href="https://github.com/jwise/HoRNDIS">https://github.com/jwise/HoRNDIS</a></p>
<p>** 四叶草引导EFI ** <a href="https://github.com/hunkier/MSI-GS63VR-7RF-macOS/releases">https://github.com/hunkier/MSI-GS63VR-7RF-macOS/releases</a></p>
<p>** 最新OC引导EFI ** <a href="https://github.com/guitaoliu/MSI-GS63VR-Hackintosh">https://github.com/guitaoliu/MSI-GS63VR-Hackintosh</a></p>
]]></content>
      <categories>
        <category>Mac osx</category>
        <category>Hackintosh</category>
      </categories>
      <tags>
        <tag>Mac osx</tag>
        <tag>Hackintosh</tag>
      </tags>
  </entry>
  <entry>
    <title>Java并发-- Lock 接口</title>
    <url>/Java-Concurrent-Lock-Interface/</url>
    <content><![CDATA[<p>​        锁是用来控制多个线程访问共享资源的方式，一般来说，一个锁能够防止多个线程同时访问共享资源（但是有些锁是可以允许多个线程并发的访问共享资源，比如读写锁）。在 Lock 接口出现之前，Java 程序是靠 synchronized 关键字实现锁的功能的，而 JavaSE 5 之后，并发包中新增了 Lock 接口（以及相关类），只是在使用时需要显式地获取和释放锁。虽然它缺少了 （通过 synchronized 块或者方法所提供的）隐式获取和释放锁的便捷性，但是却拥有了锁获取与释放的可操作性、可中断的获取锁以及超时获取锁等多种 synchronized 关键字所不具备的同步特性。<br> <span id="more"></span> </p>
<p>​        使用 synchronized 关键字将会隐式地获取锁，但是它将锁的获取和释放固化了，也就是先获取再释放。当然，这种方法简化了同步的管理，可是扩展性没有显式的锁获取和释放来的好。例如，针对一个场景，手把手进行锁获取和释放，先获得锁 A，然后再获取锁 B，当锁 B 获得后释放锁 A 同时获取锁 C，当锁 C 获得后再释放锁 B同时获取锁 D，以此类推。这种场景下，synchronized 关键字就不那么容易实现了，而使用 Lock 却容易许多。</p>
<p>​        Lock 的使用也很简单，以下代码是 Lock 的使用方式。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Lock lock = <span class="keyword">new</span> ReentrantLock();</span><br><span class="line">lock.lock();</span><br><span class="line"><span class="keyword">try</span>&#123;</span><br><span class="line">  </span><br><span class="line">&#125;<span class="keyword">finally</span>&#123;</span><br><span class="line">  lock.unlock();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>​        在 finally 块中释放锁，目的是保证在获取到锁之后，最终能够被释放。</p>
<p>​        不要将获取锁的过程写在 try 块中，因为如果在获取锁（自定义锁的实现）时发生了异常，异常抛出的同时，也会导致锁无故释放。</p>
<p>​        Lock 接口提供的 synchronized 关键字所不具备的主要特性如下表。</p>
<table>
<thead>
<tr>
<th>特性</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>尝试非阻塞地获取锁</td>
<td>当前线程尝试获取锁，如果这一时刻锁没有被其他线程获取到，则成功获取并持有锁</td>
</tr>
<tr>
<td>能被中断地获取锁</td>
<td>与 synchronized 不同，获取锁的线程能够响应中断，当获取到锁的线程被中断时，中断异常将会被抛出，同时释放锁</td>
</tr>
<tr>
<td>超时获取锁</td>
<td>在指定的截止时间之前获取锁，如果截止时间到了仍旧无法获取锁，则返回</td>
</tr>
</tbody></table>
<p>​        Lock 是一个接口，它定义了锁获取和释放的基本操作，Lock 的 API 如下表所示。</p>
<table>
<thead>
<tr>
<th>方法名称</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>void lock()</td>
<td>获取锁，调用该方法当前线程将获取锁，当锁获得后，从该方法返回</td>
</tr>
<tr>
<td>void lockInterruptibly()</td>
<td>可中断地获取锁，和 lock() 方法的不同之处在于该方法会响应中断，即在锁的获取中可以中断当前线程</td>
</tr>
<tr>
<td>boolean tryLock()</td>
<td>尝试非阻塞的获取锁，调用该方法后立刻返回，如果能够获取则返回 true，否则返回 flase</td>
</tr>
<tr>
<td>boolean tryLock(long time, TimeUnit unit) throws InterruptedException</td>
<td>超时的获取锁，当前线程在以下3中情况下会返回：①当前线程在超时时间内获得了锁 ②当前线程在超时时间内被中断 ③超时时间结束，返回 false</td>
</tr>
<tr>
<td>void unlock()</td>
<td>释放锁</td>
</tr>
<tr>
<td>Condition newCondition()</td>
<td>获取等待通知组件，该组件和当前的锁绑定，当前线程只有获得了锁，才能调用该组件的 wait() 方法，而调用后，当前线程将释放锁</td>
</tr>
</tbody></table>
<p>​        这里先简单介绍一下 Lock 接口的 API，随后的章节会详细介绍同步器 AbstractQueuedSynchronizer 以及常用 Lock 接口的实现 ReentrantLock。Lock 接口的实现基本都是通过聚合一个同步器的子类来完成线程访问控制的。</p>
<p>参考: 方腾飞,魏鹏,程晓明 著. 《Java并发编程的艺术 》(Java核心技术系列)</p>
]]></content>
      <categories>
        <category>java</category>
        <category>concurrent</category>
      </categories>
      <tags>
        <tag>jvm</tag>
        <tag>lock</tag>
        <tag>java</tag>
        <tag>concurrent</tag>
      </tags>
  </entry>
  <entry>
    <title>Java 并发--Java对象头</title>
    <url>/Java-Concurrent-java-object-header/</url>
    <content><![CDATA[<p>synchronized用的锁是存在Java对象头里的。如果对象是数组类型，则虚拟机用3个字宽（Word）存储对象头，如果对象是非数组类型，则用2字宽存储对象头。在32位虚拟机中，1字宽等于4字节，即32bit，如表所示。</p>
 <span id="more"></span> 

<table>
<thead>
<tr>
<th align="center">长度</th>
<th align="center">内容</th>
<th align="center">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="center">32/64bit</td>
<td align="center">Mark Word</td>
<td align="center">存储对象的 hashCode 或锁信息等</td>
</tr>
<tr>
<td align="center">32/64bit</td>
<td align="center">Class Metadata Address</td>
<td align="center">存储到对象类型数据的指针</td>
</tr>
<tr>
<td align="center">32/64bit</td>
<td align="center">Array length</td>
<td align="center">数组的长度 （如果当前对象是数组）</td>
</tr>
</tbody></table>
<p>Java对象头里的Mark Word里默认存储对象的HashCode、分代年龄和锁标记位。32位JVM的Mark Word的默认存储结构如表所示。</p>
<table>
<thead>
<tr>
<th align="center">锁状态</th>
<th align="center">25bit</th>
<th align="center">4bit</th>
<th align="center">1bit 是否偏向锁</th>
<th align="center">2bit 锁标志位</th>
</tr>
</thead>
<tbody><tr>
<td align="center">无锁状态</td>
<td align="center">对象的 hashCode</td>
<td align="center">对象分代年龄</td>
<td align="center">0</td>
<td align="center">01</td>
</tr>
</tbody></table>
<p>在运行期间，Mark Word里存储的数据会随着锁标志位的变化而变化。Mark Word可能变化为存储以下4种数据，如表所示。</p>
<table>
<thead>
<tr>
<th align="center">锁状态</th>
<th align="center">25bit</th>
<th align="center"></th>
<th align="center">4bit</th>
<th align="center">1bit</th>
<th align="center">2bit</th>
</tr>
</thead>
<tbody><tr>
<td align="center"></td>
<td align="center">23bit</td>
<td align="center">2bit</td>
<td align="center"></td>
<td align="center">是否偏向锁</td>
<td align="center">锁标志位</td>
</tr>
<tr>
<td align="center">轻量级锁</td>
<td align="center">指向栈中锁记录的指针</td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center">00</td>
</tr>
<tr>
<td align="center">重量级锁</td>
<td align="center">指向互斥（重量级锁）的指针</td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center">10</td>
</tr>
<tr>
<td align="center">GC 标记</td>
<td align="center">空</td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center">11</td>
</tr>
<tr>
<td align="center">偏向锁</td>
<td align="center">线程 ID</td>
<td align="center">Epoch</td>
<td align="center">对象分代年龄</td>
<td align="center">1</td>
<td align="center">01</td>
</tr>
</tbody></table>
<p>在64位虚拟机下，Mark Word是64bit大小的，其存储结构如表所示。</p>
<table>
<thead>
<tr>
<th>锁状态</th>
<th>25bit</th>
<th>31bit</th>
<th>1bit</th>
<th>4bit</th>
<th>1bit</th>
<th>2bit</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
<td></td>
<td>cms_free</td>
<td>分代年龄</td>
<td>偏向锁</td>
<td>锁标志位</td>
</tr>
<tr>
<td>无锁</td>
<td>unused</td>
<td>hashcode</td>
<td></td>
<td></td>
<td>0</td>
<td>01</td>
</tr>
<tr>
<td>偏向锁</td>
<td>TheadId(54bit)</td>
<td>Epoch(2bit)</td>
<td></td>
<td></td>
<td>1</td>
<td>01</td>
</tr>
</tbody></table>
<p>参考: 方腾飞,魏鹏,程晓明 著. 《Java并发编程的艺术 》(Java核心技术系列)</p>
]]></content>
      <categories>
        <category>java</category>
        <category>concurrent</category>
      </categories>
      <tags>
        <tag>jvm</tag>
        <tag>java</tag>
        <tag>concurrent</tag>
        <tag>object header</tag>
      </tags>
  </entry>
  <entry>
    <title>Java并发--锁的升级与对比</title>
    <url>/Java-Concurrent-lock-escalation-comparison/</url>
    <content><![CDATA[<p>Java SE 1.6为了减少获得锁和释放锁带来的性能消耗，引入了“偏向锁”和“轻量级锁”，在Java SE 1.6中，锁一共有4种状态，级别从低到高依次是：无锁状态、偏向锁状态、轻量级锁状态和重量级锁状态，这几个状态会随着竞争情况逐渐升级。锁可以升级但不能降级，意味着偏向锁升级成轻量级锁后不能降级成偏向锁。这种锁升级却不能降级的策略，目的是为了提高获得锁和释放锁的效率，下文会详细分析。<br> <span id="more"></span><br>1.偏向锁</p>
<p>HotSpot 的作者经过研究发现，大多数情况下，锁不仅不存在多线程竞争，而且总是由同一线程多次获得，为了让线程获得锁的代价更低而引入了偏向锁。当一个线程访问同步块并获取锁时，会在对象头和栈帧中的锁记录里存储锁偏向的线程ID，以后该线程在进入和退出同步块时不需要进行CAS操作来加锁和解锁，只需简单地测试一下对象头的Mark Word里是否存储着指向当前线程的偏向锁。如果测试成功，表示线程已经获得了锁。如果测试失败，则需要再测试一下Mark Word中偏向锁的标识是否设置成1（表示当前是偏向锁）：如果没有设置，则使用CAS竞争锁；如果设置了，则尝试使用CAS将对象头的偏向锁指向当前线程。</p>
<p>（1）偏向锁的撤销</p>
<p>偏向锁使用了一种等到竞争出现才释放锁的机制，所以当其他线程尝试竞争偏向锁时，持有偏向锁的线程才会释放锁。偏向锁的撤销，需要等待全局安全点（在这个时间点上没有正在执行的字节码）。它会首先暂停拥有偏向锁的线程，然后检查持有偏向锁的线程是否活着，如果线程不处于活动状态，则将对象头设置成无锁状态；如果线程仍然活着，拥有偏向锁的栈会被执行，遍历偏向对象的锁记录，栈中的锁记录和对象头的Mark Word要么重新偏向于其他线程，要么恢复到无锁或者标记对象不适合作为偏向锁，最后唤醒暂停的线程。图2-1中的线程1演示了偏向锁初始化的流程，线程2演示了偏向锁撤销的流程。</p>
<p><img src="Image00006.jpg" alt="img"></p>
<p>图2-1　偏向锁初始化的流程</p>
<p>（2）关闭偏向锁</p>
<p>偏向锁在Java 6和Java 7里是默认启用的，但是它在应用程序启动几秒钟之后才激活，如有必要可以使用JVM参数来关闭延迟：-XX:BiasedLockingStartupDelay=0。如果你确定应用程序里所有的锁通常情况下处于竞争状态，可以通过JVM参数关闭偏向锁：-XX:-UseBiasedLocking=false，那么程序默认会进入轻量级锁状态。</p>
<p>2.轻量级锁</p>
<p>（1）轻量级锁加锁</p>
<p>线程在执行同步块之前，JVM会先在当前线程的栈桢中创建用于存储锁记录的空间，并将对象头中的Mark Word复制到锁记录中，官方称为Displaced Mark Word。然后线程尝试使用CAS将对象头中的Mark Word替换为指向锁记录的指针。如果成功，当前线程获得锁，如果失败，表示其他线程竞争锁，当前线程便尝试使用自旋来获取锁。</p>
<p>（2）轻量级锁解锁</p>
<p>轻量级解锁时，会使用原子的CAS操作将Displaced Mark Word替换回到对象头，如果成功，则表示没有竞争发生。如果失败，表示当前锁存在竞争，锁就会膨胀成重量级锁。图2-2是两个线程同时争夺锁，导致锁膨胀的流程图。</p>
<p><img src="Image00007.jpg" alt="img"></p>
<p>图2-2　争夺锁导致的锁膨胀流程图</p>
<p>因为自旋会消耗CPU，为了避免无用的自旋（比如获得锁的线程被阻塞住了），一旦锁升级成重量级锁，就不会再恢复到轻量级锁状态。当锁处于这个状态下，其他线程试图获取锁时，都会被阻塞住，当持有锁的线程释放锁之后会唤醒这些线程，被唤醒的线程就会进行新一轮的夺锁之争。</p>
<p>3.锁的优缺点对比</p>
<table>
<thead>
<tr>
<th>锁</th>
<th>优点</th>
<th>缺点</th>
<th>适用场景</th>
</tr>
</thead>
<tbody><tr>
<td>偏向锁</td>
<td>加锁和解锁不需要额外的消耗，和执行非同步方法相比仅存在纳秒的差距</td>
<td>如果线程间存在竞争，会带来额外的锁撤销的消耗</td>
<td>适用于只有一个线程访问同步块场景</td>
</tr>
<tr>
<td>轻量级锁</td>
<td>竞争的线程不会阻塞，提高了程序的响应速度</td>
<td>如果始终得不到锁竞争的线程，使用自旋会消耗 CPU</td>
<td>追求响应时间，同步块执行速度非常快</td>
</tr>
<tr>
<td>重量级锁</td>
<td>线程中不使用自旋，不会消耗 CPU</td>
<td>线程阻塞，响应时间缓慢</td>
<td>追求吞吐量，同步块执行速度慢、时间长</td>
</tr>
</tbody></table>
<p>参考: 方腾飞,魏鹏,程晓明 著. 《Java并发编程的艺术 》(Java核心技术系列)</p>
]]></content>
      <categories>
        <category>java</category>
        <category>concurrent</category>
      </categories>
      <tags>
        <tag>jvm</tag>
        <tag>java</tag>
        <tag>concurrent</tag>
        <tag>lock escalation</tag>
      </tags>
  </entry>
  <entry>
    <title>Java并发--原子操作的实现原理</title>
    <url>/Java-Concurrent-realization-principle-of-atomic-operation/</url>
    <content><![CDATA[<p>原子（atomic）本意是“不能被进一步分割的最小粒子”，而原子操作（atomic operation）意为“不可被中断的一个或一系列操作”。在多处理器上实现原子操作就变得有点复杂。让我们一起来聊一聊在Intel处理器和Java里是如何实现原子操作的。</p>
<span id="more"></span> 

<p>1.术语定义</p>
<p>在了解原子操作的实现原理前，先要了解一下相关的术语，如表所示。</p>
<table>
<thead>
<tr>
<th align="center">术语名称</th>
<th align="center">英文</th>
<th align="center">解释</th>
</tr>
</thead>
<tbody><tr>
<td align="center">缓存行</td>
<td align="center">Cache line</td>
<td align="center">缓存的最小操作单位</td>
</tr>
<tr>
<td align="center">比较并交换</td>
<td align="center">Compare and Swap</td>
<td align="center">CAS 操作需要输入两个值，一个旧值（期望操作前的值）和一个新值，在操作期间先比较旧值有没有发生变化，如果没有发生变化，才交换成新值，发生了变化则不变换</td>
</tr>
<tr>
<td align="center">CPU   流水线</td>
<td align="center">CPU pipeline</td>
<td align="center">CPU 流水线的工作方式就像工业生产上装配流水线，在 CPU 中由 5<del>6 个不同功能的电路单元组成一条指令处理流水线，然后将一条 X86 指令分成 5</del>6 步后再由这些电路单元分别执行，这样就能实现一个 CPU 时钟周期完成一条指令，因此提高 CPU 的运算速度</td>
</tr>
<tr>
<td align="center">内存顺序冲突</td>
<td align="center">Memory order violation</td>
<td align="center">内存顺序冲突一般是由假共享引起的，假共享是指多个 CPU 同时修改同一个缓存行的不同部分而引起其中一个 CPU 的操作无效，当出现这个内存顺序冲突时，CPU 必须清空流水线</td>
</tr>
</tbody></table>
<p>2.处理器如何实现原子操作</p>
<p>32位IA-32处理器使用基于对缓存加锁或总线加锁的方式来实现多处理器之间的原子操作。首先处理器会自动保证基本的内存操作的原子性。处理器保证从系统内存中读取或者写入一个字节是原子的，意思是当一个处理器读取一个字节时，其他处理器不能访问这个字节的内存地址。Pentium 6和最新的处理器能自动保证单处理器对同一个缓存行里进行16/32/64位的操作是原子的，但是复杂的内存操作处理器是不能自动保证其原子性的，比如跨总线宽度、跨多个缓存行和跨页表的访问。但是，处理器提供总线锁定和缓存锁定两个机制来保证复杂内存操作的原子性。</p>
<p>（1）使用总线锁保证原子性</p>
<p>第一个机制是通过总线锁保证原子性 。如果多个处理器同时对共享变量进行读改写操作（i++就是经典的读改写操作），那么共享变量就会被多个处理器同时进行操作，这样读改写操作就不是原子的，操作完之后共享变量的值会和期望的不一致。举个例子，如果i=1，我们进行两次i++操作，我们期望的结果是3，但是有可能结果是2，如图2-3所示。</p>
<p><img src="Image00010.jpg" alt="img"></p>
<p>图2-3　结果对比</p>
<p>原因可能是多个处理器同时从各自的缓存中读取变量i，分别进行加1操作，然后分别写入系统内存中。那么，想要保证读改写共享变量的操作是原子的，就必须保证CPU1读改写共享变量的时候，CPU2不能操作缓存了该共享变量内存地址的缓存。</p>
<p>处理器使用总线锁就是来解决这个问题的。所谓总线锁就是使用处理器提供的一个LOCK＃信号，当一个处理器在总线上输出此信号时，其他处理器的请求将被阻塞住，那么该处理器可以独占共享内存。</p>
<p>（2）使用缓存锁保证原子性</p>
<p>第二个机制是通过缓存锁定来保证原子性 。在同一时刻，我们只需保证对某个内存地址的操作是原子性即可，但总线锁定把CPU和内存之间的通信锁住了，这使得锁定期间，其他处理器不能操作其他内存地址的数据，所以总线锁定的开销比较大，目前处理器在某些场合下使用缓存锁定代替总线锁定来进行优化。</p>
<p>频繁使用的内存会缓存在处理器的L1、L2和L3高速缓存里，那么原子操作就可以直接在处理器内部缓存中进行，并不需要声明总线锁，在Pentium 6和目前的处理器中可以使用“缓存锁定”的方式来实现复杂的原子性。所谓“缓存锁定”是指内存区域如果被缓存在处理器的缓存行中，并且在Lock操作期间被锁定，那么当它执行锁操作回写到内存时，处理器不在总线上声言LOCK＃信号，而是修改内部的内存地址，并允许它的缓存一致性机制来保证操作的原子性，因为缓存一致性机制会阻止同时修改由两个以上处理器缓存的内存区域数据，当其他处理器回写已被锁定的缓存行的数据时，会使缓存行无效，在如图2-3所示的例子中，当CPU1修改缓存行中的i时使用了缓存锁定，那么CPU2就不能同时缓存i的缓存行。</p>
<p>但是有两种情况下处理器不会使用缓存锁定。</p>
<p>第一种情况是：当操作的数据不能被缓存在处理器内部，或操作的数据跨多个缓存行（cache line）时，则处理器会调用总线锁定。</p>
<p>第二种情况是：有些处理器不支持缓存锁定。对于Intel 486和Pentium处理器，就算锁定的内存区域在处理器的缓存行中也会调用总线锁定。</p>
<p>针对以上两个机制，我们通过Intel处理器提供了很多Lock前缀的指令来实现。例如，位测试和修改指令：BTS、BTR、BTC；交换指令XADD、CMPXCHG，以及其他一些操作数和逻辑指令（如ADD、OR）等，被这些指令操作的内存区域就会加锁，导致其他处理器不能同时访问它。</p>
<p>3.Java如何实现原子操作</p>
<p>在Java中可以通过锁和循环CAS的方式来实现原子操作。</p>
<p>（1）使用循环CAS实现原子操作</p>
<p>JVM中的CAS操作正是利用了处理器提供的CMPXCHG指令实现的。自旋CAS实现的基本思路就是循环进行CAS操作直到成功为止，以下代码实现了一个基于CAS线程安全的计数器方法safeCount和一个非线程安全的计数器count。</p>
<hr>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> AtomicInteger atomicI = <span class="keyword">new</span> AtomicInteger(<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">final</span> Counter cas = <span class="keyword">new</span> Counter();</span><br><span class="line">        List&lt;Thread&gt; ts = <span class="keyword">new</span> ArrayList&lt;Thread&gt;(<span class="number">600</span>);</span><br><span class="line">        <span class="keyword">long</span> start = System.currentTimeMillis();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; <span class="number">100</span>; j++) &#123;</span><br><span class="line">            Thread t = <span class="keyword">new</span> Thread(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10000</span>; i++) &#123;</span><br><span class="line">                        cas.count();</span><br><span class="line">                        cas.safeCount();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">            ts.add(t);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (Thread t : ts) &#123;</span><br><span class="line">            t.start();</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="comment">// 等待所有线程执行完成</span></span><br><span class="line">        <span class="keyword">for</span> (Thread t : ts) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                t.join();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(cas.i);</span><br><span class="line">        System.out.println(cas.atomicI.get());</span><br><span class="line">        System.out.println(System.currentTimeMillis() - start);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**        * 使用CAS实现线程安全计数器        */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">safeCount</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (;;) &#123;</span><br><span class="line">            <span class="keyword">int</span> i = atomicI.get();</span><br><span class="line">            <span class="keyword">boolean</span> suc = atomicI.compareAndSet(i, ++i);</span><br><span class="line">            <span class="keyword">if</span> (suc) &#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 非线程安全计数器</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">count</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        i++;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<p>从Java 1.5开始，JDK的并发包里提供了一些类来支持原子操作，如AtomicBoolean（用原子方式更新的boolean值）、AtomicInteger（用原子方式更新的int值）和AtomicLong（用原子方式更新的long值）。这些原子包装类还提供了有用的工具方法，比如以原子的方式将当前值自增1和自减1。</p>
<p>（2）CAS实现原子操作的三大问题</p>
<p>在Java并发包中有一些并发框架也使用了自旋CAS的方式来实现原子操作，比如LinkedTransferQueue类的Xfer方法。CAS虽然很高效地解决了原子操作，但是CAS仍然存在三大问题。ABA问题，循环时间长开销大，以及只能保证一个共享变量的原子操作。</p>
<p>1）ABA问题 。因为CAS需要在操作值的时候，检查值有没有发生变化，如果没有发生变化则更新，但是如果一个值原来是A，变成了B，又变成了A，那么使用CAS进行检查时会发现它的值没有发生变化，但是实际上却变化了。ABA问题的解决思路就是使用版本号。在变量前面追加上版本号，每次变量更新的时候把版本号加1，那么A→B→A就会变成1A→2B→3A。从Java 1.5开始，JDK的Atomic包里提供了一个类AtomicStampedReference来解决ABA问题。这个类的compareAndSet方法的作用是首先检查当前引用是否等于预期引用，并且检查当前标志是否等于预期标志，如果全部相等，则以原子方式将该引用和该标志的值设置为给定的更新值。</p>
<hr>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">compareAndSet</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">           V          expectedReference,         // 预期引用</span></span></span><br><span class="line"><span class="params"><span class="function">           V          newReference,              // 更新后的引用</span></span></span><br><span class="line"><span class="params"><span class="function">           <span class="keyword">int</span>         expectedStamp,            // 预期标志</span></span></span><br><span class="line"><span class="params"><span class="function">           <span class="keyword">int</span>         newStamp                  // 更新后的标志</span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span></span><br></pre></td></tr></table></figure>

<hr>
<p>2）循环时间长开销大 。自旋CAS如果长时间不成功，会给CPU带来非常大的执行开销。如果JVM能支持处理器提供的pause指令，那么效率会有一定的提升。pause指令有两个作用：第一，它可以延迟流水线执行指令（de-pipeline），使CPU不会消耗过多的执行资源，延迟的时间取决于具体实现的版本，在一些处理器上延迟时间是零；第二，它可以避免在退出循环的时候因内存顺序冲突（Memory Order Violation）而引起CPU流水线被清空（CPU Pipeline Flush），从而提高CPU的执行效率。</p>
<p>3）只能保证一个共享变量的原子操作 。当对一个共享变量执行操作时，我们可以使用循环CAS的方式来保证原子操作，但是对多个共享变量操作时，循环CAS就无法保证操作的原子性，这个时候就可以用锁。还有一个取巧的办法，就是把多个共享变量合并成一个共享变量来操作。比如，有两个共享变量i＝2，j=a，合并一下ij=2a，然后用CAS来操作ij。从Java 1.5开始，JDK提供了AtomicReference类来保证引用对象之间的原子性，就可以把多个变量放在一个对象里来进行CAS操作。</p>
<p>（3）使用锁机制实现原子操作</p>
<p>锁机制保证了只有获得锁的线程才能够操作锁定的内存区域。JVM内部实现了很多种锁机制，有偏向锁、轻量级锁和互斥锁。有意思的是除了偏向锁，JVM实现锁的方式都用了循环CAS，即当一个线程想进入同步块的时候使用循环CAS的方式来获取锁，当它退出同步块的时候使用循环CAS释放锁。</p>
<p>参考: 方腾飞,魏鹏,程晓明 著. 《Java并发编程的艺术 》(Java核心技术系列)</p>
]]></content>
      <categories>
        <category>java</category>
        <category>concurrent</category>
      </categories>
      <tags>
        <tag>jvm</tag>
        <tag>java</tag>
        <tag>concurrent</tag>
        <tag>atomic</tag>
        <tag>CAS</tag>
        <tag>LOCK</tag>
      </tags>
  </entry>
  <entry>
    <title>Java 并发--synchronized 的实现原理与应用</title>
    <url>/Java-Concurrent-synchronized/</url>
    <content><![CDATA[<p>在多线程并发编程中 synchronized 一直是元老级角色，很多人都会称呼它为重量级锁。但是，随着 Java SE 1.6 对 synchronized 进行了各种优化之后，有些情况下它就并不那么重了。本文详细介绍 Java SE 1.6 中为了减少获得锁和释放锁带来的性能消耗而引入的偏向锁和轻量级锁，以及锁的存储结构和升级过程。<br> <span id="more"></span><br>先来看下利用 synchronized 实现同步的基础：Java中的每一个对象都可以作为锁。具体表现为以下3种形式。</p>
<p>·对于普通同步方法，锁是当前实例对象。</p>
<p>·对于静态同步方法，锁是当前类的 Class 对象。</p>
<p>·对于同步方法块，锁是 Synchonized 括号里配置的对象。</p>
<p>当一个线程试图访问同步代码块时，它首先必须得到锁，退出或抛出异常时必须释放锁。那么锁到底存在哪里呢？锁里面会存储什么信息呢？</p>
<p>从 JVM 规范中可以看到 Synchonized 在 JVM 里的实现原理，JVM 基于进入和退出 Monitor 对象来实现方法同步和代码块同步，但两者的实现细节不一样。代码块同步是使用 monitorenter 和 monitorexit 指令实现的，而方法同步是使用另外一种方式实现的，细节在 JVM 规范里并没有详细说明。但是，方法的同步同样可以使用这两个指令来实现。</p>
<p>monitorenter 指令是在编译后插入到同步代码块的开始位置，而monitorexit是插入到方法结束处和异常处，JVM要保证每个monitorenter必须有对应的monitorexit与之配对。任何对象都有一个monitor与之关联，当且一个monitor被持有后，它将处于锁定状态。线程执行到monitorenter指令时，将会尝试获取对象所对应的monitor的所有权，即尝试获得对象的锁。</p>
<p>参考: 方腾飞,魏鹏,程晓明 著. 《Java并发编程的艺术 》(Java核心技术系列)</p>
]]></content>
      <categories>
        <category>java</category>
        <category>concurrent</category>
      </categories>
      <tags>
        <tag>jvm</tag>
        <tag>java</tag>
        <tag>concurrent</tag>
        <tag>Synchronized</tag>
      </tags>
  </entry>
  <entry>
    <title>Java并发--volatile 的应用</title>
    <url>/Java-Concurrent-volatile/</url>
    <content><![CDATA[<h2 id="1-volatile的应用"><a href="#1-volatile的应用" class="headerlink" title="1　volatile的应用"></a>1　volatile的应用</h2><p>在多线程并发编程中synchronized和volatile都扮演着重要的角色，volatile是轻量级的synchronized，它在多处理器开发中保证了共享变量的“可见性”。可见性的意思是当一个线程修改一个共享变量时，另外一个线程能读到这个修改的值。如果volatile变量修饰符使用恰当的话，它比synchronized的使用和执行成本更低，因为它不会引起线程上下文的切换和调度。本文将深入分析在硬件层面上Intel处理器是如何实现volatile的，通过深入分析帮助我们正确地使用volatile变量。<br> <span id="more"></span><br>我们先从了解volatile的定义开始。</p>
<p>1.volatile的定义与实现原理</p>
<p>Java语言规范第3版中对volatile的定义如下：Java编程语言允许线程访问共享变量，为了确保共享变量能被准确和一致地更新，线程应该确保通过排他锁单独获得这个变量。Java语言提供了volatile，在某些情况下比锁要更加方便。如果一个字段被声明成volatile，Java线程内存模型确保所有线程看到这个变量的值是一致的。</p>
<p>在了解volatile实现原理之前，我们先来看下与其实现原理相关的CPU术语与说明。下面的表是CPU术语的定义。</p>
<table>
<thead>
<tr>
<th align="center">术语</th>
<th>英文单词</th>
<th>术语描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">内存屏障</td>
<td>memory barriers</td>
<td>是一组处理器指令，用于实现对内存参照顺序限制</td>
</tr>
<tr>
<td align="center">缓冲行</td>
<td>cache line</td>
<td>缓存中可以分配的最小单位。处理器填写缓存线时会加载整个缓存线，需要使用多个内存读周期</td>
</tr>
<tr>
<td align="center">原子操作</td>
<td>atomic operations</td>
<td>不可中断的一个或一系列操作</td>
</tr>
<tr>
<td align="center">缓存填充</td>
<td>cache line fill</td>
<td>当处理器识别到从内存中读取操作数是可缓存的，处理器读取整个缓存行到适当的缓存（L1，L2，L3 或所有的）</td>
</tr>
<tr>
<td align="center">缓存命中</td>
<td>cache hit</td>
<td>如果进行高速缓存行填充操作的内存位置仍然是下次处理器访问的地址时，处理器从缓存中读取操作数，而不是从内存读取</td>
</tr>
<tr>
<td align="center">写命中</td>
<td>write hit</td>
<td>当处理器将操作数写回到一个内存缓存的区域时，它首先会检查这个缓存的内存地址是否在缓存行中，如果存在一个有效的缓存行，则处理器将这个操作数写回到缓存，而不是写到内存，这个操作被称为写命中</td>
</tr>
<tr>
<td align="center">写缺失</td>
<td>write misses the cache</td>
<td>一个有效的缓存行被写入到不存在的内存区域</td>
</tr>
</tbody></table>
<p>volatile是如何来保证可见性的呢？让我们在X86处理器下通过工具获取JIT编译器生成的汇编指令来查看对volatile进行写操作时，CPU会做什么事情。</p>
<p>Java代码如下。</p>
<hr>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">instance = <span class="keyword">new</span> Singleton();                 <span class="comment">// instance是volatile变量</span></span><br></pre></td></tr></table></figure>

<hr>
<p>转变成汇编代码，如下。</p>
<hr>
<figure class="highlight basic"><table><tr><td class="code"><pre><span class="line"><span class="number">0</span>x01a3de1d: movb $<span class="number">0</span>×<span class="number">0</span>,<span class="number">0</span>×<span class="number">1104800</span>(%esi);<span class="number">0</span>x01a3de24: lock addl $<span class="number">0</span>×<span class="number">0</span>,(%esp);</span><br></pre></td></tr></table></figure>

<hr>
<p>有volatile变量修饰的共享变量进行写操作的时候会多出第二行汇编代码，通过查IA-32架构软件开发者手册可知，Lock前缀的指令在多核处理器下会引发了两件事情 。</p>
<p>1）将当前处理器缓存行的数据写回到系统内存。</p>
<p>2）这个写回内存的操作会使在其他CPU里缓存了该内存地址的数据无效。</p>
<p>为了提高处理速度，处理器不直接和内存进行通信，而是先将系统内存的数据读到内部缓存（L1，L2或其他）后再进行操作，但操作完不知道何时会写到内存。如果对声明了volatile的变量进行写操作，JVM就会向处理器发送一条Lock前缀的指令，将这个变量所在缓存行的数据写回到系统内存。但是，就算写回到内存，如果其他处理器缓存的值还是旧的，再执行计算操作就会有问题。所以，在多处理器下，为了保证各个处理器的缓存是一致的，就会实现缓存一致性协议，每个处理器通过嗅探在总线上传播的数据来检查自己缓存的值是不是过期了，当处理器发现自己缓存行对应的内存地址被修改，就会将当前处理器的缓存行设置成无效状态，当处理器对这个数据进行修改操作的时候，会重新从系统内存中把数据读到处理器缓存里。</p>
<p>下面来具体讲解volatile的两条实现原则。</p>
<p>1）Lock前缀指令会引起处理器缓存回写到内存 。Lock前缀指令导致在执行指令期间，声言处理器的LOCK#信号。在多处理器环境中，LOCK#信号确保在声言该信号期间，处理器可以独占任何共享内存  。但是，在最近的处理器里，LOCK＃信号一般不锁总线，而是锁缓存，毕竟锁总线开销的比较大。在8.1.4节有详细说明锁定操作对处理器缓存的影响，对于Intel486和Pentium处理器，在锁操作时，总是在总线上声言LOCK#信号。但在P6和目前的处理器中，如果访问的内存区域已经缓存在处理器内部，则不会声言LOCK#信号。相反，它会锁定这块内存区域的缓存并回写到内存，并使用缓存一致性机制来确保修改的原子性，此操作被称为“缓存锁定”，缓存一致性机制会阻止同时修改由两个以上处理器缓存的内存区域数据。</p>
<p>2）一个处理器的缓存回写到内存会导致其他处理器的缓存无效 。IA-32处理器和Intel 64处理器使用MESI（修改、独占、共享、无效）控制协议去维护内部缓存和其他处理器缓存的一致性。在多核处理器系统中进行操作的时候，IA-32和Intel 64处理器能嗅探其他处理器访问系统内存和它们的内部缓存。处理器使用嗅探技术保证它的内部缓存、系统内存和其他处理器的缓存的数据在总线上保持一致。例如，在Pentium和P6 family处理器中，如果通过嗅探一个处理器来检测其他处理器打算写内存地址，而这个地址当前处于共享状态，那么正在嗅探的处理器将使它的缓存行无效，在下次访问相同内存地址时，强制执行缓存行填充。</p>
<p>2.volatile的使用优化</p>
<p>著名的Java并发编程大师Doug lea在JDK 7的并发包里新增一个队列集合类LinkedTransferQueue，它在使用volatile变量时，用一种追加字节的方式来优化队列出队和入队的性能。LinkedTransferQueue的代码如下。</p>
<hr>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/** 队列中的头部节点 */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">transient</span> f?inal PaddedAtomicReference&lt;QNode&gt; head;</span><br><span class="line"><span class="comment">/** 队列中的尾部节点 */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">transient</span> f?inal PaddedAtomicReference&lt;QNode&gt; tail;</span><br><span class="line"><span class="keyword">static</span> f?inal <span class="class"><span class="keyword">class</span> <span class="title">PaddedAtomicReference</span> &lt;<span class="title">T</span>&gt; <span class="keyword">extends</span> <span class="title">AtomicReference</span> <span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">     <span class="comment">// 使用很多4个字节的引用追加到64个字节</span></span><br><span class="line">     Object p0, p1, p2, p3, p4, p5, p6, p7, p8, p9, pa, pb, pc, pd, pe;</span><br><span class="line">     PaddedAtomicReference(T r) &#123;</span><br><span class="line">        <span class="keyword">super</span>(r);</span><br><span class="line">     &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AtomicReference</span> &lt;<span class="title">V</span>&gt; <span class="keyword">implements</span> <span class="title">java</span>.<span class="title">io</span>.<span class="title">Serializable</span> </span>&#123;</span><br><span class="line">     <span class="keyword">private</span> <span class="keyword">volatile</span> V value;</span><br><span class="line">     <span class="comment">// 省略其他代码</span></span><br><span class="line">｝</span><br></pre></td></tr></table></figure>

<hr>
<p>追加字节能优化性能 ？这种方式看起来很神奇，但如果深入理解处理器架构就能理解其中的奥秘。让我们先来看看LinkedTransferQueue这个类，它使用一个内部类类型来定义队列的头节点（head）和尾节点（tail），而这个内部类PaddedAtomicReference相对于父类AtomicReference只做了一件事情，就是将共享变量追加到64字节。我们可以来计算下，一个对象的引用占4个字节，它追加了15个变量（共占60个字节），再加上父类的value变量，一共64个字节。</p>
<p>为什么追加64字节能够提高并发编程的效率呢 ？因为对于英特尔酷睿i7、酷睿、Atom和NetBurst，以及Core Solo和Pentium M处理器的L1、L2或L3缓存的高速缓存行是64个字节宽，不支持部分填充缓存行，这意味着，如果队列的头节点和尾节点都不足64字节的话，处理器会将它们都读到同一个高速缓存行中，在多处理器下每个处理器都会缓存同样的头、尾节点，当一个处理器试图修改头节点时，会将整个缓存行锁定，那么在缓存一致性机制的作用下，会导致其他处理器不能访问自己高速缓存中的尾节点，而队列的入队和出队操作则需要不停修改头节点和尾节点，所以在多处理器的情况下将会严重影响到队列的入队和出队效率。Doug lea使用追加到64字节的方式来填满高速缓冲区的缓存行，避免头节点和尾节点加载到同一个缓存行，使头、尾节点在修改时不会互相锁定。</p>
<p>那么是不是在使用volatile变量时都应该追加到64字节呢 ？不是的。在两种场景下不应该使用这种方式。</p>
<p>·缓存行非64字节宽的处理器 。如P6系列和奔腾处理器，它们的L1和L2高速缓存行是32个字节宽。</p>
<p>·共享变量不会被频繁地写 。因为使用追加字节的方式需要处理器读取更多的字节到高速缓冲区，这本身就会带来一定的性能消耗，如果共享变量不被频繁写的话，锁的几率也非常小，就没必要通过追加字节的方式来避免相互锁定。</p>
<p>不过这种追加字节的方式在Java 7下可能不生效，因为Java 7变得更加智慧，它会淘汰或重新排列无用字段，需要使用其他追加字节的方式。除了volatile，Java并发编程中应用较多的是synchronized。</p>
<p>参考: 方腾飞,魏鹏,程晓明 著. 《Java并发编程的艺术 》(Java核心技术系列)</p>
]]></content>
      <categories>
        <category>java</category>
        <category>concurrent</category>
      </categories>
      <tags>
        <tag>jvm</tag>
        <tag>java</tag>
        <tag>concurrent</tag>
        <tag>volatile</tag>
      </tags>
  </entry>
  <entry>
    <title>Mac的最大连接数限制和端口的相关参数的设置</title>
    <url>/Mac-Max-Connet-Port/</url>
    <content><![CDATA[<blockquote>
<p>“</p>
<p>使用jmeter压测服务器接口，出现连接超时或者无法找到路由之类的错误。发现实际瓶颈并非出现在服务器上，而是在本机。</p>
<p>”</p>
</blockquote>
<h2 id="最大连接数限制"><a href="#最大连接数限制" class="headerlink" title="最大连接数限制"></a>最大连接数限制</h2><p>最大连接数限制就是系统所能打开的最大文件数（文件描述符）的限制，分全局和进程两种，相应的命令如下：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sysctl kern.maxfiles</span></span><br></pre></td></tr></table></figure>

<p>输出</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">kern.maxfiles: 12288</span><br></pre></td></tr></table></figure>

<p>说明：全局限制，也就是系统默认的最大连接数限制是12288</p>
<span id="more"></span>

<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sysctl kern.maxfilesperproc</span></span><br></pre></td></tr></table></figure>

<p>输出</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">kern.maxfilesperproc: 10240</span><br></pre></td></tr></table></figure>

<p>说明：单个进程默认最大连接数限制是10240</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sudo sysctl -w kern.maxfiles=1048600</span></span><br></pre></td></tr></table></figure>

<p>输出</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">kern.maxfiles: 12288 -&gt; 1048600</span><br></pre></td></tr></table></figure>

<p>说明：设置系统最大连接数从12288到1048600</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sudo sysctl -w kern.maxfilesperproc=1048576</span></span><br></pre></td></tr></table></figure>

<p>输出</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">kern.maxfilesperproc: 10240 -&gt; 1048576</span><br></pre></td></tr></table></figure>

<p>说明：设置进程连接数限制，进程的最大连接数要小于等于全局连接数</p>
<h2 id="ulimit命令"><a href="#ulimit命令" class="headerlink" title="ulimit命令"></a>ulimit命令</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">ulimit</span> -n</span></span><br></pre></td></tr></table></figure>

<p>输出</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">2560</span><br></pre></td></tr></table></figure>

<p>说明：<code>ulimit －n</code> 命令显示当前shell能打开的最大文件数，默认值：<code>2560</code> ，该值总是小于 <code>kern.maxfilesperproc</code> 的值，因为一个shell就是一个进程。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">ulimit</span> -n 1048576</span></span><br></pre></td></tr></table></figure>

<p>说明：设置当前shell能打开的最大文件数为1048576，该值不能大于 <code>kern.maxfilesperproc</code> ，否则会提示设置失败。</p>
<h2 id="动态端口范围"><a href="#动态端口范围" class="headerlink" title="动态端口范围"></a>动态端口范围</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sysctl net.inet.ip.portrange</span></span><br></pre></td></tr></table></figure>

<p>输出</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">net.inet.ip.portrange.lowfirst: 1023</span><br><span class="line">net.inet.ip.portrange.lowlast: 600</span><br><span class="line">net.inet.ip.portrange.first: 49152</span><br><span class="line">net.inet.ip.portrange.last: 65535</span><br><span class="line">net.inet.ip.portrange.hifirst: 49152</span><br><span class="line">net.inet.ip.portrange.hilast: 65535</span><br></pre></td></tr></table></figure>

<blockquote>
<p>“</p>
<p>Linux动态端口号默认范围是32768-65535，也就是说，作为客户端连接同一个IP和同一个端口号，最多只能建立30000多个连接，而Mac默认只能建立16000个左右的连接。</p>
<p>”</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sysctl -w net.inet.ip.portrange.first=32768</span></span><br></pre></td></tr></table></figure>

<p>说明：设置动态分配起点端口号为32768，这样可以增大客户端可以建立的连接数。</p>
<p>参考：The IANA list of port numbers includes the well-known and registered port numbers and specifies the dynamic port number range.</p>
<h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><p>按以上的方式设置参数有个问题，当系统重启后，这些参数又恢复成了默认值，解决办法就是把参数写到 <code>/etc/sysctl.conf</code> 文件中，但是，默认这个文件是不存在的，所以首先就要创建它：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sudo touch /etc/sysctl.conf</span></span><br></pre></td></tr></table></figure>

<p>然后把参数写到文件里</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo vi /etc/sysctl.conf</span><br><span class="line"></span><br><span class="line">kern.maxfiles=1048600</span><br><span class="line">kern.maxfilesperproc=1048576</span><br><span class="line">net.inet.ip.portrange.first=32768   </span><br><span class="line">net.inet.ip.portrange.last=65535</span><br></pre></td></tr></table></figure>

<p>重启系统，查看结果，显示成功。</p>
<p>至于 <code>ulimit -n</code> 的值，可以把 <code>ulimit -n 1048576</code> 写到 <code>.bashrc</code> 中实现自动修改。</p>
]]></content>
      <categories>
        <category>Mac</category>
        <category>Connect</category>
        <category>Port</category>
      </categories>
      <tags>
        <tag>Mac</tag>
        <tag>Connect</tag>
        <tag>Port</tag>
      </tags>
  </entry>
  <entry>
    <title>加微信好友</title>
    <url>/My-wechat/</url>
    <content><![CDATA[<h1 id="打开微信，扫一扫加微信好友"><a href="#打开微信，扫一扫加微信好友" class="headerlink" title="打开微信，扫一扫加微信好友"></a>打开微信，扫一扫加微信好友</h1><p><img src="/assets/img/my_wechat.jpg" alt="hunkier"></p>
]]></content>
      <categories>
        <category>github</category>
        <category>hexo</category>
        <category>wechat</category>
      </categories>
      <tags>
        <tag>blog</tag>
        <tag>hexo</tag>
        <tag>wechat</tag>
      </tags>
  </entry>
  <entry>
    <title>MySQL实战45讲笔记</title>
    <url>/Mysql-45/</url>
    <content><![CDATA[<p>极客时间《MySQL实战45讲笔记》学习笔记</p>
<h1 id="基础篇"><a href="#基础篇" class="headerlink" title="基础篇"></a>基础篇</h1><h2 id="大体来说，MySQL-可以分为-Server-层和存储引擎层两部分。"><a href="#大体来说，MySQL-可以分为-Server-层和存储引擎层两部分。" class="headerlink" title="大体来说，MySQL 可以分为 Server 层和存储引擎层两部分。"></a>大体来说，MySQL 可以分为 Server 层和存储引擎层两部分。</h2><p>Server 层包括连接器、查询缓存、分析器、优化器、执行器等，涵盖 MySQL 的大多数核心服务功能，以及所有的内置函数（如日期、时间、数学和加密函数等），所有跨存储引擎的功能都在这一层实现，比如存储过程、触发器、视图等。</p>
<p>而存储引擎层负责数据的存储和提取。其架构模式是插件式的，支持 InnoDB、MyISAM、Memory 等多个存储引擎。现在最常用的存储引擎是 InnoDB，它从 MySQL 5.5.5 版本开始成为了默认存储引擎。</p>
<h2 id="WAL-的全称是-Write-Ahead-Logging，它的关键点就是先写日志，再写磁盘"><a href="#WAL-的全称是-Write-Ahead-Logging，它的关键点就是先写日志，再写磁盘" class="headerlink" title="WAL 的全称是 Write-Ahead Logging，它的关键点就是先写日志，再写磁盘"></a>WAL 的全称是 Write-Ahead Logging，它的关键点就是先写日志，再写磁盘</h2><span id="more"></span>

<p>具体来说，当有一条记录需要更新的时候，InnoDB 引擎就会先把记录写到 redo log（粉板）里面，并更新内存，这个时候更新就算完成了。同时，InnoDB 引擎会在适当的时候，将这个操作记录更新到磁盘里面，而这个更新往往是在系统比较空闲的时候做。</p>
<p>nnoDB 的 redo log 是固定大小的，比如可以配置为一组 4 个文件，每个文件的大小是 1GB，总共就可以记录 4GB 的操作。从头开始写，写到末尾就又回到开头循环写。</p>
<p>有了 redo log，InnoDB 就可以保证即使数据库发生异常重启，之前提交的记录都不会丢失，这个能力称为<strong>crash-safe</strong>。</p>
<h2 id="重要的日志模块：binlog"><a href="#重要的日志模块：binlog" class="headerlink" title="重要的日志模块：binlog"></a>重要的日志模块：binlog</h2><p>MySQL 整体来看，其实就有两块：一块是 Server 层，它主要做的是 MySQL 功能层面的事情；还有一块是引擎层，负责存储相关的具体事宜。上面我们聊到的粉板 redo log 是 InnoDB 引擎特有的日志，而 Server 层也有自己的日志，称为 binlog（归档日志）。</p>
<p>因为最开始 MySQL 里并没有 InnoDB 引擎。MySQL 自带的引擎是 MyISAM，但是 MyISAM 没有 crash-safe 的能力，binlog 日志只能用于归档。而 InnoDB 是另一个公司以插件形式引入 MySQL 的，既然只依靠 binlog 是没有 crash-safe 能力的，所以 InnoDB 使用另外一套日志系统——也就是 redo log 来实现 crash-safe 能力。</p>
<p>这两种日志有以下三点不同。</p>
<ol>
<li>redo log 是 InnoDB 引擎特有的；binlog 是 MySQL 的 Server 层实现的，所有引擎都可以使用。</li>
<li>redo log 是物理日志，记录的是“在某个数据页上做了什么修改”；binlog 是逻辑日志，记录的是这个语句的原始逻辑，比如“给 ID=2 这一行的 c 字段加 1 ”。</li>
<li>redo log 是循环写的，空间固定会用完；binlog 是可以追加写入的。“追加写”是指 binlog 文件写到一定大小后会切换到下一个，并不会覆盖以前的日志。</li>
</ol>
<p>有了对这两个日志的概念性理解，我们再来看执行器和 InnoDB 引擎在执行这个简单的 update 语句时的内部流程。</p>
<ol>
<li>执行器先找引擎取 ID=2 这一行。ID 是主键，引擎直接用树搜索找到这一行。如果 ID=2 这一行所在的数据页本来就在内存中，就直接返回给执行器；否则，需要先从磁盘读入内存，然后再返回。</li>
<li>执行器拿到引擎给的行数据，把这个值加上 1，比如原来是 N，现在就是 N+1，得到新的一行数据，再调用引擎接口写入这行新数据。</li>
<li>引擎将这行新数据更新到内存中，同时将这个更新操作记录到 redo log 里面，此时 redo log 处于 prepare 状态。然后告知执行器执行完成了，随时可以提交事务。</li>
<li>执行器生成这个操作的 binlog，并把 binlog 写入磁盘。</li>
<li>执行器调用引擎的提交事务接口，引擎把刚刚写入的 redo log 改成提交（commit）状态，更新完成。</li>
</ol>
<p>将 redo log 的写入拆成了两个步骤：prepare 和 commit，这就是”两阶段提交”。</p>
<p>redo log 用于保证 crash-safe 能力。innodb_flush_log_at_trx_commit 这个参数设置成 1 的时候，表示每次事务的 redo log 都直接持久化到磁盘。这个参数我建议你设置成 1，这样可以保证 MySQL 异常重启之后数据不丢失。</p>
<p>sync_binlog 这个参数设置成 1 的时候，表示每次事务的 binlog 都持久化到磁盘。这个参数我也建议你设置成 1，这样可以保证 MySQL 异常重启之后 binlog 不丢失。</p>
<h2 id="隔离性与隔离级别"><a href="#隔离性与隔离级别" class="headerlink" title="隔离性与隔离级别"></a>隔离性与隔离级别</h2><p>提到事务，你肯定会想到 ACID（Atomicity、Consistency、Isolation、Durability，即原子性、一致性、隔离性、持久性），今天我们就来说说其中 I，也就是“隔离性”。</p>
<p>当数据库上有多个事务同时执行的时候，就可能出现脏读（dirty read）、不可重复读（non-repeatable read）、幻读（phantom read）的问题，为了解决这些问题，就有了“隔离级别”的概念。</p>
<p>在谈隔离级别之前，你首先要知道，你隔离得越严实，效率就会越低。因此很多时候，我们都要在二者之间寻找一个平衡点。SQL 标准的事务隔离级别包括：读未提交（read uncommitted）、读提交（read committed）、可重复读（repeatable read）和串行化（serializable ）。下面我逐一为你解释：</p>
<ul>
<li>读未提交是指，一个事务还没提交时，它做的变更就能被别的事务看到。</li>
<li>读提交是指，一个事务提交之后，它做的变更才会被其他事务看到。</li>
<li>可重复读是指，一个事务执行过程中看到的数据，总是跟这个事务在启动时看到的数据是一致的。当然在可重复读隔离级别下，未提交变更对其他事务也是不可见的。</li>
<li>串行化，顾名思义是对于同一行记录，“写”会加“写锁”，“读”会加“读锁”。当出现读写锁冲突的时候，后访问的事务必须等前一个事务执行完成，才能继续执行。</li>
</ul>
<p>在实现上，数据库里面会创建一个视图，访问的时候以视图的逻辑结果为准。在“可重复读”隔离级别下，这个视图是在事务启动时创建的，整个事务存在期间都用这个视图。在“读提交”隔离级别下，这个视图是在每个 SQL 语句开始执行的时候创建的。这里需要注意的是，“读未提交”隔离级别下直接返回记录上的最新值，没有视图概念；而“串行化”隔离级别下直接用加锁的方式来避免并行访问。</p>
<p>配置的方式是，将启动参数 transaction-isolation 的值设置成 READ-COMMITTED。你可以用 show variables 来查看当前的值。</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">show</span> variables <span class="keyword">like</span> <span class="string">&#x27;transaction_isolation&#x27;</span>;</span><br></pre></td></tr></table></figure>




<h2 id="事务的启动方式"><a href="#事务的启动方式" class="headerlink" title="事务的启动方式"></a>事务的启动方式</h2><p>如前面所述，长事务有这些潜在风险，我当然是建议你尽量避免。其实很多时候业务开发同学并不是有意使用长事务，通常是由于误用所致。MySQL 的事务启动方式有以下几种：</p>
<ol>
<li>显式启动事务语句， begin 或 start transaction。配套的提交语句是 commit，回滚语句是 rollback。</li>
<li>set autocommit=0，这个命令会将这个线程的自动提交关掉。意味着如果你只执行一个 select 语句，这个事务就启动了，而且并不会自动提交。这个事务持续存在直到你主动执行 commit 或 rollback 语句，或者断开连接。</li>
</ol>
<p>在 autocommit 为 1 的情况下，用 begin 显式启动的事务，如果执行 commit 则提交事务。如果执行 commit work and chain，则是提交事务并自动启动下一个事务，这样也省去了再次执行 begin 语句的开销。同时带来的好处是从程序开发的角度明确地知道每个语句是否处于事务中。</p>
<p>你可以在 information_schema 库的 innodb_trx 这个表中查询长事务，比如下面这个语句，用于查找持续时间超过 60s 的事务。</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> information_schema.innodb_trx <span class="keyword">where</span> TIME_TO_SEC(timediff(now(),trx_started))<span class="operator">&gt;</span><span class="number">60</span>;</span><br></pre></td></tr></table></figure>

<h2 id="InnoDB-的索引模型"><a href="#InnoDB-的索引模型" class="headerlink" title="InnoDB 的索引模型"></a>InnoDB 的索引模型</h2><p>在 InnoDB 中，表都是根据主键顺序以索引的形式存放的，这种存储方式的表称为索引组织表。又因为前面我们提到的，InnoDB 使用了 B+ 树索引模型，所以数据都是存储在 B+ 树中的。</p>
<p>每一个索引在 InnoDB 里面对应一棵 B+ 树。</p>
<p>索引类型分为主键索引和非主键索引。</p>
<p>主键索引的叶子节点存的是整行数据。在 InnoDB 里，主键索引也被称为聚簇索引（clustered index）。</p>
<p>非主键索引的叶子节点内容是主键的值。在 InnoDB 里，非主键索引也被称为二级索引（secondary index）。</p>
<p>基于非主键索引的查询需要多扫描一棵索引树。因此，我们在应用中应该尽量使用主键查询。</p>
<h2 id="索引维护"><a href="#索引维护" class="headerlink" title="索引维护"></a>索引维护</h2><p>B+ 树为了维护索引有序性，在插入新值的时候需要做必要的维护。</p>
<p>如果 数据页已经满了，根据 B+ 树的算法，这时候需要申请一个新的数据页，然后挪动部分数据过去。这个过程称为页分裂。在这种情况下，性能自然会受影响。</p>
<p>除了性能外，页分裂操作还影响数据页的利用率。原本放在一个页的数据，现在分到两个页中，整体空间利用率降低大约 50%。</p>
<p>当然有分裂就有合并。当相邻两个页由于删除了数据，利用率很低之后，会将数据页做合并。合并的过程，可以认为是分裂过程的逆过程。</p>
<p>自增主键的插入数据模式，正符合了我们前面提到的递增插入的场景。每次插入一条新记录，都是追加操作，都不涉及到挪动其他记录，也不会触发叶子节点的分裂。</p>
<p>显然，主键长度越小，普通索引的叶子节点就越小，普通索引占用的空间也就越小。</p>
<h3 id="如何避免长事务对业务的影响？"><a href="#如何避免长事务对业务的影响？" class="headerlink" title="如何避免长事务对业务的影响？"></a>如何避免长事务对业务的影响？</h3><p>这个问题，我们可以从应用开发端和数据库端来看。</p>
<h4 id="首先，从应用开发端来看："><a href="#首先，从应用开发端来看：" class="headerlink" title="首先，从应用开发端来看："></a><strong>首先，从应用开发端来看：</strong></h4><ol>
<li>确认是否使用了 set autocommit=0。这个确认工作可以在测试环境中开展，把 MySQL 的 general_log 开起来，然后随便跑一个业务逻辑，通过 general_log 的日志来确认。一般框架如果会设置这个值，也就会提供参数来控制行为，你的目标就是把它改成 1。</li>
<li>确认是否有不必要的只读事务。有些框架会习惯不管什么语句先用 begin/commit 框起来。我见过有些是业务并没有这个需要，但是也把好几个 select 语句放到了事务中。这种只读事务可以去掉。</li>
<li>业务连接数据库的时候，根据业务本身的预估，通过 SET MAX_EXECUTION_TIME 命令，来控制每个语句执行的最长时间，避免单个语句意外执行太长时间。（为什么会意外？在后续的文章中会提到这类案例）</li>
</ol>
<h4 id="其次，从数据库端来看："><a href="#其次，从数据库端来看：" class="headerlink" title="其次，从数据库端来看："></a><strong>其次，从数据库端来看：</strong></h4><ol>
<li>监控 information_schema.Innodb_trx 表，设置长事务阈值，超过就报警 / 或者 kill；</li>
<li>Percona 的 pt-kill 这个工具不错，推荐使用；</li>
<li>在业务功能测试阶段要求输出所有的 general_log，分析日志行为提前发现问题；</li>
<li>如果使用的是 MySQL 5.6 或者更新版本，把 innodb_undo_tablespaces 设置成 2（或更大的值）。如果真的出现大事务导致回滚段过大，这样设置后清理起来更方便。</li>
</ol>
<h2 id="覆盖索引"><a href="#覆盖索引" class="headerlink" title="覆盖索引"></a>覆盖索引</h2><p>查询里面，索引  已经“覆盖了”我们的查询需求，我们称为覆盖索引。</p>
<p>回到主键索引树搜索的过程，我们称为回表。</p>
<p><strong>由于覆盖索引可以减少树的搜索次数，显著提升查询性能，所以使用覆盖索引是一个常用的性能优化手段。</strong></p>
<h2 id="最左前缀原则"><a href="#最左前缀原则" class="headerlink" title="最左前缀原则"></a>最左前缀原则</h2><p><strong>B+ 树这种索引结构，可以利用索引的“最左前缀”，来定位记录。</strong></p>
<p>只要满足最左前缀，就可以利用索引来加速检索。这个最左前缀可以是联合索引的最左 N 个字段，也可以是字符串索引的最左 M 个字符。</p>
<p><strong>在建立联合索引的时候，如何安排索引内的字段顺序。</strong></p>
<p><strong>第一原则是，如果通过调整顺序，可以少维护一个索引，那么这个顺序往往就是需要优先考虑采用的。</strong></p>
<h2 id="索引下推"><a href="#索引下推" class="headerlink" title="索引下推"></a>索引下推</h2><p>而 MySQL 5.6 引入的索引下推优化（index condition pushdown)， 可以在索引遍历过程中，对索引中包含的字段先做判断，直接过滤掉不满足条件的记录，减少回表次数。</p>
<h2 id="通过两个-alter-语句重建索引-K，以及通过两个-alter-语句重建主键索引是否合理？"><a href="#通过两个-alter-语句重建索引-K，以及通过两个-alter-语句重建主键索引是否合理？" class="headerlink" title="通过两个 alter 语句重建索引 K，以及通过两个 alter 语句重建主键索引是否合理？"></a>通过两个 alter 语句重建索引 K，以及通过两个 alter 语句重建主键索引是否合理？</h2><p>重建索引 k 的做法是合理的，可以达到省空间的目的。但是，重建主键的过程不合理。不论是删除主键还是创建主键，都会将整个表重建。所以连着执行这两个语句的话，第一个语句就白做了。这两个语句，你可以用这个语句代替 ： alter table T engine=InnoDB。</p>
<h2 id="全局锁"><a href="#全局锁" class="headerlink" title="全局锁"></a>全局锁</h2><p>顾名思义，全局锁就是对整个数据库实例加锁。MySQL 提供了一个加全局读锁的方法，命令是 Flush tables with read lock (FTWRL)。当你需要让整个库处于只读状态的时候，可以使用这个命令，之后其他线程的以下语句会被阻塞：数据更新语句（数据的增删改）、数据定义语句（包括建表、修改表结构等）和更新类事务的提交语句。</p>
<p><strong>全局锁的典型使用场景是，做全库逻辑备份。</strong>也就是把整库每个表都 select 出来存成文本。</p>
<p>官方自带的逻辑备份工具是 mysqldump。当 mysqldump 使用参数–single-transaction 的时候，导数据之前就会启动一个事务，来确保拿到一致性视图。而由于 MVCC 的支持，这个过程中数据是可以正常更新的。</p>
<p><strong>一致性读是好，但前提是引擎要支持这个隔离级别。</strong>比如，对于 MyISAM 这种不支持事务的引擎，如果备份过程中有更新，总是只能取到最新的数据，那么就破坏了备份的一致性。这时，我们就需要使用 FTWRL 命令了。</p>
<p>所以，<strong>single-transaction 方法只适用于所有的表使用事务引擎的库。</strong>如果有的表使用了不支持事务的引擎，那么备份就只能通过 FTWRL 方法。这往往是 DBA 要求业务开发人员使用 InnoDB 替代 MyISAM 的原因之一。</p>
<p><strong>既然要全库只读，为什么不使用 set global readonly=true 的方式呢</strong>？确实 readonly 方式也可以让全库进入只读状态，但我还是会建议你用 FTWRL 方式，主要有两个原因：</p>
<ul>
<li>一是，在有些系统中，readonly 的值会被用来做其他逻辑，比如用来判断一个库是主库还是备库。因此，修改 global 变量的方式影响面更大，我不建议你使用。</li>
<li>二是，在异常处理机制上有差异。如果执行 FTWRL 命令之后由于客户端发生异常断开，那么 MySQL 会自动释放这个全局锁，整个库回到可以正常更新的状态。而将整个库设置为 readonly 之后，如果客户端发生异常，则数据库就会一直保持 readonly 状态，这样会导致整个库长时间处于不可写状态，风险较高。</li>
</ul>
<h2 id="表级锁"><a href="#表级锁" class="headerlink" title="表级锁"></a>表级锁</h2><p>MySQL 里面表级别的锁有两种：一种是表锁，一种是元数据锁（meta data lock，MDL)。</p>
<p><strong>表锁的语法是 lock tables … read/write。</strong>与 FTWRL 类似，可以用 unlock tables 主动释放锁，也可以在客户端断开的时候自动释放。需要注意，lock tables 语法除了会限制别的线程的读写外，也限定了本线程接下来的操作对象。</p>
<p><strong>另一类表级的锁是 MDL（metadata lock)。</strong>MDL 不需要显式使用，在访问一个表的时候会被自动加上。</p>
<p>在 MySQL 5.5 版本中引入了 MDL，当对一个表做增删改查操作的时候，加 MDL 读锁；当要对表做结构变更操作的时候，加 MDL 写锁。</p>
<ul>
<li>读锁之间不互斥，因此你可以有多个线程同时对一张表增删改查。</li>
<li>读写锁之间、写锁之间是互斥的，用来保证变更表结构操作的安全性。因此，如果有两个线程要同时给一个表加字段，其中一个要等另一个执行完才能开始执行。</li>
</ul>
<p>虽然 MDL 锁是系统默认会加的，但却是你不能忽略的一个机制。比如下面这个例子，我经常看到有人掉到这个坑里：给一个小表加个字段，导致整个库挂了。</p>
]]></content>
      <categories>
        <category>mysql</category>
      </categories>
      <tags>
        <tag>mysql</tag>
      </tags>
  </entry>
  <entry>
    <title>Python 基础语法</title>
    <url>/Python-basic-grammar/</url>
    <content><![CDATA[<h2 id="python基础语法"><a href="#python基础语法" class="headerlink" title="python基础语法"></a>python基础语法</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#1.基础操作</span></span><br><span class="line">age = <span class="number">20</span>  		<span class="comment"># 声明一个变量age 用来存储一个数字 20</span></span><br><span class="line"><span class="number">1</span>+<span class="number">1</span>		        <span class="comment"># 基础数学加法</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;Hello World!&#x27;</span>)   <span class="comment"># 打印Hello World!</span></span><br></pre></td></tr></table></figure>



<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#2.条件判断if</span></span><br><span class="line"><span class="keyword">if</span> <span class="number">1</span> == <span class="number">2</span>: <span class="comment"># 如果 if 跟随的条件为 假 那么不执行属于if 的语句,然后寻找 else</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;假的&quot;</span>)</span><br><span class="line"><span class="keyword">else</span>: <span class="comment"># 寻找到 else 之后 执行属于else中的语句</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;1==2是假的&quot;</span>)</span><br></pre></td></tr></table></figure>

<span id="more"></span>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#3.循环操作---for</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>):</span><br><span class="line">    <span class="built_in">print</span>(i)</span><br></pre></td></tr></table></figure>



<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#3.循环操作---while</span></span><br><span class="line"><span class="built_in">sum</span> = <span class="number">0</span></span><br><span class="line">n = <span class="number">99</span></span><br><span class="line"><span class="keyword">while</span> n &gt; <span class="number">0</span>:</span><br><span class="line">    <span class="built_in">sum</span> = <span class="built_in">sum</span> + n</span><br><span class="line">    n = n - <span class="number">1</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">sum</span>)</span><br></pre></td></tr></table></figure>


<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#4.break、continue、pass</span></span><br><span class="line"><span class="comment">#break语句可以跳出 for 和 while 的循环体</span></span><br><span class="line">n = <span class="number">1</span></span><br><span class="line"><span class="keyword">while</span> n &lt;= <span class="number">100</span>:</span><br><span class="line">    <span class="keyword">if</span> n &gt; <span class="number">10</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="built_in">print</span>(n)</span><br><span class="line">    n += <span class="number">1</span></span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="number">4</span></span><br><span class="line"><span class="number">5</span></span><br><span class="line"><span class="number">6</span></span><br><span class="line"><span class="number">7</span></span><br><span class="line"><span class="number">8</span></span><br><span class="line"><span class="number">9</span></span><br><span class="line"><span class="number">10</span></span><br></pre></td></tr></table></figure>


<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#continue语句跳过当前循环，直接进行下一轮循环</span></span><br><span class="line">n = <span class="number">1</span></span><br><span class="line"><span class="keyword">while</span> n &lt; <span class="number">10</span>:</span><br><span class="line">    n = n + <span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span> n % <span class="number">2</span> == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    <span class="built_in">print</span>(n)</span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="number">5</span></span><br><span class="line"><span class="number">7</span></span><br><span class="line"><span class="number">9</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"> <span class="comment">#pass是空语句，一般用做占位语句，不做任何事情</span></span><br><span class="line"> <span class="keyword">for</span> letter <span class="keyword">in</span> <span class="string">&#x27;Room&#x27;</span>:</span><br><span class="line">    <span class="keyword">if</span> letter == <span class="string">&#x27;o&#x27;</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;pass&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(letter)</span><br><span class="line">R</span><br><span class="line"><span class="keyword">pass</span></span><br><span class="line">o</span><br><span class="line"><span class="keyword">pass</span></span><br><span class="line">o</span><br><span class="line">m</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#5.数据类型---Number(数字)</span></span><br><span class="line"><span class="comment">#Python支持int, float, complex三种不同的数字类型</span></span><br><span class="line">a = <span class="number">3</span></span><br><span class="line">b = <span class="number">3.14</span></span><br><span class="line">c = <span class="number">3</span> + <span class="number">4j</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">type</span>(a), <span class="built_in">type</span>(b), <span class="built_in">type</span>(c))</span><br><span class="line">&lt;<span class="class"><span class="keyword">class</span> &#x27;<span class="title">int</span>&#x27;&gt; &lt;<span class="title">class</span> &#x27;<span class="title">float</span>&#x27;&gt; &lt;<span class="title">class</span> &#x27;<span class="title">complex</span>&#x27;&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#5.数据类型---String（字符串）</span></span><br><span class="line"><span class="comment">#支持字符串拼接、截取等多种运算</span></span><br><span class="line">a = <span class="string">&quot;Hello&quot;</span></span><br><span class="line">b = <span class="string">&quot;Python&quot;</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;a + b 输出结果：&quot;</span>, a + b)</span><br><span class="line"><span class="comment">#print(&quot;a[1:4] 输出结果：&quot;, a[1:4])</span></span><br><span class="line">a + b 输出结果： HelloPython</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#5.数据类型---List（列表）</span></span><br><span class="line"><span class="comment">#列表是写在方括号 [] 之间、用逗号分隔开的元素列表。</span></span><br><span class="line"><span class="comment">#列表索引值以 0 为开始值，-1 为从末尾的开始位置。</span></span><br><span class="line"><span class="built_in">list</span> = [<span class="string">&#x27;abcd&#x27;</span>, <span class="number">786</span> , <span class="number">2.23</span>, <span class="string">&#x27;runoob&#x27;</span>, <span class="number">70.2</span>]</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">list</span>[<span class="number">1</span>:<span class="number">3</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment">#tinylist = [123, &#x27;runoob&#x27;]</span></span><br><span class="line"><span class="comment">#print(list + tinylist)</span></span><br><span class="line">[<span class="number">786</span>, <span class="number">2.23</span>]</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#5.数据类型---Tuple（元组）</span></span><br><span class="line"><span class="comment">#tuple与list类似，不同之处在于tuple的元素不能修改。tuple写在小括号里，元素之间用逗号隔开。</span></span><br><span class="line"><span class="comment">#元组的元素不可变，但可以包含可变对象，如list。</span></span><br><span class="line">t1 = (<span class="string">&#x27;abcd&#x27;</span>, <span class="number">786</span> , <span class="number">2.23</span>, <span class="string">&#x27;runoob&#x27;</span>, <span class="number">70.2</span>)</span><br><span class="line">t2 = (<span class="number">1</span>, )</span><br><span class="line">t3 = (<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, [<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;B&#x27;</span>])</span><br><span class="line">t3[<span class="number">2</span>][<span class="number">0</span>] = <span class="string">&#x27;X&#x27;</span></span><br><span class="line"><span class="built_in">print</span>(t3)</span><br><span class="line">(<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, [<span class="string">&#x27;X&#x27;</span>, <span class="string">&#x27;B&#x27;</span>])</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#5.数据类型---dict（字典）</span></span><br><span class="line"><span class="comment">#字典是无序的对象集合，使用键-值（key-value）存储，具有极快的查找速度。</span></span><br><span class="line"><span class="comment">#键(key)必须使用不可变类型。</span></span><br><span class="line"><span class="comment">#同一个字典中，键(key)必须是唯一的。</span></span><br><span class="line">d = &#123;<span class="string">&#x27;Michael&#x27;</span>: <span class="number">95</span>, <span class="string">&#x27;Bob&#x27;</span>: <span class="number">75</span>, <span class="string">&#x27;Tracy&#x27;</span>: <span class="number">85</span>&#125;</span><br><span class="line"><span class="built_in">print</span>(d[<span class="string">&#x27;Michael&#x27;</span>])</span><br><span class="line"><span class="number">95</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#5.数据类型---set（集合）</span></span><br><span class="line"><span class="comment">#set和dict类似，也是一组key的集合，但不存储value。由于key不能重复，所以，在set中，没有重复的key。</span></span><br><span class="line"><span class="comment">#set是无序的，重复元素在set中自动被过滤。</span></span><br><span class="line">s = <span class="built_in">set</span>([<span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">3</span>])</span><br><span class="line"><span class="built_in">print</span>(s)</span><br><span class="line">&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;</span><br></pre></td></tr></table></figure>


<p>原文地址：<a href="https://aistudio.baidu.com/aistudio/projectdetail/415810?pV=75981">https://aistudio.baidu.com/aistudio/projectdetail/415810?pV=75981</a></p>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>Mysql配置主从复制</title>
    <url>/Mysql-Master-Slave/</url>
    <content><![CDATA[<h1 id="一、概述"><a href="#一、概述" class="headerlink" title="一、概述"></a>一、概述</h1><p>Mysql Replication（复制） 即 主从同步（Master/Slave）：</p>
<p>主要用于数据库的备份，负载均衡，读写分离等。</p>
<span id="more"></span>

<h2 id="1、数据复制技术有以下一些特点："><a href="#1、数据复制技术有以下一些特点：" class="headerlink" title="1、数据复制技术有以下一些特点："></a>1、数据复制技术有以下一些特点：</h2><p>(1)    数据分布<br>(2)    负载平衡(load balancing)，读写分离，主写从读<br>(3)    备份<br>(4)    高可用性(high availability)和容错</p>
<h2 id="2、复制如何工作"><a href="#2、复制如何工作" class="headerlink" title="2、复制如何工作"></a>2、复制如何工作</h2><p>从高层来看，复制分成三步：<br>(1)    master将改变记录到二进制日志(binary log)中（这些记录叫做二进制日志事件，binary log events）；<br>(2)    slave将master的binary log events拷贝到它的中继日志(relay log)；<br>(3)    slave重做中继日志中的事件，将改变反映它自己的数据。</p>
<h1 id="二、数据备份还原"><a href="#二、数据备份还原" class="headerlink" title="二、数据备份还原"></a>二、数据备份还原</h1><p>在做主从同步之前首先需要对主库进行数据备份，恢复到所有的从数据库，数据库备份有冷备和热备，冷备即拷贝所有的数据文件及日志文件到从服务器，</p>
<p>这里使用mysqldump工具做在线热备</p>
<p>步骤:（这里需要备份的数据库为 db_test）</p>
<h2 id="1、Master锁定库，使只能读取不能写入"><a href="#1、Master锁定库，使只能读取不能写入" class="headerlink" title="1、Master锁定库，使只能读取不能写入"></a>1、Master锁定库，使只能读取不能写入</h2><p>mysql &gt; flush tables with read lock;</p>
<h2 id="2、Master导出备份"><a href="#2、Master导出备份" class="headerlink" title="2、Master导出备份"></a>2、Master导出备份</h2><p>~$ mysqldump –master-data -uroot -p db_test&gt;db_test.sql</p>
<p>说明：–master-data参数在生成的dump 文件中产生一条 CHANGE MASTER TO 命令，查看可知master当前使用的binlog文件名</p>
<h2 id="3、Slave导入备份"><a href="#3、Slave导入备份" class="headerlink" title="3、Slave导入备份"></a>3、Slave导入备份</h2><p>~$ mysql -uroot -p db_test&lt;db_test.sql</p>
<h2 id="4、最后配置好同步以后，Master解除写锁定"><a href="#4、最后配置好同步以后，Master解除写锁定" class="headerlink" title="4、最后配置好同步以后，Master解除写锁定"></a>4、最后配置好同步以后，Master解除写锁定</h2><p>mysql &gt; unlock tables;</p>
<h1 id="三、配置参考"><a href="#三、配置参考" class="headerlink" title="三、配置参考"></a>三、配置参考</h1><h2 id="1、网络配置"><a href="#1、网络配置" class="headerlink" title="1、网络配置"></a>1、网络配置</h2><p>1主1从，主从数据库处于同一装有CentOS机器上，使用docker运行，可互相访问。</p>
<p>主数据库master端口：3311</p>
<p>从数据库slave1端口：3312</p>
<h2 id="2、master配置"><a href="#2、master配置" class="headerlink" title="2、master配置"></a>2、master配置</h2><p>3311.cnf文件mysqld段：</p>
<p>[mysqld]<br>server-id=1<br>log-bin=mysql-bin<br>说明：必需配置，server-id指定服务器唯一id，不可重复，log-bin开启binlog日志</p>
<p>运行master</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker run --name mysql3311 -v $(PWD)/3311.cnf:/etc/mysql/conf.d/my.cnf -p 3311:3306 -e MYSQL_ROOT_PASSWORD=123456 -tid mysql:5.6</span><br></pre></td></tr></table></figure>

<p>通过mysql客户端连胜主库，设置复制账号：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">GRANT</span> REPLICATION SLAVE <span class="keyword">ON</span> <span class="operator">*</span>.<span class="operator">*</span> <span class="keyword">TO</span> <span class="string">&#x27;test&#x27;</span>@<span class="string">&#x27;%&#x27;</span> IDENTIFIED <span class="keyword">BY</span> <span class="string">&#x27;123456&#x27;</span>;</span><br><span class="line">FLUSH PRIVILEGES;</span><br><span class="line"><span class="keyword">show</span> master status;</span><br></pre></td></tr></table></figure>

<p>说明：添加一个 test 账号在任何机器上使用 123456 这个密码对任何数据库行使 replication slave 权限</p>
<p>查看Master状态：</p>
<p>mysql &gt; show master status;</p>
<p>mysql&gt; show master status;<br>+——————+———-+————–+——————+<br>| File             | Position | Binlog_Do_DB | Binlog_Ignore_DB |<br>+——————+———-+————–+——————+<br>| mysql-bin.000022 |     389 |              |                  |<br>+——————+———-+————–+——————+</p>
<h2 id="3、Slave配置"><a href="#3、Slave配置" class="headerlink" title="3、Slave配置"></a>3、Slave配置</h2><p>3312.cnf文件配置:</p>
<p>[mysqld]<br>server-id=2<br>log-bin=mysql-bin</p>
<p>运行slave</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker run --name mysql3312 -v $(PWD)/3312.cnf:/etc/mysql/conf.d/my.cnf -p 3312:3306 -e MYSQL_ROOT_PASSWORD=123456 -tid mysql:5.6</span><br></pre></td></tr></table></figure>

<p>使用mysql客户端连上从库，设置主从复制</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">stop slave; </span><br><span class="line">CHANGE MASTER <span class="keyword">TO</span> MASTER_HOST <span class="operator">=</span> <span class="string">&#x27;172.20.8.113&#x27;</span>, MASTER_USER <span class="operator">=</span> <span class="string">&#x27;test&#x27;</span>, MASTER_PASSWORD <span class="operator">=</span> <span class="string">&#x27;123456&#x27;</span>, MASTER_PORT <span class="operator">=</span> <span class="number">3311</span>,  MASTER_RETRY_COUNT <span class="operator">=</span> <span class="number">0</span>, MASTER_LOG_POS <span class="operator">=</span> <span class="number">389</span>; </span><br><span class="line"><span class="keyword">START</span> SLAVE;</span><br><span class="line"><span class="keyword">SHOW</span> SLAVE STATUS ;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>核对host、user、master_log_file是否正确，<br>Slave_IO_Running: Yes<br>Slave_SQL_Running: Yes<br>这两项yes，说明配置成功。</p>
<p>最后别忘了，Master解除写锁定：</p>
<p>mysql &gt; unlock tables;</p>
<p>注意：如果Master的mysql服务重启会生成新的bin log日志，这时候，Slave也需要重启一下服务或者stop slave - start slave，</p>
<p>如果slave服务不重启，则可以修改 mysql - replication -slave 自动生成的配置文件：/var/lib/mysql/master.info</p>
<p>18<br>mysql-bin.000022<br>398<br>172.20.8.113<br>test<br>123456<br>3311<br>60<br>查看第二行 mysq-bin文件名是否跟Master上对应，如果不对应可直接修改；</p>
<h1 id="四、常见错误"><a href="#四、常见错误" class="headerlink" title="四、常见错误"></a>四、常见错误</h1><h2 id="1、master发生故障，经修复后启动后，slave无法与master同步"><a href="#1、master发生故障，经修复后启动后，slave无法与master同步" class="headerlink" title="1、master发生故障，经修复后启动后，slave无法与master同步"></a>1、master发生故障，经修复后启动后，slave无法与master同步</h2><p>报错：Got fatal error 1236 from master when reading data from binary log</p>
<p>原因：master重启后，mysql的binlog会重新生成，相应的记录位置会改变</p>
<p>解决方法：</p>
<p>-master：</p>
<p>mysql &gt; flush logs;</p>
<p>mysql &gt; show master status;</p>
<p>记录下File和Position值</p>
<p>-slave：</p>
<p>mysql &gt; stop slave;</p>
<p>mysql &gt; CHANGE MASTER TO MASTER_LOG_FILE=’mysql-bin.000049’,MASTER_LOG_POS=1359;</p>
<p>mysql &gt; start slave;</p>
<p>mysql &gt; show slave status\G;</p>
<h2 id="2、slave发生故障，设置正确，但是无法初始化"><a href="#2、slave发生故障，设置正确，但是无法初始化" class="headerlink" title="2、slave发生故障，设置正确，但是无法初始化"></a>2、slave发生故障，设置正确，但是无法初始化</h2><p>报错：ERROR 1201 (HY000): Could not initialize master</p>
<p>解决方法：</p>
<p>-master：</p>
<p>mysql &gt; flush logs;</p>
<p>mysql &gt; show master status;</p>
<p>记录下File和Position值</p>
<p>-slave：</p>
<p>mysql &gt; reset slave;</p>
<p>mysql &gt; CHANGE MASTER TO MASTER_HOST = ‘172.20.8.113’, MASTER_USER = ‘test’, MASTER_PASSWORD = ‘123456’, MASTER_PORT = 3311,  MASTER_RETRY_COUNT = 0, MASTER_LOG_POS = 389; </p>
<p>mysql &gt; start slave;</p>
<p>mysql &gt; show slave status\G;</p>
]]></content>
      <categories>
        <category>mysql</category>
        <category>master</category>
        <category>slave</category>
      </categories>
      <tags>
        <tag>mysql</tag>
        <tag>master</tag>
        <tag>slave</tag>
      </tags>
  </entry>
  <entry>
    <title>Reactor模式的角色构成</title>
    <url>/Reactor/</url>
    <content><![CDATA[<h2 id="Reactor模式的角色构成（Reactor模式一共有5种角色构成）："><a href="#Reactor模式的角色构成（Reactor模式一共有5种角色构成）：" class="headerlink" title="Reactor模式的角色构成（Reactor模式一共有5种角色构成）："></a>Reactor模式的角色构成（Reactor模式一共有5种角色构成）：</h2><h3 id="1-Handle（句柄或是描述符）："><a href="#1-Handle（句柄或是描述符）：" class="headerlink" title="1. Handle（句柄或是描述符）："></a>1. <strong>Handle（句柄或是描述符）</strong>：</h3><p>本质上表示一种资源，是由操作系统提供的；改资源用于表示一个个的事件，比如说文件描述符，或是针对网络编程过程中的Socket描述符。事件即可以来自于外部，可以来自于内部；外部事件比如说客户端的连接请求，客户端发送过来的数据等；内部事件，比如说操作系统产生的定时器事件等。它本质上就是一个文件描述符。</p>
<span id="more"></span>
<h3 id="2-Synchronous-Event-Demultiplexer（同步事件分离器）："><a href="#2-Synchronous-Event-Demultiplexer（同步事件分离器）：" class="headerlink" title="2. Synchronous Event Demultiplexer（同步事件分离器）："></a>2. <strong>Synchronous Event Demultiplexer（同步事件分离器</strong>）：</h3><p>它本身是一个系统调用，用于等待事件的发生（事件可能是一个，也可能是多个）。调用方在调用它的时候会被阻塞，一直阻塞到同步事件分离器上有事件产生为止。对于Linux来说，同步事件分离器指的就是常用的I/O多路复用机制，比如说select、poll、epoll等。在Java NIO领域中，同步事件分离器对应的组件就是Slector；对应的阻塞方法就是select方法。</p>
<h3 id="3-Event-Handler（事件处理器）："><a href="#3-Event-Handler（事件处理器）：" class="headerlink" title="3. Event Handler（事件处理器）："></a>3. <strong>Event Handler（事件处理器）</strong>：</h3><p>本身由多个回调方法构成，这些方法构成了与应用相关的对于某个事件的反馈机制。Netty相比于Java NIO来说，在事件处理器这个角色上进行了一个升级，它为我们开发者提供了大量的回调方法，供我们在特定事件产生时实现相应的回调方法进行业务逻辑的处理。</p>
<h3 id="4-Contrete-Event-Handler（具体事件处理器）："><a href="#4-Contrete-Event-Handler（具体事件处理器）：" class="headerlink" title="4. Contrete Event Handler（具体事件处理器）："></a>4. <strong>Contrete Event Handler（具体事件处理器）</strong>：</h3><p>是事件处理器的实现。它本身实现了事件处理器所提供的各个回调方法，从而实现了特定于业务的逻辑。它本质上就是我们所编写的一个个的处理器实现。</p>
<h3 id="5-Initiation-Dispatcher（初始分发器）："><a href="#5-Initiation-Dispatcher（初始分发器）：" class="headerlink" title="5. Initiation Dispatcher（初始分发器）："></a>5. <strong>Initiation Dispatcher（初始分发器）</strong>：</h3><p>实际上就是Reactor角色。它本身定义了一些规范，这些规范用于控制事件的调度方式，同时又提供了应用进行事件处理器的注册、删除等设施。它本身是整个事件处理器的核心所在，Initiation Dispatcher会通过同步事件分离器来等待事件的发生。一旦事件发生，Initiation Dispatcher首先会分离出每一个事件，然后调用事件处理器，最后调用相关的回调方法来处理这些事件。</p>
<h2 id="Reactor模式流程"><a href="#Reactor模式流程" class="headerlink" title="Reactor模式流程"></a>Reactor模式流程</h2><ol>
<li>当应用向Initiation Dispatcher注册具体的事件处理器时，应用会标识出该事件处理器希望Initiation Dispatcher在某个事件发生时向其通知该事件，该事件与Handle关联。</li>
<li>Initiation Dispatcher会要求每个事件处理器向其传递内部的Handle。该Handler向操作系统标识了事件处理器。</li>
<li>当所有的事件处理器注册完毕后，应用会调用handle_events方法来启动Initiation Dispatcher的事件循环。这时，Initiation Dispatcher会将每个注册的事件管理的handle合并起来，并使用同步事件分离器等待这些事件的发生。比如说，TCP协议层会使用select同步事件分离器操作来等待客户端发送的数据到达连接的socket handle上。</li>
<li>当与某个事件源对应的Handle变为ready状态时（比如说，TCP socket变为等待读状态时），同步事件分离器就会通知Initiation Dispatcher。</li>
<li>Initiation Dispatcher会触发事件处理器的回调方法，从而响应这个处于ready状态的Handle。当事件发生时，Initiation Dispatcher会将被事件源激活的Handle[key]来寻找并分发恰当的事件处理器回调方法。</li>
<li>Initiation Dispatcher会回调事件处理器的handle_event回调方法来执行特定于应用的功能（开发者自己所编写的功能），从而响应这个事件。所发生的事件类型可以作为该方法参数并被该方法内部使用来执行额外的特定于服务的分类和分发。</li>
</ol>
]]></content>
      <categories>
        <category>reactor</category>
        <category>nio</category>
        <category>netty</category>
      </categories>
      <tags>
        <tag>reactor</tag>
        <tag>nio</tag>
        <tag>netty</tag>
      </tags>
  </entry>
  <entry>
    <title>shell脚本命令备忘</title>
    <url>/Shell-notes/</url>
    <content><![CDATA[<p>这里收藏工作中用到的脚本，也为了防止做重复的搜索工作，同时分享给大家。</p>
<span id="more"></span>
<h1 id="数组"><a href="#数组" class="headerlink" title="数组"></a>数组</h1><ul>
<li>初始化数组<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">name = (value1 value2 ... valuen)</span><br><span class="line"><span class="meta">$</span><span class="bash"> A=(a b c d)</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">echo</span> <span class="variable">$&#123;A[@]&#125;</span> <span class="comment"># 输出所有元素</span></span></span><br></pre></td></tr></table></figure></li>
</ul>
<ul>
<li><p>数组去重</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> array=($(awk -vRS=<span class="string">&#x27; &#x27;</span> <span class="string">&#x27;!a[$1]++&#x27;</span> &lt;&lt;&lt; <span class="variable">$&#123;array[@]&#125;</span>))</span></span><br></pre></td></tr></table></figure></li>
<li><p>取得数组元素的个数</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">echo</span> <span class="variable">$&#123;#A[@]&#125;</span></span></span><br></pre></td></tr></table></figure></li>
<li><p>取下标</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">echo</span> <span class="variable">$&#123;A[1]&#125;</span> <span class="comment"># 从1开始</span></span></span><br></pre></td></tr></table></figure></li>
<li><p>清除元素</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">unset</span> A</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">echo</span> <span class="variable">$&#123;A[@]&#125;</span></span></span><br></pre></td></tr></table></figure></li>
<li><p>循环取元素</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> <span class="keyword">for</span> a <span class="keyword">in</span> <span class="variable">$&#123;A[@]&#125;</span>; <span class="keyword">do</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash">   <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$a</span>&quot;</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="keyword">done</span></span></span><br></pre></td></tr></table></figure></li>
<li><p>替换</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> <span class="variable">$&#123;A[@]/3/100&#125;</span></span></span><br></pre></td></tr></table></figure></li>
</ul>
<h1 id="date"><a href="#date" class="headerlink" title="date"></a>date</h1><ul>
<li><p>获取当前日期并格式化成指定格式</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> NOW=$(date +<span class="string">&#x27;%Y-%m-%d_%H%M%S&#x27;</span>) <span class="comment"># 2016-09-07_184914</span></span></span><br></pre></td></tr></table></figure></li>
<li><p>计算当前时间的时间戳</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> STAMP=$(($(date +%s -d &quot;$(date +&#x27;%Y-%m-%d %H:%M:%S&#x27;)&quot;))) <span class="comment"># 1473245414</span></span></span><br></pre></td></tr></table></figure></li>
<li><p>计算N天之前的时间</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 十天之前的日期</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> TEN_DAYS_AGO=$(($(date -d &#x27;-<span class="number">10</span> day&#x27; &quot;+%Y%m%d%H%M%S&quot;))) <span class="comment">#20160828185138</span></span></span><br></pre></td></tr></table></figure></li>
<li><p>获取xxxx年xx月的天数</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 获取 2016-10 的天数</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> cal 10 2016 | awk <span class="string">&#x27;NF&#123;out=$NF;&#125;END&#123;print out&#125;&#x27;</span></span></span><br></pre></td></tr></table></figure>
<p>输出</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">31</span><br></pre></td></tr></table></figure></li>
</ul>
<h1 id="vim"><a href="#vim" class="headerlink" title="vim"></a>vim</h1><ul>
<li>vi/vim修改只读(readonly)文件，使用sudo修改<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">:w !sudo tee % &gt; /dev/null</span><br></pre></td></tr></table></figure></li>
</ul>
<h1 id="awk"><a href="#awk" class="headerlink" title="awk"></a>awk</h1><ul>
<li><p>过滤数字</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">echo</span> <span class="string">&quot;123&quot;</span> |awk <span class="string">&#x27;&#123;if($0 ~ /^[0-9]+$/) print $0;&#125;&#x27;</span></span></span><br></pre></td></tr></table></figure></li>
<li><p>数字求和</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> cat <span class="variable">$&#123;FILE&#125;</span> | awk <span class="string">&#x27;&#123;sum += $1&#125;;END &#123;printf (&quot;%d\n&quot;, sum)&#125;&#x27;</span></span></span><br></pre></td></tr></table></figure></li>
<li><p>截取字符串</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">echo</span> <span class="string">&quot;123456&quot;</span> | awk <span class="string">&#x27;&#123;print substr($1,1,4)&#125;&#x27;</span> <span class="comment">#1234</span></span></span><br></pre></td></tr></table></figure></li>
<li><p>获取月份所在季度</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> <span class="keyword">for</span> q <span class="keyword">in</span> `seq 1 12`; <span class="built_in">echo</span> <span class="variable">$q</span> | awk <span class="string">&#x27;&#123;season_least=$1%3&#125; &#123;season=$1/3&#125; &#123;if(season_least&gt;0) season+=1&#125; &#123;printf(&quot;%d\n&quot;,season)&#125;&#x27;</span></span></span><br></pre></td></tr></table></figure>
<p>输出</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">1</span><br><span class="line">1</span><br><span class="line">1</span><br><span class="line">2</span><br><span class="line">2</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">3</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">4</span><br><span class="line">4</span><br></pre></td></tr></table></figure></li>
<li><p>删除所有空格</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">echo</span> <span class="string">&quot;1 2  3 4&quot;</span> | sed -e <span class="string">&#x27;s/[[:space:]]//g &#x27;</span></span></span><br></pre></td></tr></table></figure>
<p>输出</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">1234</span><br></pre></td></tr></table></figure></li>
<li><p>替换所有的.为/</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">echo</span> <span class="string">&quot;com.xiongyingqi.Test&quot;</span> | awk <span class="string">&#x27;&#123;gsub(/\./,&quot;/&quot;); print $0&#125;&#x27;</span></span></span><br></pre></td></tr></table></figure>
<p>输出</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">com/xiongyingqi/Test</span><br></pre></td></tr></table></figure></li>
</ul>
<h1 id="sed"><a href="#sed" class="headerlink" title="sed"></a>sed</h1><ul>
<li><p>去除首尾空格</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> FOO_NO_EXTERNAL_SPACE=<span class="string">&quot;<span class="subst">$(echo -e <span class="string">&quot;<span class="variable">$&#123;FOO&#125;</span>&quot;</span> | sed -e &#x27;s/^[[:space:]]*//&#x27; -e &#x27;s/[[:space:]]*$//&#x27;)</span>&quot;</span></span></span><br></pre></td></tr></table></figure></li>
<li><p>删除空行</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sed <span class="string">&#x27;/^$/d&#x27;</span> sources.list</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h1 id="uniq"><a href="#uniq" class="headerlink" title="uniq"></a>uniq</h1><ul>
<li>统计重复数<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> cat file | uniq -c</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h1 id="文件"><a href="#文件" class="headerlink" title="文件"></a>文件</h1><ul>
<li><p>寻找有指定内容的文件</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> FOUND=<span class="string">&quot;test&quot;</span> <span class="comment"># 需要查找的内容</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> find . | <span class="keyword">while</span> <span class="built_in">read</span> file; <span class="keyword">do</span> <span class="keyword">if</span> [ -f <span class="variable">$file</span> ]; <span class="keyword">then</span> content=`cat <span class="variable">$&#123;file&#125;</span> | grep <span class="string">&quot;<span class="variable">$&#123;FOUND&#125;</span>&quot;</span>`; <span class="keyword">if</span> [ -n <span class="string">&quot;<span class="variable">$content</span>&quot;</span> ]; <span class="keyword">then</span> <span class="built_in">echo</span> <span class="variable">$&#123;file&#125;</span> ; <span class="keyword">fi</span>; <span class="keyword">fi</span>; <span class="keyword">done</span></span></span><br></pre></td></tr></table></figure></li>
<li><p>列举文件并用管道打包</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> find . -name <span class="string">&quot;*.class&quot;</span> | xargs tar cvf classes.tar</span></span><br></pre></td></tr></table></figure></li>
<li><p>批量重命名文件</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">for file in `ls `;do mv $file `echo $file|sed &#x27;s/aaa/bbb/g&#x27;`;done;</span><br></pre></td></tr></table></figure></li>
</ul>
<h1 id="变量"><a href="#变量" class="headerlink" title="变量"></a>变量</h1><p>我们先写一个简单的脚本，执行以后再解释各个变量的意义</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> touch variable</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> vi variable</span></span><br></pre></td></tr></table></figure>

<p>脚本内容如下：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/sh</span></span><br><span class="line">echo &quot;number:$#&quot;</span><br><span class="line">echo &quot;scname:$0&quot;</span><br><span class="line">echo &quot;first :$1&quot;</span><br><span class="line">echo &quot;second:$2&quot;</span><br><span class="line">echo &quot;argume:$@&quot;</span><br><span class="line">echo &quot;show parm list:$*&quot;</span><br><span class="line">echo &quot;show process id:$$&quot;</span><br><span class="line">echo &quot;show precomm stat: $?&quot;</span><br></pre></td></tr></table></figure>

<p>保存退出</p>
<p>赋予脚本执行权限</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> chmod +x variable</span></span><br></pre></td></tr></table></figure>

<p>执行脚本</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> ./variable aa bb</span></span><br></pre></td></tr></table></figure>
<p>输出</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">number:2</span><br><span class="line">scname:./variable</span><br><span class="line">first:aa</span><br><span class="line">second:bb</span><br><span class="line">argume:aa bb</span><br><span class="line">show parm list:aa bb</span><br><span class="line">show process id:24544</span><br><span class="line">show precomm stat:0</span><br></pre></td></tr></table></figure>

<p>通过显示结果可以看到：</p>
<ul>
<li>$# 是传给脚本的参数个数</li>
<li>$0 是脚本本身的名字</li>
<li>$1 是传递给该shell脚本的第一个参数</li>
<li>$2 是传递给该shell脚本的第二个参数</li>
<li>$@ 是传给脚本的所有参数的列表</li>
<li>$* 是以一个单字符串显示所有向脚本传递的参数，与位置变量不同，参数可超过9个</li>
<li>$$ 是脚本运行的当前进程ID号</li>
<li>$? 是显示最后命令的退出状态，0表示没有错误，其他表示有错误</li>
</ul>
<h1 id="例子"><a href="#例子" class="headerlink" title="例子"></a>例子</h1><ul>
<li>*amount.txt 下所有文件的第8列数字之和<blockquote>
<p>iconv -fgbk 为转换文件为 gbk</p>
</blockquote>
</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ls *amount.txt | while read file; do cat $&#123;file&#125;; done | iconv -fgbk | awk -F &quot;\t&quot; &#x27;&#123;print $8&#125;&#x27; | awk &#x27;&#123;if($0 ~ /^[0-9]+$/) print $0;&#125;&#x27; | awk &#x27;&#123;sum += $1&#125;;END &#123;printf (&quot;%d\n&quot;, sum)&#125;&#x27;</span><br></pre></td></tr></table></figure>

<ul>
<li>将目录下的jar文件转换为maven格式的依赖</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line">find . -name &quot;*.jar&quot; | while read jar; do</span><br><span class="line">    artifact=`echo $&#123;jar&#125; | awk &#x27;&#123;print substr($jar,1,length($jar)-4);&#125;&#x27;`</span><br><span class="line">    version=`echo &quot;$artifact&quot; | awk -F &#x27;-&#x27; &#x27; &#123; print $NF &#125; &#x27;`</span><br><span class="line">    if [ $version == $artifact ]; then</span><br><span class="line">        version=&quot;1.0&quot;</span><br><span class="line">    else</span><br><span class="line">        artifact=`echo &quot;$artifact&quot; | awk -v version=&quot;$version&quot; &#x27;&#123;print substr($1,1,index($1,version)-2)&#125;&#x27;`</span><br><span class="line">    fi</span><br><span class="line"></span><br><span class="line">    # find group</span><br><span class="line">    groupDirectory=`jar -tf $jar | grep &quot;.class&quot; | head -n 1`</span><br><span class="line">    last=`echo &quot;$groupDirectory&quot; | awk -F &#x27;/&#x27; &#x27; &#123; print $NF &#125; &#x27;`</span><br><span class="line">    group=`echo &quot;$groupDirectory&quot; | awk -v last=&quot;$last&quot; &#x27;&#123;print substr($1,1,index($1,last)-2)&#125;&#x27;`</span><br><span class="line">    # replace / to .</span><br><span class="line">    group=`echo $group | awk &#x27;&#123;gsub(/\//,&quot;.&quot;); print $0&#125;&#x27;`</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    echo &quot;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;$&#123;group&#125;&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;$&#123;artifact&#125;&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;$&#123;version&#125;&lt;/version&gt;</span><br><span class="line">            &lt;scope&gt;system&lt;/scope&gt;</span><br><span class="line">            &lt;systemPath&gt;\$&#123;project.basedir&#125;/lib/$&#123;jar&#125;&lt;/systemPath&gt;</span><br><span class="line">        &lt;/dependency&gt;&quot; #&gt;&gt; &quot;dependencies.tmp&quot;</span><br><span class="line">done</span><br></pre></td></tr></table></figure>

<ul>
<li>查找java类所在当前目录内的jar包</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> FOUND=<span class="string">&quot;com.xiongyingqi.Test&quot;</span> &amp;&amp; ls *.jar | <span class="keyword">while</span> <span class="built_in">read</span> jar; <span class="keyword">do</span> jar tf <span class="variable">$jar</span> | grep `<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;FOUND&#125;</span>&quot;</span> | awk <span class="string">&#x27;&#123;gsub(/\./,&quot;/&quot;); print $0&#125;&#x27;</span>` | awk -v jar=<span class="string">&quot;<span class="variable">$jar</span>&quot;</span> <span class="string">&#x27;&#123;if (length($1) &gt; 0) print jar&#125;&#x27;</span>; <span class="keyword">done</span></span></span><br></pre></td></tr></table></figure>

<ul>
<li><p>将目录内的文件转换为classpath需要的参数</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ls lib/*.jar | xargs | awk -v d=&quot;$&#123;delete&#125;&quot; &#x27;&#123;</span><br><span class="line">        str=&quot;&quot;;</span><br><span class="line">        is_in=0;</span><br><span class="line">        for(i=1;i&lt;=NF;i++)&#123;</span><br><span class="line">            if($i!=d)&#123;</span><br><span class="line">                if(is_in == 1)&#123;</span><br><span class="line">                    str=str&quot;:&quot;$i;</span><br><span class="line">                &#125;else&#123;</span><br><span class="line">                    str=str&quot;&quot;$i;</span><br><span class="line">                    is_in=1;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        print str</span><br><span class="line">    &#125;&#x27;</span><br></pre></td></tr></table></figure></li>
<li><p>查找某个目录下所有的jar包里面有哪些class是冲突的shell脚本</p>
</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!bin/bash</span></span><br><span class="line">echo &quot;Find out conflict class in the given path&quot;;</span><br><span class="line">if [ $# != 1 ] ; then</span><br><span class="line"> echo &quot;Usage: sh findconflictclass.sh $1 ,first param means the path you want to find,eg: sh findconflictclass.sh lib&quot;;</span><br><span class="line">exit 1;</span><br><span class="line">fifindconflictclass.sh</span><br><span class="line">echo &quot;Please wait ...&quot;;</span><br><span class="line">jarpath=$1;</span><br><span class="line">function unjarclass()&#123;</span><br><span class="line"> for i in `find $jarpath -name *.jar`; do</span><br><span class="line"> jar -tvf &quot;$i&quot; |grep .class$ | awk &#x27;&#123;print $8&#125;&#x27; ;</span><br><span class="line"><span class="meta"> #</span><span class="bash"> <span class="keyword">if</span> [[ $? == 0 ]]; <span class="keyword">then</span> <span class="built_in">echo</span> <span class="variable">$i</span>; <span class="keyword">fi</span>;</span></span><br><span class="line"> done</span><br><span class="line">&#125;</span><br><span class="line">unjarclass 1&gt;temp.txt;</span><br><span class="line">echo &#x27;unjar class in the given path has done&#x27;;</span><br><span class="line">sleep 10s</span><br><span class="line">function findclassinjar()&#123;</span><br><span class="line">echo -e &quot;\033[47;31m &#x27;The class $1 exists in multi-place below:&#x27; \033[0m&quot; ;</span><br><span class="line"> for i in `find $2 -name *.jar`; do</span><br><span class="line"> jar -tvf &quot;$i&quot; | grep --color -i &quot;$1&quot; ;</span><br><span class="line"> if [[ $? == 0 ]]; then echo -e &quot;\033[33m &#x27;The jar path is: $i&#x27; \033[0m&quot; ; fi;</span><br><span class="line"> done</span><br><span class="line">&#125;</span><br><span class="line">sort temp.txt | uniq -d | cat | while read line; do a=$line; findclassinjar $a $jarpath;done</span><br><span class="line">rm -rf temp.txt</span><br></pre></td></tr></table></figure>

<ul>
<li>替换字符串</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> data=<span class="string">&quot;a&quot;</span> &amp;&amp; newdata=<span class="string">&quot;c&quot;</span> &amp;&amp; <span class="built_in">echo</span> <span class="string">&quot;aaabbba&quot;</span>|awk -v var=<span class="variable">$&#123;1&#125;</span> -v var1=<span class="variable">$&#123;data&#125;</span> -v var2=<span class="variable">$&#123;newdata&#125;</span> <span class="string">&#x27;$0 ~ var &#123;gsub(var1,var2); print&#125;&#x27;</span></span></span><br></pre></td></tr></table></figure>

<p>输出</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cccbbbc</span><br></pre></td></tr></table></figure>

<ul>
<li>文件内容替换<br>替换<code>当前目录下的所有文件</code>内容中的<code>hello</code>为<code>helloworld</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">find . -type f | while read file; do sed -i &#x27;s/hello/helloworld/g&#x27; $file;done</span><br></pre></td></tr></table></figure>


<ul>
<li>测试curl</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> size=1000;i=0; <span class="keyword">while</span> [ <span class="variable">$i</span> -lt <span class="variable">$size</span> ];<span class="keyword">do</span> i=$((i+<span class="number">1</span>)); curl <span class="string">&quot;http://baidu.com&quot;</span> &amp; <span class="keyword">done</span></span></span><br></pre></td></tr></table></figure>

<ul>
<li>获取从开始日期到结束日期所经历过的季度</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">FROM_DATE=&quot;$1&quot;</span><br><span class="line">TO_DATE=&quot;$2&quot;</span><br><span class="line"></span><br><span class="line">FROM_SEASON=`echo &quot;$&#123;FROM_DATE&#125;&quot; | awk -F &quot;-&quot; &#x27;&#123;print $2&#125;&#x27;| awk &#x27;&#123;season_least=$1%3&#125; &#123;season=$1/3&#125; &#123;if(season_least&gt;0) season+=1&#125; &#123;printf(&quot;%d\n&quot;,season)&#125;&#x27;`</span><br><span class="line">TO_SEASON=`echo &quot;$&#123;TO_DATE&#125;&quot; | awk -F &quot;-&quot; &#x27;&#123;print $2&#125;&#x27;| awk &#x27;&#123;season_least=$1%3&#125; &#123;season=$1/3&#125; &#123;if(season_least&gt;0) season+=1&#125; &#123;printf(&quot;%d\n&quot;,season)&#125;&#x27;`</span><br><span class="line">echo &quot;FROM_SEASON: $&#123;FROM_SEASON&#125;&quot;</span><br><span class="line">echo &quot;TO_SEASON: $&#123;TO_SEASON&#125;&quot;</span><br><span class="line"></span><br><span class="line">FROM_YEAR=`echo &quot;$&#123;FROM_DATE&#125;&quot; | awk -F &quot;-&quot; &#x27;&#123;print $1&#125;&#x27;`</span><br><span class="line">TO_YEAR=`echo &quot;$&#123;TO_DATE&#125;&quot; | awk -F &quot;-&quot; &#x27;&#123;print $1&#125;&#x27;`</span><br><span class="line"></span><br><span class="line">year_season_file=&quot;year_season.tmp&quot;</span><br><span class="line">if [ -f $&#123;year_season_file&#125; ];then</span><br><span class="line">    echo &quot;delete file: $&#123;year_season_file&#125;&quot;</span><br><span class="line">    rm -f $&#123;year_season_file&#125;</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">if [ $&#123;FROM_YEAR&#125; -eq $&#123;TO_YEAR&#125; ]; then</span><br><span class="line">    for season in `seq $&#123;FROM_SEASON&#125; $&#123;TO_SEASON&#125;`; do</span><br><span class="line">        echo &quot;$&#123;FROM_YEAR&#125;Q$&#123;season&#125;&quot; &gt;&gt; $&#123;year_season_file&#125;</span><br><span class="line">    done</span><br><span class="line">else</span><br><span class="line">    for season in `seq $&#123;FROM_SEASON&#125; 4`; do</span><br><span class="line">        echo &quot;$&#123;FROM_YEAR&#125;Q$&#123;season&#125;&quot; &gt;&gt; $&#123;year_season_file&#125;</span><br><span class="line">    done</span><br><span class="line"></span><br><span class="line">    #FROM_YEAR</span><br><span class="line">    if [ $((TO_YEAR-FROM_YEAR)) -ge 2 ]; then</span><br><span class="line">        for year in `seq $((FROM_YEAR+1)) $((TO_YEAR-1))`; do</span><br><span class="line">            for season in `seq 1 4`; do</span><br><span class="line">                echo &quot;$&#123;year&#125;Q$&#123;season&#125;&quot; &gt;&gt; $&#123;year_season_file&#125;</span><br><span class="line">            done</span><br><span class="line">        done</span><br><span class="line">    fi</span><br><span class="line"></span><br><span class="line">    for season in `seq 1 $&#123;TO_SEASON&#125;`; do</span><br><span class="line">        echo &quot;$&#123;TO_YEAR&#125;Q$&#123;season&#125;&quot; &gt;&gt; $&#123;year_season_file&#125;</span><br><span class="line">    done</span><br><span class="line"></span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">cat $&#123;year_season_file&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>多线程访问</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">for ((i=0;i&lt;10;)); do</span><br><span class="line">	for j in `seq 1 100`; do</span><br><span class="line">    	curl &quot;http://baidu.com&quot; &amp;</span><br><span class="line">    done;</span><br><span class="line">    wait;</span><br><span class="line">    i=$((i+1));</span><br><span class="line">done</span><br></pre></td></tr></table></figure>

<ul>
<li>按列合并</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cat filtsoort | awk &#x27;&#123;sum[$1]+=$2&#125;END&#123;for (i in sum) print i&quot; &quot;sum[i]&#125;&#x27;</span><br></pre></td></tr></table></figure>

<ul>
<li>转换编码</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">find . -name &quot;*.java&quot; | while read file; do iconv -f gbk -t utf-8 $file &gt; $&#123;file&#125;.bak; mv -f $&#123;file&#125;.bak $file; done</span><br></pre></td></tr></table></figure>


<ul>
<li><p>word转换为markdown<br>需要先安装<code>w2m</code>: <a href="https://github.com/benbalter/word-to-markdown">benbalter/word-to-markdown</a></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">find doc -name &quot;*.doc&quot; | while read file; do</span><br><span class="line">    folder_tmp=&quot;markdown/$file&quot;;</span><br><span class="line">    folder=$&#123;folder_tmp%/*&#125;;</span><br><span class="line">    target_file=&quot;$&#123;folder_tmp%%.*&#125;&quot;.md</span><br><span class="line">    mkdir -p $folder;</span><br><span class="line">    w2m $file &gt; $target_file;</span><br><span class="line">done</span><br></pre></td></tr></table></figure></li>
<li><p>移除base64图像</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sed -i &#x27;s-\!\[\](data:image\/\*;base64,.*)--g&#x27; $file</span><br></pre></td></tr></table></figure></li>
<li><p>判断是否为asccii字符串（英文字符）</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">echo &quot;呵呵&quot; | awk &#x27;&#123; print (length($0)&gt;NF)&#125;&#x27; #1</span><br></pre></td></tr></table></figure></li>
<li><p>输出带颜色的字符<br>shell脚本中echo显示内容带颜色显示,echo显示带颜色，需要使用参数-e<br>格式如下：</p>
</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">echo -e &quot;\033[字背景颜色；文字颜色m字符串\033[0m&quot;</span><br></pre></td></tr></table></figure>

<p>例如：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">echo -e &quot;\033[41;36m something here \033[0m&quot;</span><br></pre></td></tr></table></figure>

<p>其中41的位置代表底色， 36的位置是代表字的颜色</p>
<blockquote>
<p>注：<br>1、字背景颜色和文字颜色之间是英文的””<br>2、文字颜色后面有个m<br>3、字符串前后可以没有空格，如果有的话，输出也是同样有空格</p>
</blockquote>
<p>下面是相应的字和背景颜色，可以自己来尝试找出不同颜色搭配<br>例</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">echo -e &quot;\033[31m 红色字 \033[0m&quot;</span><br><span class="line">echo -e &quot;\033[34m 黄色字 \033[0m&quot;</span><br><span class="line">echo -e &quot;\033[41;33m 红底黄字 \033[0m&quot;</span><br><span class="line">echo -e &quot;\033[41;37m 红底白字 \033[0m&quot;</span><br></pre></td></tr></table></figure>

<p>字颜色：30—–37</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">echo -e &quot;\033[30m 黑色字 \033[0m&quot;</span><br><span class="line">echo -e &quot;\033[31m 红色字 \033[0m&quot;</span><br><span class="line">echo -e &quot;\033[32m 绿色字 \033[0m&quot;</span><br><span class="line">echo -e &quot;\033[33m 黄色字 \033[0m&quot;</span><br><span class="line">echo -e &quot;\033[34m 蓝色字 \033[0m&quot;</span><br><span class="line">echo -e &quot;\033[35m 紫色字 \033[0m&quot;</span><br><span class="line">echo -e &quot;\033[36m 天蓝字 \033[0m&quot;</span><br><span class="line">echo -e &quot;\033[37m 白色字 \033[0m&quot;</span><br></pre></td></tr></table></figure>

<p>字背景颜色范围：40—–47</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">echo -e &quot;\033[40;37m 黑底白字 \033[0m&quot;</span><br><span class="line">echo -e &quot;\033[41;37m 红底白字 \033[0m&quot;</span><br><span class="line">echo -e &quot;\033[42;37m 绿底白字 \033[0m&quot;</span><br><span class="line">echo -e &quot;\033[43;37m 黄底白字 \033[0m&quot;</span><br><span class="line">echo -e &quot;\033[44;37m 蓝底白字 \033[0m&quot;</span><br><span class="line">echo -e &quot;\033[45;37m 紫底白字 \033[0m&quot;</span><br><span class="line">echo -e &quot;\033[46;37m 天蓝底白字 \033[0m&quot;</span><br><span class="line">echo -e &quot;\033[47;30m 白底黑字 \033[0m&quot;</span><br></pre></td></tr></table></figure>

<p>最后面控制选项说明</p>
<ul>
<li>\33[0m 关闭所有属性</li>
<li>\33[1m 设置高亮度</li>
<li>\33[4m 下划线</li>
<li>\33[5m 闪烁</li>
<li>\33[7m 反显</li>
<li>\33[8m 消隐</li>
<li>\33[30m — \33[37m 设置前景色</li>
<li>\33[40m — \33[47m 设置背景色</li>
<li>\33[nA 光标上移n行</li>
<li>\33[nB 光标下移n行</li>
<li>\33[nC 光标右移n行</li>
<li>\33[nD 光标左移n行</li>
<li>\33[y;xH设置光标位置</li>
<li>\33[2J 清屏</li>
<li>\33[K 清除从光标到行尾的内容</li>
<li>\33[s 保存光标位置</li>
<li>\33[u 恢复光标位置</li>
<li>\33[?25l 隐藏光标</li>
<li>\33[?25h 显示光标</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">function echoGreen()&#123;</span><br><span class="line">    echo -e &quot;\033[32m$1\033[0m&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function echoRed()&#123;</span><br><span class="line">    echo -e &quot;\033[31m$1\033[0m&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function echoYellow()&#123;</span><br><span class="line">    echo -e &quot;\033[33m$1\033[0m&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>从第二行开始显示<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cat file | awk &#x27;NR&gt;2&#123;print p&#125;&#123;p=$0&#125;&#x27;</span><br></pre></td></tr></table></figure></li>
</ul>
]]></content>
      <tags>
        <tag>shell</tag>
        <tag>vim</tag>
      </tags>
  </entry>
  <entry>
    <title>Windows环境下Vmware中Centos共享文件</title>
    <url>/Windows-Vmware-Centos-share-Folder/</url>
    <content><![CDATA[<h3 id="先安装包依赖："><a href="#先安装包依赖：" class="headerlink" title="先安装包依赖："></a>先安装包依赖：</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">yum -y install kernel-devel-$(uname -r)  net-tools perl gcc gcc-c++</span><br></pre></td></tr></table></figure>

 <span id="more"></span>
<h3 id="安装vm-tool"><a href="#安装vm-tool" class="headerlink" title="安装vm tool"></a>安装vm tool</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">在home文件夹下新建tmp文件夹：mkdir tmp</span><br><span class="line">mount /dev/cdrom /home/tmp</span><br><span class="line">cp /home/tmp/VMwareTools-10.2.5-8068393.tar.gz /tmp</span><br><span class="line">cd /tmp</span><br><span class="line">tar -zxvf VMwareTools-10.2.5-8068393.tar.gz</span><br><span class="line">cd vmware-tools-distrib</span><br><span class="line">./vmware-install.pl</span><br><span class="line">根据提示输入或一直回车即</span><br></pre></td></tr></table></figure>

<h3 id="安装挂载工具"><a href="#安装挂载工具" class="headerlink" title="安装挂载工具"></a>安装挂载工具</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">yum install -y open-vm-tools-devel</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>linux</category>
        <category>centos</category>
        <category>vmware</category>
      </categories>
      <tags>
        <tag>centos</tag>
        <tag>linux</tag>
        <tag>vmware</tag>
      </tags>
  </entry>
  <entry>
    <title>二分查找</title>
    <url>/algorithm-bi-search/</url>
    <content><![CDATA[<p>又叫折半查找，要求待查找的序列有序。每次取中间位置与待查关键字比较，如果中间位置的值比待查关键字大，则在前半部分循环这个查找的过程，如果中间位置的值比待查关键字小，则在后半部分循环这个查找的过程。直到查找到了为止。否则序列中没有待查的关键字。</p>
 <span id="more"></span>

<p>Java 代码实现如下</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">biSearch</span><span class="params">(<span class="keyword">int</span> []array, <span class="keyword">int</span> a)</span></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> lo = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">int</span> hi = array.length - <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">int</span> mid;</span><br><span class="line">  <span class="keyword">while</span>(lo&lt;=hi)&#123;</span><br><span class="line">    mid=(lo+li)/<span class="number">2</span>; <span class="comment">// 中间位置</span></span><br><span class="line">    <span class="keyword">if</span>(array[mid]==a)&#123;</span><br><span class="line">      <span class="keyword">return</span> mid + <span class="number">1</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span>(array[mid]&lt;a)&#123; <span class="comment">// 向右查找</span></span><br><span class="line">      lo = mid + <span class="number">1</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span> &#123; <span class="comment">// 向左查找</span></span><br><span class="line">    	hi = mid - <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>java</category>
        <category>algorithm</category>
        <category>biSearch</category>
      </categories>
      <tags>
        <tag>java</tag>
        <tag>algorithm</tag>
        <tag>biSearch</tag>
      </tags>
  </entry>
  <entry>
    <title>冒泡排序</title>
    <url>/algorithm-bubble-sort/</url>
    <content><![CDATA[<p>(1) 比较前后相邻的二个数据，如果前面数据大于后面的数据，就将这二个数据交换。</p>
<p>(2) 这样对数组的第 0 个数据到 N-1 个数据进行一次遍历后，最大的一个数据就 ”沉“ 到数组di N-1 个位置。</p>
<p>(3) N=N-1，如果 N 不为 0 就重复前面二步，否则排序完成。</p>
 <span id="more"></span>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">bubbleSort</span><span class="params">(<span class="keyword">int</span> [] a)</span></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> n = a.length;</span><br><span class="line">  <span class="keyword">int</span> i,j;</span><br><span class="line">  <span class="keyword">for</span>(i=<span class="number">0</span>; i&lt;n; i++)&#123; <span class="comment">// 表示 n 次排序过程</span></span><br><span class="line">    <span class="keyword">for</span>(j=<span class="number">1</span>; j&lt;n-i; j++)&#123;</span><br><span class="line">      <span class="keyword">if</span>(a[j-<span class="number">1</span>] &gt; a[j])&#123; <span class="comment">// 前面的数字大于后面的数字就交换</span></span><br><span class="line">        <span class="comment">// 交换 a[j-i] 和 a[j]</span></span><br><span class="line">        <span class="keyword">int</span> temp ;</span><br><span class="line">        temp = a[j-<span class="number">1</span>];</span><br><span class="line">        a[j-<span class="number">1</span>] = a[j];</span><br><span class="line">        a[j] = temp;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>java</category>
        <category>algorithm</category>
        <category>bubble sort</category>
      </categories>
  </entry>
  <entry>
    <title>插入排序</title>
    <url>/algorithm-insert-sort/</url>
    <content><![CDATA[<p>通过构建有序序列，对于未排序数据，在已排序序列中从后向前扫描，找到相应的位置并插入。插入排序非常类似于整扑克。在开始摸牌时，左手是空的，牌面朝下放在桌面。接着，一次从桌上磨起一张牌，并将它插入到左手一把牌中的正确位置上。为了找到这张牌的正确位置，要将它与手中已有的牌从左到右地进行比较。无论什么时候，左手中的牌都是排好序的。</p>
 <span id="more"></span>
<p>如果输入数组已经是排好序的话，插入排序出现最佳情况，其运行时间是输入规模的一个线性函数。如果输入数组是逆序排列的，将出现最坏情况。平均情况与最坏情况一样，其时间代价是($$n^2$$)。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sort</span><span class="params">(<span class="keyword">int</span> arr[])</span></span>&#123;</span><br><span class="line">   <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i&lt;arr.length; i++)&#123;</span><br><span class="line">     <span class="comment">// 插入的数</span></span><br><span class="line">     <span class="keyword">int</span> insertVal = arr[i];</span><br><span class="line">     <span class="comment">// 被插入的位置(准备和前一个数比较)</span></span><br><span class="line">     <span class="keyword">int</span> index = i-<span class="number">1</span>;</span><br><span class="line">     <span class="comment">// 如果插入的数比被插入的数小</span></span><br><span class="line">     <span class="keyword">while</span>(index&gt;=<span class="number">0</span> &amp;&amp; insertVal&lt;arr[index])&#123;</span><br><span class="line">       <span class="comment">// 将把 arr[index] 向后移动</span></span><br><span class="line">       arr[index+<span class="number">1</span>] = arr[index];</span><br><span class="line">       <span class="comment">// 让 index 向前移动</span></span><br><span class="line">       index--;</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="comment">// 把插入的数放入合适位置</span></span><br><span class="line">     arr[index+<span class="number">1</span>]=insertVal;</span><br><span class="line">   &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>




]]></content>
      <categories>
        <category>java</category>
        <category>algorithm</category>
        <category>insert sort</category>
      </categories>
      <tags>
        <tag>java</tag>
        <tag>algorithm</tag>
        <tag>insert sort</tag>
      </tags>
  </entry>
  <entry>
    <title>桶排序</title>
    <url>/algorithm-bucket-sort/</url>
    <content><![CDATA[<p>桶排序的基本思想是：把数组 arr 划分为 n 个大小相同子区间 (桶), 每个子区间各自排序，最后合并。计数排序是桶排序的一种特殊情况，可以把计数排序当成每个桶里面只有一个元素的情况。<br> <span id="more"></span></p>
<ol>
<li>找出待排序数组中的最大值 max、最小值 min</li>
<li>我们使用 动态数组 ArrayList 作为桶，桶里放的元素也用 ArrayList 存储。桶的数量为 (max-min)/arr.length+1</li>
<li>遍历数组 arr，计算每个元素 arr[i] 放的桶</li>
<li>每个桶各自排序</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">bucketSort</span><span class="params">(<span class="keyword">int</span>[] arr)</span></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> max = Interger.MIN_VALUE;</span><br><span class="line">  <span class="keyword">int</span> min = Integer.MAX_VALUE;</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i&lt;arr.length; i++)&#123;</span><br><span class="line">    max = Math.max(max,arr[i]);</span><br><span class="line">    min = Math.min(min,arr[i]);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 创建桶</span></span><br><span class="line">  <span class="keyword">int</span> bucketNum = (max-min)/arr.length +<span class="number">1</span>;</span><br><span class="line">  ArrayList&lt;ArrayList&lt;Interger&gt;&gt; bucketArr = <span class="keyword">new</span> ArrayList&lt;&gt;(bucketNum);</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span> ;i &lt; bucketNum; i++)&#123;</span><br><span class="line">    bucketArr.add(<span class="keyword">new</span> ArrayList&lt;Integer&gt;());</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 将每个元素放入桶</span></span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span> ; i&lt;arr.length; i++)&#123;</span><br><span class="line">    <span class="keyword">int</span> num = (arr[i] - min) / (arr.length);</span><br><span class="line">    bucketArr.get(num).add(arr[i]);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 对每个桶进行排序</span></span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span> ; i&lt;bucketArr.size(); i++)&#123;</span><br><span class="line">    Collections.sort(bucketArr.get(i));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





]]></content>
      <categories>
        <category>java</category>
        <category>algorithm</category>
        <category>bucket sort</category>
      </categories>
      <tags>
        <tag>java</tag>
        <tag>algorithm</tag>
        <tag>bucket sort</tag>
      </tags>
  </entry>
  <entry>
    <title>归并排序</title>
    <url>/algorithm-merge-sort/</url>
    <content><![CDATA[<p>归并 （Merge） 排序法是将两个 （或两个以上）有序表合并成一个新的有序表，即把待排序序列分为多干个子序列，每个子序列是有序的。然后再把有序子序列合并为整体有序序列。</p>
<span id="more"></span>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MergeSortTest</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">  	<span class="keyword">int</span>[] data = <span class="keyword">new</span> <span class="keyword">int</span>[]&#123;<span class="number">5</span>, <span class="number">3</span>, <span class="number">6</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">9</span>, <span class="number">4</span>, <span class="number">8</span>, <span class="number">7</span>&#125;;</span><br><span class="line">  	print(data);</span><br><span class="line">  	mergeSort(data);</span><br><span class="line"> 	 System.out.println(<span class="string">&quot;排序后的数组&quot;</span>);</span><br><span class="line">  	print(data);</span><br><span class="line">	&#125;</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">mergeSort</span><span class="params">(<span class="keyword">int</span>[] data)</span></span>&#123;</span><br><span class="line">    sort(data,<span class="number">0</span>,data.length-<span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sort</span><span class="params">(<span class="keyword">int</span>[] data, <span class="keyword">int</span> left, <span class="keyword">int</span> right)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(left&gt;=right)&#123;</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 找出中间索引</span></span><br><span class="line">    <span class="keyword">int</span> center = (left + right)/<span class="number">2</span>;</span><br><span class="line">    <span class="comment">// 对左边数组进行递归</span></span><br><span class="line">    sort(data,left,center);</span><br><span class="line">    <span class="comment">// 对右边数组进行递归</span></span><br><span class="line">    sort(data, center+<span class="number">1</span>, right);</span><br><span class="line">    <span class="comment">// 合并</span></span><br><span class="line">    merge(data, left, center, right);</span><br><span class="line">    print(data);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">  * 将两个数组进行归并，归并前面 2 个数组已经有序，归并后依然有序</span></span><br><span class="line"><span class="comment">  * </span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param</span> data</span></span><br><span class="line"><span class="comment">  *             数组对象</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param</span> left</span></span><br><span class="line"><span class="comment">  *             左数组的第一个元素的索引</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param</span> center</span></span><br><span class="line"><span class="comment">  *             左数组的最后一个元素的索引，center+1 是右数组第一个元素的索引</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param</span> right</span></span><br><span class="line"><span class="comment">  *             右数组最后一个元素的索引</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">merge</span><span class="params">(<span class="keyword">int</span>[] data, <span class="keyword">int</span> left, <span class="keyword">int</span> center, <span class="keyword">int</span> right)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 临时数组</span></span><br><span class="line">    <span class="keyword">int</span>[] tmpArr = <span class="keyword">new</span> <span class="keyword">int</span>[data.length];</span><br><span class="line">    <span class="comment">// 右数组第一个元素索引</span></span><br><span class="line">    <span class="keyword">int</span> mid = center + <span class="number">1</span>;</span><br><span class="line">    <span class="comment">// third 记录临时数组的索引</span></span><br><span class="line">    <span class="keyword">int</span> third = left;</span><br><span class="line">    <span class="comment">// 缓存数组第一个元素的索引</span></span><br><span class="line">    <span class="keyword">int</span> tmp = left;</span><br><span class="line">    <span class="keyword">while</span>(left &lt;= center &amp;&amp; mid &lt;= right)&#123;</span><br><span class="line">      <span class="comment">// 从两个数组中取出最小的放入临时数组</span></span><br><span class="line">      <span class="keyword">if</span>(data[left] &lt;= data[mid])&#123;</span><br><span class="line">        tmpArr[third++] = data[left++];</span><br><span class="line">      &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">        tempArr[third++] = data[mid++];</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 剩余部分依次放入临时数组 （实际上两个 while 只会执行其中一个）</span></span><br><span class="line">    <span class="keyword">while</span>(mid &lt;=right)&#123;</span><br><span class="line">      tmpArr[third++] = data[mid++];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span>(left &lt;= center)&#123;</span><br><span class="line">      temArr[third++] = data[left++];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 将临时数组中的内容拷贝会原数组中</span></span><br><span class="line">    <span class="comment">// （原 left-right 范围的内容被复制回原数组）</span></span><br><span class="line">    <span class="keyword">while</span>(tmp &lt;= right)&#123;</span><br><span class="line">      data[tmp] = tempArr[tmp++];</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">print</span><span class="params">(<span class="keyword">int</span>[] data)</span></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span> ; i &lt; data.length; i++)&#123;</span><br><span class="line">      System.out.print(data[i] + <span class="string">&quot;\t&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    System.out.println();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>java</category>
        <category>algorithm</category>
        <category>merge sort</category>
      </categories>
      <tags>
        <tag>java</tag>
        <tag>algorithm</tag>
        <tag>merge sort</tag>
      </tags>
  </entry>
  <entry>
    <title>快速排序</title>
    <url>/algorithm-quick-sort/</url>
    <content><![CDATA[<p>快速排序的原理：选择一个关键值作为基准值。比较基准值小的都放在左边序列(一般是无序的), 比基准值大的都在右边(一般是无序的)。一般选择序列的第一个元素。<br> <span id="more"></span><br>一次循环：从后往前比较，用基准值和最后一个值比较，如果比基准值小的交换位置，如果没有继续比较下一个，知道找到第一个比基准值小的值才交换。找到这个值之后，又从前往后开始比较，如果有比基准值大的，交换位置，如果没有继续比较下一个，直到找到第一个比基准值大的值才交换。直到从前往后的比较索引&gt;从后往前比较的索引，结束第一次比较的索引，结束第一次循环，此时，对于基准值来说，左右两边就是有序的了。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sort</span><span class="params">(<span class="keyword">int</span>[] a, <span class="keyword">int</span> low, <span class="keyword">int</span> high)</span></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> start = low;</span><br><span class="line">  <span class="keyword">int</span> end = high;</span><br><span class="line">  <span class="keyword">int</span> key = a[low];</span><br><span class="line">  <span class="keyword">while</span>(end&gt;start)&#123;</span><br><span class="line">    <span class="comment">// 从后往前比较</span></span><br><span class="line">    <span class="keyword">while</span>(end&gt;start &amp;&amp; a[end]&gt;=key)&#123;</span><br><span class="line">      <span class="comment">// 如果没有比关键值小的，比较下一个，直到有比关键值小的交换位置，然后又从前往后比较</span></span><br><span class="line">      end--;</span><br><span class="line">      <span class="keyword">if</span>(a[end]&lt;=key)&#123;</span><br><span class="line">        <span class="keyword">int</span> tem = a[end];</span><br><span class="line">        a[end] = a[start];</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// 从前往后比较</span></span><br><span class="line">      <span class="keyword">while</span>(end&gt;start &amp;&amp; a[start]&lt;=key)&#123;</span><br><span class="line">        start++;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span>(a[start]&gt;=key)&#123;</span><br><span class="line">        <span class="keyword">int</span> temp = a[start];</span><br><span class="line">        a[start] = a[end];</span><br><span class="line">        a[end] = temp;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// 此时第一次循环比较结束，关键值的位置已经确定了。左边的值都比关键值小，右边的值都比关键值大，但是两边的顺序还有可能是不一样的，进行下面的递归调用</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 递归</span></span><br><span class="line">    <span class="keyword">if</span>(start&gt;low)&#123;</span><br><span class="line">      <span class="comment">// 左边序列。第一个索引位置到关键值索引-1</span></span><br><span class="line">      sort(a,low,start-<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(end&lt;hight)&#123;</span><br><span class="line">      <span class="comment">// 右边序列。从关键值索引+1 到最后一个</span></span><br><span class="line">      sort(a,end+<span class="number">1</span>,high);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



]]></content>
      <categories>
        <category>java</category>
        <category>algorithm</category>
        <category>quick sort</category>
      </categories>
      <tags>
        <tag>java</tag>
        <tag>algorithm</tag>
        <tag>quick sort</tag>
      </tags>
  </entry>
  <entry>
    <title>计数排序</title>
    <url>/algorithm-radix-sort/</url>
    <content><![CDATA[<p>将所有待比较数值 （正整数）统一为同样的数位长度，数位较短的数前面补零。然后，从最低位开始，依次进行一次排序。这样从最低位开始，依次进行一次排序。这样从最低位排序一直到最高位排序完成以后，数列就变成一个有序序列。<br> <span id="more"></span></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RadixSort</span> </span>&#123;</span><br><span class="line">	<span class="keyword">int</span>[] a =&#123;<span class="number">49</span>,<span class="number">38</span>,<span class="number">65</span>,<span class="number">97</span>,<span class="number">76</span>,<span class="number">13</span>,<span class="number">27</span>,<span class="number">49</span>,<span class="number">78</span>,<span class="number">34</span>,<span class="number">12</span>,<span class="number">64</span>,<span class="number">5</span>,<span class="number">4</span>,<span class="number">62</span>,<span class="number">99</span>,<span class="number">98</span>,<span class="number">54</span>,<span class="number">101</span>,<span class="number">56</span>,<span class="number">17</span>,<span class="number">18</span>,<span class="number">23</span>,<span class="number">34</span>,<span class="number">15</span>,<span class="number">35</span>,<span class="number">25</span>,<span class="number">53</span>,<span class="number">51</span>&#125;;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">radixSort</span><span class="params">()</span></span>&#123;</span><br><span class="line">    sort(a);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;a.length; i++)&#123;</span><br><span class="line">      System.out.println(a[i]);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sort</span><span class="params">(<span class="keyword">int</span>[] array)</span></span>&#123;</span><br><span class="line">    <span class="comment">// 首先确定排序的趟数；</span></span><br><span class="line">    <span class="keyword">int</span> max = array[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>; i&lt;array.length; i++)&#123;</span><br><span class="line">      <span class="keyword">if</span>(array[i]&gt;max)&#123;</span><br><span class="line">        max = array[i];</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> time = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">// 判断位数；</span></span><br><span class="line">    <span class="keyword">while</span>(max &gt;<span class="number">0</span>)&#123;</span><br><span class="line">      max/=<span class="number">10</span>;</span><br><span class="line">      time++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 建立 10 个队列</span></span><br><span class="line">    List&lt;ArrayList&gt; queue = <span class="keyword">new</span> ArrayList&lt;ArrayList&gt;();</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span> ; i &lt; <span class="number">10</span> ; i++)&#123;</span><br><span class="line">      ArrayList&lt;Integer&gt; queue1 = <span class="keyword">new</span> ArrayList&lt;Integer&gt;();</span><br><span class="line">      queue.add(queue1);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 进行 time 次分配和收集</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i =<span class="number">0</span>; i&lt; time; i++)&#123;</span><br><span class="line">      <span class="comment">// 分配数组元素</span></span><br><span class="line">      <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>; j&lt;array.length; j++)&#123;</span><br><span class="line">        <span class="comment">// 得到数字的第 time+1 位数</span></span><br><span class="line">        <span class="keyword">int</span> x = array[j]%(<span class="keyword">int</span>)Math.pow(<span class="number">10</span>,i+<span class="number">1</span>)/(<span class="keyword">int</span>)Math.pow(<span class="number">10</span>,i);</span><br><span class="line">        ArrayList&lt;Integer&gt; queue2 = queue.get(x);</span><br><span class="line">        queue2.add(array[j]);</span><br><span class="line">        queue.set(x,queue2);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 元素计数器；</span></span><br><span class="line">    <span class="keyword">int</span> count = <span class="number">0</span> ;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> k = <span class="number">0</span>; k &lt; <span class="number">10</span>; k++)&#123;</span><br><span class="line">      <span class="keyword">while</span>(queue.get(k).size()&gt;<span class="number">0</span>)&#123;</span><br><span class="line">        ArrayList&lt;Integer&gt; queue3 = queue.get(k);</span><br><span class="line">        array[count] = queue3.get(<span class="number">0</span>);</span><br><span class="line">        queue3.remove(<span class="number">0</span>);</span><br><span class="line">        count++;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



]]></content>
      <categories>
        <category>java</category>
        <category>algorithm</category>
        <category>radix sort</category>
      </categories>
      <tags>
        <tag>java</tag>
        <tag>algorithm</tag>
        <tag>radix sort</tag>
      </tags>
  </entry>
  <entry>
    <title>希尔排序</title>
    <url>/algorithm-shell-sort/</url>
    <content><![CDATA[<p>基本思想：先将整个待排序的记录分割成若干子序列分别进行插入排序，待整个序列中的记录 ”基本有序“ 时，再对全体记录进行依次直接插入排序。<br> <span id="more"></span><br>1.操作方法：</p>
<p>​    选择一个增量序列 t1, t2, …, tk, 其中 ti&gt;tj, tk=1;</p>
<p>2.按增量序列个数 k，对序列进行 k 趟排序；</p>
<p>3.每趟排序，根据对应的增量 ti，将待排序列分割成若干长度为 m 的子序列，分别对各字表进行直接插入排序。仅增量因子为 1 时，整个序列作为一个表来处理，表长度即为整个序列的长度。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">shellSort</span><span class="params">(<span class="keyword">int</span>[] a)</span></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> dk = a.length/<span class="number">2</span>;</span><br><span class="line">  <span class="keyword">while</span>(dk&gt;<span class="number">1</span>)&#123;</span><br><span class="line">    ShellInSertSort(a,dk);</span><br><span class="line">    dk /= <span class="number">2</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">ShellInsertSort</span><span class="params">(<span class="keyword">int</span>[] a,<span class="keyword">int</span> dk)</span></span>&#123;</span><br><span class="line">  <span class="comment">// 类似插入排序，只是插入排序增量是1，这里增量是 dk，把 1 换成 dk 就可以了</span></span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">int</span> i=dk; i&lt;a.length; i++)&#123;</span><br><span class="line">    <span class="keyword">if</span>(a[i]&lt;a[i-dk])&#123;</span><br><span class="line">      <span class="keyword">int</span> j ;</span><br><span class="line">      <span class="keyword">int</span> x = a[i]; <span class="comment">// X 为待插入元素</span></span><br><span class="line">      a[i] = a[i-dk];</span><br><span class="line">      <span class="keyword">for</span>(j=i-dk; j&gt;=<span class="number">0</span> &amp;&amp; x&lt;a[j]; j=j-dk)&#123;</span><br><span class="line">        <span class="comment">// 通过循环，逐个后移一位找到要插入的位置。</span></span><br><span class="line">        a[j+dk] = a[j];</span><br><span class="line">      &#125;</span><br><span class="line">      a[j+dk]=x; <span class="comment">// 插入</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>java</category>
        <category>algorithm</category>
        <category>shell sort</category>
      </categories>
      <tags>
        <tag>java</tag>
        <tag>algorithm</tag>
        <tag>shell sort</tag>
      </tags>
  </entry>
  <entry>
    <title>使用 https 协议部署博客</title>
    <url>/deploy-blog-with-https/</url>
    <content><![CDATA[<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>https 成为互联网标配，自然得跟上，给自己的博客用加密版的传输协议 https。</p>
<p>首先需要一个域名和一台拥有固定外网 ip 的服务器，使域名可以解析到该服务器上。<a href="https://caddyserver.com/">caddy</a> 可以自动能够向 Let’s Encrypt 申请和续期免费证书，有效期为 3 个月， 到期后自动续期。</p>
<span id="more"></span> 

<p>博客源码托管在 GitHub，因此需要先安装 git</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">yum install -y git</span><br></pre></td></tr></table></figure>

<p>安装 caddy </p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">curl https://getcaddy.com | bash -s personal  http.git,http.cors,http.forwardproxy,http.authz,hook.service,dns</span><br></pre></td></tr></table></figure>

<p>添加 caddy 到系统服务</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">vi /etc/init.d/caddy</span><br></pre></td></tr></table></figure>

<p>写入内容</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">## BEGIN INIT INFO</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Provides:          Caddy</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Required-Start:    <span class="variable">$network</span> <span class="variable">$local_fs</span> <span class="variable">$remote_fs</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Required-Stop:     <span class="variable">$network</span> <span class="variable">$local_fs</span> <span class="variable">$remote_fs</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Default-Start:     2 3 4 5</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Default-Stop:      0 1 6</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Short-Description: The HTTP/2 web server with automatic HTTPS</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Description:       Start or stop the Caddy server</span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">## END INIT INFO</span></span></span><br><span class="line"></span><br><span class="line">NAME=&quot;Caddy&quot;</span><br><span class="line">NAME_BIN=&quot;caddy&quot;</span><br><span class="line">BIN=&quot;/usr/local/bin/caddy&quot;</span><br><span class="line"></span><br><span class="line">if [ -f &quot;/usr/local/caddy/Caddyfile&quot; ]; then</span><br><span class="line">	CONF=&quot;/usr/local/caddy/Caddyfile&quot;</span><br><span class="line">elif [ -f &quot;/etc/caddy/Caddyfile&quot; ]; then</span><br><span class="line">	CONF=&quot;/etc/caddy/Caddyfile&quot;</span><br><span class="line">fi</span><br><span class="line">Info_font_prefix=&quot;\033[32m&quot; &amp;&amp; Error_font_prefix=&quot;\033[31m&quot; &amp;&amp; Info_background_prefix=&quot;\033[42;37m&quot; &amp;&amp; Error_background_prefix=&quot;\033[41;37m&quot; &amp;&amp; Font_suffix=&quot;\033[0m&quot;</span><br><span class="line">RETVAL=0</span><br><span class="line"></span><br><span class="line">check_running()&#123;</span><br><span class="line">	PID=`ps -ef |grep &quot;$&#123;NAME_BIN&#125;&quot; |grep -v &quot;grep&quot; |grep -v &quot;init.d&quot; |grep -v &quot;service&quot; |awk &#x27;&#123;print $2&#125;&#x27;`</span><br><span class="line">	if [[ ! -z $&#123;PID&#125; ]]; then</span><br><span class="line">		return 0</span><br><span class="line">	else</span><br><span class="line">		return 1</span><br><span class="line">	fi</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">do_start()&#123;</span><br><span class="line">	check_running</span><br><span class="line">	if [[ $? -eq 0 ]]; then</span><br><span class="line">		echo -e &quot;$&#123;Info_font_prefix&#125;[信息]$&#123;Font_suffix&#125; $NAME (PID $&#123;PID&#125;) 正在运行...&quot; &amp;&amp; exit 0</span><br><span class="line">	else</span><br><span class="line">		ulimit -n 51200</span><br><span class="line">		nohup &quot;$BIN&quot; --conf=&quot;$CONF&quot; -agree &gt;&gt; /tmp/caddy.log 2&gt;&amp;1 &amp;</span><br><span class="line">		sleep 2s</span><br><span class="line">		check_running</span><br><span class="line">		if [[ $? -eq 0 ]]; then</span><br><span class="line">			echo -e &quot;$&#123;Info_font_prefix&#125;[信息]$&#123;Font_suffix&#125; $NAME 启动成功 !&quot;</span><br><span class="line">		else</span><br><span class="line">			echo -e &quot;$&#123;Error_font_prefix&#125;[错误]$&#123;Font_suffix&#125; $NAME 启动失败 !&quot;</span><br><span class="line">		fi</span><br><span class="line">	fi</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">do_stop()&#123;</span><br><span class="line">	check_running</span><br><span class="line">	if [[ $? -eq 0 ]]; then</span><br><span class="line">		kill -9 $&#123;PID&#125;</span><br><span class="line">		RETVAL=$?</span><br><span class="line">		if [[ $RETVAL -eq 0 ]]; then</span><br><span class="line">			echo -e &quot;$&#123;Info_font_prefix&#125;[信息]$&#123;Font_suffix&#125; $NAME 停止成功 !&quot;</span><br><span class="line">		else</span><br><span class="line">			echo -e &quot;$&#123;Error_font_prefix&#125;[错误]$&#123;Font_suffix&#125;$NAME 停止失败 !&quot;</span><br><span class="line">		fi</span><br><span class="line">	else</span><br><span class="line">		echo -e &quot;$&#123;Info_font_prefix&#125;[信息]$&#123;Font_suffix&#125; $NAME 未运行 !&quot;</span><br><span class="line">		RETVAL=1</span><br><span class="line">	fi</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">do_status()&#123;</span><br><span class="line">	check_running</span><br><span class="line">	if [[ $? -eq 0 ]]; then</span><br><span class="line">		echo -e &quot;$&#123;Info_font_prefix&#125;[信息]$&#123;Font_suffix&#125; $NAME (PID $&#123;PID&#125;) 正在运行...&quot;</span><br><span class="line">	else</span><br><span class="line">		echo -e &quot;$&#123;Info_font_prefix&#125;[信息]$&#123;Font_suffix&#125; $NAME 未运行 !&quot;</span><br><span class="line">		RETVAL=1</span><br><span class="line">	fi</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">do_tail()&#123;</span><br><span class="line">	tail -100f /tmp/caddy.log</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">do_restart()&#123;</span><br><span class="line">	do_stop</span><br><span class="line">	do_start</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">do_console()&#123;</span><br><span class="line">	do_start</span><br><span class="line">	do_tail</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">case &quot;$1&quot; in</span><br><span class="line">	start|stop|restart|status|console|tail)</span><br><span class="line"><span class="meta">	do_$</span><span class="bash">1</span></span><br><span class="line">	;;</span><br><span class="line">	*)</span><br><span class="line">	echo &quot;使用方法: $0 &#123; start | stop | restart | status | console | tail &#125;&quot;</span><br><span class="line">	RETVAL=1</span><br><span class="line">	;;</span><br><span class="line">esac</span><br><span class="line">exit $RETVAL</span><br></pre></td></tr></table></figure>

<p>更改权限，加入开机自启动</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">chmod 755 /etc/init.d/caddy</span><br><span class="line">chkconfig caddy on</span><br></pre></td></tr></table></figure>

<p>编辑配置文件</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">mkdir -p /etc/caddy/vhosts</span><br><span class="line">vi /etc/caddy/Caddyfile</span><br></pre></td></tr></table></figure>

<p>caddyfile 文件内容</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 配置文件分开存放</span></span><br><span class="line">import vhosts/*.conf</span><br></pre></td></tr></table></figure>

<p>具体配置文件</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">vi /etc/caddy/vhosts/hunkier.cn.conf</span><br></pre></td></tr></table></figure>

<p>这里的代码仓库是开放的，若是私有项目，请自行查阅相关资料。</p>
<p>文件内容</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">hunkier.<span class="attribute">cn</span> www.hunkier.cn &#123;</span><br><span class="line">    <span class="comment"># web 页面存放路径</span></span><br><span class="line">    <span class="attribute">root</span> /var/www/hunkier/</span><br><span class="line">    <span class="comment"># 配置错误页面，所有错误都显示 404.html 页面</span></span><br><span class="line">    errors &#123;</span><br><span class="line">        * 404.<span class="attribute">html</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment"># 启用压缩</span></span><br><span class="line">    gzip</span><br><span class="line">    <span class="comment"># 用来申请及更新 https 证书的邮箱，前提是 hunkier.cn 的域名能解析到 本机</span></span><br><span class="line">    tls huangkuier@gmail.com</span><br><span class="line">    git github.com/hunkier/hunkier.github.io &#123;</span><br><span class="line">    	<span class="comment"># git clone 的目标路径</span></span><br><span class="line">        <span class="attribute">path</span> /var/www/hunkier</span><br><span class="line">        <span class="comment"># 使用 webhook 触发自动部署，</span></span><br><span class="line">        <span class="comment"># GitHub 项目的 setting -&gt; Webhooks 页 Add webhook</span></span><br><span class="line">        <span class="comment"># Payload URL 为 https://hunkier.cn/webhook </span></span><br><span class="line">        <span class="comment"># Content type 为 application/json</span></span><br><span class="line">        <span class="comment"># Cecret 为 GitHubSecretKey</span></span><br><span class="line">        hook /webhook GitHubSecretKey</span><br><span class="line">        hook_type github</span><br><span class="line">        clone_args --recursive</span><br><span class="line">        pull_args --recurse-submodules</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>创建目录</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">mkdir -p /var/www/hunkier</span><br></pre></td></tr></table></figure>

<p>解除链接文件限制</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ulimit -n 8192</span><br></pre></td></tr></table></figure>

<p>也可以使用 caddy 用作代理服务器用来科学上网（你懂得^_^）</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">vi /etc/caddy/vhost/xxx.hunkier.cn.conf</span><br></pre></td></tr></table></figure>

<p>文件 xxx.hunkier.cn.conf 内容如下：</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line">xxx.hunkier.<span class="section">cn</span> &#123;</span><br><span class="line">    <span class="comment"># 伪装成正常的网站</span></span><br><span class="line">    <span class="attribute">root</span> /var/www/hunkier/</span><br><span class="line">    <span class="comment"># 配置错误页面，所有错误都显示 404.html 页面</span></span><br><span class="line">    errors &#123;</span><br><span class="line">        * 404.<span class="attribute">html</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment"># 开启压缩</span></span><br><span class="line">    gzip</span><br><span class="line">    <span class="comment"># 使用邮箱申请和续期证书</span></span><br><span class="line">    tls huangkuier@gmail.com</span><br><span class="line">    <span class="comment"># http 代理设置</span></span><br><span class="line">    forwardproxy &#123;</span><br><span class="line">        <span class="attribute">hide_ip</span></span><br><span class="line">        hide_via</span><br><span class="line">        <span class="comment"># 使用 basic 认证</span></span><br><span class="line">        basicauth user1 passwd1</span><br><span class="line">        basicauth user2 passwd2</span><br><span class="line">        basicauth user3 passwd3</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>此时 caddy 被用作 web 服务器和代理服务器，协议转换推荐使用<a href="https://github.com/ginuerzh/gost/releases">gost</a> 。</p>
<p> caddy 服务 启动/停止/重启/检查状态</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">service caddy start/stop/restart/status</span><br></pre></td></tr></table></figure>

<p>启动成功后可以在浏览器里面正常访问 <a href="https://hunkier.cn/">https://hunkier.cn</a></p>
<p>若启动失败，查看日志</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">tail -100f /tmp/caddy.log </span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>https</category>
        <category>blog</category>
        <category>caddy</category>
      </categories>
      <tags>
        <tag>blog</tag>
        <tag>https</tag>
        <tag>caddy</tag>
      </tags>
  </entry>
  <entry>
    <title>iOS越狱</title>
    <url>/iOS-Jailbreaking/</url>
    <content><![CDATA[<ul>
<li><strong>写在开头</strong></li>
</ul>
<p>什么是iOS越狱？</p>
<blockquote>
<p>iOS越狱（英语：iOS Jailbreaking）是获取iOS设备的Root权限的技术手段。iOS系统的Root用户对除Apple特定私有进程之外的其他进程不开放，使用Root用户运行的进程在进程树中的PID为0。程序员在iOS中挖掘出一些可以将进程提权至PID0的漏洞（例如Task For PID0）。利用Root用户运行的进程意味着可以任意读取设备其中的APFS分区表和内核缓存地址，拥有一个用户可以随意控制的PID0进程还不能称之为一个完整的越狱。之后还需要利用Bypass（旁路）手段绕过Apple在iOS系统中设置的其他安全防护措施，将APFS或HFS+文件系统中的ROOTFS分区重新挂载（Remount）为可读写（R/W），从而达到添加二进制文件和守护进程的目的。通常大众用户认为能够正常使用Cydia才能被称为越狱，但其实这种说法是不正确的。但通过此软件可以完成越狱前不可能进行的动作，例如安装App Store以外未经过签名的应用、修改SpringBoard、运行Shell程序、使有运营商锁的设备利用卡贴解锁后通过替换配置文件形式实现本地化（例如“去除+86”，解锁FaceTime功能）。[1]</p>
</blockquote>
<span id="more"></span> 

<blockquote>
<p>越狱软件分发商店Cydia的创始人Jay Freeman在2010年10月估计，全球大概有10%的iPhone曾进行过越狱[2]。 当一台iOS设备越狱之后，用户将能实践很多此前无能以得的各种功能，或是使用很多被Apple认为不安全的软件。比如：虚拟定位、修改iPhone的登录设备、翻越防火墙、修改设备界面字体和主题、快速转换自定义铃声、使用自己编程的软件或插件等。</p>
</blockquote>
<p>越狱工具：</p>
<p>挂神团队越狱 <a href="https://app.nk8686.xin/ios/">https://app.nk8686.xin/ios/</a></p>
<p>electra越狱 <a href="https://coolstar.org/electra/">https://coolstar.org/electra/</a></p>
<p>pp助手越狱 <a href="https://pro.25pp.com/ppghost">https://pro.25pp.com/ppghost</a></p>
<p>爱思越狱助手：<a href="https://www.i4.cn/">https://www.i4.cn/</a></p>
<p>iOS9.2~iOS9.3.3越狱修复 <a href="http://jb92.i4.cn/">http://jb92.i4.cn/</a></p>
]]></content>
      <categories>
        <category>ios</category>
        <category>Jailbreaking</category>
      </categories>
      <tags>
        <tag>ios</tag>
        <tag>Jailbreaking</tag>
      </tags>
  </entry>
  <entry>
    <title>Hello World</title>
    <url>/hello-world/</url>
    <content><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p>
<p>Hosted by <a href="https://pages.coding.me" style="font-weight: bold">Coding Pages</a></p>

<span id="more"></span>

<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/deployment.html">Deployment</a></p>
]]></content>
      <categories>
        <category>github</category>
      </categories>
      <tags>
        <tag>blog</tag>
        <tag>hexo</tag>
      </tags>
  </entry>
  <entry>
    <title>javascript正则表达式验证数字</title>
    <url>/js-reg-exp/</url>
    <content><![CDATA[<p>javascript 验证输入的是否为正确的数组</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">validate</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">      <span class="keyword">var</span> reg = <span class="keyword">new</span> <span class="built_in">RegExp</span>(<span class="string">&quot;^[0-9]*$&quot;</span>);</span><br><span class="line">      <span class="keyword">var</span> obj = <span class="built_in">document</span>.getElementById(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">   <span class="keyword">if</span>(!reg.test(obj.value))&#123;</span><br><span class="line">       alert(<span class="string">&quot;请输入数字!&quot;</span>);</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">if</span>(!<span class="regexp">/^[0-9]*$/</span>.test(obj.value))&#123;</span><br><span class="line">       alert(<span class="string">&quot;请输入数字!&quot;</span>);</span><br><span class="line">   &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<span id="more"></span>

<p>验证数字的正则表达式集</p>
<p>验证数字：<code>^[0-9]*$</code> </p>
<p>验证n位的数字：<code>^\d&#123;n&#125;$</code> </p>
<p>验证至少n位数字：<code>^\d&#123;n,&#125;$</code> </p>
<p>验证m-n位的数字：<code>^\d&#123;m,n&#125;$</code></p>
<p>验证零和非零开头的数字：<code>^(0|[1-9][0-9]*)$</code></p>
<p>验证有两位小数的正实数：<code>^[0-9]+(.[0-9]&#123;2&#125;)?$</code></p>
<p>验证有1-3位小数的正实数：<code>^[0-9]+(.[0-9]&#123;1,3&#125;)?$</code></p>
<p>验证非零的正整数：<code>^\+?[1-9][0-9]*$</code> </p>
<p>验证非零的负整数：<code>^\-[1-9][0-9]*$</code> </p>
<p>验证非负整数（正整数 + 0） <code>^\d+$</code> </p>
<p>验证非正整数（负整数 + 0） <code>^((-\d+)|(0+))$</code></p>
<p>验证长度为3的字符：<code>^.&#123;3&#125;$</code> </p>
<p>验证由26个英文字母组成的字符串：<code>^[A-Za-z]+$</code> </p>
<p>验证由26个大写英文字母组成的字符串：<code>^[A-Z]+$</code> </p>
<p>验证由26个小写英文字母组成的字符串：<code>^[a-z]+$</code> </p>
<p>验证由数字和26个英文字母组成的字符串：<code>^[A-Za-z0-9]+$</code> </p>
<p>验证由数字、26个英文字母或者下划线组成的字符串：<code>^\w+$</code></p>
<p>验证用户密码:<code>^[a-zA-Z]\w&#123;5,17&#125;$</code> </p>
<p>正确格式为：以字母开头，长度在6-18之间，只能包含字符、数字和下划线。 </p>
<p>验证是否含有 <code>^%&amp;&#39;,;=?$\&quot;</code> 等字符：<code>[^%&amp;&#39;,;=?$\x22]+</code></p>
<p>验证汉字：<code>^[\u4e00-\u9fa5],&#123;0,&#125;$</code> </p>
<p>验证Email地址：<code>^\w+[-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$</code> </p>
<p>验证InternetURL：<code>^http://([\w-]+\.)+[\w-]+(/[\w-./?%&amp;=]*)?$ ；^[a-zA-z]+://(w+(-w+)*)(.(w+(-w+)*))*(?S*)?$</code> </p>
<p>验证电话号码：<code>^(\(\d&#123;3,4&#125;\)|\d&#123;3,4&#125;-)?\d&#123;7,8&#125;$</code></p>
<p>正确格式为：<code>XXXX-XXXXXXX，XXXX-XXXXXXXX，XXX-XXXXXXX，XXX-XXXXXXXX，XXXXXXX，XXXXXXXX</code>。</p>
<p>验证身份证号（15位或18位数字）：<code>^\d&#123;15&#125;|\d&#123;&#125;18$</code><br>验证一年的12个月：<code>^(0?[1-9]|1[0-2])$</code><br>正确格式为：“01”-“09”和“1”“12”<br>验证一个月的31天：<code>^((0?[1-9])|((1|2)[0-9])|30|31)$ </code><br>正确格式为：01、09和1、31。<br>整数：<code>^-?\d+$ </code><br>非负浮点数（正浮点数 + 0）：<code>^\d+(\.\d+)?$ </code><br>正浮点数<code>^(([0-9]+\.[0-9]*[1-9][0-9]*)|([0-9]*[1-9][0-9]*\.[0-9]+)|([0-9]*[1-9][0-9]*))$</code><br>非正浮点数（负浮点数 + 0）<code>^((-\d+(\.\d+)?)|(0+(\.0+)?))$</code><br>负浮点数 <code>^(-(([0-9]+\.[0-9]*[1-9][0-9]*)|([0-9]*[1-9][0-9]*\.[0-9]+)|([0-9]*[1-9][0-9]*)))$ </code><br>浮点数<code> ^(-?\d+)(\.\d+)?$</code></p>
]]></content>
      <categories>
        <category>正则</category>
      </categories>
      <tags>
        <tag>正则</tag>
      </tags>
  </entry>
  <entry>
    <title>kibana 认证登录</title>
    <url>/kibana-auth/</url>
    <content><![CDATA[<p><code>Kibana</code>从5.5开始不提供认证功能，用官方的认证<code>X-Pack</code>，则需购买授权许可。</p>
<p>为了安全访问，我们可以使用<code>Nginx</code>的代理功能来认证登录</p>
<span id="more"></span>

<p>安装<code>Nginx</code><br>安装<code>Apache</code>密码生产工具</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">yum install httpd-tools</span><br></pre></td></tr></table></figure>

<p>生成密码文件</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">mkdir -p /etc/nginx/passwd</span><br><span class="line"></span><br><span class="line">htpasswd -c -b /etc/nginx/passwd/kibana.passwd admin 123456</span><br></pre></td></tr></table></figure>

<p>配置<code>Nginx</code></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">vim /usr/<span class="built_in">local</span>/nginx/nginx.conf</span><br></pre></td></tr></table></figure>

<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">  <span class="attribute">listen</span> <span class="number">172.20.8.113:5601</span>;</span><br><span class="line"></span><br><span class="line">  <span class="attribute">auth_basic</span> <span class="string">&quot;Kibana Auth&quot;</span>;</span><br><span class="line">  <span class="attribute">auth_basic_user_file</span> /etc/nginx/passwd/kibana.passwd;</span><br><span class="line"></span><br><span class="line">  <span class="attribute">location</span> / &#123;</span><br><span class="line">    <span class="attribute">proxy_pass</span> http://127.0.0.1:5601;</span><br><span class="line">    <span class="attribute">proxy_redirect</span> <span class="literal">off</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>修改<code>Kibana</code>配置文件</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">vim /usr/<span class="built_in">local</span>/kibana/config/kibana.yml</span><br></pre></td></tr></table></figure>



<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="comment"># The host to bind the server to.</span></span><br><span class="line"></span><br><span class="line">server.host: &quot;localhost&quot;</span><br></pre></td></tr></table></figure>


<p>重启<code>Kibana</code>服务，配置文件生效</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">systemctl restart kibana</span><br></pre></td></tr></table></figure>

<p>重载<code>Nginx</code>配置</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">nginx -s reload</span><br></pre></td></tr></table></figure>

<p>登录<code>Kibana</code><br>URL: <a href="http://172.20.8.113:5601/">http://172.20.8.113:5601</a></p>
]]></content>
      <categories>
        <category>kibana</category>
        <category>nginx</category>
        <category>htpasswd</category>
        <category>auth</category>
      </categories>
      <tags>
        <tag>nginx</tag>
        <tag>kibana</tag>
        <tag>htpasswd</tag>
        <tag>auth</tag>
      </tags>
  </entry>
  <entry>
    <title>mycat 按月分表</title>
    <url>/mycat-single-database-log-table-part-by-month/</url>
    <content><![CDATA[<p>什么是MYCAT<br>•  一个彻底开源的，面向企业应用开发的大数据库集群<br>•  支持事务、ACID、可以替代MySQL的加强版数据库<br>•  一个可以视为MySQL集群的企业级数据库，用来替代昂贵的Oracle集群<br>•  一个融合内存缓存技术、NoSQL技术、HDFS大数据的新型SQL Server<br>•  结合传统数据库和新型分布式数据仓库的新一代企业级数据库产品<br>•  一个新颖的数据库中间件产品</p>
 <span id="more"></span>
<p>Mycat关键特性<br>•  支持SQL92标准<br>•  支持MySQL、Oracle、DB2、SQL Server、PostgreSQL等DB的常见SQL语法<br>•  遵守Mysql原生协议，跨语言，跨平台，跨数据库的通用中间件代理。<br>•  基于心跳的自动故障切换，支持读写分离，支持MySQL主从，以及galera cluster集群。<br>•  支持Galera for MySQL集群，Percona Cluster或者MariaDB cluster<br>•  基于Nio实现，有效管理线程，解决高并发问题。<br>•  支持数据的多片自动路由与聚合，支持sum,count,max等常用的聚合函数,支持跨库分页。<br>•  支持单库内部任意join，支持跨库2表join，甚至基于caltlet的多表join。<br>•  支持通过全局表，ER关系的分片策略，实现了高效的多表join查询。<br>•  支持多租户方案。<br>•  支持分布式事务（弱xa）。<br>•  支持XA分布式事务（1.6.5）。<br>•  支持全局序列号，解决分布式下的主键生成问题。<br>•  分片规则丰富，插件化开发，易于扩展。<br>•  强大的web，命令行监控。<br>•  支持前端作为MySQL通用代理，后端JDBC方式支持Oracle、DB2、SQL Server 、 mongodb 、巨杉。<br>•  支持密码加密<br>•  支持服务降级<br>•  支持IP白名单<br>•  支持SQL黑名单、sql注入攻击拦截<br>•  支持prepare预编译指令（1.6）<br>•  支持非堆内存(Direct Memory)聚合计算（1.6）<br>•  支持PostgreSQL的native协议（1.6）<br>•  支持mysql和oracle存储过程，out参数、多结果集返回（1.6）<br>•  支持zookeeper协调主从切换、zk序列、配置zk化（1.6）<br>•  支持库内分表（1.6）<br>•  集群基于ZooKeeper管理，在线升级，扩容，智能优化，大数据处理（2.0开发版）。<br>一、分表规则<br><code>dm_log</code>和<code>dm_opendoor_record</code>表每年数据量两千万左右，平均每个月两百万左右，mysql单表数据量达到800万时性能出现明显下降，此时需要考虑优化。优先方案考虑优化程序以及sql语句，再优化表结构，最后才是分库分表。<br>自然月分表，每个月分一张表，分表规则定义在<code>MYCAT_HOME/conf/rule.xml</code>中具体如下：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">tableRule</span> <span class="attr">name</span>=<span class="string">&quot;dm_log_sharding-by-date&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">rule</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">columns</span>&gt;</span>logtime<span class="tag">&lt;/<span class="name">columns</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">algorithm</span>&gt;</span>partbymonth<span class="tag">&lt;/<span class="name">algorithm</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">rule</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tableRule</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tableRule</span> <span class="attr">name</span>=<span class="string">&quot;dm_opendoor_record_sharding-by-date&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">rule</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">columns</span>&gt;</span>opertime<span class="tag">&lt;/<span class="name">columns</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">algorithm</span>&gt;</span>partbymonth<span class="tag">&lt;/<span class="name">algorithm</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">rule</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tableRule</span>&gt;</span></span><br></pre></td></tr></table></figure>



<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">function</span> <span class="attr">name</span>=<span class="string">&quot;partbymonth&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">class</span>=<span class="string">&quot;io.mycat.route.function.PartitionByMonth&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dateFormat&quot;</span>&gt;</span>yyyy-MM-dd HH:mm:ss<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;sBeginDate&quot;</span>&gt;</span>2014-01-01 00:00:00<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;sEndDate&quot;</span>&gt;</span>2014-12-31 00:00:00<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">function</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><code>dm_log</code>表按<code>logtime</code>字段根据<code>partbymonth</code>算法分表，<br><code>dm_opendoor_record</code>表按<code>opertime</code>字段根据<code>partbymonth</code>算法分表，<br>算法<code>partbymonth</code>中的<code>dateFormat</code>定义时间格式，在sql语句增删改查中时间需要按照定义格式传入，才能正常执行分表算法。<br>分表名称定义在<code>MYCAT_HOME/conf/schema.xml</code></p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">schema</span> <span class="attr">name</span>=<span class="string">&quot;mt_pm&quot;</span> <span class="attr">checkSQLschema</span>=<span class="string">&quot;false&quot;</span> <span class="attr">sqlMaxLimit</span>=<span class="string">&quot;100&quot;</span> <span class="attr">dataNode</span>=<span class="string">&quot;mt_pm_dn&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">table</span> <span class="attr">name</span>=<span class="string">&quot;dm_log&quot;</span> <span class="attr">primaryKey</span>=<span class="string">&quot;logid&quot;</span> <span class="attr">autoIncrement</span>=<span class="string">&quot;true&quot;</span> <span class="attr">subTables</span>=<span class="string">&quot;dm_log_$1-12&quot;</span> <span class="attr">dataNode</span>=<span class="string">&quot;mt_pm_dn&quot;</span></span></span><br><span class="line"><span class="tag">             <span class="attr">rule</span>=<span class="string">&quot;dm_log_sharding-by-month&quot;</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">table</span> <span class="attr">name</span>=<span class="string">&quot;dm_opendoor_record&quot;</span> <span class="attr">primaryKey</span>=<span class="string">&quot;id&quot;</span> <span class="attr">autoIncrement</span>=<span class="string">&quot;true&quot;</span> <span class="attr">subTables</span>=<span class="string">&quot;dm_opendoor_record_$1-12&quot;</span></span></span><br><span class="line"><span class="tag">             <span class="attr">dataNode</span>=<span class="string">&quot;mt_pm_dn&quot;</span> <span class="attr">rule</span>=<span class="string">&quot;dm_opendoor_record_sharding-by-month&quot;</span>/&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">schema</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>subTables</code>定义了分表的名称：<br>​         <code>dm_log</code>表定义了分表名为<code>dm_log_$1-12</code>，表示分为12张表，表名分别为：<code>dm_log_1、dm_log_2、dm_log_3、dm_log_4、dm_log_5、dm_log_6、dm_log_7、dm_log_8、dm_log_9、dm_log_10、dm_log_11、dm_log_12</code>。<code>logtime</code>为一月份时，根据算法会将数据分配到<code>dm_log_1</code>表，二月份数据插入表<code>dm_log_2</code>，以此类推，到十二月份后的一月份数据又循环插入<code>dm_log_1</code>表。<br>​         <code>dm_opendoor_record</code>表定义了分表名为<code>dm_opendoor_record _$1-12</code>，表示分为12张表，表名分别为：<code>dm_opendoor_record _1、dm_opendoor_record _2、dm_opendoor_record _3、dm_opendoor_record _4、dm_opendoor_record _5、dm_opendoor_record _6、dm_opendoor_record_7、dm_opendoor_record_8、dm_opendoor_record_9、dm_opendoor_record _10、dm_opendoor_record _11、dm_opendoor_record _12</code>。opertime为一月份时，根据算法会将数据分配到dm_opendoor_record _1表，二月份数据插入表<code>dm_opendoor_record_2</code>，以此类推，到十二月份后的一月份数据又循环插入<code>dm_opendoor_record _1</code>表。</p>
<p>二、自增主键<br>原理:<br>​      在数据库中建立一张表，存放 sequence 名称(name)，sequence 当前值(current_value)，步长(increment) int 类型每次读取多少个 sequence，假设为 K)等信息；<br>Sequence 获取步骤：<br>​     1).当初次使用该 sequence 时，根据传入的 sequence 名称，从数据库这张表中读取 current_value，和 increment 到 MyCat 中，并将数据库中的 current_value 设置为原 current_value 值+increment 值；<br>​    2).MyCat 将读取到 current_value+increment 作为本次要使用的 sequence 值，下次使用时，自动加 1，当使用 increment 次后，执行步骤 1)相同的操作.<br>MyCat 负责维护这张表，用到哪些 sequence，只需要在这张表中插入一条记录即可。若某次读取的sequence 没有用完，系统就停掉了，则这次读取的 sequence 剩余值不会再使用。<br>配置方式：<br><code>MYCAT_HOME/conf/server.xml</code> 配置：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">system</span>&gt;</span><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;sequnceHandlerType&quot;</span>&gt;</span>1<span class="tag">&lt;/<span class="name">property</span>&gt;</span><span class="tag">&lt;/<span class="name">system</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>注：sequnceHandlerType 需要配置为 1，表示使用数据库方式生成 sequence.<br><code>MYCAT_HOME/conf/schema.xml</code>配置：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">schema</span> <span class="attr">name</span>=<span class="string">&quot;mt_pm&quot;</span> <span class="attr">checkSQLschema</span>=<span class="string">&quot;false&quot;</span> <span class="attr">sqlMaxLimit</span>=<span class="string">&quot;100&quot;</span> <span class="attr">dataNode</span>=<span class="string">&quot;mt_pm_dn&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">table</span> <span class="attr">name</span>=<span class="string">&quot;dm_log&quot;</span> <span class="attr">primaryKey</span>=<span class="string">&quot;logid&quot;</span> <span class="attr">autoIncrement</span>=<span class="string">&quot;true&quot;</span> <span class="attr">subTables</span>=<span class="string">&quot;dm_log_$1-12&quot;</span> <span class="attr">dataNode</span>=<span class="string">&quot;mt_pm_dn&quot;</span></span></span><br><span class="line"><span class="tag">             <span class="attr">rule</span>=<span class="string">&quot;dm_log_sharding-by-month&quot;</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">table</span> <span class="attr">name</span>=<span class="string">&quot;dm_opendoor_record&quot;</span> <span class="attr">primaryKey</span>=<span class="string">&quot;id&quot;</span> <span class="attr">autoIncrement</span>=<span class="string">&quot;true&quot;</span> <span class="attr">subTables</span>=<span class="string">&quot;dm_opendoor_record_$1-12&quot;</span></span></span><br><span class="line"><span class="tag">             <span class="attr">dataNode</span>=<span class="string">&quot;mt_pm_dn&quot;</span> <span class="attr">rule</span>=<span class="string">&quot;dm_opendoor_record_sharding-by-month&quot;</span>/&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">schema</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>在table节点配置<code>primaryKey</code>和<code>autoIncrement</code>，<code>primaryKey</code>为自增主键，<code>autoIncrement</code>值为<code>ture</code>。</p>
<p>数据库配置：</p>
<ol>
<li>创建 <code>MYCAT_SEQUENCE</code> 表<br>– 创建存放 <code>sequence</code> 的表</li>
</ol>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> MYCAT_SEQUENCE;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> MYCAT_SEQUENCE (name <span class="type">VARCHAR</span>(<span class="number">50</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,current_value <span class="type">INT</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span>,increment <span class="type">INT</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="number">100</span>, <span class="keyword">PRIMARY</span> KEY(name)) ENGINE<span class="operator">=</span>InnoDB;</span><br></pre></td></tr></table></figure>

<ol>
<li><p> <code>name</code> sequence 名称</p>
</li>
<li><p> <code>current_value</code> 当前 value</p>
</li>
<li><p> <code>increment</code> 增长步长，可理解为 mycat 在数据库中一次读取多少个 sequence， 当这些用完后, 下次再从数据库中读取。</p>
</li>
</ol>
<p>– 插入sequence</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `mycat_sequence` (`name`, `current_value`, `increment`) <span class="keyword">VALUES</span> (<span class="string">&#x27;dm_log&#x27;</span>, <span class="string">&#x27;152509809922444&#x27;</span>, <span class="string">&#x27;1000&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `mycat_sequence` (`name`, `current_value`, `increment`) <span class="keyword">VALUES</span> (<span class="string">&#x27;dm_opendoor_record&#x27;</span>, <span class="string">&#x27;58733280&#x27;</span>, <span class="string">&#x27;1000&#x27;</span>); </span><br></pre></td></tr></table></figure>

<ol start="2">
<li>创建相关 <code>function</code></li>
</ol>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">–<span class="operator">-</span> 获取当前 sequence 的值 (返回当前值,增量)</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">FUNCTION</span> IF <span class="keyword">EXISTS</span> mycat_seq_currval;</span><br><span class="line">DELIMITER</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">FUNCTION</span> mycat_seq_currval(seq_name <span class="type">VARCHAR</span>(<span class="number">50</span>)) <span class="keyword">RETURNS</span> <span class="type">varchar</span>(<span class="number">64</span>) CHARSET utf<span class="number">-8</span></span><br><span class="line"><span class="keyword">DETERMINISTIC</span></span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line"><span class="keyword">DECLARE</span> retval <span class="type">VARCHAR</span>(<span class="number">64</span>);</span><br><span class="line"><span class="keyword">SET</span> retval<span class="operator">=</span>“<span class="number">-999999999</span>,<span class="keyword">null</span>” ;</span><br><span class="line"><span class="keyword">SELECT</span> concat(<span class="built_in">CAST</span>(current_value <span class="keyword">AS</span> <span class="type">CHAR</span>),“,” ,<span class="built_in">CAST</span>(increment <span class="keyword">AS</span> <span class="type">CHAR</span>)) <span class="keyword">INTO</span> retval <span class="keyword">FROM</span></span><br><span class="line">MYCAT_SEQUENCE <span class="keyword">WHERE</span> name <span class="operator">=</span> seq_name;</span><br><span class="line"><span class="keyword">RETURN</span> retval;</span><br><span class="line"><span class="keyword">END</span></span><br><span class="line">DELIMITER;</span><br><span class="line">–<span class="operator">-</span> 设置 sequence 值</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">FUNCTION</span> IF <span class="keyword">EXISTS</span> mycat_seq_setval;</span><br><span class="line">DELIMITER</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">FUNCTION</span> mycat_seq_setval(seq_name <span class="type">VARCHAR</span>(<span class="number">50</span>),<span class="keyword">value</span> <span class="type">INTEGER</span>) <span class="keyword">RETURNS</span> <span class="type">varchar</span>(<span class="number">64</span>)</span><br><span class="line">CHARSET utf<span class="number">-8</span></span><br><span class="line"><span class="keyword">DETERMINISTIC</span></span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">UPDATE MYCAT_SEQUENCE</span><br><span class="line"><span class="keyword">SET</span> current_value <span class="operator">=</span> <span class="keyword">value</span></span><br><span class="line"><span class="keyword">WHERE</span> name <span class="operator">=</span> seq_name;</span><br><span class="line"><span class="keyword">RETURN</span> mycat_seq_currval(seq_name);</span><br><span class="line"><span class="keyword">END</span></span><br><span class="line">DELIMITER;</span><br><span class="line">–<span class="operator">-</span> 获取下一个 sequence 值</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">FUNCTION</span> IF <span class="keyword">EXISTS</span> mycat_seq_nextval;</span><br><span class="line">DELIMITER</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">FUNCTION</span> mycat_seq_nextval(seq_name <span class="type">VARCHAR</span>(<span class="number">50</span>)) <span class="keyword">RETURNS</span> <span class="type">varchar</span>(<span class="number">64</span>) CHARSET utf<span class="number">-8</span></span><br><span class="line"><span class="keyword">DETERMINISTIC</span></span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">UPDATE MYCAT_SEQUENCE <span class="keyword">SET</span> current_value <span class="operator">=</span> current_value <span class="operator">+</span> increment <span class="keyword">WHERE</span> name <span class="operator">=</span> seq_name;</span><br><span class="line"><span class="keyword">RETURN</span> mycat_seq_currval(seq_name);</span><br><span class="line"><span class="keyword">END</span></span><br><span class="line">DELIMITER;</span><br></pre></td></tr></table></figure>

<ol start="4">
<li><code>sequence_db_conf.properties</code> 相关配置,指定 sequence 相关配置在哪个节点上：<br>例如：</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">DM_LOG=mt_pm_dn</span><br><span class="line">DM_OPENDOOR_RECORD=mt_pm_dn</span><br></pre></td></tr></table></figure>

<p>注意：MYCAT_SEQUENCE 表和以上的 3 个 function，需要放在同一个节点上。 function 请直接在具体节<br>点的数据库上执行，如果执行的时候报：<br><code>you might want to use the less safe log_bin_trust_function_creators variable</code><br>需要对数据库做如下设置：<br>windows 下 <code>my.ini[mysqld]</code>加上 <code>log_bin_trust_function_creators=1</code><br>linux 下<code>/etc/my.cnf</code> 下 <code>my.ini[mysqld]</code>加上 <code>log_bin_trust_function_creators=1</code><br>修改完后，即可在 mysql 数据库中执行上面的函数.<br>使用示例：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `mt_pm`.`dm_log` (`logid`, `deviceid`, `logtype`, `logtime`, `content`, `picurl`, `id`, `positionid`, `position`, `comid`, `launchposition`, `status`) <span class="keyword">VALUES</span> (next <span class="keyword">value</span> <span class="keyword">for</span> MYCATSEQ_DM_LOG, <span class="string">&#x27;af0f69db62-4d31-d4e2-c041-793ed33931&#x27;</span>, <span class="string">&#x27;unlock&#x27;</span>, <span class="string">&#x27;2018-01-01 08:01:39&#x27;</span>, <span class="string">&#x27;3|0e3f6740|1&#x27;</span>, <span class="keyword">NULL</span>, <span class="keyword">NULL</span>, <span class="keyword">NULL</span>, <span class="keyword">NULL</span>, <span class="keyword">NULL</span>, <span class="keyword">NULL</span>, <span class="keyword">NULL</span>);</span><br></pre></td></tr></table></figure>

<p>或者不带主键</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `mt_pm`.`dm_log` (`deviceid`, `logtype`, `logtime`, `content`, `picurl`, `id`, `positionid`, `position`, `comid`, `launchposition`, `status`) <span class="keyword">VALUES</span> (<span class="string">&#x27;af0f69db62-4d31-d4e2-c041-793ed33931&#x27;</span>, <span class="string">&#x27;unlock&#x27;</span>, <span class="string">&#x27;2018-01-01 08:01:39&#x27;</span>, <span class="string">&#x27;3|0e3f6740|1&#x27;</span>, <span class="keyword">NULL</span>, <span class="keyword">NULL</span>, <span class="keyword">NULL</span>, <span class="keyword">NULL</span>, <span class="keyword">NULL</span>, <span class="keyword">NULL</span>, <span class="keyword">NULL</span>);</span><br></pre></td></tr></table></figure>

<p>三、定期备份表数据<br>​    分为12张表后，每年循环插入数据，最终数据量越来越大，需要定期将历史数据备份或迁移。这里采用修改表名，再新建和原表名结构一样的新表。例如：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">ALTER</span>  <span class="keyword">TABLE</span> dm_log_1 RENAME <span class="keyword">TO</span> dm_log201801;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> IF <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> dm_log_1 <span class="keyword">LIKE</span> dm_log201801;</span><br></pre></td></tr></table></figure>

<p>​    备份dm_log_1的数据，假设dm_log_1存的都是2018年1月份数据，则把表名修改为dm_log201801，然后再吉安一张表名为dm_log_1的表。<br>​    上述操作在数据库中写成存储过程，通过数据库定时事件调用执行，详细请看附件中相关sql语句。</p>
<p>定时事件调用策略：</p>
<pre><code>    每月1日的凌晨3:30执行备份历史数据，例如:2018年7月1日凌晨3:30把表dm_log_1改为dm_log201801并新建表dm_log_1，2018年8月1日凌晨3:30把表dm_log_2改为dm_log201802并新建表dm_log_2，以此类推，保留最近半年的数据供物管系统页面查询，超过半年数据则需通过数据库查询历史数据。
    rename_dm_log_history为备份dm_log表数据的存储过程，Event_Rename_dm_log_history为定时事件每月调用rename_dm_log_history备份数据。
</code></pre>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">   每月1日的凌晨3:30执行备份历史数据，例如:2018年7月1日凌晨3:30把表`dm_opendoor_record_1`改为dm_opendoor_record201801并新建表dm_opendoor_record_1，2018年8月1日凌晨3:30把表dm_opendoor_record_2改为dm_opendoor_record201802并新建表dm_opendoor_record_2，以此类推，保留最近半年的数据供物管系统页面查询，超过半年数据则需通过数据库查询历史数据。</span><br><span class="line">rename_dm_opendoor_record_history为备份dm_opendoor_record表数据的存储过程，Event_Rename_dm_opendoor_record_history为定时事件每月调用rename_dm_log_history备份数据。</span><br></pre></td></tr></table></figure>

<p>四、附件<br>1.相关sql语句</p>
<p>2.mycat<br>​<br>五、参考资料<br>Mycat官网：<a href="http://www.mycat.io/">http://www.mycat.io/</a><br>Mycat权威指南：<a href="http://www.mycat.io/document/Mycat_V1.6.0.pdf">http://www.mycat.io/document/Mycat_V1.6.0.pdf</a></p>
]]></content>
      <categories>
        <category>mysql</category>
        <category>mycat</category>
        <category>subtable</category>
        <category>partbymonth</category>
      </categories>
      <tags>
        <tag>mysql</tag>
        <tag>mycat</tag>
        <tag>subtable</tag>
        <tag>partbymonth</tag>
      </tags>
  </entry>
  <entry>
    <title>wget参数使用参考</title>
    <url>/wget-use/</url>
    <content><![CDATA[<p><code>wget</code>是一个从网络上自动下载文件的自由工具。它支持<code>HTTP</code>，<code>HTTPS</code>和<code>FTP</code>协议，可以使用<code>HTTP</code>代理. 所谓的自动下载是指，<code>wget</code>可以在用户退出系统的之后在后台执行。这意味这你可以登录系统，启动一个<code>wget</code>下载任务，然后退出系统，<code>wget</code>将在后台执行直到任务完成，相对于其它大部分浏览器在下载大量数据时需要用户一直的参与，这省去了极大的麻烦。 </p>
<span id="more"></span>
<p>​      <code>wget</code> 可以跟踪<code>HTML</code>页面上的链接依次下载来创建远程服务器的本地版本，完全重建原始站点的目录结构。这又常被称作”递归下载”。在递归下载的时候，<code>wget</code> 遵循<code>Robot Exclusion</code>标准(<code>/robots.txt</code>)。<code>wget</code>可以在下载的同时，将链接转换成指向本地文件，以方便离线浏览。 </p>
<p>​      <code>wget</code> 非常稳定,它在带宽很窄的情况下和不稳定网络中有很强的适应性.如果是由于网络的原因下载失败，wget会不断的尝试，直到整个文件下载完毕。如果是服务 器打断下载过程，它会再次联到服务器上从停止的地方继续下载。这对从那些限定了链接时间的服务器上下载大文件非常有用。</p>
<p><code>wget</code>的常见用法：</p>
<p><code>wget</code>不但功能强大，而且使用起来比较简单</p>
<p>基本的语法是：<code>wget [参数列表] &quot;URL&quot;</code> 用””引起来可以避免因<code>URL</code>中有特殊字符造成的下载出错。</p>
<p>下面就结合具体的例子来说明一下<code>wget</code>的用法。</p>
<p>​     1、下载整个<code>http</code>或者<code>ftp</code>站点。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">wget http://place.your.url/here</span><br></pre></td></tr></table></figure>

<p>  这个命令可以将<code>http://place.your.url/here</code>首页下载下来。使用-x会强制建立服务器上一模一样的目录，如果使用<code>-nd</code>参数，那么服务器上下载的所有内容都会加到本地当前目录。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">wget -r http://place.your.url/here</span><br></pre></td></tr></table></figure>


<p>​     这个命令会按照递归的方法，下载服务器上所有的目录和文件，实质就是下载整个网站。这个命令一定要小心使用，因为在下载的时候，被下载网站指向的所有地址 同样会被下载，因此，如果这个网站引用了其他网站，那么被引用的网站也会被下载下来！基于这个原因，这个参数不常用。可以用<code>-l number</code>参数来指定下载的层次。例如只下载两层，那么使用<code>-l 2</code>。</p>
<p>​     要是您想制作镜像站点，那么可以使用－m参数，例如：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">wget -m http://place.your.url/here</span><br></pre></td></tr></table></figure>


<p>​     这时wget会自动判断合适的参数来制作镜像站点。此时，wget会登录到服务器上，读入<code>robots.txt</code>并按<code>robots.txt</code>的规定来执行。</p>
<p>​     2、断点续传。<br>​     当文件特别大或者网络特别慢的时候，往往一个文件还没有下载完，连接就已经被切断，此时就需要断点续传。<code>wget</code>的断点续传是自动的，只需要使用<code>-c</code>参数，例如：<br>​    </p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">wget -c http://the.url.of/incomplete/file</span><br></pre></td></tr></table></figure>

<p>​     使用断点续传要求服务器支持断点续传。<code>-t</code>参数表示重试次数，例如需要重试100次，那么就写-<code>t 100</code>，如果设成<code>-t 0</code>，那么表示无穷次重试，直到连接成功。<code>-T</code>参数表示超时等待时间，例如<code>-T 120</code>，表示等待120秒连接不上就算超时。</p>
<p>​     3、批量下载。<br>​     如果有多个文件需要下载，那么可以生成一个文件，把每个文件的URL写一行，例如生成文件<code>download.txt</code>，然后用命令：<code>wget -i download.txt</code><br>这样就会把<code>download.txt</code>里面列出的每个<code>URL</code>都下载下来。（如果列的是文件就下载文件，如果列的是网站，那么下载首页）</p>
<p>​     4、选择性的下载。<br>​     可以指定让<code>wget</code>只下载一类文件，或者不下载什么文件。例如： </p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">wget -m --reject=gif http://target.web.site/subdirectory</span><br></pre></td></tr></table></figure>

<p>​     表示下载<code>http://target.web.site/subdirector</code>y，但是忽略gif文件。<code>--accept=LIST</code>可以接受的文件类型，<code>--reject=LIST</code>拒绝接受的文件类型。</p>
<p>​     表示下载<code>http://target.web.site/subdirectory</code>，但是忽略gif文件。–accept=LIST 可以接受的文件类型，–reject=LIST拒绝接受的文件类型。</p>
<p>​     5、密码和认证。<br>​     wget只能处理利用用户名/密码方式限制访问的网站，可以利用两个参数：<br>​    <code>--http-user=USER</code>设置HTTP用户<br>​    <code>--http-passwd=PASS</code>设置HTTP密码<br>​     对于需要证书做认证的网站，就只能利用其他下载工具了，例如<code>curl</code>。</p>
<p>​     6、利用代理服务器进行下载。<br>​     如果用户的网络需要经过代理服务器，那么可以让<code>wget</code>通过代理服务器进行文件的下载。此时需要在当前用户的目录下创建一个<code>.wgetrc</code>文件。文件中可以设置代理服务器： </p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line">http-<span class="attribute">proxy</span> = <span class="number">111.111.111.111:8080</span> </span><br><span class="line">ftp-proxy = <span class="number">111.111.111.111:8080</span> </span><br></pre></td></tr></table></figure>

<p>​     分别表示<code>http</code>的代理服务器和<code>ftp</code>的代理服务器。如果代理服务器需要密码则使用：<br>​    <code>--proxy-user=USER</code>设置代理用户<br>​    <code>--proxy-passwd=PASS</code>设置代理密码<br>​     这两个参数。<br>​     使用参数<code>--proxy=on/off 使</code>用或者关闭代理。<br>​    <code>wget</code>还有很多有用的功能，需要用户去挖掘。</p>
<p>​     分别表示<code>http</code>的代理服务器和<code>ftp</code>的代理服务器。如果代理服务器需要密码则使用：<br>​    <code>--proxy-user=USER</code>设置代理用户<br>​    <code>--proxy-passwd=PASS</code>设置代理密码<br>​     这两个参数。<br>​     使用参数–proxy=on/off 使用或者关闭代理。<br>​     wget还有很多有用的功能，需要用户去挖掘。</p>
<p><code>wget</code>的使用格式</p>
<p><code>Usage: wget [OPTION]... [URL]...</code></p>
<ul>
<li>用wget做站点镜像:</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">wget -r -p -np -k http://dsec.pku.edu.cn/~usr_name/</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 或者</span></span><br><span class="line">wget -m http://dsec.pku.edu.cn/~usr_name/</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 在不稳定的网络上下载一个部分下载的文件，以及在空闲时段下载</span></span><br><span class="line">wget -t 0 -w 31 -c http://dsec.pku.edu.cn/BBC.avi -o down.log &amp;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 或者从filelist读入要下载的文件列表</span></span><br><span class="line">wget -t 0 -w 31 -c -B ftp://dsec.pku.edu.cn/linuxsoft -i filelist.txt -o down.log &amp;</span><br></pre></td></tr></table></figure>

<p>上面的代码还可以用来在网络比较空闲的时段进行下载。我的用法是:在<code>mozilla</code>中将不方便当时下载的<code>URL</code>链接拷贝到内存中然后粘贴到文件<code>filelist.txt</code>中，在晚上要出去系统前执行上面代码的第二条。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 使用代理下载</span></span><br><span class="line">wget -Y on -p -k https://sourceforge.net/projects/wvware/</span><br></pre></td></tr></table></figure>

<p>代理可以在环境变量或<code>wgetrc</code>文件中设定</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 在环境变量中设定代理</span></span><br><span class="line">export PROXY=http://211.90.168.94:8080/</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 在~/.wgetrc中设定代理</span></span><br><span class="line">http_proxy = http://proxy.yoyodyne.com:18023/</span><br><span class="line">ftp_proxy = http://proxy.yoyodyne.com:18023/</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><code>wget</code>各种选项分类列表</p>
<ul>
<li>启动</li>
</ul>
<p><code>-V, --version</code>            显示<code>wget</code>的版本后退出</p>
<p><code>-h,      --help</code>               打印语法帮助</p>
<p><code>-b,      --background</code>         启动后转入后台执行</p>
<p><code>-e,      --execute=COMMAND</code>    执行``.wgetrc’<code>格式的命令，</code>wgetrc<code>格式参见</code>/etc/wgetrc<code>或</code>~/.wgetrc`</p>
<ul>
<li>记录和输入文件</li>
</ul>
<p><code>-o,      --output-file=FILE</code>      把记录写到<code>FILE</code>文件中</p>
<p><code>-a,      --append-output=FILE</code>    把记录追加到<code>FILE</code>文件中</p>
<p><code>-d, --debug</code>                 打印调试输出</p>
<p><code>-q,      --quiet</code>                 安静模式(没有输出)</p>
<p><code>-v,      --verbose</code>               冗长模式(这是缺省设置)</p>
<p><code>-nv,    --non-verbose</code>           关掉冗长模式，但不是安静模式</p>
<p><code>-i,       --input-file=FILE</code>       下载在FILE文件中出现的<code>URLs</code></p>
<p><code>-F,      --force-html</code>            把输入文件当作<code>HTML</code>格式文件对待</p>
<p><code>-B,      --base=URL</code>              将<code>URL</code>作为在<code>-F -i</code>参数指定的文件中出现的相对链接的前缀</p>
<p><code>--sslcertfile=FILE</code>      可选客户端证书</p>
<p><code>--sslcertkey=KEYFILE</code>    可选客户端证书的KEYFILE</p>
<p><code>--egd-file=FILE</code>         指定<code>EGD socket</code>的文件名</p>
<ul>
<li>下载</li>
</ul>
<p><code>--bind-address=ADDRESS</code>    指定本地使用地址(主机名或IP，当本地有多个IP或名字时使用)</p>
<p><code>-t,      --tries=NUMBER</code>            设定最大尝试链接次数(0 表示无限制).</p>
<p><code>-O      --output-document=FILE</code>    把文档写到<code>FILE</code>文件中</p>
<p><code>-nc,   --no-clobber</code>              不要覆盖存在的文件或使用.#前缀</p>
<p><code>-c,     --continue</code>                接着下载没下载完的文件</p>
<p><code>--progress=TYPE</code>           设定进程条标记</p>
<p><code>-N, --timestamping</code>            不要重新下载文件除非比本地文件新</p>
<p><code>-S,    --server-response</code>         打印服务器的回应</p>
<p><code>--spider</code>                  不下载任何东西</p>
<p><code>-T, --timeout=SECONDS</code>         设定响应超时的秒数</p>
<p><code>-w,   --wait=SECONDS</code>            两次尝试之间间隔SECONDS秒<code>--waitretry=SECONDS</code>       在重新链接之间等待1…SECONDS秒</p>
<p><code>--random-wait</code>             在下载之间等待0…2*WAIT秒</p>
<p><code>-Y,    --proxy=on/off</code>            打开或关闭代理</p>
<p><code>-Q,   --quota=NUMBER</code>            设置下载的容量限制</p>
<p><code>--limit-rate=RATE</code>         限定下载输率</p>
<ul>
<li>目录</li>
</ul>
<p><code>-nd   --no-directories</code>             不创建目录</p>
<p><code>-x,     --force-directories</code>          强制创建目录</p>
<p><code>-nH, --no-host-directories</code>        不创建主机目录</p>
<p><code>-P,   --directory-prefix=PREFIX</code>    将文件保存到目录 PREFIX/…</p>
<p><code>--cut-dirs=NUMBER</code>            忽略 NUMBER层远程目录</p>
<ul>
<li>HTTP 选项</li>
</ul>
<p><code>--http-user=USER</code>       设定HTTP用户名为 USER.</p>
<p><code>--http-passwd=PASS</code>     设定http密码为 PASS.</p>
<p><code>-C,   --cache=on/off</code>         允许/不允许服务器端的数据缓存 (一般情况下允许).</p>
<p><code>-E,   --html-extension</code>       将所有<code>text/html</code>文档以<code>.html</code>扩展名保存</p>
<p><code>--ignore-length</code>        忽略<code>Content-Length</code>头域</p>
<p><code>--header=STRING</code>      在headers中插入字符串 STRING</p>
<p><code>--proxy-user=USER</code>      设定代理的用户名为<code>USER</code></p>
<p><code>--proxy-passwd=PASS</code>    设定代理的密码为<code>PASS</code></p>
<p><code>--referer=URL</code>          在<code>HTTP</code>请求中包含<code>Referer: URL</code>头</p>
<p><code>-s,   --save-headers</code>         保存<code>HTTP</code>头到文件</p>
<p><code>-U,   --user-agent=AGENT</code>     设定代理的名称为<code>AGENT</code>而不是<code>Wget/VERSION</code>.</p>
<p><code>--no-http-keep-alive</code>   关闭<code>HTTP</code>活动链接 (永远链接).</p>
<p><code>--cookies=off</code>          不使用<code>cookies</code>.</p>
<p><code>--load-cookies=FILE</code>    在开始会话前从文件<code>FILE</code>中加载<code>cookie</code></p>
<p><code>--save-cookies=FILE</code>    在会话结束后将 cookies保存到 FILE文件中</p>
<ul>
<li>FTP 选项</li>
</ul>
<p><code>-nr, --dont-remove-listing</code>    不移走``.listing’`文件</p>
<p><code>-g,   --glob=on/off</code>            打开或关闭文件名的<code>globbing</code>机制</p>
<p><code>--passive-ftp</code>            使用被动传输模式 (缺省值).</p>
<p><code>--active-ftp</code>             使用主动传输模式</p>
<p><code>--retr-symlinks</code>          在递归的时候，将链接指向文件(而不是目录)</p>
<ul>
<li>递归下载</li>
</ul>
<p><code>-r,   --recursive</code>           递归下载－－慎用!</p>
<p><code>-l,   --level=NUMBER</code>        最大递归深度 (inf 或 0 代表无穷).</p>
<p><code>--delete-after</code>        在现在完毕后局部删除文件</p>
<p><code>-k,   --convert-links</code>       转换非相对链接为相对链接</p>
<p><code>-K,   --backup-converted</code>    在转换文件X之前，将之备份为<code>X.orig</code></p>
<p><code>-m,   --mirror</code>              等价于<code>-r -N -l inf -nr</code>.</p>
<p><code>-p,   --page-requisites</code>     下载显示<code>HTML</code>文件的所有图片</p>
<ul>
<li>递归下载中的包含和不包含(accept/reject)</li>
</ul>
<p><code>-A,   --accept=LIST</code>                 分号分隔的被接受扩展名的列表</p>
<p><code>-R,   --reject=LIST</code>                 分号分隔的不被接受的扩展名的列表</p>
<p><code>-D,   --domains=LIST</code>                分号分隔的被接受域的列表</p>
<p><code>--exclude-domains=LIS</code>T        分号分隔的不被接受的域的列表</p>
<p><code>--follow-ftp</code>                  跟踪HTML文档中的FTP链接</p>
<p><code>--follow-tags=LIST</code>            分号分隔的被跟踪的HTML标签的列表</p>
<p><code>-G,   --ignore-tags=LIST</code>            分号分隔的被忽略的HTML标签的列表</p>
<p><code>-H,    --span-hosts</code>                  当递归时转到外部主机</p>
<p><code>-L,    --relative</code>                    仅仅跟踪相对链接</p>
<p><code>-I,     --include-directories=LIST</code>    允许目录的列表</p>
<p><code>-X,   --exclude-directories=LIST</code>    不被包含目录的列表</p>
<p><code>-np, --no-parent</code>                   不要追溯到父目录</p>
<p><code>wget -S --spider url</code> 不下载只显示过程</p>
]]></content>
      <categories>
        <category>wget</category>
        <category>linux</category>
      </categories>
      <tags>
        <tag>wget</tag>
      </tags>
  </entry>
  <entry>
    <title>CentOS 7 安装 MySQL 5.7</title>
    <url>/CentOS-7-install-MySQL-5-7/</url>
    <content><![CDATA[<p>CentOS 7 安装MySQL5.7</p>
<h1 id="一、安装包下载"><a href="#一、安装包下载" class="headerlink" title="一、安装包下载"></a>一、安装包下载</h1><p>下载地址：<a href="https://dev.mysql.com/downloads/mysql/5.6.html#downloads">https://dev.mysql.com/downloads/mysql/5.6.html#downloads</a></p>
<p>国内可以使用163镜像加速下载：<a href="http://mirrors.163.com/mysql/Downloads/MySQL-5.7/">http://mirrors.163.com/mysql/Downloads/MySQL-5.7/</a></p>
<p>选择相应的平台和版本下载</p>
<span id="more"></span>

<h1 id="二、安装"><a href="#二、安装" class="headerlink" title="二、安装"></a>二、安装</h1><h2 id="1-将下载好的安装到解压到-usr-local目录下"><a href="#1-将下载好的安装到解压到-usr-local目录下" class="headerlink" title="1.将下载好的安装到解压到/usr/local目录下"></a>1.将下载好的安装到解压到/usr/local目录下</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">tar -zxvf mysql-5.7.26-linux-glibc2.12-x86_64.tar.gz -C /usr/local/</span><br></pre></td></tr></table></figure>

<h2 id="2-进入-usr-local目录"><a href="#2-进入-usr-local目录" class="headerlink" title="2.进入/usr/local目录"></a>2.进入/usr/local目录</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cd /usr/local/</span><br></pre></td></tr></table></figure>

<h2 id="3-为mysql安装目录创建软链接"><a href="#3-为mysql安装目录创建软链接" class="headerlink" title="3.为mysql安装目录创建软链接"></a>3.为mysql安装目录创建软链接</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ln -s mysql-5.7.26-linux-glibc2.12-x86_64 mysql</span><br></pre></td></tr></table></figure>

<h2 id="4-为centos添加mysql用户组和mysql用户-s-bin-false参数指定mysql用户仅拥有所有权，而没有登录权限"><a href="#4-为centos添加mysql用户组和mysql用户-s-bin-false参数指定mysql用户仅拥有所有权，而没有登录权限" class="headerlink" title="4.为centos添加mysql用户组和mysql用户(-s /bin/false参数指定mysql用户仅拥有所有权，而没有登录权限)"></a>4.为centos添加mysql用户组和mysql用户(-s /bin/false参数指定mysql用户仅拥有所有权，而没有登录权限)</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">groupadd mysql</span><br><span class="line">useradd -r -g mysql -s /bin/false mysql</span><br></pre></td></tr></table></figure>

<h2 id="5-进入安装mysql软件的目录，命令如下"><a href="#5-进入安装mysql软件的目录，命令如下" class="headerlink" title="5.进入安装mysql软件的目录，命令如下"></a>5.进入安装mysql软件的目录，命令如下</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cd /usr/local/mysql</span><br></pre></td></tr></table></figure>

<h2 id="6-修改当前目录拥有者为新建的mysql用户，命令如下："><a href="#6-修改当前目录拥有者为新建的mysql用户，命令如下：" class="headerlink" title="6.修改当前目录拥有者为新建的mysql用户，命令如下："></a>6.修改当前目录拥有者为新建的mysql用户，命令如下：</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">chown -R mysql:mysql ./</span><br></pre></td></tr></table></figure>

<h2 id="7-安装mysql，命令如下："><a href="#7-安装mysql，命令如下：" class="headerlink" title="7.安装mysql，命令如下："></a>7.安装mysql，命令如下：</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">./bin/mysqld --user=mysql --basedir=/usr/local/mysql --datadir=/usr/local/mysql/data --initialize</span><br></pre></td></tr></table></figure>

<p>可能会出现如下错误</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">./bin/mysqld: error while loading shared libraries: libaio.so.1: cannot open shared object file: No such file or directory</span><br></pre></td></tr></table></figure>

<p>解决方法</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"> yum install -y libaio</span><br><span class="line">Loaded plugins: fastestmirror</span><br><span class="line">Determining fastest mirrors</span><br><span class="line">base                                                                                                                                                            | 3.6 kB  00:00:00     </span><br><span class="line">epel                                                                                                                                                            | 5.3 kB  00:00:00     </span><br><span class="line">extras                                                                                                                                                          | 3.4 kB  00:00:00     </span><br><span class="line">updates                                                                                                                                                         | 3.4 kB  00:00:00     </span><br><span class="line">(1/4): epel/x86_64/updateinfo                                                                                                                                   | 977 kB  00:00:00     </span><br><span class="line">(2/4): extras/7/x86_64/primary_db                                                                                                                               | 200 kB  00:00:00     </span><br><span class="line">(3/4): updates/7/x86_64/primary_db                                                                                                                              | 5.7 MB  00:00:00     </span><br><span class="line">(4/4): epel/x86_64/primary_db                                                                                                                                   | 6.7 MB  00:00:00     </span><br><span class="line">Resolving Dependencies</span><br><span class="line"><span class="meta">--&gt;</span><span class="bash"> Running transaction check</span></span><br><span class="line"><span class="meta">---&gt;</span><span class="bash"> Package libaio.x86_64 0:0.3.109-13.el7 will be installed</span></span><br><span class="line"><span class="meta">--&gt;</span><span class="bash"> Finished Dependency Resolution</span></span><br><span class="line"></span><br><span class="line">Dependencies Resolved</span><br><span class="line"></span><br><span class="line">=======================================================================================================================================================================================</span><br><span class="line"> Package                                   Arch                                      Version                                             Repository                               Size</span><br><span class="line">=======================================================================================================================================================================================</span><br><span class="line">Installing:</span><br><span class="line"> libaio                                    x86_64                                    0.3.109-13.el7                                      base                                     24 k</span><br><span class="line"></span><br><span class="line">Transaction Summary</span><br><span class="line">=======================================================================================================================================================================================</span><br><span class="line">Install  1 Package</span><br><span class="line"></span><br><span class="line">Total download size: 24 k</span><br><span class="line">Installed size: 38 k</span><br><span class="line">Downloading packages:</span><br><span class="line">libaio-0.3.109-13.el7.x86_64.rpm                                                                                                                                |  24 kB  00:00:00     </span><br><span class="line">Running transaction check</span><br><span class="line">Running transaction test</span><br><span class="line">Transaction test succeeded</span><br><span class="line">Running transaction</span><br><span class="line">  Installing : libaio-0.3.109-13.el7.x86_64                                                                                                                                        1/1 </span><br><span class="line">  Verifying  : libaio-0.3.109-13.el7.x86_64                                                                                                                                        1/1 </span><br><span class="line"></span><br><span class="line">Installed:</span><br><span class="line">  libaio.x86_64 0:0.3.109-13.el7                                                                                                                                                       </span><br><span class="line"></span><br><span class="line">Complete!</span><br></pre></td></tr></table></figure>

<p>如果出现如下所示则为安装成功</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">2019-05-20T14:14:00.607305Z 0 [Warning] InnoDB: New log files created, LSN=45790</span><br><span class="line">2019-05-20T14:14:00.643051Z 0 [Warning] InnoDB: Creating foreign key constraint system tables.</span><br><span class="line">2019-05-20T14:14:00.833733Z 0 [Warning] No existing UUID has been found, so we assume that this is the first time that this server has been started. Generating a new UUID: 83d6fb34-7b09-11e9-96b7-000c2932f18d.</span><br><span class="line">2019-05-20T14:14:00.892413Z 0 [Warning] Gtid table is not ready to be used. Table &#x27;mysql.gtid_executed&#x27; cannot be opened.</span><br><span class="line">2019-05-20T14:14:00.893234Z 1 [Note] A temporary password is generated for root@localhost: sBN18?Wq&amp;&gt;&gt;I</span><br><span class="line">2019-05-20T14:14:01.309353Z 1 [Warning] &#x27;user&#x27; entry &#x27;root@localhost&#x27; ignored in --skip-name-resolve mode.</span><br><span class="line">2019-05-20T14:14:01.309376Z 1 [Warning] &#x27;user&#x27; entry &#x27;mysql.session@localhost&#x27; ignored in --skip-name-resolve mode.</span><br><span class="line">2019-05-20T14:14:01.309382Z 1 [Warning] &#x27;user&#x27; entry &#x27;mysql.sys@localhost&#x27; ignored in --skip-name-resolve mode.</span><br><span class="line">2019-05-20T14:14:01.309392Z 1 [Warning] &#x27;db&#x27; entry &#x27;performance_schema mysql.session@localhost&#x27; ignored in --skip-name-resolve mode.</span><br><span class="line">2019-05-20T14:14:01.309395Z 1 [Warning] &#x27;db&#x27; entry &#x27;sys mysql.sys@localhost&#x27; ignored in --skip-name-resolve mode.</span><br><span class="line">2019-05-20T14:14:01.309400Z 1 [Warning] &#x27;proxies_priv&#x27; entry &#x27;@ root@localhost&#x27; ignored in --skip-name-resolve mode.</span><br><span class="line">2019-05-20T14:14:01.309416Z 1 [Warning] &#x27;tables_priv&#x27; entry &#x27;user mysql.session@localhost&#x27; ignored in --skip-name-resolve mode.</span><br><span class="line">2019-05-20T14:14:01.309420Z 1 [Warning] &#x27;tables_priv&#x27; entry &#x27;sys_config mysql.sys@localhost&#x27; ignored in --skip-name-resolve mode.</span><br></pre></td></tr></table></figure>

<p>其实已经生成了root的临时账号：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">A temporary password is generated for root@localhost: sBN18?Wq&amp;&gt;&gt;I</span><br></pre></td></tr></table></figure>

<h2 id="8-开启mysql服务，命令如下："><a href="#8-开启mysql服务，命令如下：" class="headerlink" title="8.开启mysql服务，命令如下："></a>8.开启mysql服务，命令如下：</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">./support-files/mysql.server start</span><br></pre></td></tr></table></figure>


<p>如果出现文件不存在错误，则说明mysql配置文件/etc/my.cnf中的路径不对，修改内容如下，datadir和socket都修改成mysql的安装目录下，增加[client]板块，用于命令行连接mysql数据库。</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="comment">#在etc下新建配置文件my.cnf，并在该文件内添加以下配置</span></span><br><span class="line"><span class="section">[mysql]</span></span><br><span class="line"><span class="comment"># 设置mysql客户端默认字符集</span></span><br><span class="line"><span class="attr">default-character-set</span>=utf8mb4 </span><br><span class="line"><span class="section">[mysqld]</span></span><br><span class="line">skip-name-resolve</span><br><span class="line"><span class="comment">#skip-grant-tables</span></span><br><span class="line"><span class="comment">#设置3306端口</span></span><br><span class="line"><span class="attr">port</span> = <span class="number">3306</span> </span><br><span class="line"><span class="comment"># 设置mysql的安装目录</span></span><br><span class="line"><span class="attr">basedir</span>=/usr/local/mysql</span><br><span class="line"><span class="comment"># 设置mysql数据库的数据的存放目录</span></span><br><span class="line"><span class="attr">datadir</span>=/usr/local/mysql/data</span><br><span class="line"><span class="comment"># 允许最大连接数</span></span><br><span class="line"><span class="attr">max_connections</span>=<span class="number">200</span></span><br><span class="line"><span class="comment"># 设置忽略大小写</span></span><br><span class="line"><span class="attr">lower_case_table_names</span> = <span class="number">1</span></span><br><span class="line"><span class="comment"># 服务端使用的字符集默认为8比特编码的latin1字符集</span></span><br><span class="line"><span class="comment"># 指定编码</span></span><br><span class="line"><span class="attr">character-set-client-handshake</span>=<span class="literal">FALSE</span> </span><br><span class="line"><span class="attr">character-set-server</span>=utf8mb4</span><br><span class="line"><span class="attr">collation-server</span>=utf8mb4_unicode_ci</span><br><span class="line"><span class="attr">init_connect</span>=<span class="string">&#x27;SET NAMES utf8mb4&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 开启ip绑定</span></span><br><span class="line"><span class="attr">bind-address</span> = <span class="number">0.0</span>.<span class="number">0.0</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># 创建新表时将使用的默认存储引擎</span></span><br><span class="line"><span class="attr">default-storage-engine</span>=INNODB </span><br><span class="line"><span class="attr">lower_case_table_names</span>=<span class="number">1</span></span><br><span class="line"><span class="attr">max_allowed_packet</span>=<span class="number">16</span>M</span><br><span class="line"></span><br><span class="line"><span class="comment"># 主从复制配置</span></span><br><span class="line"><span class="attr">gtid_mode</span> = <span class="literal">on</span></span><br><span class="line"><span class="attr">enforce_gtid_consistency</span> = <span class="number">1</span></span><br><span class="line"><span class="attr">binlog_gtid_simple_recovery</span> = <span class="number">1</span></span><br><span class="line"><span class="attr">relay_log_recovery</span> = <span class="literal">ON</span></span><br><span class="line"><span class="attr">master_info_repository</span> = TABLE</span><br><span class="line"><span class="attr">relay_log_info_repository</span> = TABLE</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="section">[mysqld_safe]</span></span><br><span class="line"><span class="attr">log-error</span>=/var/log/mysql/mysqld.log</span><br><span class="line"><span class="attr">pid-file</span>=/var/run/mysql/mysqld.pid</span><br><span class="line"> </span><br><span class="line"><span class="comment">#指定客户端连接mysql时的编码设置</span></span><br><span class="line"><span class="section">[client]</span></span><br><span class="line"><span class="attr">default-character-set</span>=utf8mb4</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>创建相应目录并赋权</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mkdir -p /var/log/mysql/</span><br><span class="line">chown -R mysql:mysql /var/log/mysql </span><br><span class="line">mkdir -p /var/run/mysql</span><br><span class="line">chown -R mysql:mysql /var/run/mysql</span><br></pre></td></tr></table></figure>



<h2 id="9-重新启开启mysql服务，如下所示则开启成功！"><a href="#9-重新启开启mysql服务，如下所示则开启成功！" class="headerlink" title="9.重新启开启mysql服务，如下所示则开启成功！"></a>9.重新启开启mysql服务，如下所示则开启成功！</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">./support-files/mysql.server start</span><br><span class="line">Starting MySQL.. SUCCESS!</span><br></pre></td></tr></table></figure>

<h2 id="10-将mysql进程放入系统进程中，命令如下："><a href="#10-将mysql进程放入系统进程中，命令如下：" class="headerlink" title="10.将mysql进程放入系统进程中，命令如下："></a>10.将mysql进程放入系统进程中，命令如下：</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">cp support-files/mysql.server /etc/init.d/mysqld</span><br></pre></td></tr></table></figure>

<h2 id="11-重新启动mysql服务，命令如下："><a href="#11-重新启动mysql服务，命令如下：" class="headerlink" title="11.重新启动mysql服务，命令如下："></a>11.重新启动mysql服务，命令如下：</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">service mysqld restart</span><br><span class="line">Shutting down MySQL.... SUCCESS! </span><br><span class="line">Starting MySQL. SUCCESS! </span><br></pre></td></tr></table></figure>

<p>修改文件权限</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">chmod 755 /etc/rc.d/init.d/mysqld</span><br></pre></td></tr></table></figure>

<p>设置开机启动</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">chkconfig mysqld on</span><br></pre></td></tr></table></figure>

<p>启动、停止命令</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">service mysqld start/stop</span><br></pre></td></tr></table></figure>

<h2 id="12-配置mysql环境变量"><a href="#12-配置mysql环境变量" class="headerlink" title="12.配置mysql环境变量"></a>12.配置mysql环境变量</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">vi /etc/profile</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:/usr/<span class="built_in">local</span>/mysql/bin</span><br></pre></td></tr></table></figure>

<p>保存退出，再编译下：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">source</span> /etc/profile</span><br></pre></td></tr></table></figure>

<h2 id="13-使用随机密码登录mysql数据库，命令如下："><a href="#13-使用随机密码登录mysql数据库，命令如下：" class="headerlink" title="13.使用随机密码登录mysql数据库，命令如下："></a>13.使用随机密码登录mysql数据库，命令如下：</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">mysql -u root -p</span><br></pre></td></tr></table></figure>

<p>输入密码回车可能出现如下错误</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">mysql -uroot -p</span><br><span class="line">Enter password: </span><br><span class="line">ERROR 2002 (HY000): Can&#x27;t connect to local MySQL server through socket &#x27;/usr/local/mysql/mysql.sock&#x27; (2)</span><br></pre></td></tr></table></figure>

<p>查看是否系统自带的mariadb</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">rpm -qa|grep mariadb</span><br><span class="line">mariadb-libs-5.5.60-1.el7_5.x86_64</span><br></pre></td></tr></table></figure>

<p>卸载系统自带的mariadb</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">yum remove mariadb-libs-5.5.60-1.el7_5.x86_64</span><br></pre></td></tr></table></figure>
<p>可能出现如下错误</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">mysql -uroot -p</span><br><span class="line">mysql: error while loading shared libraries: libncurses.so.5: cannot open shared object file: No such file or directory</span><br></pre></td></tr></table></figure>

<p>安装相关依赖</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"> yum install  libncurses.so.5</span><br><span class="line">Last metadata expiration check: 0:11:30 ago on Tue 07 Jan 2020 07:57:07 AM CST.</span><br><span class="line">Dependencies resolved.</span><br><span class="line">===================================================================================================================================================================================================================</span><br><span class="line"> Package                                                  Arch                                        Version                                                 Repository                                      Size</span><br><span class="line">===================================================================================================================================================================================================================</span><br><span class="line">Installing:</span><br><span class="line"> ncurses-compat-libs                                      i686                                        6.1-7.20180224.el8                                      BaseOS                                         350 k</span><br><span class="line">Installing dependencies:</span><br><span class="line"> glibc32                                                  x86_64                                      2.28-42.1.el8                                           AppStream                                      1.5 M</span><br><span class="line"> libgcc                                                   i686                                        8.2.1-3.5.el8                                           BaseOS                                          84 k</span><br><span class="line"> libstdc++                                                i686                                        8.2.1-3.5.el8                                           BaseOS                                         485 k</span><br><span class="line"></span><br><span class="line">Transaction Summary</span><br><span class="line">===================================================================================================================================================================================================================</span><br><span class="line">Install  4 Packages</span><br><span class="line"></span><br><span class="line">Total download size: 2.4 M</span><br><span class="line">Installed size: 8.3 M</span><br><span class="line">Is this ok [y/N]: y</span><br><span class="line">Downloading Packages:</span><br><span class="line">(1/4): libgcc-8.2.1-3.5.el8.i686.rpm                                                                                                                                                72 kB/s |  84 kB     00:01    </span><br><span class="line">(2/4): glibc32-2.28-42.1.el8.x86_64.rpm                                                                                                                                            596 kB/s | 1.5 MB     00:02    </span><br><span class="line">(3/4): libstdc++-8.2.1-3.5.el8.i686.rpm                                                                                                                                            180 kB/s | 485 kB     00:02    </span><br><span class="line">(4/4): ncurses-compat-libs-6.1-7.20180224.el8.i686.rpm                                                                                                                             227 kB/s | 350 kB     00:01    </span><br><span class="line">-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</span><br><span class="line">Total                                                                                                                                                                              510 kB/s | 2.4 MB     00:04     </span><br><span class="line">Running transaction check</span><br><span class="line">Transaction check succeeded.</span><br><span class="line">Running transaction test</span><br><span class="line">Transaction test succeeded.</span><br><span class="line">Running transaction</span><br><span class="line">  Preparing        :                                                                                                                                                                                           1/1 </span><br><span class="line">  Installing       : libgcc-8.2.1-3.5.el8.i686                                                                                                                                                                 1/4 </span><br><span class="line">  Running scriptlet: libgcc-8.2.1-3.5.el8.i686                                                                                                                                                                 1/4 </span><br><span class="line">  Installing       : glibc32-2.28-42.1.el8.x86_64                                                                                                                                                              2/4 </span><br><span class="line">  Running scriptlet: glibc32-2.28-42.1.el8.x86_64                                                                                                                                                              2/4 </span><br><span class="line">  Installing       : libstdc++-8.2.1-3.5.el8.i686                                                                                                                                                              3/4 </span><br><span class="line">  Running scriptlet: libstdc++-8.2.1-3.5.el8.i686                                                                                                                                                              3/4 </span><br><span class="line">  Installing       : ncurses-compat-libs-6.1-7.20180224.el8.i686                                                                                                                                               4/4 </span><br><span class="line">  Running scriptlet: ncurses-compat-libs-6.1-7.20180224.el8.i686                                                                                                                                               4/4 </span><br><span class="line">  Verifying        : glibc32-2.28-42.1.el8.x86_64                                                                                                                                                              1/4 </span><br><span class="line">  Verifying        : libgcc-8.2.1-3.5.el8.i686                                                                                                                                                                 2/4 </span><br><span class="line">  Verifying        : libstdc++-8.2.1-3.5.el8.i686                                                                                                                                                              3/4 </span><br><span class="line">  Verifying        : ncurses-compat-libs-6.1-7.20180224.el8.i686                                                                                                                                               4/4 </span><br><span class="line"></span><br><span class="line">Installed:</span><br><span class="line">  ncurses-compat-libs-6.1-7.20180224.el8.i686                     glibc32-2.28-42.1.el8.x86_64                     libgcc-8.2.1-3.5.el8.i686                     libstdc++-8.2.1-3.5.el8.i686                    </span><br><span class="line"></span><br><span class="line">Complete!</span><br></pre></td></tr></table></figure>

<p>如果是 CentOS 8 还需要执行以下脚本</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ln -s /usr/lib64/libncurses.so.6 /usr/lib64/libncurses.so.5</span><br><span class="line">ln -s /usr/lib64/libtinfo.so.6 /usr/lib64/libtinfo.so.5     </span><br></pre></td></tr></table></figure>

<p>输入随机密码登录成功：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Welcome to the MySQL monitor.  Commands end with ; or \g.</span><br><span class="line">Your MySQL connection id is 2010</span><br><span class="line">Server version: 5.7.26 MySQL Community Server (GPL)</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2019, Oracle and/or its affiliates. All rights reserved.</span><br><span class="line"></span><br><span class="line">Oracle is a registered trademark of Oracle Corporation and/or its</span><br><span class="line">affiliates. Other names may be trademarks of their respective</span><br><span class="line">owners.</span><br><span class="line"></span><br><span class="line">Type &#x27;help;&#x27; or &#x27;\h&#x27; for help. Type &#x27;\c&#x27; to clear the current input statement.</span><br><span class="line"></span><br><span class="line">mysql&gt; </span><br></pre></td></tr></table></figure>



<h2 id="14-进入mysql操作行，为root用户设置新密码（比如设为123456）："><a href="#14-进入mysql操作行，为root用户设置新密码（比如设为123456）：" class="headerlink" title="14.进入mysql操作行，为root用户设置新密码（比如设为123456）："></a>14.进入mysql操作行，为root用户设置新密码（比如设为123456）：</h2><p>在13条已经登录的终端中输入如下命令：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">alter user &#x27;root&#x27;@&#x27;localhost&#x27; identified by &#x27;123456&#x27;;</span><br><span class="line"># 或者</span><br><span class="line">use mysql</span><br><span class="line">update user set authentication_string=password(&#x27;新密码&#x27;) where user=&#x27;root&#x27;;</span><br></pre></td></tr></table></figure>

<h2 id="15-设置允许远程连接数据库，命令如下："><a href="#15-设置允许远程连接数据库，命令如下：" class="headerlink" title="15.设置允许远程连接数据库，命令如下："></a>15.设置允许远程连接数据库，命令如下：</h2><p>先选择数据库：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">use mysql</span><br><span class="line">update user set user.Host=&#x27;%&#x27; where user.User=&#x27;root&#x27;;</span><br></pre></td></tr></table></figure>


<p>查看修改后的值：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">select user,host from user;</span><br></pre></td></tr></table></figure>

<h2 id="16-刷新权限，命令如下："><a href="#16-刷新权限，命令如下：" class="headerlink" title="16.刷新权限，命令如下："></a>16.刷新权限，命令如下：</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">flush privileges;</span><br></pre></td></tr></table></figure>

<h2 id="17、开启3306防火墙端口，然后即可远程连接mysql（因为我的防火墙是全部关闭，所以省略了这步）"><a href="#17、开启3306防火墙端口，然后即可远程连接mysql（因为我的防火墙是全部关闭，所以省略了这步）" class="headerlink" title="17、开启3306防火墙端口，然后即可远程连接mysql（因为我的防火墙是全部关闭，所以省略了这步）"></a>17、开启3306防火墙端口，然后即可远程连接mysql（因为我的防火墙是全部关闭，所以省略了这步）</h2><h2 id="18、如果还是无法远程连接，查看-etc-my-cnf"><a href="#18、如果还是无法远程连接，查看-etc-my-cnf" class="headerlink" title="18、如果还是无法远程连接，查看/etc/my.cnf"></a>18、如果还是无法远程连接，查看/etc/my.cnf</h2><p>找到bind-address = 127.0.0.1这一行</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">改为bind-address = 0.0.0.0即可</span><br></pre></td></tr></table></figure>


<h2 id="19、添加新的用户并授权"><a href="#19、添加新的用户并授权" class="headerlink" title="19、添加新的用户并授权"></a>19、添加新的用户并授权</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">CREATE USER &#x27;developer&#x27;@&#x27;%&#x27; IDENTIFIED BY &#x27;123456&#x27;;</span><br><span class="line">GRANT ALL PRIVILEGES ON *.* TO &#x27;developer&#x27;@&#x27;%&#x27;  WITH GRANT OPTION ;</span><br><span class="line">flush privileges;</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>centos</category>
        <category>mysql</category>
      </categories>
      <tags>
        <tag>centos</tag>
        <tag>mysql</tag>
      </tags>
  </entry>
  <entry>
    <title>Java并发问题--乐观锁与悲观锁以及乐观锁的一种实现方式-CAS</title>
    <url>/Java-Concurrent-Optimistic-And-Pessimistic-Locks/</url>
    <content><![CDATA[<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">原文：https://www.cnblogs.com/qjjazry/p/6581568.html</span><br></pre></td></tr></table></figure>



<p><strong>首先介绍一些乐观锁与悲观锁:</strong></p>
<p>　　悲观锁：总是假设最坏的情况，每次去拿数据的时候都认为别人会修改，所以每次在拿数据的时候都会上锁，这样别人想拿这个数据就会阻塞直到它拿到锁。传统的关系型数据库里边就用到了很多这种锁机制，比如行锁，表锁等，读锁，写锁等，都是在做操作之前先上锁。再比如Java里面的同步原语synchronized关键字的实现也是悲观锁。</p>
<p>　　乐观锁：顾名思义，就是很乐观，每次去拿数据的时候都认为别人不会修改，所以不会上锁，但是在更新的时候会判断一下在此期间别人有没有去更新这个数据，可以使用版本号等机制。乐观锁适用于多读的应用类型，这样可以提高吞吐量，像数据库提供的类似于write_condition机制，其实都是提供的乐观锁。在Java中java.util.concurrent.atomic包下面的原子变量类就是使用了乐观锁的一种实现方式CAS实现的。</p>
 <span id="more"></span> 

<p><strong>乐观锁的一种实现方式-CAS(Compare and Swap 比较并交换)：</strong></p>
<p>　　锁存在的问题:</p>
<p>　　　　Java在JDK1.5之前都是靠 synchronized关键字保证同步的，这种通过使用一致的锁定协议来协调对共享状态的访问，可以确保无论哪个线程持有共享变量的锁，都采用独占的方式来访问这些变量。这就是一种独占锁，独占锁其实就是一种悲观锁，所以可以说 <strong>synchronized 是悲观锁。</strong></p>
<p>　　　　悲观锁机制存在以下问题：　　</p>
<p>　　　　　　1. 在多线程竞争下，加锁、释放锁会导致比较多的上下文切换和调度延时，引起性能问题。</p>
<p>　　　　　　2. 一个线程持有锁会导致其它所有需要此锁的线程挂起。</p>
<p>　　　　　　3. 如果一个优先级高的线程等待一个优先级低的线程释放锁会导致优先级倒置，引起性能风险。</p>
<p>　　　　对比于悲观锁的这些问题，另一个更加有效的锁就是乐观锁。其实乐观锁就是：每次不加锁而是假设没有并发冲突而去完成某项操作，如果因为并发冲突失败就重试，直到成功为止。</p>
<p>　　乐观锁：</p>
<p>　　　　乐观锁（ Optimistic Locking ）在上文已经说过了，其实就是一种思想。相对悲观锁而言，乐观锁假设认为数据一般情况下不会产生并发冲突，所以在数据进行提交更新的时候，才会正式对数据是否产生并发冲突进行检测，如果发现并发冲突了，则让返回用户错误的信息，让用户决定如何去做。</p>
<p>　　　　上面提到的乐观锁的概念中其实已经阐述了它的具体实现细节：主要就是两个步骤：<strong>冲突检测和数据更新。</strong>其实现方式有一种比较典型的就是 Compare and Swap ( CAS )。</p>
<p>　　CAS：</p>
<p>　　　　CAS是乐观锁技术，当多个线程尝试使用CAS同时更新同一个变量时，只有其中一个线程能更新变量的值，而其它线程都失败，失败的线程并不会被挂起，而是被告知这次竞争中失败，并可以再次尝试。　　　</p>
<p>　　　　CAS 操作中包含三个操作数 —— 需要读写的内存位置（V）、进行比较的预期原值（A）和拟写入的新值(B)。如果内存位置V的值与预期原值A相匹配，那么处理器会自动将该位置值更新为新值B。否则处理器不做任何操作。无论哪种情况，它都会在 CAS 指令之前返回该位置的值。（在 CAS 的一些特殊情况下将仅返回 CAS 是否成功，而不提取当前值。）CAS 有效地说明了“ 我认为位置 V 应该包含值 A；如果包含该值，则将 B 放到这个位置；否则，不要更改该位置，只告诉我这个位置现在的值即可。 ”这其实和乐观锁的冲突检查+数据更新的原理是一样的。</p>
<p>　　　　这里再强调一下，乐观锁是一种思想。CAS是这种思想的一种实现方式。</p>
<p>　　JAVA对CAS的支持：</p>
<p>　　　　在JDK1.5 中新增 java.util.concurrent (J.U.C)就是建立在CAS之上的。相对于对于 synchronized 这种阻塞算法，CAS是非阻塞算法的一种常见实现。所以J.U.C在性能上有了很大的提升。</p>
<p>　　　　以 java.util.concurrent 中的 AtomicInteger 为例，看一下在不使用锁的情况下是如何保证线程安全的。主要理解 getAndIncrement 方法，该方法的作用相当于 ++i 操作。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AtomicInteger</span> <span class="keyword">extends</span> <span class="title">Number</span> <span class="keyword">implements</span> <span class="title">java</span>.<span class="title">io</span>.<span class="title">Serializable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span> <span class="keyword">int</span> value;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">int</span> <span class="title">get</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">int</span> <span class="title">getAndIncrement</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (;;) &#123;</span><br><span class="line">            <span class="keyword">int</span> current = get();</span><br><span class="line">            <span class="keyword">int</span> next = current + <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span> (compareAndSet(current, next))</span><br><span class="line">                <span class="keyword">return</span> current;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">boolean</span> <span class="title">compareAndSet</span><span class="params">(<span class="keyword">int</span> expect, <span class="keyword">int</span> update)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> unsafe.compareAndSwapInt(<span class="keyword">this</span>, valueOffset, expect, update);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>　　　　在没有锁的机制下,字段value要借助volatile原语，保证线程间的数据是可见性。这样在获取变量的值的时候才能直接读取。然后来看看 ++i 是怎么做到的。</p>
<p>　　　  getAndIncrement 采用了CAS操作，每次从内存中读取数据然后将此数据和 +1 后的结果进行CAS操作，如果成功就返回结果，否则重试直到成功为止。</p>
<p>　　　  而 compareAndSet 利用JNI（Java Native Interface）来完成CPU指令的操作：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">boolean</span> <span class="title">compareAndSet</span><span class="params">(<span class="keyword">int</span> expect, <span class="keyword">int</span> update)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> unsafe.compareAndSwapInt(<span class="keyword">this</span>, valueOffset, expect, update);</span><br><span class="line">&#125;　　　</span><br></pre></td></tr></table></figure>

<p>　　　　其中unsafe.compareAndSwapInt(this, valueOffset, expect, update);类似如下逻辑：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"> <span class="keyword">if</span> (<span class="keyword">this</span> == expect) &#123;</span><br><span class="line">    <span class="keyword">this</span> = update</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>　　　　那么比较this == expect，替换this = update，compareAndSwapInt实现这两个步骤的原子性呢？ 参考CAS的原理</p>
<p>　　CAS原理：</p>
<p>　　　　CAS通过调用JNI的代码实现的。而compareAndSwapInt就是借助C来调用CPU底层指令实现的。</p>
<p>　　　　  下面从分析比较常用的CPU（intel x86）来解释CAS的实现原理。</p>
<p> 　　　  下面是sun.misc.Unsafe类的compareAndSwapInt()方法的源代码：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">native</span> <span class="keyword">boolean</span> <span class="title">compareAndSwapInt</span><span class="params">(Object o, <span class="keyword">long</span> offset,</span></span></span><br><span class="line"><span class="params"><span class="function">                                              <span class="keyword">int</span> expected,</span></span></span><br><span class="line"><span class="params"><span class="function">                                              <span class="keyword">int</span> x)</span></span>;</span><br></pre></td></tr></table></figure>

<p>　　　　 可以看到这是个本地方法调用。这个本地方法在JDK中依次调用的C++代码为：</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> LOCK_IF_MP(mp) __asm cmp mp, 0  \</span></span><br><span class="line"><span class="meta">                       __asm je L0      \</span></span><br><span class="line"><span class="meta">                       __asm _emit 0xF0 \</span></span><br><span class="line"><span class="meta">                       __asm L0:</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> jint     <span class="title">Atomic::cmpxchg</span>    <span class="params">(jint     exchange_value, <span class="keyword">volatile</span> jint*     dest, jint     compare_value)</span> </span>&#123;</span><br><span class="line">  <span class="comment">// alternative for InterlockedCompareExchange</span></span><br><span class="line">  <span class="keyword">int</span> mp = os::<span class="built_in">is_MP</span>();</span><br><span class="line">  __asm &#123;</span><br><span class="line">    mov edx, dest</span><br><span class="line">    mov ecx, exchange_value</span><br><span class="line">    mov eax, <span class="function">compare_value</span></span><br><span class="line"><span class="function">    <span class="title">LOCK_IF_MP</span><span class="params">(mp)</span></span></span><br><span class="line"><span class="function">    cmpxchg dword ptr [edx], ecx</span></span><br><span class="line"><span class="function">  &#125;</span></span><br><span class="line"><span class="function">&#125;</span></span><br></pre></td></tr></table></figure>

<p>　　　　如上面源代码所示，程序会根据当前处理器的类型来决定是否为cmpxchg指令添加lock前缀。如果程序是在多处理器上运行，就为cmpxchg指令加上lock前缀（lock cmpxchg）。反之，如果程序是在单处理器上运行，就省略lock前缀（单处理器自身会维护单处理器内的顺序一致性，不需要lock前缀提供的内存屏障效果）。</p>
<p>　　CAS缺点：</p>
<p>　　　　　1. <strong>ABA问题：</strong></p>
<p>　　　　　　　比如说一个线程one从内存位置V中取出A，这时候另一个线程two也从内存中取出A，并且two进行了一些操作变成了B，然后two又将V位置的数据变成A，这时候线程one进行CAS操作发现内存中仍然是A，然后one操作成功。尽管线程one的CAS操作成功，但可能存在潜藏的问题。如下所示：</p>
<p>　　　　　　　<img src="/assets/img/Java-Concurrent-Lock/1047941-20170319183935713-1224322401.png" alt="img"></p>
<p>　　　　　　　现有一个用单向链表实现的堆栈，栈顶为A，这时线程T1已经知道A.next为B，然后希望用CAS将栈顶替换为B：</p>
<p>　　　　　　　　　　head.compareAndSet(A,B);</p>
<p>　　　　　　　　在T1执行上面这条指令之前，线程T2介入，将A、B出栈，再pushD、C、A，此时堆栈结构如下图，而对象B此时处于游离状态：</p>
<p>　　　　　　　<img src="/assets/img/Java-Concurrent-Lock/1047941-20170319184016838-1784274955.png" alt="img"></p>
<p>　　　　　　　此时轮到线程T1执行CAS操作，检测发现栈顶仍为A，所以CAS成功，栈顶变为B，但实际上B.next为null，所以此时的情况变为：</p>
<p>　　　　　　　<img src="/assets/img/Java-Concurrent-Lock/1047941-20170319184054182-183582877.png" alt="img"></p>
<p>　　　　　　　其中堆栈中只有B一个元素，C和D组成的链表不再存在于堆栈中，平白无故就把C、D丢掉了。</p>
<p>　　　　　　　从Java1.5开始JDK的atomic包里提供了一个类AtomicStampedReference来解决ABA问题。这个类的compareAndSet方法作用是首先检查当前引用是否等于预期引用，并且当前标志是否等于预期标志，如果全部相等，则以原子方式将该引用和该标志的值设置为给定的更新值。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">compareAndSet</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">               V      expectedReference,//预期引用</span></span></span><br><span class="line"><span class="params"><span class="function"></span></span></span><br><span class="line"><span class="params"><span class="function">               V      newReference,//更新后的引用</span></span></span><br><span class="line"><span class="params"><span class="function"></span></span></span><br><span class="line"><span class="params"><span class="function">              <span class="keyword">int</span>    expectedStamp, //预期标志</span></span></span><br><span class="line"><span class="params"><span class="function"></span></span></span><br><span class="line"><span class="params"><span class="function">              <span class="keyword">int</span>    newStamp //更新后的标志</span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span></span><br></pre></td></tr></table></figure>

<p>　　　　　　　　实际应用代码：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> AtomicStampedReference&lt;Integer&gt; atomicStampedRef = <span class="keyword">new</span> AtomicStampedReference&lt;Integer&gt;(<span class="number">100</span>, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">........</span><br><span class="line"></span><br><span class="line">atomicStampedRef.compareAndSet(<span class="number">100</span>, <span class="number">101</span>, stamp, stamp + <span class="number">1</span>);</span><br></pre></td></tr></table></figure>

<p> 　　　　2. <strong>循环时间长开销大：</strong></p>
<p>　　　　　　自旋CAS（不成功，就一直循环执行，直到成功）如果长时间不成功，会给CPU带来非常大的执行开销。如果JVM能支持处理器提供的pause指令那么效率会有一定的提升，pause指令有两个作用，第一它可以延迟流水线执行指令（de-pipeline）,使CPU不会消耗过多的执行资源，延迟的时间取决于具体实现的版本，在一些处理器上延迟时间是零。第二它可以避免在退出循环的时候因内存顺序冲突（memory order violation）而引起CPU流水线被清空（CPU pipeline flush），从而提高CPU的执行效率。</p>
<p>　　　　</p>
<p>　　　　3. <strong>只能保证一个共享变量的原子操作</strong>：</p>
<p>　　　　　　当对一个共享变量执行操作时，我们可以使用循环CAS的方式来保证原子操作，但是对多个共享变量操作时，循环CAS就无法保证操作的原子性，这个时候就可以用锁，或者有一个取巧的办法，就是把多个共享变量合并成一个共享变量来操作。比如有两个共享变量i＝2,j=a，合并一下ij=2a，然后用CAS来操作ij。从Java1.5开始JDK提供了<strong>AtomicReference****类来保证引用对象之间的原子性，你可以把多个变量放在一个对象里来进行CAS操作。</strong></p>
<p>　　CAS与Synchronized的使用情景：　　　</p>
<p>　　　　1、对于资源竞争较少（线程冲突较轻）的情况，使用synchronized同步锁进行线程阻塞和唤醒切换以及用户态内核态间的切换操作额外浪费消耗cpu资源；而CAS基于硬件实现，不需要进入内核，不需要切换线程，操作自旋几率较少，因此可以获得更高的性能。</p>
<p>　　　 2、对于资源竞争严重（线程冲突严重）的情况，CAS自旋的概率会比较大，从而浪费更多的CPU资源，效率低于synchronized。</p>
<p>　　　补充： synchronized在jdk1.6之后，已经改进优化。synchronized的底层实现主要依靠Lock-Free的队列，基本思路是自旋后阻塞，竞争切换后继续竞争锁，稍微牺牲了公平性，但获得了高吞吐量。在线程冲突较少的情况下，可以获得和CAS类似的性能；而线程冲突严重的情况下，性能远高于CAS。</p>
<p>　　concurrent包的实现：</p>
<p>　　　　由于java的CAS同时具有 volatile 读和volatile写的内存语义，因此Java线程之间的通信现在有了下面四种方式：</p>
<p>　　　　　　1. A线程写volatile变量，随后B线程读这个volatile变量。</p>
<p>　　　　　　2. A线程写volatile变量，随后B线程用CAS更新这个volatile变量。</p>
<p>　　　　　　3. A线程用CAS更新一个volatile变量，随后B线程用CAS更新这个volatile变量。</p>
<p>　　　　　　4. A线程用CAS更新一个volatile变量，随后B线程读这个volatile变量。</p>
<p>　　　　Java的CAS会使用现代处理器上提供的高效机器级别原子指令，这些原子指令以原子方式对内存执行读-改-写操作，这是在多处理器中实现同步的关键（从本质上来说，能够支持原子性读-改-写指令的计算机器，是顺序计算图灵机的异步等价机器，因此任何现代的多处理器都会去支持某种能对内存执行原子性读-改-写操作的原子指令）。同时，volatile变量的读/写和CAS可以实现线程之间的通信。把这些特性整合在一起，就形成了整个concurrent包得以实现的基石。如果我们仔细分析concurrent包的源代码实现，会发现一个通用化的实现模式：</p>
<p>　　　　　　1. 首先，声明共享变量为volatile；　　</p>
<p>　　　　　　2. 然后，使用CAS的原子条件更新来实现线程之间的同步；</p>
<p>　　　　　　3. 同时，配合以volatile的读/写和CAS所具有的volatile读和写的内存语义来实现线程之间的通信。</p>
<p>　　　　AQS，非阻塞数据结构和原子变量类（java.util.concurrent.atomic包中的类），这些concurrent包中的基础类都是使用这种模式来实现的，而concurrent包中的高层类又是依赖于这些基础类来实现的。从整体来看，concurrent包的实现示意图如下：</p>
<p>　　　　　　<img src="/assets/img/Java-Concurrent-Lock/1047941-20170319190237932-274252686.png" alt="img"></p>
<p>　　JVM中的CAS（堆中对象的分配）：　</p>
<p>　　　　Java调用<code>new object()</code>会创建一个对象，这个对象会被分配到JVM的堆中。那么这个对象到底是怎么在堆中保存的呢？</p>
<p>　　　　首先，<code>new object()</code>执行的时候，这个对象需要多大的空间，其实是已经确定的，因为java中的各种数据类型，占用多大的空间都是固定的（对其原理不清楚的请自行Google）。那么接下来的工作就是在堆中找出那么一块空间用于存放这个对象。<br>　　　　在单线程的情况下，一般有两种分配策略：</p>
<p>　　　　　　1. 指针碰撞：这种一般适用于内存是绝对规整的（内存是否规整取决于内存回收策略），分配空间的工作只是将指针像空闲内存一侧移动对象大小的距离即可。</p>
<p>　　　　　　2. 空闲列表：这种适用于内存非规整的情况，这种情况下JVM会维护一个内存列表，记录哪些内存区域是空闲的，大小是多少。给对象分配空间的时候去空闲列表里查询到合适的区域然后进行分配即可。</p>
<p>　　　　但是JVM不可能一直在单线程状态下运行，那样效率太差了。由于再给一个对象分配内存的时候不是原子性的操作，至少需要以下几步：查找空闲列表、分配内存、修改空闲列表等等，这是不安全的。解决并发时的安全问题也有两种策略：</p>
<p>　　　　　　1. CAS：实际上虚拟机采用CAS配合上失败重试的方式保证更新操作的原子性，原理和上面讲的一样。</p>
<p>　　　　　　2. TLAB：如果使用CAS其实对性能还是会有影响的，所以JVM又提出了一种更高级的优化策略：每个线程在Java堆中预先分配一小块内存，称为本地线程分配缓冲区（TLAB），线程内部需要分配内存时直接在TLAB上分配就行，避免了线程冲突。只有当缓冲区的内存用光需要重新分配内存的时候才会进行CAS操作分配更大的内存空间。<br>　　　　　　虚拟机是否使用TLAB，可以通过<code>-XX:+/-UseTLAB</code>参数来进行配置（jdk5及以后的版本默认是启用TLAB的）。</p>
]]></content>
      <categories>
        <category>java</category>
      </categories>
      <tags>
        <tag>jvm</tag>
        <tag>lock</tag>
        <tag>java</tag>
        <tag>concurrent</tag>
      </tags>
  </entry>
  <entry>
    <title>Python 进阶练习</title>
    <url>/Python-advance-practive/</url>
    <content><![CDATA[<ul>
<li><p> <strong>深度学习</strong>离不开数学分析（高等数学）、线性代数、概率论等知识，<strong>更离不开以编程为核心的动手实践。</strong></p>
</li>
<li><p>无论是在机器学习还是深度学习中，<strong>Python</strong> 已经成为主导性的编程语言。而且，现在许多主流的深度学习框架都提供Python接口，Python被用于数据预处理、定义网络模型、执行训练过程、数据可视化等</p>
</li>
<li><p><strong>熟悉 Python 的基础语法，并掌握 NumPy，Pandas 及其他基础工具模块的使用对深度学习实践是非常重要的！</strong></p>
</li>
</ul>
<br/>

<span id="more"></span>

<p><strong>目录</strong></p>
<ul>
<li>Python数据结构</li>
<li>Python面向对象</li>
<li>Python JSON</li>
<li>Python 异常处理</li>
<li> 常见Linux命令</li>
</ul>
<h1 id="Python数据结构"><a href="#Python数据结构" class="headerlink" title="Python数据结构"></a>Python数据结构</h1><p>数字、字符串、列表、元祖、字典</p>
<h2 id="数字"><a href="#数字" class="headerlink" title="数字"></a>数字</h2><p>Python Number 数据类型用于存储数值。</p>
<p>Python Number 数据类型用于存储数值，包括整型、长整型、浮点型、复数。</p>
<p><strong>（1）Python math 模块</strong>：Python 中数学运算常用的函数基本都在 math 模块</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> math</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(math.ceil(<span class="number">4.1</span>))   <span class="comment">#返回数字的上入整数</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(math.floor(<span class="number">4.9</span>))  <span class="comment">#返回数字的下舍整数</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(math.fabs(-<span class="number">10</span>))   <span class="comment">#返回数字的绝对值</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(math.sqrt(<span class="number">9</span>))     <span class="comment">#返回数字的平方根</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(math.exp(<span class="number">1</span>))      <span class="comment">#返回e的x次幂</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<pre><code>5
4
10.0
3.0
2.718281828459045
</code></pre>
<p><strong>（2）Python随机数</strong></p>
<p>首先import random，使用random()方法即可随机生成一个[0,1)范围内的实数</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line">ran = random.random()</span><br><span class="line"><span class="built_in">print</span>(ran)</span><br></pre></td></tr></table></figure>

<pre><code>0.8200670438985006
</code></pre>
<p>调用 random.random() 生成随机数时，每一次生成的数都是随机的。但是，当预先使用 random.seed(x) 设定好种子之后，其中的 x 可以是任意数字，此时使用 random() 生成的随机数将会是同一个。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="built_in">print</span> (<span class="string">&quot;------- 设置种子 seed -------&quot;</span>)</span><br><span class="line">random.seed(<span class="number">10</span>)</span><br><span class="line"><span class="built_in">print</span> (<span class="string">&quot;Random number with seed 10 : &quot;</span>, random.random())</span><br><span class="line"></span><br><span class="line"><span class="comment"># 生成同一个随机数</span></span><br><span class="line">random.seed(<span class="number">10</span>)</span><br><span class="line"><span class="built_in">print</span> (<span class="string">&quot;Random number with seed 10 : &quot;</span>, random.random())</span><br></pre></td></tr></table></figure>

<pre><code>------- 设置种子 seed -------
Random number with seed 10 :  0.5714025946899135
Random number with seed 10 :  0.5714025946899135
</code></pre>
<p>randint()生成一个随机整数</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">ran = random.randint(<span class="number">1</span>,<span class="number">20</span>)</span><br><span class="line"><span class="built_in">print</span>(ran)</span><br></pre></td></tr></table></figure>

<pre><code>14
</code></pre>
<h1 id="字符串"><a href="#字符串" class="headerlink" title="字符串"></a>字符串</h1><p>字符串连接：+</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">a = <span class="string">&quot;Hello &quot;</span></span><br><span class="line">b = <span class="string">&quot;World &quot;</span></span><br><span class="line"><span class="built_in">print</span>(a + b)</span><br></pre></td></tr></table></figure>

<pre><code>Hello World 
</code></pre>
<p>重复输出字符串：*</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="built_in">print</span>(a * <span class="number">3</span>)</span><br></pre></td></tr></table></figure>

<pre><code>Hello Hello Hello 
</code></pre>
<p>通过索引获取字符串中字符[]</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="built_in">print</span>(a[<span class="number">0</span>])</span><br></pre></td></tr></table></figure>

<pre><code>H
</code></pre>
<p>字符串截取[:]  牢记：左开右闭</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="built_in">print</span>(a[<span class="number">1</span>:<span class="number">4</span>])</span><br></pre></td></tr></table></figure>

<pre><code>ell
</code></pre>
<p>判断字符串中是否包含给定的字符: in, not in</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;e&#x27;</span> <span class="keyword">in</span> a)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;e&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> a)</span><br></pre></td></tr></table></figure>

<pre><code>True
False
</code></pre>
<p>join():以字符作为分隔符，将字符串中所有的元素合并为一个新的字符串</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">new_str = <span class="string">&#x27;-&#x27;</span>.join(<span class="string">&#x27;Hello&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(new_str)</span><br></pre></td></tr></table></figure>

<pre><code>H-e-l-l-o
</code></pre>
<p>字符串单引号、双引号、三引号</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;Hello World!&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Hello World!&quot;</span>)</span><br></pre></td></tr></table></figure>

<pre><code>Hello World!
Hello World!
</code></pre>
<p>转义字符 \</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="built_in">print</span>(<span class="string">&quot;The \t is a tab&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;I\&#x27;m going to the movies&#x27;</span>)</span><br></pre></td></tr></table></figure>

<pre><code>The      is a tab
I&#39;m going to the movies
</code></pre>
<p>三引号让程序员从引号和特殊字符串的泥潭里面解脱出来，自始至终保持一小块字符串的格式是所谓的WYSIWYG（<strong>所见即所得</strong>）格式的。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;&#x27;&#x27;I&#x27;m going to the movies&#x27;&#x27;&#x27;</span>)</span><br><span class="line"></span><br><span class="line">html = <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">&lt;HTML&gt;&lt;HEAD&gt;&lt;TITLE&gt;</span></span><br><span class="line"><span class="string">Friends CGI Demo&lt;/TITLE&gt;&lt;/HEAD&gt;</span></span><br><span class="line"><span class="string">&lt;BODY&gt;&lt;H3&gt;ERROR&lt;/H3&gt;</span></span><br><span class="line"><span class="string">&lt;B&gt;%s&lt;/B&gt;&lt;P&gt;</span></span><br><span class="line"><span class="string">&lt;FORM&gt;&lt;INPUT TYPE=button VALUE=Back</span></span><br><span class="line"><span class="string">ONCLICK=&quot;window.history.back()&quot;&gt;&lt;/FORM&gt;</span></span><br><span class="line"><span class="string">&lt;/BODY&gt;&lt;/HTML&gt;</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="built_in">print</span>(html)</span><br></pre></td></tr></table></figure>

<pre><code>I&#39;m going to the movies

&lt;HTML&gt;&lt;HEAD&gt;&lt;TITLE&gt;
Friends CGI Demo&lt;/TITLE&gt;&lt;/HEAD&gt;
&lt;BODY&gt;&lt;H3&gt;ERROR&lt;/H3&gt;
&lt;B&gt;%s&lt;/B&gt;&lt;P&gt;
&lt;FORM&gt;&lt;INPUT TYPE=button VALUE=Back
ONCLICK=&quot;window.history.back()&quot;&gt;&lt;/FORM&gt;
&lt;/BODY&gt;&lt;/HTML&gt;
</code></pre>
<h2 id="列表"><a href="#列表" class="headerlink" title="列表"></a>列表</h2><p>作用：类似其他语言中的数组</p>
<br/>

<p>声明一个列表，并通过下标或索引获取元素</p>
<p><img src="https://ai-studio-static-online.cdn.bcebos.com/41840090b1c14c4daa704f9565fd5ba663d08a7d383444fa98c5c3d31f7e4c1d"></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">#声明一个列表</span></span><br><span class="line">names = [<span class="string">&#x27;jack&#x27;</span>,<span class="string">&#x27;tom&#x27;</span>,<span class="string">&#x27;tonney&#x27;</span>,<span class="string">&#x27;superman&#x27;</span>,<span class="string">&#x27;jay&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">#通过下标或索引获取元素</span></span><br><span class="line"><span class="built_in">print</span>(names[<span class="number">0</span>])</span><br><span class="line"><span class="built_in">print</span>(names[<span class="number">1</span>])</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<pre><code>jack
tom
</code></pre>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#获取最后一个元素</span></span><br><span class="line"><span class="built_in">print</span>(names[-<span class="number">1</span>])</span><br><span class="line"><span class="built_in">print</span>(names[<span class="built_in">len</span>(names)-<span class="number">1</span>])</span><br></pre></td></tr></table></figure>

<pre><code>jay
jay
</code></pre>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#获取第一个元素</span></span><br><span class="line"><span class="built_in">print</span>(names[-<span class="number">5</span>])</span><br></pre></td></tr></table></figure>

<pre><code>jack
</code></pre>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#遍历列表，获取元素</span></span><br><span class="line"><span class="keyword">for</span> name <span class="keyword">in</span> names:</span><br><span class="line">    <span class="built_in">print</span>(name)</span><br></pre></td></tr></table></figure>

<pre><code>jack
tom
tonney
superman
jay
</code></pre>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">#查询names里面有没有superman</span></span><br><span class="line"><span class="keyword">for</span> name <span class="keyword">in</span> names:</span><br><span class="line">    <span class="keyword">if</span> name == <span class="string">&#x27;superman&#x27;</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;有超人&#x27;</span>)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;有超人&#x27;</span>)</span><br><span class="line">    </span><br></pre></td></tr></table></figure>

<pre><code>有超人
</code></pre>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#更简单的方法,来查询names里有没有superman</span></span><br><span class="line"><span class="keyword">if</span> <span class="string">&#x27;superman&#x27;</span> <span class="keyword">in</span> names:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;有超人&#x27;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;有超人&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<pre><code>有超人
</code></pre>
<p>列表元素添加</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#声明一个空列表</span></span><br><span class="line">girls = []</span><br><span class="line"></span><br><span class="line"><span class="comment">#append(),末尾追加</span></span><br><span class="line">girls.append(<span class="string">&#x27;杨超越&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(girls)</span><br></pre></td></tr></table></figure>

<pre><code>[&#39;杨超越&#39;]
</code></pre>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#extend(),一次添加多个。把一个列表添加到另一个列表 ，列表合并。</span></span><br><span class="line">models = [<span class="string">&#x27;刘雯&#x27;</span>,<span class="string">&#x27;奚梦瑶&#x27;</span>]</span><br><span class="line">girls.extend(models)</span><br><span class="line"><span class="comment">#girls = girls + models</span></span><br><span class="line"><span class="built_in">print</span>(girls)</span><br></pre></td></tr></table></figure>

<pre><code>[&#39;杨超越&#39;, &#39;刘雯&#39;, &#39;奚梦瑶&#39;]
</code></pre>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#insert():指定位置添加</span></span><br><span class="line">girls.insert(<span class="number">1</span>,<span class="string">&#x27;虞书欣&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(girls)</span><br></pre></td></tr></table></figure>

<pre><code>[&#39;杨超越&#39;, &#39;虞书欣&#39;, &#39;刘雯&#39;, &#39;奚梦瑶&#39;]
</code></pre>
<p>列表元素修改,通过下标找到元素，然后用=赋值</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">fruits = [<span class="string">&#x27;apple&#x27;</span>,<span class="string">&#x27;pear&#x27;</span>,<span class="string">&#x27;香蕉&#x27;</span>,<span class="string">&#x27;pineapple&#x27;</span>,<span class="string">&#x27;草莓&#x27;</span>]</span><br><span class="line"><span class="built_in">print</span>(fruits)</span><br><span class="line"></span><br><span class="line">fruits[-<span class="number">1</span>] = <span class="string">&#x27;strawberry&#x27;</span></span><br><span class="line"><span class="built_in">print</span>(fruits)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<pre><code>[&#39;apple&#39;, &#39;pear&#39;, &#39;香蕉&#39;, &#39;pineapple&#39;, &#39;草莓&#39;]
[&#39;apple&#39;, &#39;pear&#39;, &#39;香蕉&#39;, &#39;pineapple&#39;, &#39;strawberry&#39;]
</code></pre>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">将fruits列表中的‘香蕉’替换为‘banana’</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> fruit <span class="keyword">in</span> fruits:</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;香蕉&#x27;</span> <span class="keyword">in</span> fruit:</span><br><span class="line">        fruit = <span class="string">&#x27;banana&#x27;</span></span><br><span class="line"><span class="built_in">print</span>(fruits)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(fruits)):</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;香蕉&#x27;</span> <span class="keyword">in</span> fruits[i]:</span><br><span class="line">        fruits[i] = <span class="string">&#x27;banana&#x27;</span></span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"><span class="built_in">print</span>(fruits)</span><br></pre></td></tr></table></figure>

<pre><code>[&#39;apple&#39;, &#39;pear&#39;, &#39;香蕉&#39;, &#39;pineapple&#39;, &#39;strawberry&#39;]
[&#39;apple&#39;, &#39;pear&#39;, &#39;banana&#39;, &#39;pineapple&#39;, &#39;strawberry&#39;]
</code></pre>
<br/>

<p>列表元素删除</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">words = [<span class="string">&#x27;cat&#x27;</span>,<span class="string">&#x27;hello&#x27;</span>,<span class="string">&#x27;pen&#x27;</span>,<span class="string">&#x27;pencil&#x27;</span>,<span class="string">&#x27;ruler&#x27;</span>]</span><br><span class="line"><span class="keyword">del</span> words[<span class="number">1</span>]</span><br><span class="line"><span class="built_in">print</span>(words)</span><br></pre></td></tr></table></figure>

<pre><code>[&#39;cat&#39;, &#39;pen&#39;, &#39;pencil&#39;, &#39;ruler&#39;]
</code></pre>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">words = [<span class="string">&#x27;cat&#x27;</span>,<span class="string">&#x27;hello&#x27;</span>,<span class="string">&#x27;pen&#x27;</span>,<span class="string">&#x27;pencil&#x27;</span>,<span class="string">&#x27;ruler&#x27;</span>]</span><br><span class="line">words.remove(<span class="string">&#x27;cat&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(words)</span><br></pre></td></tr></table></figure>

<pre><code>[&#39;hello&#39;, &#39;pen&#39;, &#39;pencil&#39;, &#39;ruler&#39;]
</code></pre>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">words = [<span class="string">&#x27;cat&#x27;</span>,<span class="string">&#x27;hello&#x27;</span>,<span class="string">&#x27;pen&#x27;</span>,<span class="string">&#x27;pencil&#x27;</span>,<span class="string">&#x27;ruler&#x27;</span>]</span><br><span class="line">words.pop(<span class="number">1</span>)</span><br><span class="line"><span class="built_in">print</span>(words)</span><br></pre></td></tr></table></figure>

<pre><code>[&#39;cat&#39;, &#39;pen&#39;, &#39;pencil&#39;, &#39;ruler&#39;]
</code></pre>
<br/>

<p>列表切片</p>
<ul>
<li><p>在Python中处理列表的部分元素，称之为切片。</p>
</li>
<li><p>创建切片，可指定要使用的第一个元素和最后一个元素的索引。注意：左开右闭</p>
</li>
<li><p>将截取的结果再次存放在一个列表中，所以还是返回列表</p>
</li>
</ul>
<p><img src="https://ai-studio-static-online.cdn.bcebos.com/3e1286d72f144f378afd29d8fc720e1430919c5b0c0d413b9ca1539f3ae087a0"></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">animals = [<span class="string">&#x27;cat&#x27;</span>,<span class="string">&#x27;dog&#x27;</span>,<span class="string">&#x27;tiger&#x27;</span>,<span class="string">&#x27;snake&#x27;</span>,<span class="string">&#x27;mouse&#x27;</span>,<span class="string">&#x27;bird&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(animals[<span class="number">2</span>:<span class="number">5</span>])</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(animals[-<span class="number">1</span>:])</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(animals[-<span class="number">3</span>:-<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(animals[-<span class="number">5</span>:-<span class="number">1</span>:<span class="number">2</span>])</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(animals[::<span class="number">2</span>])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<pre><code>[&#39;tiger&#39;, &#39;snake&#39;, &#39;mouse&#39;]
[&#39;bird&#39;]
[&#39;snake&#39;, &#39;mouse&#39;]
[&#39;dog&#39;, &#39;snake&#39;]
[&#39;cat&#39;, &#39;tiger&#39;, &#39;mouse&#39;]
</code></pre>
<br/>

<p>列表排序</p>
<ul>
<li>随机生成10个不同的整数，并进行排序</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">生成10个不同的随机整数，并存至列表中</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">import</span>  random</span><br><span class="line"></span><br><span class="line">random_list = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">    ran = random.randint(<span class="number">1</span>,<span class="number">20</span>)</span><br><span class="line">    <span class="keyword">if</span> ran <span class="keyword">not</span> <span class="keyword">in</span>  random_list:</span><br><span class="line">        random_list.append(ran)</span><br><span class="line"><span class="built_in">print</span>(random_list)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<pre><code>[16, 19, 1, 7, 15, 9, 6, 2, 17]
</code></pre>
<br/>

<p>上述代码存在什么问题吗？</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span>  random</span><br><span class="line"></span><br><span class="line">random_list = []</span><br><span class="line">i = <span class="number">0</span></span><br><span class="line"><span class="keyword">while</span> i &lt; <span class="number">10</span>:</span><br><span class="line">    ran = random.randint(<span class="number">1</span>,<span class="number">20</span>)</span><br><span class="line">    <span class="keyword">if</span> ran <span class="keyword">not</span> <span class="keyword">in</span>  random_list:</span><br><span class="line">        random_list.append(ran)</span><br><span class="line">        i+=<span class="number">1</span></span><br><span class="line"><span class="built_in">print</span>(random_list)</span><br></pre></td></tr></table></figure>

<pre><code>[16, 11, 3, 8, 12, 2, 14, 5, 20, 13]
</code></pre>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#默认升序</span></span><br><span class="line">new_list = <span class="built_in">sorted</span>(random_list)</span><br><span class="line"><span class="built_in">print</span>(new_list)</span><br><span class="line"></span><br><span class="line"><span class="comment">#降序</span></span><br><span class="line">new_list = <span class="built_in">sorted</span>(random_list,reverse =<span class="literal">True</span>)</span><br><span class="line"><span class="built_in">print</span>(new_list)</span><br></pre></td></tr></table></figure>

<pre><code>[2, 3, 5, 8, 11, 12, 13, 14, 16, 20]
[20, 16, 14, 13, 12, 11, 8, 5, 3, 2]
</code></pre>
<h2 id="元组"><a href="#元组" class="headerlink" title="元组"></a>元组</h2><p>与列表类似，元祖中的内容不可修改</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">tuple1 = ()</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">type</span>(tuple1))</span><br></pre></td></tr></table></figure>

<pre><code>&lt;class &#39;tuple&#39;&gt;
</code></pre>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">tuple2 = (<span class="string">&#x27;hello&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">type</span>(tuple2))</span><br></pre></td></tr></table></figure>

<pre><code>&lt;class &#39;str&#39;&gt;
</code></pre>
<br/>

<p>注意：元组中只有一个元素时，需要在后面加逗号！</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">tuple3 = (<span class="string">&#x27;hello&#x27;</span>,)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">type</span>(tuple3))</span><br></pre></td></tr></table></figure>

<pre><code>&lt;class &#39;tuple&#39;&gt;
</code></pre>
<p>元组不能修改，所以不存在往元组里加入元素。</p>
<p>那作为容器的元组，如何存放元素？</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line">random_list = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">    ran = random.randint(<span class="number">1</span>,<span class="number">20</span>)</span><br><span class="line">    random_list.append(ran)</span><br><span class="line"><span class="built_in">print</span>(random_list)</span><br><span class="line"></span><br><span class="line">random_tuple = <span class="built_in">tuple</span>(random_list)</span><br><span class="line"><span class="built_in">print</span>(random_tuple)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<pre><code>[14, 10, 9, 15, 6, 10, 12, 5, 15, 8]
(14, 10, 9, 15, 6, 10, 12, 5, 15, 8)
</code></pre>
<br/>

<p>元组访问</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="built_in">print</span>(random_tuple)</span><br><span class="line"><span class="built_in">print</span>(random_tuple[<span class="number">0</span>])</span><br><span class="line"><span class="built_in">print</span>(random_tuple[-<span class="number">1</span>])</span><br><span class="line"><span class="built_in">print</span>(random_tuple[<span class="number">1</span>:-<span class="number">3</span>])</span><br><span class="line"><span class="built_in">print</span>(random_tuple[::-<span class="number">1</span>])</span><br></pre></td></tr></table></figure>

<pre><code>(14, 10, 9, 15, 6, 10, 12, 5, 15, 8)
14
8
(10, 9, 15, 6, 10, 12)
(8, 15, 5, 12, 10, 6, 15, 9, 10, 14)
</code></pre>
<p>元组的修改：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">t1 = (<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>)+(<span class="number">4</span>,<span class="number">5</span>)</span><br><span class="line"><span class="built_in">print</span>(t1)</span><br></pre></td></tr></table></figure>

<pre><code>(1, 2, 3, 4, 5)
</code></pre>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">t2 = (<span class="number">1</span>,<span class="number">2</span>) * <span class="number">2</span></span><br><span class="line"><span class="built_in">print</span>(t2)</span><br></pre></td></tr></table></figure>

<pre><code>(1, 2, 1, 2)
</code></pre>
<p>元组的一些函数：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="built_in">print</span>(<span class="built_in">max</span>(random_tuple))</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">min</span>(random_tuple))</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">sum</span>(random_tuple))</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">len</span>(random_tuple))</span><br></pre></td></tr></table></figure>

<pre><code>15
5
104
10
</code></pre>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#统计元组中4的个数</span></span><br><span class="line"><span class="built_in">print</span>(random_tuple.count(<span class="number">4</span>))</span><br></pre></td></tr></table></figure>

<pre><code>0
</code></pre>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#元组中4所对应的下标，如果不存在，则会报错</span></span><br><span class="line"><span class="built_in">print</span>(random_tuple.index(<span class="number">4</span>))</span><br></pre></td></tr></table></figure>


<pre><code>---------------------------------------------------------------------------

ValueError                                Traceback (most recent call last)

&lt;ipython-input-49-82b4b5455c6b&gt; in &lt;module&gt;
      1 #元组中4所对应的下标，如果不存在，则会报错
----&gt; 2 print(random_tuple.index(4))


ValueError: tuple.index(x): x not in tuple
</code></pre>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#判断元组中是否存在1这个元素</span></span><br><span class="line"><span class="built_in">print</span>(<span class="number">4</span> <span class="keyword">in</span> random_tuple)</span><br><span class="line"></span><br><span class="line"><span class="comment">#返回元组中4所对应的下标,不会报错</span></span><br><span class="line"><span class="keyword">if</span>(<span class="number">4</span> <span class="keyword">in</span> random_tuple):</span><br><span class="line">    <span class="built_in">print</span>(random_tuple.index(<span class="number">4</span>))</span><br></pre></td></tr></table></figure>

<p>元组的拆包与装包</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#定义一个元组</span></span><br><span class="line">t3 = (<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#将元组赋值给变量a,b,c</span></span><br><span class="line">a,b,c = t3</span><br><span class="line"></span><br><span class="line"><span class="comment">#打印a,b,c</span></span><br><span class="line"><span class="built_in">print</span>(a,b,c)</span><br></pre></td></tr></table></figure>


<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">#当元组中元素个数与变量个数不一致时</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#定义一个元组，包含5个元素</span></span><br><span class="line">t4 = (<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#将t4[0],t4[1]分别赋值给a,b;其余的元素装包后赋值给c</span></span><br><span class="line">a,b,*c = t4</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(a,b,c)</span><br><span class="line"><span class="built_in">print</span>(c)</span><br><span class="line"><span class="built_in">print</span>(*c)</span><br></pre></td></tr></table></figure>

<h2 id="字典"><a href="#字典" class="headerlink" title="字典"></a>字典</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#定义一个空字典</span></span><br><span class="line"></span><br><span class="line">dict1 = &#123;&#125;</span><br><span class="line"></span><br><span class="line">dict2 = &#123;<span class="string">&#x27;name&#x27;</span>:<span class="string">&#x27;杨超越&#x27;</span>,<span class="string">&#x27;weight&#x27;</span>:<span class="number">45</span>,<span class="string">&#x27;age&#x27;</span>:<span class="number">25</span>&#125;</span><br><span class="line"><span class="built_in">print</span>(dict2[<span class="string">&#x27;name&#x27;</span>])</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#list可以转成字典，但前提是列表中元素都要成对出现</span></span><br><span class="line">dict3 = <span class="built_in">dict</span>([(<span class="string">&#x27;name&#x27;</span>,<span class="string">&#x27;杨超越&#x27;</span>),(<span class="string">&#x27;weight&#x27;</span>,<span class="number">45</span>)])</span><br><span class="line"><span class="built_in">print</span>(dict3)</span><br></pre></td></tr></table></figure>


<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">dict4 = &#123;&#125;</span><br><span class="line">dict4[<span class="string">&#x27;name&#x27;</span>] = <span class="string">&#x27;虞书欣&#x27;</span></span><br><span class="line">dict4[<span class="string">&#x27;weight&#x27;</span>] = <span class="number">43</span></span><br><span class="line"><span class="built_in">print</span>(dict4)</span><br></pre></td></tr></table></figure>


<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">dict4[<span class="string">&#x27;weight&#x27;</span>] = <span class="number">44</span></span><br><span class="line"><span class="built_in">print</span>(dict4)</span><br></pre></td></tr></table></figure>


<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#字典里的函数 items()  keys() values()</span></span><br><span class="line"></span><br><span class="line">dict5 = &#123;<span class="string">&#x27;杨超越&#x27;</span>:<span class="number">165</span>,<span class="string">&#x27;虞书欣&#x27;</span>:<span class="number">166</span>,<span class="string">&#x27;上官喜爱&#x27;</span>:<span class="number">164</span>&#125;</span><br><span class="line"><span class="built_in">print</span>(dict5.items())</span><br><span class="line"><span class="keyword">for</span> key,value <span class="keyword">in</span> dict5.items():</span><br><span class="line">    <span class="keyword">if</span> value &gt; <span class="number">165</span>:</span><br><span class="line">        <span class="built_in">print</span>(key)</span><br></pre></td></tr></table></figure>


<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#values() 取出字典中所有的值,保存到列表中</span></span><br><span class="line"></span><br><span class="line">results = dict5.values()</span><br><span class="line"><span class="built_in">print</span>(results)</span><br></pre></td></tr></table></figure>


<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#求小姐姐的平均身高</span></span><br><span class="line">heights = dict5.values()</span><br><span class="line"><span class="built_in">print</span>(heights)</span><br><span class="line">total = <span class="built_in">sum</span>(heights)</span><br><span class="line">avg = total/<span class="built_in">len</span>(heights)</span><br><span class="line"><span class="built_in">print</span>(avg)</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">names = dict5.keys()</span><br><span class="line"><span class="built_in">print</span>(names)</span><br></pre></td></tr></table></figure>


<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">#print(dict5[&#x27;赵小棠&#x27;])       </span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(dict5.get(<span class="string">&#x27;赵小棠&#x27;</span>))</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(dict5.get(<span class="string">&#x27;赵小棠&#x27;</span>,<span class="number">170</span>)) <span class="comment">#如果能够取到值，则返回字典中的值，否则返回默认值170</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>


<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">dict6 = &#123;<span class="string">&#x27;杨超越&#x27;</span>:<span class="number">165</span>,<span class="string">&#x27;虞书欣&#x27;</span>:<span class="number">166</span>,<span class="string">&#x27;上官喜爱&#x27;</span>:<span class="number">164</span>&#125;</span><br><span class="line"><span class="keyword">del</span> dict6[<span class="string">&#x27;杨超越&#x27;</span>]</span><br><span class="line"><span class="built_in">print</span>(dict6)</span><br></pre></td></tr></table></figure>


<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">result = dict6.pop(<span class="string">&#x27;虞书欣&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(result)</span><br><span class="line"><span class="built_in">print</span>(dict6)</span><br></pre></td></tr></table></figure>

<h1 id="Python面向对象"><a href="#Python面向对象" class="headerlink" title="Python面向对象"></a>Python面向对象</h1><p>定义一个类Animals:</p>
<p>(1)<strong>init</strong>()定义构造函数，与其他面向对象语言不同的是，Python语言中，会明确地把代表自身实例的self作为第一个参数传入</p>
<p>(2)创建一个实例化对象 cat，<strong>init</strong>()方法接收参数</p>
<p>(3)使用点号 . 来访问对象的属性。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Animal</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self,name</span>):</span></span><br><span class="line">        self.name = name</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;动物名称实例化&#x27;</span>)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">eat</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(self.name +<span class="string">&#x27;要吃东西啦！&#x27;</span>)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">drink</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(self.name +<span class="string">&#x27;要喝水啦！&#x27;</span>)</span><br><span class="line"></span><br><span class="line">cat =  Animal(<span class="string">&#x27;miaomiao&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(cat.name)</span><br><span class="line">cat.eat()</span><br><span class="line">cat.drink()</span><br></pre></td></tr></table></figure>


<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span>:</span>        </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self,name</span>):</span></span><br><span class="line">        self.name = name</span><br><span class="line">        <span class="built_in">print</span> (<span class="string">&#x27;调用父类构造函数&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">eat</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;调用父类方法&#x27;</span>)</span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span>(<span class="params">Person</span>):</span>  <span class="comment"># 定义子类</span></span><br><span class="line">   <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">      <span class="built_in">print</span> (<span class="string">&#x27;调用子类构造方法&#x27;</span>)</span><br><span class="line"> </span><br><span class="line">   <span class="function"><span class="keyword">def</span> <span class="title">study</span>(<span class="params">self</span>):</span></span><br><span class="line">      <span class="built_in">print</span>(<span class="string">&#x27;调用子类方法&#x27;</span>)</span><br><span class="line"></span><br><span class="line">s = Student()          <span class="comment"># 实例化子类</span></span><br><span class="line">s.study()              <span class="comment"># 调用子类的方法</span></span><br><span class="line">s.eat()                <span class="comment"># 调用父类方法</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="Python-JSON"><a href="#Python-JSON" class="headerlink" title="Python JSON"></a>Python JSON</h1><p>JSON(JavaScript Object Notation) 是一种轻量级的数据交换格式，易于人阅读和编写。</p>
<p>json.dumps 用于将 Python 对象编码成 JSON 字符串。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line">data = [ &#123; <span class="string">&#x27;b&#x27;</span> : <span class="number">2</span>, <span class="string">&#x27;d&#x27;</span> : <span class="number">4</span>, <span class="string">&#x27;a&#x27;</span> : <span class="number">1</span>, <span class="string">&#x27;c&#x27;</span> : <span class="number">3</span>, <span class="string">&#x27;e&#x27;</span> : <span class="number">5</span> &#125; ]</span><br><span class="line">json = json.dumps(data)</span><br><span class="line"><span class="built_in">print</span>(json)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>为了提高可读性，dumps方法提供了一些可选的参数。</p>
<p>sort_keys=True表示按照字典排序(a到z)输出。</p>
<p>indent参数，代表缩进的位数</p>
<p>separators参数的作用是去掉,和:后面的空格，传输过程中数据越精简越好</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line">data = [ &#123; <span class="string">&#x27;b&#x27;</span> : <span class="number">2</span>, <span class="string">&#x27;d&#x27;</span> : <span class="number">4</span>, <span class="string">&#x27;a&#x27;</span> : <span class="number">1</span>, <span class="string">&#x27;c&#x27;</span> : <span class="number">3</span>, <span class="string">&#x27;e&#x27;</span> : <span class="number">5</span> &#125; ]</span><br><span class="line">json = json.dumps(data, sort_keys=<span class="literal">True</span>, indent=<span class="number">4</span>,separators=(<span class="string">&#x27;,&#x27;</span>, <span class="string">&#x27;:&#x27;</span>))</span><br><span class="line"><span class="built_in">print</span>(json)</span><br></pre></td></tr></table></figure>

<p>json.loads 用于解码 JSON 数据。该函数返回 Python 字段的数据类型。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line">jsonData = <span class="string">&#x27;&#123;&quot;a&quot;:1,&quot;b&quot;:2,&quot;c&quot;:3,&quot;d&quot;:4,&quot;e&quot;:5&#125;&#x27;</span></span><br><span class="line">text = json.loads(jsonData)  <span class="comment">#将string转换为dict</span></span><br><span class="line"><span class="built_in">print</span>(text)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="Python异常处理"><a href="#Python异常处理" class="headerlink" title="Python异常处理"></a>Python异常处理</h1><p>当Python脚本发生异常时我们需要捕获处理它，否则程序会终止执行。</p>
<p>捕捉异常可以使用try/except语句。</p>
<p>try/except语句用来检测try语句块中的错误，从而让except语句捕获异常信息并处理。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    fh = <span class="built_in">open</span>(<span class="string">&quot;/home/aistudio/data/testfile01.txt&quot;</span>, <span class="string">&quot;w&quot;</span>)</span><br><span class="line">    fh.write(<span class="string">&quot;这是一个测试文件，用于测试异常!!&quot;</span>)</span><br><span class="line"><span class="keyword">except</span> IOError:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Error: 没有找到文件或读取文件失败&#x27;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span> (<span class="string">&#x27;内容写入文件成功&#x27;</span>)</span><br><span class="line">    fh.close()</span><br></pre></td></tr></table></figure>

<p>finally中的内容，退出try时总会执行</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    f = <span class="built_in">open</span>(<span class="string">&quot;/home/aistudio/data/testfile02.txt&quot;</span>, <span class="string">&quot;w&quot;</span>)</span><br><span class="line">    f.write(<span class="string">&quot;这是一个测试文件，用于测试异常!!&quot;</span>)</span><br><span class="line"><span class="keyword">finally</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;关闭文件&#x27;</span>)</span><br><span class="line">    f.close()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="常见Linux命令"><a href="#常见Linux命令" class="headerlink" title="常见Linux命令"></a>常见Linux命令</h1><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">!ls /home</span><br></pre></td></tr></table></figure>


<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">!ls ./</span><br></pre></td></tr></table></figure>


<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">ls  -l</span><br></pre></td></tr></table></figure>


<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">!pwd</span><br></pre></td></tr></table></figure>

<p>cp ：复制文件或目录</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">!cp test.txt ./test_copy.txt</span><br></pre></td></tr></table></figure>

<p>mv:移动文件与目录，或修改文件与目录的名称</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">!mv /home/aistudio/work/test_copy.txt /home/aistudio/data/</span><br></pre></td></tr></table></figure>

<p>rm :移除文件或目录</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">!rm /home/aistudio/data/test_copy.txt</span><br></pre></td></tr></table></figure>

<p>很多大型文件或者数据从服务器上传或者下载的时候都需要打包和压缩解压，这时候知道压缩和解压的各种命令是很有必要的。</p>
<p>常见的压缩文件后缀名有.tar.gz，.gz，和.zip，下面来看看在Linux上它们分别的解压和压缩命令。</p>
<h2 id="gzip"><a href="#gzip" class="headerlink" title="gzip:"></a>gzip:</h2><p>linux压缩文件中最常见的后缀名即为.gz，gzip是用来压缩和解压.gz文件的命令。</p>
<p>常用参数:</p>
<pre><code>-d或--decompress或--uncompress：解压文件；
-r或--recursive：递归压缩指定文件夹下的文件（该文件夹下的所有文件被压缩成单独的.gz文件）；
-v或--verbose：显示指令执行过程。
注：gzip命令只能压缩单个文件，而不能把一个文件夹压缩成一个文件（与打包命令的区别）。
</code></pre>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#会将文件压缩为文件 test.txt.gz，原来的文件则没有了，解压缩也一样</span></span><br><span class="line">!gzip /home/aistudio/work/test.txt</span><br></pre></td></tr></table></figure>


<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">!gzip -d /home/aistudio/test.gz</span><br></pre></td></tr></table></figure>

<h2 id="tar"><a href="#tar" class="headerlink" title="tar:"></a>tar:</h2><p>tar本身是一个打包命令，用来打包或者解包后缀名为.tar。配合参数可同时实现打包和压缩。</p>
<p>常用参数:</p>
<pre><code>-c或--create：建立新的备份文件；
-x或--extract或--get：从备份文件中还原文件；
-v：显示指令执行过程；
-f或--file：指定备份文件；
-C：指定目的目录；
-z：通过gzip指令处理备份文件；
-j：通过bzip2指令处理备份文件。
</code></pre>
<p>最常用的是将tar命令与gzip命令组合起来，直接对文件夹先打包后压缩：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">!tar -zcvf /home/aistudio/work/test.tar.gz /home/aistudio/work/test.txt</span><br></pre></td></tr></table></figure>


<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">!tar -zxvf /home/aistudio/work/test.tar.gz</span><br></pre></td></tr></table></figure>

<h2 id="zip和unzip"><a href="#zip和unzip" class="headerlink" title="zip和unzip"></a>zip和unzip</h2><p>zip命令和unzip命令用在在Linux上处理.zip的压缩文件。</p>
<p>常用参数</p>
<p>zip:</p>
<pre><code>-v：显示指令执行过程；
-m：不保留原文件；
-r：递归处理。
</code></pre>
<p>unzip:</p>
<pre><code>-v：显示指令执行过程；
-d：解压到指定目录。
</code></pre>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">!<span class="built_in">zip</span> -r /home/aistudio/work/test.<span class="built_in">zip</span> /home/aistudio/work/test.txt</span><br></pre></td></tr></table></figure>


<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">!unzip  /home/aistudio/work/test.<span class="built_in">zip</span> </span><br></pre></td></tr></table></figure>




<p>原文地址：<a href="https://aistudio.baidu.com/aistudio/projectdetail/420385?pV=77924">https://aistudio.baidu.com/aistudio/projectdetail/420385?pV=77924</a></p>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>CentOS 7 下使用 Percona XtraBackup 备份和恢复 MySQL5.7</title>
    <url>/Percona-XtraBackup-MySQL5-7/</url>
    <content><![CDATA[<h1 id="一、概述"><a href="#一、概述" class="headerlink" title="一、概述"></a>一、概述</h1><p><a href="https://www.percona.com/software/mysql-database/percona-xtrabackup">XtraBackup</a> 是 <a href="https://www.percona.com/">Percona</a> 开源的免费数据库热备份软件，它能对InnoDB数据库和XtraDB存储引擎的数据库非阻塞地备份（对于MyISAM的备份同样需要加表锁）；mysqldump备份方式是采用的逻辑备份，其最大的缺陷是备份和恢复速度较慢，如果数据库大于50G，mysqldump备份就不太适合。</p>
<span id="more"></span>

<h2 id="mysqldump优缺点"><a href="#mysqldump优缺点" class="headerlink" title="mysqldump优缺点"></a>mysqldump优缺点</h2><p><strong>优点</strong><br>使用场景：<br>10G以下的数据库操作简单</p>
<p><strong>缺点</strong><br>数据量范围：30G –&gt; TB级别 的时候备份、恢复操作很慢，效率低</p>
<h2 id="xtrabackup备份软件"><a href="#xtrabackup备份软件" class="headerlink" title="xtrabackup备份软件"></a>xtrabackup备份软件</h2><p>使用场景：<br>1、数据量大，变换量小<br>2、数据量小，变化量大</p>
<p>Xtrabackup安装完成后有4个可执行文件，其中2个比较重要的备份工具是innobackupex、xtrabackup</p>
<p>1）xtrabackup 是专门用来备份InnoDB表的，和mysql server没有交互；<br>2）innobackupex 是一个封装xtrabackup的Perl脚本，支持同时备份innodb和myisam，但在对myisam备份时需要加一个全局的读锁。<br>3）xbcrypt 加密解密备份工具<br>4）xbstream 流传打包传输工具，类似tar<br>5）物理备份工具，在同级数据量基础上，都要比逻辑备份性能好的多，特别是在数据量较大的时候，体现的更加明显。</p>
<p><strong>Xtrabackup优点</strong><br>1）备份速度快，物理备份可靠</p>
<p>2）备份过程不会打断正在执行的事务（无需锁表）</p>
<p>3）能够基于压缩等功能节约磁盘空间和流量</p>
<p>4）自动备份校验</p>
<p>5）还原速度快</p>
<p>6）可以流传将备份传输到另外一台机器上</p>
<p>7）在不增加服务器负载的情况备份数据</p>
<p>8）物理备份工具，在同级数据量基础上，都要比逻辑备份性能要好的多。几十G到不超过TB级别的条件下。但在同数据量级别，物理备份恢复数据上有一定优势。</p>
<h2 id="备份原理"><a href="#备份原理" class="headerlink" title="备份原理"></a>备份原理</h2><p>拷贝数据文件、拷贝数据页</p>
<p><strong>对于innodb表可以实现热备。</strong></p>
<p>(1) 在数据库还有修改操作的时刻，直接将数据文件备走，此时，备份走的数据对于当前mysql来讲是不一致的。<br>(2) 将备份过程中的redo和undo一并备走。<br>(3) 为了恢复的时候，只要保证备份出来的数据页lsn能和redo lsn匹配，将来恢复的就是一致的数据。redo应用和undo应用。</p>
<p><strong>对于myisam表实现自动锁表拷贝文件。</strong></p>
<p>　　备份开始时首先会开启一个后台检测进程，实时检测mysql redo的变化，一旦发现有新的日志写入，立刻将日志记入后台日志文件xtrabackup_log中，之后复制innodb的数据文件一系统表空间文件ibdatax，复制结束后，将执行flush tables with readlock,然后复制.frm MYI MYD等文件，最后执行unlock tables,最终停止xtrabackup_log</p>
<h1 id="二、背景"><a href="#二、背景" class="headerlink" title="二、背景"></a>二、背景</h1><p>最近公司上线一个新项目，使用用 DELL 单片机和磁盘阵列，配置如下</p>
<table>
<thead>
<tr>
<th>名称</th>
<th>配置</th>
</tr>
</thead>
<tbody><tr>
<td>操作系统</td>
<td>CentOS 7.7 x64</td>
</tr>
<tr>
<td>主机地址</td>
<td>172.20.8.132</td>
</tr>
<tr>
<td>主机名称</td>
<td>localhost</td>
</tr>
<tr>
<td>MySQL 版本</td>
<td>5.7.28</td>
</tr>
<tr>
<td>XtraBack 版本</td>
<td>2.4.16</td>
</tr>
</tbody></table>
<h1 id="三、安装"><a href="#三、安装" class="headerlink" title="三、安装"></a>三、安装</h1><p>按照<a href="https://www.percona.com/doc/percona-xtrabackup/2.4/installation/yum_repo.html">官网文档</a>，通用 yum 在线方式安装，步骤如下：</p>
<ol>
<li><h2 id="安装-Percona-的-yum-仓库，使用-root-账号执行下面命令："><a href="#安装-Percona-的-yum-仓库，使用-root-账号执行下面命令：" class="headerlink" title="安装 Percona 的 yum 仓库，使用 root 账号执行下面命令："></a>安装 Percona 的 yum 仓库，使用 root 账号执行下面命令：</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@localhost ~]# yum install https://repo.percona.com/yum/percona-release-latest.noarch.rpm</span><br><span class="line">Loaded plugins: fastestmirror, langpacks</span><br><span class="line">percona-release-latest.noarch.rpm                                                                                        |  17 kB  00:00:00     </span><br><span class="line">Examining /var/tmp/yum-root-1mopyU/percona-release-latest.noarch.rpm: percona-release-1.0-13.noarch</span><br><span class="line">Marking /var/tmp/yum-root-1mopyU/percona-release-latest.noarch.rpm to be installed</span><br><span class="line">Resolving Dependencies</span><br><span class="line"><span class="meta">--&gt;</span><span class="bash"> Running transaction check</span></span><br><span class="line"><span class="meta">---&gt;</span><span class="bash"> Package percona-release.noarch 0:1.0-13 will be installed</span></span><br><span class="line"><span class="meta">--&gt;</span><span class="bash"> Finished Dependency Resolution</span></span><br><span class="line"></span><br><span class="line">Dependencies Resolved</span><br><span class="line"></span><br><span class="line">================================================================================================================================================</span><br><span class="line"> Package                            Arch                      Version                   Repository                                         Size</span><br><span class="line">================================================================================================================================================</span><br><span class="line">Installing:</span><br><span class="line"> percona-release                    noarch                    1.0-13                    /percona-release-latest.noarch                     20 k</span><br><span class="line"></span><br><span class="line">Transaction Summary</span><br><span class="line">================================================================================================================================================</span><br><span class="line">Install  1 Package</span><br><span class="line"></span><br><span class="line">Total size: 20 k</span><br><span class="line">Installed size: 20 k</span><br><span class="line">Is this ok [y/d/N]: y</span><br><span class="line">Downloading packages:</span><br><span class="line">Running transaction check</span><br><span class="line">Running transaction test</span><br><span class="line">Transaction test succeeded</span><br><span class="line">Running transaction</span><br><span class="line">  Installing : percona-release-1.0-13.noarch                                                                                                1/1 </span><br><span class="line">* Enabling the Percona Original repository</span><br><span class="line">&lt;*&gt; All done!</span><br><span class="line">The percona-release package now contains a percona-release script that can enable additional repositories for our newer products.</span><br><span class="line"></span><br><span class="line">For example, to enable the Percona Server 8.0 repository use:</span><br><span class="line"></span><br><span class="line">  percona-release setup ps80</span><br><span class="line"></span><br><span class="line">Note: To avoid conflicts with older product versions, the percona-release setup command may disable our original repository for some products.</span><br><span class="line"></span><br><span class="line">For more information, please visit:</span><br><span class="line">  https://www.percona.com/doc/percona-repo-config/percona-release.html</span><br><span class="line"></span><br><span class="line">  Verifying  : percona-release-1.0-13.noarch                                                                                                1/1 </span><br><span class="line"></span><br><span class="line">Installed:</span><br><span class="line">  percona-release.noarch 0:1.0-13                                                                                                               </span><br><span class="line"></span><br><span class="line">Complete!</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><h2 id="启用-Percona-的-yum-仓库"><a href="#启用-Percona-的-yum-仓库" class="headerlink" title="启用 Percona 的 yum 仓库"></a>启用 Percona 的 yum 仓库</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@localhost ~]#  percona-release enable-only tools release                      </span><br><span class="line">* Disabling all Percona Repositories</span><br><span class="line">* Enabling the Percona Tools repository</span><br><span class="line">&lt;*&gt; All done!</span><br></pre></td></tr></table></figure></li>
<li><h3 id="安装-Percona-XtraBackup"><a href="#安装-Percona-XtraBackup" class="headerlink" title="安装 Percona XtraBackup"></a>安装 Percona XtraBackup</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@localhost databases]# yum list | grep percona                             </span><br><span class="line">percona-release.noarch                      1.0-13                     @/percona-release-latest.noarch</span><br><span class="line">percona-backup-mongodb.x86_64               1.0.0-1.el7                tools-release-x86_64</span><br><span class="line">percona-mysql-shell.x86_64                  8.0.15-1.el7               tools-release-x86_64</span><br><span class="line">percona-mysql-shell-debuginfo.x86_64        8.0.15-1.el7               tools-release-x86_64</span><br><span class="line">percona-toolkit.x86_64                      3.1.0-2.el7                tools-release-x86_64</span><br><span class="line">percona-toolkit-debuginfo.x86_64            3.0.13-1.el7               tools-release-x86_64</span><br><span class="line">percona-xtrabackup-24.x86_64                2.4.16-1.el7               tools-release-x86_64</span><br><span class="line">percona-xtrabackup-24-debuginfo.x86_64      2.4.16-1.el7               tools-release-x86_64</span><br><span class="line">percona-xtrabackup-80.x86_64                8.0.8-1.el7                tools-release-x86_64</span><br><span class="line">percona-xtrabackup-80-debuginfo.x86_64      8.0.8-1.el7                tools-release-x86_64</span><br><span class="line">percona-xtrabackup-test-24.x86_64           2.4.16-1.el7               tools-release-x86_64</span><br><span class="line">percona-xtrabackup-test-80.x86_64           8.0.8-1.el7                tools-release-x86_64</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@localhost databases]# yum install -y percona-xtrabackup-24.x86_64</span><br><span class="line">Loaded plugins: fastestmirror, langpacks</span><br><span class="line">Loading mirror speeds from cached hostfile</span><br><span class="line"> * base: mirrors.tuna.tsinghua.edu.cn</span><br><span class="line"> * extras: mirrors.cqu.edu.cn</span><br><span class="line"> * updates: mirrors.cqu.edu.cn</span><br><span class="line">Resolving Dependencies</span><br><span class="line"><span class="meta">--&gt;</span><span class="bash"> Running transaction check</span></span><br><span class="line"><span class="meta">---&gt;</span><span class="bash"> Package percona-xtrabackup-24.x86_64 0:2.4.16-1.el7 will be installed</span></span><br><span class="line"><span class="meta">--&gt;</span><span class="bash"> Finished Dependency Resolution</span></span><br><span class="line"></span><br><span class="line">Dependencies Resolved</span><br><span class="line"></span><br><span class="line">================================================================================================================================================</span><br><span class="line"> Package                                 Arch                     Version                          Repository                              Size</span><br><span class="line">================================================================================================================================================</span><br><span class="line">Installing:</span><br><span class="line"> percona-xtrabackup-24                   x86_64                   2.4.16-1.el7                     tools-release-x86_64                   7.6 M</span><br><span class="line"></span><br><span class="line">Transaction Summary</span><br><span class="line">================================================================================================================================================</span><br><span class="line">Install  1 Package</span><br><span class="line"></span><br><span class="line">Total download size: 7.6 M</span><br><span class="line">Installed size: 7.6 M</span><br><span class="line">Downloading packages:</span><br><span class="line">percona-xtrabackup-24-2.4.16-1.el7.x86_64.rpm                                                                            | 7.6 MB  00:01:49     </span><br><span class="line">Running transaction check</span><br><span class="line">Running transaction test</span><br><span class="line">Transaction test succeeded</span><br><span class="line">Running transaction</span><br><span class="line">  Installing : percona-xtrabackup-24-2.4.16-1.el7.x86_64                                                                                    1/1 </span><br><span class="line">  Verifying  : percona-xtrabackup-24-2.4.16-1.el7.x86_64                                                                                    1/1 </span><br><span class="line"></span><br><span class="line">Installed:</span><br><span class="line">  percona-xtrabackup-24.x86_64 0:2.4.16-1.el7                                                                                                   </span><br><span class="line"></span><br><span class="line">Complete!</span><br></pre></td></tr></table></figure></li>
<li><h2 id="若要删除-Percona-XtraBackup-，使用-root-账号或者-sudo-执行："><a href="#若要删除-Percona-XtraBackup-，使用-root-账号或者-sudo-执行：" class="headerlink" title="若要删除 Percona XtraBackup ，使用 root 账号或者 sudo 执行："></a>若要删除 Percona XtraBackup ，使用 root 账号或者 sudo 执行：</h2> <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@localhost databases]# rpm -qa|grep percona</span><br><span class="line">percona-xtrabackup-80-8.0.8-1.el7.x86_64</span><br><span class="line">percona-release-1.0-13.noarch</span><br><span class="line">[root@localhost databases]#  yum remove percona-xtrabackup-80-8.0.8-1.el7.x86_64</span><br><span class="line">Loaded plugins: fastestmirror, langpacks</span><br><span class="line">Resolving Dependencies</span><br><span class="line"><span class="meta">--&gt;</span><span class="bash"> Running transaction check</span></span><br><span class="line"><span class="meta">---&gt;</span><span class="bash"> Package percona-xtrabackup-80.x86_64 0:8.0.8-1.el7 will be erased</span></span><br><span class="line"><span class="meta">--&gt;</span><span class="bash"> Finished Dependency Resolution</span></span><br><span class="line"></span><br><span class="line">Dependencies Resolved</span><br><span class="line"></span><br><span class="line">================================================================================================================================================</span><br><span class="line"> Package                                 Arch                     Version                         Repository                               Size</span><br><span class="line">================================================================================================================================================</span><br><span class="line">Removing:</span><br><span class="line"> percona-xtrabackup-80                   x86_64                   8.0.8-1.el7                     @tools-release-x86_64                    54 M</span><br><span class="line"></span><br><span class="line">Transaction Summary</span><br><span class="line">================================================================================================================================================</span><br><span class="line">Remove  1 Package</span><br><span class="line"></span><br><span class="line">Installed size: 54 M</span><br><span class="line">Is this ok [y/N]: y</span><br><span class="line">Downloading packages:</span><br><span class="line">Running transaction check</span><br><span class="line">Running transaction test</span><br><span class="line">Transaction test succeeded</span><br><span class="line">Running transaction</span><br><span class="line">  Erasing    : percona-xtrabackup-80-8.0.8-1.el7.x86_64                                                                                     1/1 </span><br><span class="line">  Verifying  : percona-xtrabackup-80-8.0.8-1.el7.x86_64                                                                                     1/1 </span><br><span class="line"></span><br><span class="line">Removed:</span><br><span class="line">  percona-xtrabackup-80.x86_64 0:8.0.8-1.el7                                                                                                    </span><br><span class="line"></span><br><span class="line">Complete!</span><br></pre></td></tr></table></figure></li>
<li><h2 id="检查是否成功安装-Percona-XtraBackup"><a href="#检查是否成功安装-Percona-XtraBackup" class="headerlink" title="检查是否成功安装 Percona XtraBackup"></a>检查是否成功安装 Percona XtraBackup</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@localhost databases]# xtrabackup -v</span><br><span class="line">xtrabackup: recognized server arguments: --datadir=/data1/databases/mysql/data </span><br><span class="line">xtrabackup version 2.4.16 based on MySQL server 5.7.26 Linux (x86_64) (revision id: c807cfa)</span><br></pre></td></tr></table></figure></li>
</ol>
<h1 id="xtrabackup实践操作"><a href="#xtrabackup实践操作" class="headerlink" title="xtrabackup实践操作"></a>xtrabackup实践操作</h1><p><strong>全量备份</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">innobackupex --defaults-file=/etc/my.cnf --host=127.0.0.1 --user=root --password=123456  /data1/databases/backup/xfull/ </span><br></pre></td></tr></table></figure>

<p><strong>查看备份</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@localhost databases]# ls /data1/databases/backup/xfull/ -lh</span><br><span class="line">total 4.0K</span><br><span class="line">drwxr-x---. 5 root root 4.0K Nov 28 22:08 2019-11-28_22-02-20</span><br></pre></td></tr></table></figure>

<p><strong>恢复</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">service mysql stop</span><br><span class="line">innobackupex --apply-log /data1/databases/backup/xfull/2019-11-28_22-02-20/</span><br><span class="line"> rm /data1/databases/mysql/data -rf</span><br><span class="line">innobackupex --defaults-file=/etc/my.cnf --copy-back --rsync /data1/databases/backup/xfull/2019-11-28_22-02-20/</span><br><span class="line">chown -R mysql:mysql /data1/databases/mysql/</span><br><span class="line">service mysql  start</span><br></pre></td></tr></table></figure>



<h2 id="增量备份与恢复"><a href="#增量备份与恢复" class="headerlink" title="增量备份与恢复"></a>增量备份与恢复</h2><p>innobackupex增量备份过程中的”增量”处理，其实主要是相对innodb而言，对myisam和其他存储引擎而言，它仍然是全拷贝(全备份)<br>增量备份从哪增量？<br>基于上一次的备份进行增量。<br>redo默认情况下是一组两个文件，并且有固定大小。其使用的文件是一种轮询使用方式，他不是永久的，文件随时可能被覆盖。</p>
<p>注意：千万不要在业务繁忙时做备份。</p>
<p>备份什么内容？</p>
<p>1、可以使用binlog作为增量</p>
<p>2、自带的增量备份，基于上次备份后的变化的数据页，还要备份在备份过程中的undo、redo变化</p>
<p><strong>操作</strong><br>1、先进行第一次全备</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">innobackupex --defaults-file=/etc/my.cnf --host=127.0.0.1 --user=root --password=123456 /data1/databases/backup/xfull/ </span><br></pre></td></tr></table></figure>

<p>2、再进行增量备份。这个是在全备的基础上做的，需要指定全量备份的目录：/data1/databases/backup/xfull/ ；增量备份到 /data1/databases/backup//xinc1</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">innobackupex --defaults-file=/etc/my.cnf --host=127.0.0.1 --user=root --password=123456 --incremental --incremental-basedir=/data1/databases/backup/xfull/2019-11-28_22-02-20/ /data1/databases/backup/xinc1</span><br></pre></td></tr></table></figure>

<p><strong>恢复</strong><br>1、先应用全备日志</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">innobackupex --apply-log --redo-only /data1/databases/backup/xfull/2019-11-28_22-02-20/</span><br></pre></td></tr></table></figure>

<p>2、合并增量到全备中（一致性的合并）</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">innobackupex --apply-log -redo-only --incremental-dir=/data1/databases/backup/xinc1/2019-11-28_22-22-57/ /data1/databases/backup/xfull/2019-11-28_22-02-20/</span><br><span class="line">innobackupex --apply-log --incremental-dir=/data1/databases/backup/xinc1/2019-11-28_22-23-11/ /data1/databases/backup/xfull/2019-11-28_22-02-20/</span><br><span class="line">innobackupex --apply-log /data1/databases/backup/xfull/2019-11-28_22-02-20/</span><br></pre></td></tr></table></figure>

<p>3、合并完成进行恢复<br>使用innobackupex命令进行恢复(推荐)</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">innobackupex --defaults-file=/etc/my.cnf --copy-back --rsync /data1/databases/backup/xfull/2019-11-28_22-02-20/</span><br><span class="line">chown -R mysql:mysql /data1/databases/mysql/</span><br></pre></td></tr></table></figure>

<p><strong>数据库备份策略</strong><br>每周的周日进行一次全备；周一到周六每天做上一天增量，每周轮询一次。<br>备份方案： xtrabackup全备+增量</p>
<p>备份策略（crontab）：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">crontab -e</span><br><span class="line"><span class="meta">#</span><span class="bash"> 每周一的凌晨3点执行完全备份</span></span><br><span class="line">0 3 * * 1 /data1/databases/shell/allbak.sh  &gt;/dev/null </span><br><span class="line"></span><br><span class="line">vim /root/allbak.sh</span><br><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line">tmpPath=/data1/databases/backup/xfull</span><br><span class="line">compressPath=/data1/databases/backup/compress/$(date &#x27;+%Y/%m/&#x27;)</span><br><span class="line"><span class="meta">#</span><span class="bash"> 定义日期是时间</span></span><br><span class="line">day=`date +%F` </span><br><span class="line">user=root</span><br><span class="line">pass=123456</span><br><span class="line">host=127.0.0.1</span><br><span class="line"><span class="meta">#</span><span class="bash"> 新建个文件夹临时存放备份文件的</span></span><br><span class="line">[ ! -e &quot;$&#123;tmpPath&#125;/$&#123;day&#125;-full&quot; ]&amp;&amp; mkdir -p &quot;$&#123;tmpPath&#125;/$&#123;day&#125;-full&quot;</span><br><span class="line">[ ! -e $&#123;compressPath&#125; ]&amp;&amp; mkdir -p $&#123;compressPath&#125;</span><br><span class="line"><span class="meta">#</span><span class="bash"> 删除历史备份临时文件</span></span><br><span class="line">[ -e $&#123;tmpPath&#125; ]&amp;&amp; rm -rf &quot;$&#123;tmpPath&#125;/*&quot;</span><br><span class="line"><span class="meta">#</span><span class="bash"> 用innobackupex做完全备份</span></span><br><span class="line">innobackupex --host=$host --user=$user --password=$pass &quot;$&#123;tmpPath&#125;/$&#123;day&#125;-full&quot; --no-timestamp </span><br><span class="line">cd &quot;$&#123;tmpPath&#125;&quot;</span><br><span class="line">echo &quot;$(date &#x27;+%Y-%m-%d %H:%M:%S&#x27;)&quot; &gt; &quot;$&#123;day&#125;-full/time.txt&quot;</span><br><span class="line">echo &quot;本次全量备份时间： $(date &#x27;+%Y-%m-%d %H:%M:%S&#x27;)&quot; &gt;&gt; &quot;$&#123;day&#125;-full/full.txt&quot;</span><br><span class="line">tar -czvf &quot;$&#123;compressPath&#125;/$(date &#x27;+%Y-%m-%d_%H_%M_%S&#x27;)-full.tar.gz&quot;  &quot;$&#123;day&#125;-full&quot;</span><br><span class="line"><span class="meta">#</span><span class="bash"> 启用binlog日志，每次完全备份之后，每周刷新一遍binlog日志</span></span><br><span class="line">mysql -h$host  -u$user -p$pass -e &quot;flush logs&quot;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 每周二到周日的凌晨4点执行增量备份</span></span><br><span class="line">0 4 * * 2-7 /data1/databases/shell/newbak.sh  &gt;/dev/null </span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 周一全备，如果是周二执行，判断dir1 存在，则增量备份，如果不存在，则判断昨天的增量，存在则执行周三的增量，如果都没有，则全备执行一次吧</span></span><br><span class="line">vi /data1/databases/shell/newbak.sh</span><br><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 定义时间，用日期来区分</span></span><br><span class="line">d1=`date +%F` </span><br><span class="line"><span class="meta">#</span><span class="bash"> 找到昨天的日期，好指明上一次备份的备份文件</span></span><br><span class="line">d2=`date +%F -d &quot;-1 days&quot; `</span><br><span class="line"><span class="meta">#</span><span class="bash"> 昨天做的完全备份文件</span></span><br><span class="line">dir1=&quot;/data1/databases/backup/xfull/$&#123;d2&#125;-full&quot; </span><br><span class="line"><span class="meta">#</span><span class="bash">昨天做的增量备份文件</span></span><br><span class="line">dir2=&quot;/data1/databases/backup/xincrement/$&#123;d2&#125;-increment&quot; </span><br><span class="line"><span class="meta">#</span><span class="bash"> 备份压缩文件存储路径</span></span><br><span class="line">compressPath=/data1/databases/backup/compress/$(date &#x27;+%Y/%m/&#x27;)</span><br><span class="line">host=127.0.0.1</span><br><span class="line">user=root</span><br><span class="line">pass=123456</span><br><span class="line"><span class="meta">#</span><span class="bash"> 如果文件不存在，则创建文件夹</span></span><br><span class="line">[ ! -e $(dirname $dir1 ) ]&amp;&amp; mkdir -p $(dirname $dir1 )</span><br><span class="line">[ ! -e $(dirname $dir2 ) ]&amp;&amp; mkdir -p $(dirname $dir2 )</span><br><span class="line">[ ! -e $&#123;compressPath&#125; ]&amp;&amp; mkdir -p &quot;$&#123;compressPath&#125;&quot; </span><br><span class="line"><span class="meta">#</span><span class="bash"> 判断昨天做的是增量备份</span></span><br><span class="line">if [ -e $&#123;dir2&#125; ];then </span><br><span class="line">        # 指定昨天备份的增量备份文件</span><br><span class="line">        innobackupex --host=$host --user=$user --password=$pass --incremental &quot;$(dirname $dir2)/$&#123;d1&#125;-increment&quot; --incremental-basedir=&quot;$&#123;dir2&#125;&quot; --no-timestamp </span><br><span class="line">        cd &quot;$(dirname $dir2)&quot;</span><br><span class="line">        echo &quot;$(date &#x27;+%Y-%m-%d %H:%M:%S&#x27;)&quot; &gt; &quot;$&#123;d1&#125;-increment/time.txt&quot;</span><br><span class="line">        echo &quot;本次增量量备份时间： $(date &#x27;+%Y-%m-%d %H:%M:%S&#x27;)&quot; &gt; &quot;$&#123;d1&#125;-increment/increment.txt&quot;</span><br><span class="line">        echo &quot;基于上次增量备份时间： $(cat $dir2/time.txt)&quot; &gt;&gt; &quot;$&#123;d1&#125;-increment/increment.txt&quot;</span><br><span class="line">        tar -czvf &quot;$&#123;compressPath&#125;/$(date &#x27;+%Y-%m-%d_%H_%M_%S&#x27;)-increment.tar.gz&quot;  &quot;$&#123;d1&#125;-increment&quot;</span><br><span class="line">        echo &quot; 指定昨天备份的增量备份文件&quot;</span><br><span class="line">        # 删除上次的增量备份的临时文件</span><br><span class="line">        [ -e &quot;$&#123;dir2&#125;&quot; ]&amp;&amp; rm -rf &quot;$&#123;dir2&#125;&quot;</span><br><span class="line"><span class="meta">#</span><span class="bash"> 判断昨天做的是全量备份</span></span><br><span class="line">elif [ -e $&#123;dir1&#125; ];then </span><br><span class="line">          # 删除上次的增量备份的临时文件</span><br><span class="line">          [ -e &quot;$(dirname $dir2)&quot; ]&amp;&amp; rm -rf &quot;$(dirname $dir2)/*&quot;</span><br><span class="line">          # 指定昨天备份的完全备份文件</span><br><span class="line">          innobackupex --host=$host --user=$user --password=$pass --incremental &quot;$(dirname $dir2)/$&#123;d1&#125;-increment&quot; --incremental-basedir=$&#123;dir1&#125; --no-timestamp </span><br><span class="line">          cd &quot;$(dirname $dir2)&quot;</span><br><span class="line">          echo &quot;$(date &#x27;+%Y-%m-%d %H:%M:%S&#x27;)&quot; &gt; &quot;$&#123;d1&#125;-increment/time.txt&quot;</span><br><span class="line">          echo &quot;本次增量量备份时间： $(date &#x27;+%Y-%m-%d %H:%M:%S&#x27;)&quot; &gt; &quot;$&#123;d1&#125;-increment/increment.txt&quot;</span><br><span class="line">          echo &quot;基于上次全量备份时间： $(cat $dir1/time.txt)&quot; &gt;&gt; &quot;$&#123;d1&#125;-increment/increment.txt&quot;</span><br><span class="line">          tar -czvf &quot;$&#123;compressPath&#125;/$(date &#x27;+%Y-%m-%d_%H_%M_%S&#x27;)-increment.tar.gz&quot;  &quot;$&#123;d1&#125;-increment&quot;</span><br><span class="line">          echo &quot; 指定昨天备份的完全备份文件 &quot;</span><br><span class="line">else</span><br><span class="line"><span class="meta">#</span><span class="bash"> 昨天既没有做增量备份，又没有做完全备份，则做一次完全备份。</span></span><br><span class="line">        # 删除上次的全量备份的临时文件</span><br><span class="line">        [ -e &quot;$(dirname $dir1)&quot; ]&amp;&amp; rm -rf &quot;$(dirname $dir1)/*&quot;</span><br><span class="line">        # 做一次完全备份。</span><br><span class="line">        innobackupex --host=$host --user=$user --password=$pass &quot;$(dirname $dir1)/$&#123;d1&#125;-full&quot; --no-timestamp </span><br><span class="line">        cd &quot;$(dirname $dir1)&quot;</span><br><span class="line">        echo &quot;$(date &#x27;+%Y-%m-%d %H:%M:%S&#x27;)&quot; &gt; &quot;$&#123;d1&#125;-full/time.txt&quot;</span><br><span class="line">        echo &quot;本次全量备份时间： $(date &#x27;+%Y-%m-%d %H:%M:%S&#x27;)&quot; &gt; &quot;$&#123;d1&#125;-full/full.txt&quot;</span><br><span class="line">        tar -czvf &quot;$&#123;compressPath&#125;/$(date &#x27;+%Y-%m-%d_%H_%M_%S&#x27;)-full.tar.gz&quot;  &quot;$&#123;d1&#125;-full&quot;</span><br><span class="line">        echo &quot; 做一次完全备份&quot;</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">echo &quot;  $&#123;dir1&#125; $&#123;dir2&#125; $&#123;compressPath&#125;&quot;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>实际应用</strong></p>
<p>binlog日志 默认大小：1G左右，设置 ，配置文件里加一个 max_binlog_size = ？</p>
<p>数据创建阶段</p>
<p>1、创建备份需要的目录</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">mkdir full inc1 inc2</span><br></pre></td></tr></table></figure>

<p>2、周日全备</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">innobackupex --user=root --password=123 --no-timestamp /backup/xbackup/full/</span><br></pre></td></tr></table></figure>

<p>3、模拟数据变化</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">use oldboy</span><br><span class="line">create table test(id int,name char(20),age int);</span><br><span class="line">insert into test values(8,&#x27;outman&#x27;,99);</span><br><span class="line">insert into test values(9,&#x27;outgirl&#x27;,100);</span><br><span class="line">commit;</span><br></pre></td></tr></table></figure>

<p>4、周一增量备份</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">innobackupex --user=root --password=123 --incremental --no-timestamp --incremental-basedir=/backup/xbackup/full/ /backup/xbackup/inc1</span><br></pre></td></tr></table></figure>

<p>5、模拟数据变化</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">use oldboy</span><br><span class="line">insert into test values(8,&#x27;outman1&#x27;,119);</span><br><span class="line">insert into test values(9,&#x27;outgirl1&#x27;,120);</span><br><span class="line">commit;</span><br></pre></td></tr></table></figure>

<p>6、周二的增量备份</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">innobackupex --user=root --password=123 --incremental --no-timestamp --incremental-basedir=/backup/xbackup/inc1 /backup/xbackup/inc2</span><br></pre></td></tr></table></figure>



<ol>
<li><p>再插入新的行操作</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">use oldboy</span><br><span class="line">insert into test values(10,&#x27;outman2&#x27;,19);</span><br><span class="line">insert into test values(11,&#x27;outgirl2&#x27;,10);</span><br><span class="line">commit;</span><br></pre></td></tr></table></figure></li>
</ol>
<p>模拟误操作事故</p>
<p>模拟场景，周二下午2点误删除test表</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">use oldboy;</span><br><span class="line">drop table test;</span><br></pre></td></tr></table></figure>

<p>准备恢复数据</p>
<p>1.准备xtrabackup备份，合并备份</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">innobackupex --apply-log --redo-only /backup/xbackup/full</span><br><span class="line">innobackupex --apply-log --redo-only --incremental-dir=/backup/xbackup/inc1 /backup/xbackup/full</span><br><span class="line">innobackupex --apply-log --incremental-dir=/backup/xbackup/inc2 /backup/xbackup/full</span><br><span class="line">innobackupex --apply-log /backup/xbackup/full</span><br></pre></td></tr></table></figure>


<p>2．确认binlog起点，准备截取binlog。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cd /backup/xbackup/inc2/</span><br><span class="line">cat xtrabackup_binlog_info</span><br><span class="line">mysql-bin.000001 1121</span><br></pre></td></tr></table></figure>


<p>3.截取到drop操作之前的binlog</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">mysqlbinlog --start-position=1121 /tmp/mysql-bin.000003</span><br></pre></td></tr></table></figure>

<p>找到drop之前的event和postion号做日志截取，假如 1437 这个可以用 mysqlbinlog master-bin.000032|less </p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">mysqlbinlog --start-position=1121 --stop-position=1437 /tmp/mysql-bin.000003 &gt;/tmp/incbinlog.sql</span><br></pre></td></tr></table></figure>

<p>4．关闭数据库、备份二进制日志</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">/etc/init.d/mysqld stop</span><br><span class="line">cd /application/mysql/data/</span><br><span class="line">cp mysql-bin.000001 /tmp</span><br></pre></td></tr></table></figure>

<p>5.删除MySQL所有数据</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cd /application/mysql/data/</span><br><span class="line">rm -rf *</span><br></pre></td></tr></table></figure>

<p>恢复数据</p>
<p>1．将全量备份的数据恢复到数据目录下</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">innobackupex --defaults-file=/etc/my.cnf --copy-back --rsync /backup/xbackup/full/</span><br><span class="line">chown -R mysql:mysql /application/mysql/data/</span><br><span class="line">/etc/init.d/mysqld start</span><br></pre></td></tr></table></figure>

<p>2.恢复binlog记录</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">set sql_log_bin=0</span><br><span class="line">source /tmp/incbinlog.sql</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>centos</category>
        <category>mysql</category>
        <category>Percona XtraBackup</category>
      </categories>
      <tags>
        <tag>centos</tag>
        <tag>mysql</tag>
        <tag>Percona XtraBackup</tag>
      </tags>
  </entry>
  <entry>
    <title>Springboot启动扩展点超详细总结，再也不怕面试官问了</title>
    <url>/Spring-Boot-Extend/</url>
    <content><![CDATA[<h2 id="1-背景"><a href="#1-背景" class="headerlink" title="1.背景"></a>1.背景</h2><p>Spring的核心思想就是容器，当容器refresh的时候，外部看上去风平浪静，其实内部则是一片惊涛骇浪，汪洋一片。Springboot更是封装了Spring，遵循约定大于配置，加上自动装配的机制。很多时候我们只要引用了一个依赖，几乎是零配置就能完成一个功能的装配。</p>
<p>我非常喜欢这种自动装配的机制，所以在自己开发中间件和公共依赖工具的时候也会用到这个特性。让使用者以最小的代价接入。想要把自动装配玩的转，就必须要了解spring对于bean的构造生命周期以及各个扩展接口。当然了解了bean的各个生命周期也能促进我们加深对spring的理解。业务代码也能合理利用这些扩展点写出更加漂亮的代码。</p>
<p>在网上搜索spring扩展点，发现很少有博文说的很全的，只有一些常用的扩展点的说明。</p>
<p>所以在这篇文章里，我总结了几乎Spring &amp; Springboot所有的扩展接口，以及各个扩展点的使用场景。并且整理出了一个bean在spring内部从被加载到最后初始化完成所有可扩展点的顺序调用图。从而我们也能窥探到bean是如何一步步加载到spring容器中的。</p>
<span id="more"></span>

<h2 id="2-可扩展的接口启动调用顺序图"><a href="#2-可扩展的接口启动调用顺序图" class="headerlink" title="2.可扩展的接口启动调用顺序图"></a>2.可扩展的接口启动调用顺序图</h2><p>以下是我整理的spring容器中Bean的生命周期内所有可扩展的点的调用顺序，下面会一个个分析</p>
<p><img src="https://upload-images.jianshu.io/upload_images/7880910-df5c16edbf034676.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1200/format/webp" alt="img"></p>
<p>1.jpg</p>
<h2 id="3-ApplicationContextInitializer"><a href="#3-ApplicationContextInitializer" class="headerlink" title="3.ApplicationContextInitializer"></a>3.ApplicationContextInitializer</h2><blockquote>
<p>org.springframework.context.ApplicationContextInitializer</p>
</blockquote>
<p>这是整个spring容器在刷新之前初始化<code>ConfigurableApplicationContext</code>的回调接口，简单来说，就是在容器刷新之前调用此类的<code>initialize</code>方法。这个点允许被用户自己扩展。用户可以在整个spring容器还没被初始化之前做一些事情。</p>
<p>可以想到的场景可能为，在最开始激活一些配置，或者利用这时候class还没被类加载器加载的时机，进行动态字节码注入等操作。</p>
<p>扩展方式为：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestApplicationContextInitializer</span> <span class="keyword">implements</span> <span class="title">ApplicationContextInitializer</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">initialize</span><span class="params">(ConfigurableApplicationContext applicationContext)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;[ApplicationContextInitializer]&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>因为这时候spring容器还没被初始化，所以想要自己的扩展的生效，有以下三种方式：</p>
<ul>
<li>在启动类中用<code>springApplication.addInitializers(new TestApplicationContextInitializer())</code>语句加入</li>
<li>配置文件配置<code>context.initializer.classes=com.example.demo.TestApplicationContextInitializer</code></li>
<li>Spring SPI扩展，在spring.factories中加入<code>org.springframework.context.ApplicationContextInitializer=com.example.demo.TestApplicationContextInitializer</code></li>
</ul>
<h2 id="4-BeanDefinitionRegistryPostProcessor"><a href="#4-BeanDefinitionRegistryPostProcessor" class="headerlink" title="4.BeanDefinitionRegistryPostProcessor"></a>4.BeanDefinitionRegistryPostProcessor</h2><blockquote>
<p>org.springframework.beans.factory.support.BeanDefinitionRegistryPostProcessor</p>
</blockquote>
<p>这个接口在读取项目中的<code>beanDefinition</code>之后执行，提供一个补充的扩展点</p>
<p>使用场景：你可以在这里动态注册自己的<code>beanDefinition</code>，可以加载classpath之外的bean</p>
<p>扩展方式为:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestBeanDefinitionRegistryPostProcessor</span> <span class="keyword">implements</span> <span class="title">BeanDefinitionRegistryPostProcessor</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">postProcessBeanDefinitionRegistry</span><span class="params">(BeanDefinitionRegistry registry)</span> <span class="keyword">throws</span> BeansException </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;[BeanDefinitionRegistryPostProcessor] postProcessBeanDefinitionRegistry&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">postProcessBeanFactory</span><span class="params">(ConfigurableListableBeanFactory beanFactory)</span> <span class="keyword">throws</span> BeansException </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;[BeanDefinitionRegistryPostProcessor] postProcessBeanFactory&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="5-BeanFactoryPostProcessor"><a href="#5-BeanFactoryPostProcessor" class="headerlink" title="5.BeanFactoryPostProcessor"></a>5.BeanFactoryPostProcessor</h2><blockquote>
<p>org.springframework.beans.factory.config.BeanFactoryPostProcessor</p>
</blockquote>
<p>这个接口是<code>beanFactory</code>的扩展接口，调用时机在spring在读取<code>beanDefinition</code>信息之后，实例化bean之前。</p>
<p>在这个时机，用户可以通过实现这个扩展接口来自行处理一些东西，比如修改已经注册的<code>beanDefinition</code>的元信息。</p>
<p>扩展方式为：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestBeanFactoryPostProcessor</span> <span class="keyword">implements</span> <span class="title">BeanFactoryPostProcessor</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">postProcessBeanFactory</span><span class="params">(ConfigurableListableBeanFactory beanFactory)</span> <span class="keyword">throws</span> BeansException </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;[BeanFactoryPostProcessor]&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="6-InstantiationAwareBeanPostProcessor"><a href="#6-InstantiationAwareBeanPostProcessor" class="headerlink" title="6.InstantiationAwareBeanPostProcessor"></a>6.InstantiationAwareBeanPostProcessor</h2><blockquote>
<p>org.springframework.beans.factory.config.InstantiationAwareBeanPostProcessor</p>
</blockquote>
<p>该接口继承了<code>BeanPostProcess</code>接口，区别如下：</p>
<p><font color="red"><strong><code>BeanPostProcess</code>接口只在bean的初始化阶段进行扩展（注入spring上下文前后），而<code>InstantiationAwareBeanPostProcessor</code>接口在此基础上增加了3个方法，把可扩展的范围增加了实例化阶段和属性注入阶段。</strong></font></p>
<p>该类主要的扩展点有以下5个方法，主要在bean生命周期的两大阶段：<font color=red><strong>实例化阶段</strong></font>和<font color=red><strong>初始化阶段</strong></font>，下面一起进行说明，按调用顺序为：</p>
<ul>
<li><code>postProcessBeforeInstantiation</code>：实例化bean之前，相当于new这个bean之前</li>
<li><code>postProcessAfterInstantiation</code>：实例化bean之后，相当于new这个bean之后</li>
<li><code>postProcessPropertyValues</code>：bean已经实例化完成，在属性注入时阶段触发，<code>@Autowired</code>,<code>@Resource</code>等注解原理基于此方法实现</li>
<li><code>postProcessBeforeInitialization</code>：初始化bean之前，相当于把bean注入spring上下文之前</li>
<li><code>postProcessAfterInitialization</code>：初始化bean之后，相当于把bean注入spring上下文之后</li>
</ul>
<p>使用场景：这个扩展点非常有用 ，无论是写中间件和业务中，都能利用这个特性。比如对实现了某一类接口的bean在各个生命期间进行收集，或者对某个类型的bean进行统一的设值等等。</p>
<p>扩展方式为：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestInstantiationAwareBeanPostProcessor</span> <span class="keyword">implements</span> <span class="title">InstantiationAwareBeanPostProcessor</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">postProcessBeforeInitialization</span><span class="params">(Object bean, String beanName)</span> <span class="keyword">throws</span> BeansException </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;[TestInstantiationAwareBeanPostProcessor] before initialization &quot;</span> + beanName);</span><br><span class="line">        <span class="keyword">return</span> bean;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">postProcessAfterInitialization</span><span class="params">(Object bean, String beanName)</span> <span class="keyword">throws</span> BeansException </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;[TestInstantiationAwareBeanPostProcessor] after initialization &quot;</span> + beanName);</span><br><span class="line">        <span class="keyword">return</span> bean;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">postProcessBeforeInstantiation</span><span class="params">(Class&lt;?&gt; beanClass, String beanName)</span> <span class="keyword">throws</span> BeansException </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;[TestInstantiationAwareBeanPostProcessor] before instantiation &quot;</span> + beanName);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">postProcessAfterInstantiation</span><span class="params">(Object bean, String beanName)</span> <span class="keyword">throws</span> BeansException </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;[TestInstantiationAwareBeanPostProcessor] after instantiation &quot;</span> + beanName);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> PropertyValues <span class="title">postProcessPropertyValues</span><span class="params">(PropertyValues pvs, PropertyDescriptor[] pds, Object bean, String beanName)</span> <span class="keyword">throws</span> BeansException </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;[TestInstantiationAwareBeanPostProcessor] postProcessPropertyValues &quot;</span> + beanName);</span><br><span class="line">        <span class="keyword">return</span> pvs;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>





<h2 id="7-SmartInstantiationAwareBeanPostProcessor"><a href="#7-SmartInstantiationAwareBeanPostProcessor" class="headerlink" title="7.SmartInstantiationAwareBeanPostProcessor"></a>7.SmartInstantiationAwareBeanPostProcessor</h2><blockquote>
<p>org.springframework.beans.factory.config.SmartInstantiationAwareBeanPostProcessor</p>
</blockquote>
<p>该扩展接口有3个触发点方法：</p>
<ul>
<li><code>predictBeanType</code>：该触发点发生在<code>postProcessBeforeInstantiation</code>之前(在图上并没有标明，因为一般不太需要扩展这个点)，这个方法用于预测Bean的类型，返回第一个预测成功的Class类型，如果不能预测返回null；当你调用<code>BeanFactory.getType(name)</code>时当通过bean的名字无法得到bean类型信息时就调用该回调方法来决定类型信息。</li>
<li><code>determineCandidateConstructors</code>：该触发点发生在<code>postProcessBeforeInstantiation</code>之后，用于确定该bean的构造函数之用，返回的是该bean的所有构造函数列表。用户可以扩展这个点，来自定义选择相应的构造器来实例化这个bean。</li>
<li><code>getEarlyBeanReference</code>：该触发点发生在<code>postProcessAfterInstantiation</code>之后，当有循环依赖的场景，当bean实例化好之后，为了防止有循环依赖，会提前暴露回调方法，用于bean实例化的后置处理。这个方法就是在提前暴露的回调方法中触发。</li>
</ul>
<p>扩展方式为：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestSmartInstantiationAwareBeanPostProcessor</span> <span class="keyword">implements</span> <span class="title">SmartInstantiationAwareBeanPostProcessor</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Class&lt;?&gt; predictBeanType(Class&lt;?&gt; beanClass, String beanName) <span class="keyword">throws</span> BeansException &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;[TestSmartInstantiationAwareBeanPostProcessor] predictBeanType &quot;</span> + beanName);</span><br><span class="line">        <span class="keyword">return</span> beanClass;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Constructor&lt;?&gt;[] determineCandidateConstructors(Class&lt;?&gt; beanClass, String beanName) <span class="keyword">throws</span> BeansException &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;[TestSmartInstantiationAwareBeanPostProcessor] determineCandidateConstructors &quot;</span> + beanName);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">getEarlyBeanReference</span><span class="params">(Object bean, String beanName)</span> <span class="keyword">throws</span> BeansException </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;[TestSmartInstantiationAwareBeanPostProcessor] getEarlyBeanReference &quot;</span> + beanName);</span><br><span class="line">        <span class="keyword">return</span> bean;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="8-BeanFactoryAware"><a href="#8-BeanFactoryAware" class="headerlink" title="8.BeanFactoryAware"></a>8.BeanFactoryAware</h2><blockquote>
<p>org.springframework.beans.factory.BeanFactoryAware</p>
</blockquote>
<p>这个类只有一个触发点，发生在bean的实例化之后，注入属性之前，也就是Setter之前。这个类的扩展点方法为<code>setBeanFactory</code>，可以拿到<code>BeanFactory</code>这个属性。</p>
<p>使用场景为，你可以在bean实例化之后，但还未初始化之前，拿到 <code>BeanFactory</code>，在这个时候，可以对每个bean作特殊化的定制。也或者可以把<code>BeanFactory</code>拿到进行缓存，日后使用。</p>
<p>扩展方式为：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestBeanFactoryAware</span> <span class="keyword">implements</span> <span class="title">BeanFactoryAware</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setBeanFactory</span><span class="params">(BeanFactory beanFactory)</span> <span class="keyword">throws</span> BeansException </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;[TestBeanFactoryAware] &quot;</span> + beanFactory.getBean(TestBeanFactoryAware.class).getClass().getSimpleName());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="9-ApplicationContextAwareProcessor"><a href="#9-ApplicationContextAwareProcessor" class="headerlink" title="9.ApplicationContextAwareProcessor"></a>9.ApplicationContextAwareProcessor</h2><blockquote>
<p>org.springframework.context.support.ApplicationContextAwareProcessor</p>
</blockquote>
<p>该类本身并没有扩展点，但是该类内部却有6个扩展点可供实现 ，这些类触发的时机在bean实例化之后，初始化之前</p>
<p><img src="https://upload-images.jianshu.io/upload_images/7880910-aa93fed8235676ff.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1200/format/webp" alt="img"></p>
<p>2.png</p>
<p>可以看到，该类用于执行各种驱动接口，在bean实例化之后，属性填充之后，通过执行以上红框标出的扩展接口，来获取对应容器的变量。<strong>所以这里应该来说是有6个扩展点</strong>，这里就放一起来说了</p>
<ul>
<li><code>EnvironmentAware</code>：用于获取<code>EnviromentAware</code>的一个扩展类，这个变量非常有用， 可以获得系统内的所有参数。当然个人认为这个Aware没必要去扩展，因为spring内部都可以通过注入的方式来直接获得。</li>
<li><code>EmbeddedValueResolverAware</code>：用于获取<code>StringValueResolver</code>的一个扩展类， <code>StringValueResolver</code>用于获取基于<code>String</code>类型的properties的变量，一般我们都用<code>@Value</code>的方式去获取，如果实现了这个Aware接口，把<code>StringValueResolver</code>缓存起来，通过这个类去获取<code>String</code>类型的变量，效果是一样的。</li>
<li><code>ResourceLoaderAware</code>：用于获取<code>ResourceLoader</code>的一个扩展类，<code>ResourceLoader</code>可以用于获取classpath内所有的资源对象，可以扩展此类来拿到<code>ResourceLoader</code>对象。</li>
<li><code>ApplicationEventPublisherAware</code>：用于获取<code>ApplicationEventPublisher</code>的一个扩展类，<code>ApplicationEventPublisher</code>可以用来发布事件，结合<code>ApplicationListener</code>来共同使用，下文在介绍<code>ApplicationListener</code>时会详细提到。这个对象也可以通过spring注入的方式来获得。</li>
<li><code>MessageSourceAware</code>：用于获取<code>MessageSource</code>的一个扩展类，<code>MessageSource</code>主要用来做国际化。</li>
<li><code>ApplicationContextAware</code>：用来获取<code>ApplicationContext</code>的一个扩展类，<code>ApplicationContext</code>应该是很多人非常熟悉的一个类了，就是spring上下文管理器，可以手动的获取任何在spring上下文注册的bean，我们经常扩展这个接口来缓存spring上下文，包装成静态方法。同时<code>ApplicationContext</code>也实现了<code>BeanFactory</code>，<code>MessageSource</code>，<code>ApplicationEventPublisher</code>等接口，也可以用来做相关接口的事情。</li>
</ul>
<h2 id="10-BeanNameAware"><a href="#10-BeanNameAware" class="headerlink" title="10.BeanNameAware"></a>10.BeanNameAware</h2><blockquote>
<p>org.springframework.beans.factory.BeanNameAware</p>
</blockquote>
<p>可以看到，这个类也是Aware扩展的一种，触发点在bean的初始化之前，也就是<code>postProcessBeforeInitialization</code>之前，这个类的触发点方法只有一个：<code>setBeanName</code></p>
<p>使用场景为：用户可以扩展这个点，在初始化bean之前拿到spring容器中注册的的beanName，来自行修改这个beanName的值。</p>
<p>扩展方式为：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NormalBeanA</span> <span class="keyword">implements</span> <span class="title">BeanNameAware</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">NormalBeanA</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;NormalBean constructor&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setBeanName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;[BeanNameAware] &quot;</span> + name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="11-PostConstruct"><a href="#11-PostConstruct" class="headerlink" title="11.@PostConstruct"></a>11.@PostConstruct</h2><blockquote>
<p>javax.annotation.PostConstruct</p>
</blockquote>
<p>这个并不算一个扩展点，其实就是一个标注。其作用是在bean的初始化阶段，如果对一个方法标注了<code>@PostConstruct</code>，会先调用这个方法。这里重点是要关注下这个标准的触发点，这个触发点是在<code>postProcessBeforeInitialization</code>之后，<code>InitializingBean.afterPropertiesSet</code>之前。</p>
<p>使用场景：用户可以对某一方法进行标注，来进行初始化某一个属性</p>
<p>扩展方式为：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NormalBeanA</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">NormalBeanA</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;NormalBean constructor&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostConstruct</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;[PostConstruct] NormalBeanA&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="12-InitializingBean"><a href="#12-InitializingBean" class="headerlink" title="12.InitializingBean"></a>12.InitializingBean</h2><blockquote>
<p>org.springframework.beans.factory.InitializingBean</p>
</blockquote>
<p>这个类，顾名思义，也是用来初始化bean的。<code>InitializingBean</code>接口为bean提供了初始化方法的方式，它只包括<code>afterPropertiesSet</code>方法，凡是继承该接口的类，在初始化bean的时候都会执行该方法。这个扩展点的触发时机在<code>postProcessAfterInitialization</code>之前。</p>
<p>使用场景：用户实现此接口，来进行系统启动的时候一些业务指标的初始化工作。</p>
<p>扩展方式为：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NormalBeanA</span> <span class="keyword">implements</span> <span class="title">InitializingBean</span></span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterPropertiesSet</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;[InitializingBean] NormalBeanA&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="13-FactoryBean"><a href="#13-FactoryBean" class="headerlink" title="13.FactoryBean"></a>13.FactoryBean</h2><blockquote>
<p>org.springframework.beans.factory.FactoryBean</p>
</blockquote>
<p>一般情况下，Spring通过反射机制利用bean的class属性指定支线类去实例化bean，在某些情况下，实例化Bean过程比较复杂，如果按照传统的方式，则需要在bean中提供大量的配置信息。配置方式的灵活性是受限的，这时采用编码的方式可能会得到一个简单的方案。Spring为此提供了一个<code>org.springframework.bean.factory.FactoryBean</code>的工厂类接口，用户可以通过实现该接口定制实例化Bean的逻辑。<code>FactoryBean</code>接口对于Spring框架来说占用重要的地位，Spring自身就提供了70多个<code>FactoryBean</code>的实现。它们隐藏了实例化一些复杂bean的细节，给上层应用带来了便利。从Spring3.0开始，<code>FactoryBean</code>开始支持泛型，即接口声明改为<code>FactoryBean&lt;T&gt;</code>的形式</p>
<p>使用场景：用户可以扩展这个类，来为要实例化的bean作一个代理，比如为该对象的所有的方法作一个拦截，在调用前后输出一行log，模仿<code>ProxyFactoryBean</code>的功能。</p>
<p>扩展方式为：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestFactoryBean</span> <span class="keyword">implements</span> <span class="title">FactoryBean</span>&lt;<span class="title">TestFactoryBean</span>.<span class="title">TestFactoryInnerBean</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> TestFactoryBean.<span class="function">TestFactoryInnerBean <span class="title">getObject</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;[FactoryBean] getObject&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> TestFactoryBean.TestFactoryInnerBean();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Class&lt;?&gt; getObjectType() &#123;</span><br><span class="line">        <span class="keyword">return</span> TestFactoryBean.TestFactoryInnerBean.class;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isSingleton</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">TestFactoryInnerBean</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="14-SmartInitializingSingleton"><a href="#14-SmartInitializingSingleton" class="headerlink" title="14.SmartInitializingSingleton"></a>14.SmartInitializingSingleton</h2><blockquote>
<p>org.springframework.beans.factory.SmartInitializingSingleton</p>
</blockquote>
<p>这个接口中只有一个方法<code>afterSingletonsInstantiated</code>，其作用是是 在spring容器管理的所有单例对象（非懒加载对象）初始化完成之后调用的回调接口。其触发时机为<code>postProcessAfterInitialization</code>之后。</p>
<p>使用场景：用户可以扩展此接口在对所有单例对象初始化完毕后，做一些后置的业务处理。</p>
<p>扩展方式为：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestSmartInitializingSingleton</span> <span class="keyword">implements</span> <span class="title">SmartInitializingSingleton</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterSingletonsInstantiated</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;[TestSmartInitializingSingleton]&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="15-CommandLineRunner"><a href="#15-CommandLineRunner" class="headerlink" title="15.CommandLineRunner"></a>15.CommandLineRunner</h2><blockquote>
<p>org.springframework.boot.CommandLineRunner</p>
</blockquote>
<p>这个接口也只有一个方法：<code>run(String... args)</code>，触发时机为整个项目启动完毕后，自动执行。如果有多个<code>CommandLineRunner</code>，可以利用<code>@Order</code>来进行排序。</p>
<p>使用场景：用户扩展此接口，进行启动项目之后一些业务的预处理。</p>
<p>扩展方式为：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestCommandLineRunner</span> <span class="keyword">implements</span> <span class="title">CommandLineRunner</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">(String... args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;[TestCommandLineRunner]&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="16-DisposableBean"><a href="#16-DisposableBean" class="headerlink" title="16.DisposableBean"></a>16.DisposableBean</h2><blockquote>
<p>org.springframework.beans.factory.DisposableBean</p>
</blockquote>
<p>这个扩展点也只有一个方法：<code>destroy()</code>，其触发时机为当此对象销毁时，会自动执行这个方法。比如说运行<code>applicationContext.registerShutdownHook</code>时，就会触发这个方法。</p>
<p>扩展方式为：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NormalBeanA</span> <span class="keyword">implements</span> <span class="title">DisposableBean</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destroy</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;[DisposableBean] NormalBeanA&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="17-ApplicationListener"><a href="#17-ApplicationListener" class="headerlink" title="17.ApplicationListener"></a>17.ApplicationListener</h2><blockquote>
<p>org.springframework.context.ApplicationListener</p>
</blockquote>
<p>准确的说，这个应该不算spring&amp;springboot当中的一个扩展点，<code>ApplicationListener</code>可以监听某个事件的<code>event</code>，触发时机可以穿插在业务方法执行过程中，用户可以自定义某个业务事件。但是spring内部也有一些内置事件，这种事件，可以穿插在启动调用中。我们也可以利用这个特性，来自己做一些内置事件的监听器来达到和前面一些触发点大致相同的事情。</p>
<p>接下来罗列下spring主要的内置事件：</p>
<ul>
<li><p>ContextRefreshedEvent</p>
<p>ApplicationContext 被初始化或刷新时，该事件被发布。这也可以在<code>ConfigurableApplicationContext</code>接口中使用 <code>refresh()</code>方法来发生。此处的初始化是指：所有的Bean被成功装载，后处理Bean被检测并激活，所有Singleton Bean 被预实例化，<code>ApplicationContext</code>容器已就绪可用。</p>
</li>
<li><p>ContextStartedEvent</p>
<p>当使用 <code>ConfigurableApplicationContext</code> （ApplicationContext子接口）接口中的 start() 方法启动 <code>ApplicationContext</code>时，该事件被发布。你可以调查你的数据库，或者你可以在接受到这个事件后重启任何停止的应用程序。</p>
</li>
<li><p>ContextStoppedEvent</p>
<p>当使用 <code>ConfigurableApplicationContext</code>接口中的 <code>stop()</code>停止<code>ApplicationContext</code> 时，发布这个事件。你可以在接受到这个事件后做必要的清理的工作</p>
</li>
<li><p>ContextClosedEvent</p>
<p>当使用 <code>ConfigurableApplicationContext</code>接口中的 <code>close()</code>方法关闭 <code>ApplicationContext</code> 时，该事件被发布。一个已关闭的上下文到达生命周期末端；它不能被刷新或重启</p>
</li>
<li><p>RequestHandledEvent</p>
<p>这是一个 web-specific 事件，告诉所有 bean HTTP 请求已经被服务。只能应用于使用DispatcherServlet的Web应用。在使用Spring作为前端的MVC控制器时，当Spring处理用户请求结束后，系统会自动触发该事件</p>
</li>
</ul>
<h2 id="18-最后"><a href="#18-最后" class="headerlink" title="18.最后"></a>18.最后</h2><p>我们从这些spring&amp;springboot的扩展点当中，大致可以窥视到整个bean的生命周期。在业务开发或者写中间件业务的时候，可以合理利用spring提供给我们的扩展点，在spring启动的各个阶段内做一些事情。以达到自定义初始化的目的。此篇总结，如果有错误或者疏漏的地方，恳请指正。</p>
<p>作者：铂赛东<br>链接：<a href="https://www.jianshu.com/p/38d834db7413">https://www.jianshu.com/p/38d834db7413</a><br>来源：简书<br>著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。</p>
]]></content>
      <categories>
        <category>SpringBoot</category>
        <category>Extend</category>
      </categories>
      <tags>
        <tag>SpringBoot</tag>
        <tag>Extend</tag>
      </tags>
  </entry>
  <entry>
    <title>Java并发-- AbstractQueuedSynchronizer 队列同步器</title>
    <url>/Java-Concurrent-AbstractQueuedSynchronizer/</url>
    <content><![CDATA[<p>队列同步器AbstractQueuedSynchronizer（以下简称同步器），是用来构建锁或者其他同步组件的基础框架，它使用了一个int成员变量表示同步状态，通过内置的FIFO队列来完成资源获取线程的排队工作，并发包的作者（Doug Lea）期望它能够成为实现大部分同步需求的基础。<br> <span id="more"></span> </p>
<p>同步器的主要使用方式是继承，子类通过继承同步器并实现它的抽象方法来管理同步状态，在抽象方法的实现过程中免不了要对同步状态进行更改，这时就需要使用同步器提供的3个方法（getState()、setState(int newState)和compareAndSetState(int expect,int update)）来进行操作，因为它们能够保证状态的改变是安全的。子类推荐被定义为自定义同步组件的静态内部类，同步器自身没有实现任何同步接口，它仅仅是定义了若干同步状态获取和释放的方法来供自定义同步组件使用，同步器既可以支持独占式地获取同步状态，也可以支持共享式地获取同步状态，这样就可以方便实现不同类型的同步组件（ReentrantLock、ReentrantReadWriteLock和CountDownLatch等）。</p>
<p>同步器是实现锁（也可以是任意同步组件）的关键，在锁的实现中聚合同步器，利用同步器实现锁的语义。可以这样理解二者之间的关系：锁是面向使用者的，它定义了使用者与锁交互的接口（比如可以允许两个线程并行访问），隐藏了实现细节；同步器面向的是锁的实现者，它简化了锁的实现方式，屏蔽了同步状态管理、线程的排队、等待与唤醒等底层操作。锁和同步器很好地隔离了使用者和实现者所需关注的领域。</p>
<h3 id="队列同步器的接口与示例"><a href="#队列同步器的接口与示例" class="headerlink" title="队列同步器的接口与示例"></a>队列同步器的接口与示例</h3><p>同步器的设计是基于模板方法模式的，也就是说，使用者需要继承同步器并重写指定的方法，随后将同步器组合在自定义同步组件的实现中，并调用同步器提供的模板方法，而这些模板方法将会调用使用者重写的方法。</p>
<p>重写同步器指定的方法时，需要使用同步器提供的如下3个方法来访问或修改同步状态。</p>
<ul>
<li><p>getState()：获取当前同步状态。</p>
</li>
<li><p>setState(int newState)：设置当前同步状态。</p>
</li>
<li><p>compareAndSetState(int expect,int update)：使用CAS设置当前状态，该方法能够保证状态设置的原子性。</p>
</li>
</ul>
<p>同步器可重写的方法与描述如表所示。</p>
<table>
<thead>
<tr>
<th>方法名称</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>protected boolean tryAcquire(int arg)</td>
<td>独占式获取同步锁，实现该方法需要查询当前状态并判断同步状态是否符合预期，然后再进行 CAS 设置同步状态</td>
</tr>
<tr>
<td>protected tryRelease(int arg)</td>
<td>独占式释放同步状态，等待获取同步状态的线程将有机会获取同步状态</td>
</tr>
<tr>
<td>protected int tryAcquireShare(int arg)</td>
<td>共享式获取同步状态，返回大于等于 0 的值，表示获取成功，反之，获取失败</td>
</tr>
<tr>
<td>protected boolean tryReleaseShared(int arg)</td>
<td>共享式释放同步状态</td>
</tr>
<tr>
<td>protected boolean isHeldExclusively()</td>
<td>当前同步器释放在独占模式下被线程占用，一般该方法表示是否被当前线程所独占</td>
</tr>
</tbody></table>
<p>实现自定义同步组件时，将会调用同步器提供的模板方法，这些（部分）模板方法与描述如下表所示。</p>
<table>
<thead>
<tr>
<th>方法名称</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>void acquire(int arg)</td>
<td>独占式获取同步状态，如果当前线程获取同步状态成功，则由该方法返回，否则，将会进入同步队列等待，该方法将会调用重写的 tryAcquire(int arg) 方法</td>
</tr>
<tr>
<td>void acquireInterruptibly(int arg)</td>
<td>与 acquire(int arg) 相同，但是该方法响应中断，当前线程未获取到同步状态而进入同步队列中，如果当前线程被中断，则该方法会抛出 InterruptedException 并返回</td>
</tr>
<tr>
<td>boolean tryAcquireNanos(int arg, long nanos)</td>
<td>在 acquireInterruptibly(int arg) 基础上增加了超时限制，如果当前线程在超时时间内没有获取到同步状态，那么将会返回 false，如果获取到了返回 true</td>
</tr>
<tr>
<td>void requireShared(int arg)</td>
<td>共享式的获取同步状态，如果当前线程未获取到同步状态，将会进入同步队列等待，与独占式获取的主要区别是在同一时刻可以有多个线程获取到同步状态</td>
</tr>
<tr>
<td>void acquireSharedInterruptibly(int arg)</td>
<td>与 accquireShared(int arg) 相同，该方法响应中断</td>
</tr>
<tr>
<td>boolean tryAcquireSharedNanos(int arg, long nonos)</td>
<td>在 acquireSharedInterruptibly(int arg) 基础上增加了超时限制</td>
</tr>
<tr>
<td>boolean release(int arg)</td>
<td>独占式的释放同步状态，该方法会在释放同步状态之后，将同步队列中第一个节点包含的线程唤醒</td>
</tr>
<tr>
<td>boolean releaseShared(int arg)</td>
<td>共享式的释放同步状态</td>
</tr>
<tr>
<td>Collection<Thread> getQueuedThreads()</td>
<td>获取等待在同步队列上的线程集合</td>
</tr>
</tbody></table>
<p>同步器提供的模板方法基本上分为3类：独占式获取与释放同步状态、共享式获取与释放同步状态和查询同步队列中的等待线程情况。自定义同步组件将使用同步器提供的模板方法来实现自己的同步语义。</p>
<p>只有掌握了同步器的工作原理才能更加深入地理解并发包中其他的并发组件，所以下面通过一个独占锁的示例来深入了解一下同步器的工作</p>
<p>顾名思义，独占锁就是在同一时刻只能有一个线程获取到锁，而其他获取锁的线程只能处于同步队列中等待，只有获取锁的线程释放了锁，后继的线程才能够获取锁，如代码清单所示。</p>
<p>代码清单　Mutex.java</p>
<hr>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Mutex</span> <span class="keyword">implements</span> <span class="title">Lock</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 静态内部类，自定义同步器</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Sync</span> <span class="keyword">extends</span> <span class="title">AbstractQueuedSynchronizer</span> </span>&#123;</span><br><span class="line">            <span class="comment">// 是否处于占用状态</span></span><br><span class="line">            <span class="function"><span class="keyword">protected</span> <span class="keyword">boolean</span> <span class="title">isHeldExclusively</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                    <span class="keyword">return</span> getState() == <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 当状态为0的时候获取锁</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">tryAcquire</span><span class="params">(<span class="keyword">int</span> acquires)</span> </span>&#123;</span><br><span class="line">                    <span class="keyword">if</span> (compareAndSetState(<span class="number">0</span>, <span class="number">1</span>)) &#123;</span><br><span class="line">    setExclusiveOwnerThread(Thread.currentThread());</span><br><span class="line">                            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 释放锁，将状态设置为0</span></span><br><span class="line">            <span class="function"><span class="keyword">protected</span> <span class="keyword">boolean</span> <span class="title">tryRelease</span><span class="params">(<span class="keyword">int</span> releases)</span> </span>&#123;</span><br><span class="line">                    <span class="keyword">if</span> (getState() == <span class="number">0</span>) <span class="keyword">throw</span> <span class="keyword">new</span> </span><br><span class="line">                    IllegalMonitorStateException();</span><br><span class="line">                    setExclusiveOwnerThread(<span class="keyword">null</span>);</span><br><span class="line">                    setState(<span class="number">0</span>);</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 返回一个Condition，每个condition都包含了一个condition队列</span></span><br><span class="line">            <span class="function">Condition <span class="title">newCondition</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> <span class="keyword">new</span> ConditionObject(); &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 仅需要将操作代理到Sync上即可</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Sync sync = <span class="keyword">new</span> Sync();</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">lock</span><span class="params">()</span> </span>&#123; sync.acquire(<span class="number">1</span>); &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">tryLock</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> sync.tryAcquire(<span class="number">1</span>); &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">unlock</span><span class="params">()</span> </span>&#123; sync.release(<span class="number">1</span>); &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Condition <span class="title">newCondition</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> sync.newCondition(); &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isLocked</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> sync.isHeldExclusively(); &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hasQueuedThreads</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> sync.hasQueuedThreads(); &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">lockInterruptibly</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">            sync.acquireInterruptibly(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">tryLock</span><span class="params">(<span class="keyword">long</span> timeout, TimeUnit unit)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> sync.tryAcquireNanos(<span class="number">1</span>, unit.toNanos(timeout));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<p>上述示例中，独占锁Mutex是一个自定义同步组件，它在同一时刻只允许一个线程占有锁。Mutex中定义了一个静态内部类，该内部类继承了同步器并实现了独占式获取和释放同步状态。在tryAcquire(int acquires)方法中，如果经过CAS设置成功（同步状态设置为1），则代表获取了同步状态，而在tryRelease(int releases)方法中只是将同步状态重置为0。用户使用Mutex时并不会直接和内部同步器的实现打交道，而是调用Mutex提供的方法，在Mutex的实现中，以获取锁的lock()方法为例，只需要在方法实现中调用同步器的模板方法acquire(int args)即可，当前线程调用该方法获取同步状态失败后会被加入到同步队列中等待，这样就大大降低了实现一个可靠自定义同步组件的门槛。        </p>
<h3 id="队列同步器的实现分析"><a href="#队列同步器的实现分析" class="headerlink" title="队列同步器的实现分析"></a>队列同步器的实现分析</h3><p>接下来将从实现角度分析同步器是如何完成线程同步的，主要包括：同步队列、独占式同步状态获取与释放、共享式同步状态获取与释放以及超时获取同步状态等同步器的核心数据结构与模板方法。</p>
<p>1.同步队列</p>
<p>同步器依赖内部的同步队列（一个FIFO双向队列）来完成同步状态的管理，当前线程获取同步状态失败时，同步器会将当前线程以及等待状态等信息构造成为一个节点（Node）并将其加入同步队列，同时会阻塞当前线程，当同步状态释放时，会把首节点中的线程唤醒，使其再次尝试获取同步状态。</p>
<p>同步队列中的节点（Node）用来保存获取同步状态失败的线程引用、等待状态以及前驱和后继节点，节点的属性类型与名称以及描述如下表所示。</p>
<table>
<thead>
<tr>
<th>属性类型与名称</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>int waitStatus</td>
<td>等待状态。包含如下状态：① CANCELLED，值为1，由于在同步队列中等待的线程等待超时或者被中断了，需要从同步队列中取消等待，节点进入该状态将不会变化。② SIGNAL，值为 -1，后继节点的线程处于等待状态，而当前节点的线程如果释放了同步状态或者被取消，将会通知后继节点，使后继节点的线程得以运行。③ CONDITION，值为 -2，节点在等待队列总，节点线程等待在 Conditoin 上，当其他线程对 Condition 调用了 signal() 方法后，该节点将会从等待队列转移到同步队列中，加入到对同步状态的获取中。④ PROPAGATE，值为 -3，表示下一次共享式同步状态获取将会无条件地被传播下去。⑤ INITIAL，值为 0，初始状态。</td>
</tr>
<tr>
<td>Node prev</td>
<td>前驱节点，当节点加入同步队列时被设置 （尾部添加）</td>
</tr>
<tr>
<td>Node next</td>
<td>后继节点</td>
</tr>
<tr>
<td>Node nextWaiter</td>
<td>等待队列中的后继节点。如果当前节点时共享的，那么这个字段将是一个 SHARED 常量，也就是说节点类型（独占和共享）和等待队列中的后继节点共同用一个字段</td>
</tr>
<tr>
<td>Thread thread</td>
<td>获取同步状态的线程</td>
</tr>
</tbody></table>
<p>节点是构成同步队列（等待队列，在5.6节中将会介绍）的基础，同步器拥有首节点（head）和尾节点（tail），没有成功获取同步状态的线程将会成为节点加入该队列的尾部，同步队列的基本结构如图所示。</p>
<p>图同步队列的基本结构</p>
<p>在图5-1中，同步器包含了两个节点类型的引用，一个指向头节点，而另一个指向尾节点。试想一下，当一个线程成功地获取了同步状态（或者锁），其他线程将无法获取到同步状态，转而被构造成为节点并加入到同步队列中，而这个加入队列的过程必须要保证线程安全，因此同步器提供了一个基于CAS的设置尾节点的方法：compareAndSetTail(Node expect,Node update)，它需要传递当前线程“认为”的尾节点和当前节点，只有设置成功后，当前节点才正式与之前的尾节点建立关联。</p>
<p>同步器将节点加入到同步队列的过程如图所示。</p>
<p>图节点加入到同步队列</p>
<p>同步队列遵循FIFO，首节点是获取同步状态成功的节点，首节点的线程在释放同步状态时，将会唤醒后继节点，而后继节点将会在获取同步状态成功时将自己设置为首节点，该过程如图所示。</p>
<p>图首节点的设置</p>
<p>在图中，设置首节点是通过获取同步状态成功的线程来完成的，由于只有一个线程能够成功获取到同步状态，因此设置头节点的方法并不需要使用CAS来保证，它只需要将首节点设置成为原首节点的后继节点并断开原首节点的next引用即可。</p>
<p>2.独占式同步状态获取与释放</p>
<p>通过调用同步器的acquire(int arg)方法可以获取同步状态，该方法对中断不敏感，也就是由于线程获取同步状态失败后进入同步队列中，后续对线程进行中断操作时，线程不会从同步队列中移出，该方法代码如下代码清单所示。</p>
<p>同步器的acquire方法</p>
<hr>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">acquire</span><span class="params">(<span class="keyword">int</span> arg)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!tryAcquire(arg) &amp;&amp;</span><br><span class="line">            acquireQueued(addWaiter(Node.EXCLUSIVE), arg))</span><br><span class="line">            selfInterrupt();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<p>上述代码主要完成了同步状态获取、节点构造、加入同步队列以及在同步队列中自旋等待的相关工作，其主要逻辑是：首先调用自定义同步器实现的tryAcquire(int arg)方法，该方法保证线程安全的获取同步状态，如果同步状态获取失败，则构造同步节点（独占式Node.EXCLUSIVE，同一时刻只能有一个线程成功获取同步状态）并通过addWaiter(Node node)方法将该节点加入到同步队列的尾部，最后调用acquireQueued(Node node,int arg)方法，使得该节点以“死循环”的方式获取同步状态。如果获取不到则阻塞节点中的线程，而被阻塞线程的唤醒主要依靠前驱节点的出队或阻塞线程被中断来实现。</p>
<p>下面分析一下相关工作。首先是节点的构造以及加入同步队列，如代码清单所示。</p>
<p>同步器的addWaiter和enq方法</p>
<hr>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> Node <span class="title">addWaiter</span><span class="params">(Node mode)</span> </span>&#123;</span><br><span class="line">    Node node = <span class="keyword">new</span> Node(Thread.currentThread(), mode);</span><br><span class="line">    <span class="comment">// 快速尝试在尾部添加</span></span><br><span class="line">    Node pred = tail;</span><br><span class="line">    <span class="keyword">if</span> (pred != <span class="keyword">null</span>) &#123;</span><br><span class="line">            node.prev = pred;</span><br><span class="line">            <span class="keyword">if</span> (compareAndSetTail(pred, node)) &#123;</span><br><span class="line">                    pred.next = node;</span><br><span class="line">                    <span class="keyword">return</span> node;</span><br><span class="line">            &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    enq(node);</span><br><span class="line">    <span class="keyword">return</span> node;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">private</span> Node <span class="title">enq</span><span class="params">(<span class="keyword">final</span> Node node)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (;;) &#123;</span><br><span class="line">            Node t = tail;</span><br><span class="line">            <span class="keyword">if</span> (t == <span class="keyword">null</span>) &#123; <span class="comment">// Must initialize</span></span><br><span class="line">                    <span class="keyword">if</span> (compareAndSetHead(<span class="keyword">new</span> Node()))</span><br><span class="line">                            tail = head;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    node.prev = t;</span><br><span class="line">                    <span class="keyword">if</span> (compareAndSetTail(t, node)) &#123;</span><br><span class="line">                            t.next = node;</span><br><span class="line">                            <span class="keyword">return</span> t;</span><br><span class="line">                    &#125;</span><br><span class="line">            &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<p>上述代码通过使用compareAndSetTail(Node expect,Node update)方法来确保节点能够被线程安全添加。试想一下：如果使用一个普通的LinkedList来维护节点之间的关系，那么当一个线程获取了同步状态，而其他多个线程由于调用tryAcquire(int arg)方法获取同步状态失败而并发地被添加到LinkedList时，LinkedList将难以保证Node的正确添加，最终的结果可能是节点的数量有偏差，而且顺序也是混乱的。</p>
<p>在enq(final Node node)方法中，同步器通过“死循环”来保证节点的正确添加，在“死循环”中只有通过CAS将节点设置成为尾节点之后，当前线程才能从该方法返回，否则，当前线程不断地尝试设置。可以看出，enq(final Node node)方法将并发添加节点的请求通过CAS变得“串行化”了。</p>
<p>节点进入同步队列之后，就进入了一个自旋的过程，每个节点（或者说每个线程）都在自省地观察，当条件满足，获取到了同步状态，就可以从这个自旋过程中退出，否则依旧留在这个自旋过程中（并会阻塞节点的线程），如代码清单所示。</p>
<p>同步器的acquireQueued方法</p>
<hr>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">final</span> <span class="keyword">boolean</span> <span class="title">acquireQueued</span><span class="params">(<span class="keyword">final</span> Node node, <span class="keyword">int</span> arg)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">boolean</span> failed = <span class="keyword">true</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">boolean</span> interrupted = <span class="keyword">false</span>;</span><br><span class="line">            <span class="keyword">for</span> (;;) &#123;</span><br><span class="line">                    <span class="keyword">final</span> Node p = node.predecessor();</span><br><span class="line">                    <span class="keyword">if</span> (p == head &amp;&amp; tryAcquire(arg)) &#123;</span><br><span class="line">                            setHead(node);</span><br><span class="line">                            p.next = <span class="keyword">null</span>; <span class="comment">// help GC</span></span><br><span class="line">                            failed = <span class="keyword">false</span>;</span><br><span class="line">                            <span class="keyword">return</span> interrupted;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">if</span> (shouldParkAfterFailedAcquire(p, node) &amp;&amp; </span><br><span class="line">                    parkAndCheckInterrupt())</span><br><span class="line">                            interrupted = <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (failed)</span><br><span class="line">                    cancelAcquire(node);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<p>在acquireQueued(final Node node,int arg)方法中，当前线程在“死循环”中尝试获取同步状态，而只有前驱节点是头节点才能够尝试获取同步状态，这是为什么？原因有两个，如下。</p>
<p>第一，头节点是成功获取到同步状态的节点，而头节点的线程释放了同步状态之后，将会唤醒其后继节点，后继节点的线程被唤醒后需要检查自己的前驱节点是否是头节点。</p>
<p>第二，维护同步队列的FIFO原则。该方法中，节点自旋获取同步状态的行为如图所示。</p>
<p>图 节点自旋获取同步状态</p>
<p>在图5-4中，由于非首节点线程前驱节点出队或者被中断而从等待状态返回，随后检查自己的前驱是否是头节点，如果是则尝试获取同步状态。可以看到节点和节点之间在循环检查的过程中基本不相互通信，而是简单地判断自己的前驱是否为头节点，这样就使得节点的释放规则符合FIFO，并且也便于对过早通知的处理（过早通知是指前驱节点不是头节点的线程由于中断而被唤醒）。</p>
<p>独占式同步状态获取流程，也就是acquire(int arg)方法调用流程，如图所示。</p>
<p>图　独占式同步状态获取流程</p>
<p>在图中，前驱节点为头节点且能够获取同步状态的判断条件和线程进入等待状态是获取同步状态的自旋过程。当同步状态获取成功之后，当前线程从acquire(int arg)方法返回，如果对于锁这种并发组件而言，代表着当前线程获取了锁。</p>
<p>当前线程获取同步状态并执行了相应逻辑之后，就需要释放同步状态，使得后续节点能够继续获取同步状态。通过调用同步器的release(int arg)方法可以释放同步状态，该方法在释放了同步状态之后，会唤醒其后继节点（进而使后继节点重新尝试获取同步状态）。该方法代码如代码清单所示。</p>
<p>同步器的release方法</p>
<hr>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">boolean</span> <span class="title">release</span><span class="params">(<span class="keyword">int</span> arg)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (tryRelease(arg)) &#123;</span><br><span class="line">            Node h = head;</span><br><span class="line">            <span class="keyword">if</span> (h != <span class="keyword">null</span> &amp;&amp; h.waitStatus != <span class="number">0</span>)</span><br><span class="line">                    unparkSuccessor(h);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<p>该方法执行时，会唤醒头节点的后继节点线程，unparkSuccessor(Node node)方法使用LockSupport（在后面的章节会专门介绍）来唤醒处于等待状态的线程。</p>
<p>分析了独占式同步状态获取和释放过程后，适当做个总结：在获取同步状态时，同步器维护一个同步队列，获取状态失败的线程都会被加入到队列中并在队列中进行自旋；移出队列（或停止自旋）的条件是前驱节点为头节点且成功获取了同步状态。在释放同步状态时，同步器调用tryRelease(int arg)方法释放同步状态，然后唤醒头节点的后继节点。</p>
<p>3.共享式同步状态获取与释放</p>
<p>共享式获取与独占式获取最主要的区别在于同一时刻能否有多个线程同时获取到同步状态。以文件的读写为例，如果一个程序在对文件进行读操作，那么这一时刻对于该文件的写操作均被阻塞，而读操作能够同时进行。写操作要求对资源的独占式访问，而读操作可以是共享式访问，两种不同的访问模式在同一时刻对文件或资源的访问情况，如图所示。</p>
<p>图　共享式与独占式访问资源的对比</p>
<p>在图5-6中，左半部分，共享式访问资源时，其他共享式的访问均被允许，而独占式访问被阻塞，右半部分是独占式访问资源时，同一时刻其他访问均被阻塞。</p>
<p>通过调用同步器的acquireShared(int arg)方法可以共享式地获取同步状态，该方法代码如代码清单所示。</p>
<p>同步器的acquireShared和doAcquireShared方法</p>
<hr>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">acquireShared</span><span class="params">(<span class="keyword">int</span> arg)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (tryAcquireShared(arg) &lt; <span class="number">0</span>)    </span><br><span class="line">            doAcquireShared(arg);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">doAcquireShared</span><span class="params">(<span class="keyword">int</span> arg)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> Node node = addWaiter(Node.SHARED);</span><br><span class="line">    <span class="keyword">boolean</span> failed = <span class="keyword">true</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">boolean</span> interrupted = <span class="keyword">false</span>;</span><br><span class="line">            <span class="keyword">for</span> (;;) &#123;</span><br><span class="line">                    <span class="keyword">final</span> Node p = node.predecessor();</span><br><span class="line">                    <span class="keyword">if</span> (p == head) &#123;</span><br><span class="line">                            <span class="keyword">int</span> r = tryAcquireShared(arg);</span><br><span class="line">                            <span class="keyword">if</span> (r &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">                                    setHeadAndPropagate(node, r);</span><br><span class="line">                                    p.next = <span class="keyword">null</span>;</span><br><span class="line">                                    <span class="keyword">if</span> (interrupted)</span><br><span class="line">                                            selfInterrupt();</span><br><span class="line">                                    failed = <span class="keyword">false</span>;</span><br><span class="line">                                    <span class="keyword">return</span>;</span><br><span class="line">                            &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">if</span> (shouldParkAfterFailedAcquire(p, node) &amp;&amp; </span><br><span class="line">                    parkAndCheckInterrupt())</span><br><span class="line">                            interrupted = <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (failed)</span><br><span class="line">                    cancelAcquire(node);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<p>在acquireShared(int arg)方法中，同步器调用tryAcquireShared(int arg)方法尝试获取同步状态，tryAcquireShared(int arg)方法返回值为int类型，当返回值大于等于0时，表示能够获取到同步状态。因此，在共享式获取的自旋过程中，成功获取到同步状态并退出自旋的条件就是tryAcquireShared(int arg)方法返回值大于等于0。可以看到，在doAcquireShared(int arg)方法的自旋过程中，如果当前节点的前驱为头节点时，尝试获取同步状态，如果返回值大于等于0，表示该次获取同步状态成功并从自旋过程中退出。</p>
<p>与独占式一样，共享式获取也需要释放同步状态，通过调用releaseShared(int arg)方法可以释放同步状态，该方法代码如代码清单所示。</p>
<p>同步器的releaseShared方法</p>
<hr>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">boolean</span> <span class="title">releaseShared</span><span class="params">(<span class="keyword">int</span> arg)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (tryReleaseShared(arg)) &#123;</span><br><span class="line">            doReleaseShared();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<p>该方法在释放同步状态之后，将会唤醒后续处于等待状态的节点。对于能够支持多个线程同时访问的并发组件（比如Semaphore），它和独占式主要区别在于tryReleaseShared(int arg)方法必须确保同步状态（或者资源数）线程安全释放，一般是通过循环和CAS来保证的，因为释放同步状态的操作会同时来自多个线程。</p>
<p>4.独占式超时获取同步状态</p>
<p>通过调用同步器的doAcquireNanos(int arg,long nanosTimeout)方法可以超时获取同步状态，即在指定的时间段内获取同步状态，如果获取到同步状态则返回true，否则，返回false。该方法提供了传统Java同步操作（比如synchronized关键字）所不具备的特性。</p>
<p>在分析该方法的实现前，先介绍一下响应中断的同步状态获取过程。在Java 5之前，当一个线程获取不到锁而被阻塞在synchronized之外时，对该线程进行中断操作，此时该线程的中断标志位会被修改，但线程依旧会阻塞在synchronized上，等待着获取锁。在Java 5中，同步器提供了acquireInterruptibly(int arg)方法，这个方法在等待获取同步状态时，如果当前线程被中断，会立刻返回，并抛出InterruptedException。</p>
<p>超时获取同步状态过程可以被视作响应中断获取同步状态过程的“增强版”，doAcquireNanos(int arg,long nanosTimeout)方法在支持响应中断的基础上，增加了超时获取的特性。针对超时获取，主要需要计算出需要睡眠的时间间隔nanosTimeout，为了防止过早通知，nanosTimeout计算公式为：nanosTimeout-=now-lastTime，其中now为当前唤醒时间，lastTime为上次唤醒时间，如果nanosTimeout大于0则表示超时时间未到，需要继续睡眠nanosTimeout纳秒，反之，表示已经超时，该方法代码如代码清单所示。</p>
<p>同步器的doAcquireNanos方法</p>
<hr>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">doAcquireNanos</span><span class="params">(<span class="keyword">int</span> arg, <span class="keyword">long</span> nanosTimeout)</span></span></span><br><span class="line"><span class="function"><span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">    <span class="keyword">long</span> lastTime = System.nanoTime();</span><br><span class="line">    <span class="keyword">final</span> Node node = addWaiter(Node.EXCLUSIVE);</span><br><span class="line">    <span class="keyword">boolean</span> failed = <span class="keyword">true</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">for</span> (;;) &#123;</span><br><span class="line">                    <span class="keyword">final</span> Node p = node.predecessor();</span><br><span class="line">                    <span class="keyword">if</span> (p == head &amp;&amp; tryAcquire(arg)) &#123;</span><br><span class="line">                            setHead(node);</span><br><span class="line">                            p.next = <span class="keyword">null</span>; <span class="comment">// help GC</span></span><br><span class="line">                            failed = <span class="keyword">false</span>;</span><br><span class="line">                            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">if</span> (nanosTimeout &lt;= <span class="number">0</span>)</span><br><span class="line">                            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">                    <span class="keyword">if</span> (shouldParkAfterFailedAcquire(p, node) </span><br><span class="line">                            &amp;&amp; nanosTimeout &gt; spinForTimeoutThreshold) </span><br><span class="line">                            LockSupport.parkNanos(<span class="keyword">this</span>, nanosTimeout);</span><br><span class="line">                    <span class="keyword">long</span> now = System.nanoTime();</span><br><span class="line">                    <span class="comment">//计算时间，当前时间now减去睡眠之前的时间lastTime得到已经睡眠</span></span><br><span class="line">                    <span class="comment">//的时间delta，然后被原有超时时间nanosTimeout减去，得到了</span></span><br><span class="line">                    <span class="comment">//还应该睡眠的时间</span></span><br><span class="line">                    nanosTimeout -= now - lastTime;</span><br><span class="line">                    lastTime = now;</span><br><span class="line">                    <span class="keyword">if</span> (Thread.interrupted())</span><br><span class="line">                            <span class="keyword">throw</span> <span class="keyword">new</span> InterruptedException();</span><br><span class="line">            &#125;</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (failed)</span><br><span class="line">                    cancelAcquire(node);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<p>该方法在自旋过程中，当节点的前驱节点为头节点时尝试获取同步状态，如果获取成功则从该方法返回，这个过程和独占式同步获取的过程类似，但是在同步状态获取失败的处理上有所不同。如果当前线程获取同步状态失败，则判断是否超时（nanosTimeout小于等于0表示已经超时），如果没有超时，重新计算超时间隔nanosTimeout，然后使当前线程等待nanosTimeout纳秒（当已到设置的超时时间，该线程会从LockSupport.parkNanos(Object blocker,long nanos)方法返回）。</p>
<p>如果nanosTimeout小于等于spinForTimeoutThreshold（1000纳秒）时，将不会使该线程进行超时等待，而是进入快速的自旋过程。原因在于，非常短的超时等待无法做到十分精确，如果这时再进行超时等待，相反会让nanosTimeout的超时从整体上表现得反而不精确。因此，在超时非常短的场景下，同步器会进入无条件的快速自旋。</p>
<p>独占式超时获取同步态的流程如下图所示。</p>
<p>从图中可以看出，独占式超时获取同步状态doAcquireNanos(int arg,long nanosTimeout)和独占式获取同步状态acquire(int args)在流程上非常相似，其主要区别在于未获取到同步状态时的处理逻辑。acquire(int args)在未获取到同步状态时，将会使当前线程一直处于等待状态，而doAcquireNanos(int arg,long nanosTimeout)会使当前线程等待nanosTimeout纳秒，如果当前线程在nanosTimeout纳秒内没有获取到同步状态，将会从等待逻辑中自动返回。</p>
<p>图　独占式超时获取同步状态的流程</p>
<p>5.自定义同步组件——TwinsLock</p>
<p>在前面的章节中，对同步器AbstractQueuedSynchronizer进行了实现层面的分析，本节通过编写一个自定义同步组件来加深对同步器的理解。</p>
<p>设计一个同步工具：该工具在同一时刻，只允许至多两个线程同时访问，超过两个线程的访问将被阻塞，我们将这个同步工具命名为TwinsLock。</p>
<p>首先，确定访问模式。TwinsLock能够在同一时刻支持多个线程的访问，这显然是共享式访问，因此，需要使用同步器提供的acquireShared(int args)方法等和Shared相关的方法，这就要求TwinsLock必须重写tryAcquireShared(int args)方法和tryReleaseShared(int args)方法，这样才能保证同步器的共享式同步状态的获取与释放方法得以执行。</p>
<p>其次，定义资源数。TwinsLock在同一时刻允许至多两个线程的同时访问，表明同步资源数为2，这样可以设置初始状态status为2，当一个线程进行获取，status减1，该线程释放，则status加1，状态的合法范围为0、1和2，其中0表示当前已经有两个线程获取了同步资源，此时再有其他线程对同步状态进行获取，该线程只能被阻塞。在同步状态变更时，需要使用compareAndSet(int expect,int update)方法做原子性保障。</p>
<p>最后，组合自定义同步器。前面的章节提到，自定义同步组件通过组合自定义同步器来完成同步功能，一般情况下自定义同步器会被定义为自定义同步组件的内部类。</p>
<p>TwinsLock（部分）代码如代码清单所示。</p>
<p>　TwinsLock.java</p>
<hr>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TwinsLock</span> <span class="keyword">implements</span> <span class="title">Lock</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Sync    sync    = <span class="keyword">new</span> Sync(<span class="number">2</span>);</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">Sync</span> <span class="keyword">extends</span> <span class="title">AbstractQueuedSynchronizer</span> </span>&#123;</span><br><span class="line">            Sync(<span class="keyword">int</span> count) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (count &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">                            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">&quot;count must large </span></span><br><span class="line"><span class="string">                            than zero.&quot;</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                    setState(count);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">tryAcquireShared</span><span class="params">(<span class="keyword">int</span> reduceCount)</span> </span>&#123;</span><br><span class="line">                    <span class="keyword">for</span> (;;) &#123;</span><br><span class="line">                            <span class="keyword">int</span> current = getState();</span><br><span class="line">                            <span class="keyword">int</span> newCount = current - reduceCount;</span><br><span class="line">                            <span class="keyword">if</span> (newCount &lt; <span class="number">0</span> || compareAndSetState(current, </span><br><span class="line">                            newCount)) &#123;</span><br><span class="line">                                    <span class="keyword">return</span> newCount;</span><br><span class="line">                            &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">tryReleaseShared</span><span class="params">(<span class="keyword">int</span> returnCount)</span> </span>&#123;</span><br><span class="line">                    <span class="keyword">for</span> (;;) &#123;</span><br><span class="line">                            <span class="keyword">int</span> current = getState();</span><br><span class="line">                            <span class="keyword">int</span> newCount = current + returnCount;</span><br><span class="line">                            <span class="keyword">if</span> (compareAndSetState(current, newCount)) &#123;</span><br><span class="line">                                    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">                            &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">            &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">lock</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            sync.acquireShared(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">unlock</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            sync.releaseShared(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 其他接口方法略</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<p>在上述示例中，TwinsLock实现了Lock接口，提供了面向使用者的接口，使用者调用lock()方法获取锁，随后调用unlock()方法释放锁，而同一时刻只能有两个线程同时获取到锁。TwinsLock同时包含了一个自定义同步器Sync，而该同步器面向线程访问和同步状态控制。以共享式获取同步状态为例：同步器会先计算出获取后的同步状态，然后通过CAS确保状态的正确设置，当tryAcquireShared(int reduceCount)方法返回值大于等于0时，当前线程才获取同步状态，对于上层的TwinsLock而言，则表示当前线程获得了锁。</p>
<p>同步器作为一个桥梁，连接线程访问以及同步状态控制等底层技术与不同并发组件（比如Lock、CountDownLatch等）的接口语义。</p>
<p>下面编写一个测试来验证TwinsLock是否能按照预期工作。在测试用例中，定义了工作者线程Worker，该线程在执行过程中获取锁，当获取锁之后使当前线程睡眠1秒（并不释放锁），随后打印当前线程名称，最后再次睡眠1秒并释放锁，测试用例如代码清单所示。</p>
<p>　TwinsLockTest.java</p>
<hr>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TwinsLockTest</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">final</span> Lock lock = <span class="keyword">new</span> TwinsLock();</span><br><span class="line">            <span class="class"><span class="keyword">class</span> <span class="title">Worker</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>&#123;</span><br><span class="line">                    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                            <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">                                    lock.lock();</span><br><span class="line">                                    <span class="keyword">try</span> &#123;</span><br><span class="line">                                            SleepUtils.second(<span class="number">1</span>);</span><br><span class="line">    System.out.println(Thread.currentThread().getName());</span><br><span class="line">                                            SleepUtils.second(<span class="number">1</span>);</span><br><span class="line">                                    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                                            lock.unlock();</span><br><span class="line">                                    &#125;</span><br><span class="line">                            &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 启动10个线程</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">                    Worker w = <span class="keyword">new</span> Worker();</span><br><span class="line">                    w.setDaemon(<span class="keyword">true</span>);</span><br><span class="line">                    w.start();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 每隔1秒换行</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">                    SleepUtils.second(<span class="number">1</span>);</span><br><span class="line">                    System.out.println();</span><br><span class="line">            &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<p>运行该测试用例，可以看到线程名称成对输出，也就是在同一时刻只有两个线程能够获取到锁，这表明TwinsLock可以按照预期正确工作。</p>
<p>参考: 方腾飞,魏鹏,程晓明 著. 《Java并发编程的艺术 》(Java核心技术系列)</p>
]]></content>
      <categories>
        <category>java</category>
        <category>concurrent</category>
        <category>AbstractQueuedSynchronizer</category>
      </categories>
      <tags>
        <tag>jvm</tag>
        <tag>java</tag>
        <tag>concurrent</tag>
        <tag>AbstractQueuedSynchronizer</tag>
      </tags>
  </entry>
  <entry>
    <title>AI Studio基本操作(一) Notebook篇</title>
    <url>/AiStudio-basic-use-notebook/</url>
    <content><![CDATA[<p>由于AI Studio使用了Notebook为主要编辑器, 因此也引入了一些iPython操作. 特别示例说明</p>
<p>AI Studio的Notebook项目的基本操作.</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">项目启停</span><br><span class="line">执行和调试</span><br><span class="line">多文件代码编辑</span><br><span class="line">上传Notebook</span><br><span class="line">Notebook快捷键</span><br><span class="line">暗黑模式</span><br><span class="line">字号调节</span><br><span class="line">Notebook中使用Shell命令</span><br><span class="line">    使用pip来安装自己需要的package (但不支持apt-get)</span><br><span class="line">    查看当前环境中安装的package</span><br><span class="line">    持久化安装</span><br><span class="line">        使用git命令来同步代码 (暂时需要Paddle 1.4.1以上)</span><br><span class="line">    文件下载</span><br><span class="line">Python代码执行与调试</span><br><span class="line">变量监控</span><br><span class="line">Magic命令</span><br><span class="line">     %env：设置环境变量</span><br><span class="line">     %run: 运行python代码</span><br><span class="line">     %%writefile and %pycat: 导出cell内容/显示外部脚本的内容</span><br><span class="line">关于快速查看某个对象/方法/接口的用法</span><br><span class="line">关于变量监控</span><br><span class="line">关于调试代码</span><br></pre></td></tr></table></figure>

 <span id="more"></span>
<h1 id="项目启停"><a href="#项目启停" class="headerlink" title="项目启停"></a>项目启停</h1><p>当进入自己项目的详情页面时, 用户可以选择”运行”项目, 也就是准备项目环境.</p>
<p>同样的, 当不想继续时, 可以此页面点击”停止”以终止项目.</p>
<p><img src="https://ai-studio-static-online.cdn.bcebos.com/897ace5ff04b49f8896db4e742f61c207e0bd990722640438df5eb75fcb7c264" alt="img"></p>
<hr>
<p>当启动项目时, 如个人信息完整, 则可以获得算力奖励</p>
<p><img src="https://ai-studio-static-online.cdn.bcebos.com/c28902b6a58f4dbb8b41069c07b9207967ff54019cbb4653b673c4f51c96ab2e" alt="img"></p>
<hr>
<p>主动填写个人信息的入口在右上角的个人中心里</p>
<p><img src="https://ai-studio-static-online.cdn.bcebos.com/fb558d5a532f4c28bbe33fe376c8a2af330ed7437b9542e8ab83c8dc66fb22a7" alt="img"></p>
<h1 id="执行和调试"><a href="#执行和调试" class="headerlink" title="执行和调试"></a>执行和调试</h1><p>基于Notebook的方案和传统IDE方案略有不同, 请见下图:</p>
<p><img src="https://ai-studio-static-online.cdn.bcebos.com/136c52a305814e20a6f026722f080051d219b216e005432c9a9ac73e079ddbb8" alt="img"></p>
<p>插入断点则需要使用Python自带Debugger: PDB. 用法请点击这里:</p>
<p><a href="https://aistudio.baidu.com/aistudio/projectdetail/69987">PDB用法</a></p>
<h1 id="多文件代码编辑"><a href="#多文件代码编辑" class="headerlink" title="多文件代码编辑"></a>多文件代码编辑</h1><p>本系统的Notebook支持多文件编辑, 支持.py, .json, .txt, .log等格式的在线编辑, 支持部分图片类型文件的在线预览.</p>
<p><img src="https://ai-studio-static-online.cdn.bcebos.com/222e72279ad74d1c81fdd250ec61664de4297161cac540e686fae4db2ac942c2" alt="img"></p>
<p><strong>上传文件的体积是150MB. 如果需要引用更大体积的文件, 请使用数据集功能</strong>.</p>
<p>用户也可以使用命令, <code>!cat &lt;&lt;newfile &gt; newfile.py</code> 在项目空间内直接创建文件, 之后双击进行编辑. 如下图所示:</p>
<p><img src="https://ai-studio-static-online.cdn.bcebos.com/6bb509c98c5d4b37859e3fb06287e1e01e04c670f6604de6b2e405ac9e57344a" alt="img"></p>
<h1 id="上传Notebook"><a href="#上传Notebook" class="headerlink" title="上传Notebook"></a>上传Notebook</h1><p>可以用自己的ipynb文件取代当前默认的Notebook(前提是格式合法)</p>
<p><img src="https://ai-studio-static-online.cdn.bcebos.com/152eaa9467084d00b856d18d50cae24af7890698d80945b1a3256203ea4ad98a" alt="img"></p>
<h1 id="Notebook快捷键"><a href="#Notebook快捷键" class="headerlink" title="Notebook快捷键"></a>Notebook快捷键</h1><p>和原生Notebook快捷键基本一致.</p>
<p>快捷键分成两种状态下的. 一个是命令模式, 一个是编辑模式, 掌握之后事半功倍.</p>
<p><img src="https://ai-studio-static-online.cdn.bcebos.com/3a9f826518cb42e89965641e4eea9a289dbcce74862e4335ba8738d978e37fc2" alt="img"></p>
<p><img src="https://ai-studio-static-online.cdn.bcebos.com/968cf800086a47129fdda653891c170a1c9b1248296747aeaa766bb5cef2932c" alt="img"></p>
<hr>
<h1 id="暗黑模式"><a href="#暗黑模式" class="headerlink" title="暗黑模式"></a>暗黑模式</h1><p>经常有小伙伴来咨询如何使用暗黑模式(Dark Theme), @ACK白纸 同学提供了一个快捷方案: 使用浏览器插件.</p>
<blockquote>
<p>Chrome下请搜索: 夜间眼睛</p>
</blockquote>
<blockquote>
<p>Firefox下请搜索: Dark Reader.</p>
</blockquote>
<p>最终效果如下:</p>
<p><img src="https://ai-studio-static-online.cdn.bcebos.com/af05b84bacde4e7ea31397ea062b86ca39001e9f143f4cad8321fd4b3af252d9" alt="img"></p>
<p>@ACK白纸 同学还推荐了更多有用的插件, 可以点击这里. <a href="https://ai.baidu.com/forum/topic/show/957556">很有帮助哦</a></p>
<h1 id="字号调节"><a href="#字号调节" class="headerlink" title="字号调节"></a>字号调节</h1><p>如果觉得字体太小看不清楚, 可在左侧设置区找到相关设置进行调节:</p>
<p><img src="https://ai-studio-static-online.cdn.bcebos.com/e270d629d24744088771a42c29cdb05f7522877377854c06ba4d8f9a748797f1" alt="img"></p>
<h1 id="Notebook中使用Shell命令"><a href="#Notebook中使用Shell命令" class="headerlink" title="Notebook中使用Shell命令"></a><strong>Notebook中使用Shell命令</strong></h1><p>通过在Shell命令前添加! (感叹号), 就可以执行部分Shell命令. 包括诸如 !pip install这样的命令. 不过, !apt-get这种可能引发用户进一步操作的命令是不支持的.</p>
<p>下面是两个示例.</p>
<p>In [1]</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 查看当前挂载的数据集目录</span></span><br><span class="line">!ls /home/aistudio/data/</span><br><span class="line">data269</span><br></pre></td></tr></table></figure>

<p>In [4]</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#显示当前路径</span></span><br><span class="line"></span><br><span class="line">!<span class="built_in">pwd</span></span><br><span class="line">/home/aistudio</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="使用pip来安装自己需要的package-但不支持apt-get"><a href="#使用pip来安装自己需要的package-但不支持apt-get" class="headerlink" title="使用pip来安装自己需要的package (但不支持apt-get)"></a>使用pip来安装自己需要的package (但不支持apt-get)</h3><p>例如:</p>
<p>In [26]</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">!pip install jupyterthemes</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="查看当前环境中安装的package"><a href="#查看当前环境中安装的package" class="headerlink" title="查看当前环境中安装的package"></a>查看当前环境中安装的package</h3><p>In [1]</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">!pip list --format=columns</span><br><span class="line">Package            Version        </span><br><span class="line">------------------ ---------------</span><br><span class="line">absl-py            0.8.1          </span><br><span class="line">attrs              19.2.0         </span><br><span class="line">backcall           0.1.0          </span><br><span class="line">bleach             3.1.0          </span><br><span class="line">certifi            2019.9.11      </span><br><span class="line">chardet            3.0.4          </span><br><span class="line">Click              7.0            </span><br><span class="line">cloudpickle        1.2.1          </span><br><span class="line">cma                2.7.0          </span><br><span class="line">cycler             0.10.0         </span><br><span class="line">Cython             0.29           </span><br><span class="line">decorator          4.4.0          </span><br><span class="line">entrypoints        0.3            </span><br><span class="line">Flask              1.1.1          </span><br><span class="line">funcsigs           1.0.2          </span><br><span class="line">future             0.18.0         </span><br><span class="line">graphviz           0.13           </span><br><span class="line">grpcio             1.24.1         </span><br><span class="line">gym                0.12.1         </span><br><span class="line">h5py               2.9.0          </span><br><span class="line">idna               2.8            </span><br><span class="line">imageio            2.6.1          </span><br><span class="line">imageio-ffmpeg     0.3.0          </span><br><span class="line">importlib-metadata 0.23           </span><br><span class="line">ipykernel          5.1.0          </span><br><span class="line">ipython            7.0.1          </span><br><span class="line">ipython-genutils   0.2.0          </span><br><span class="line">itsdangerous       1.1.0          </span><br><span class="line">jedi               0.15.1         </span><br><span class="line">Jinja2             2.10.1         </span><br><span class="line">jsonschema         3.1.1          </span><br><span class="line">jupyter-client     5.3.3          </span><br><span class="line">jupyter-core       4.5.0          </span><br><span class="line">kiwisolver         1.1.0          </span><br><span class="line">Markdown           3.1.1          </span><br><span class="line">MarkupSafe         1.1.1          </span><br><span class="line">matplotlib         2.2.3          </span><br><span class="line">mistune            0.8.4          </span><br><span class="line">more-itertools     7.2.0          </span><br><span class="line">moviepy            1.0.1          </span><br><span class="line">nbconvert          5.3.1          </span><br><span class="line">nbformat           4.4.0          </span><br><span class="line">nltk               3.4.5          </span><br><span class="line">notebook           5.7.0          </span><br><span class="line">numpy              1.16.4         </span><br><span class="line">opencv-python      4.1.1.26       </span><br><span class="line">paddlehub          1.2.0          </span><br><span class="line">paddlepaddle-gpu   1.5.1.post97   </span><br><span class="line">pandas             0.23.4         </span><br><span class="line">pandocfilters      1.4.2          </span><br><span class="line">parl               1.1.2          </span><br><span class="line">parso              0.5.1          </span><br><span class="line">pexpect            4.7.0          </span><br><span class="line">pickleshare        0.7.5          </span><br><span class="line">Pillow             6.2.0          </span><br><span class="line">pip                19.2.3         </span><br><span class="line">prettytable        0.7.2          </span><br><span class="line">proglog            0.1.9          </span><br><span class="line">prometheus-client  0.5.0          </span><br><span class="line">prompt-toolkit     2.0.10         </span><br><span class="line">protobuf           3.10.0         </span><br><span class="line">ptyprocess         0.6.0          </span><br><span class="line">pyarrow            0.13.0         </span><br><span class="line">pyglet             1.4.5          </span><br><span class="line">Pygments           2.4.2          </span><br><span class="line">pyparsing          2.4.2          </span><br><span class="line">pyrsistent         0.15.4         </span><br><span class="line">python-dateutil    2.8.0          </span><br><span class="line">pytz               2019.3         </span><br><span class="line">PyYAML             5.1.2          </span><br><span class="line">pyzmq              18.0.1         </span><br><span class="line">rarfile            3.1            </span><br><span class="line">recordio           0.1.7          </span><br><span class="line">requests           2.22.0         </span><br><span class="line">scikit-learn       0.20.0         </span><br><span class="line">scipy              1.3.0          </span><br><span class="line">Send2Trash         1.5.0          </span><br><span class="line">setuptools         41.4.0         </span><br><span class="line">simplegeneric      0.8.1          </span><br><span class="line">six                1.12.0         </span><br><span class="line">sklearn            0.0            </span><br><span class="line">tb-nightly         1.15.0a20190801</span><br><span class="line">tb-paddle          0.3.6          </span><br><span class="line">tensorboardX       1.8            </span><br><span class="line">termcolor          1.1.0          </span><br><span class="line">terminado          0.8.2          </span><br><span class="line">testpath           0.4.2          </span><br><span class="line">tornado            5.1.1          </span><br><span class="line">tqdm               4.36.1         </span><br><span class="line">traitlets          4.3.3          </span><br><span class="line">urllib3            1.25.6         </span><br><span class="line">visualdl           1.3.0          </span><br><span class="line">wcwidth            0.1.7          </span><br><span class="line">webencodings       0.5.1          </span><br><span class="line">Werkzeug           0.16.0         </span><br><span class="line">wheel              0.33.6         </span><br><span class="line">zipp               0.6.0          </span><br></pre></td></tr></table></figure>

<p>In [1]</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#以及使用下方命令查看预装软件</span></span><br><span class="line">!apt list</span><br></pre></td></tr></table></figure>

<h2 id="持久化安装"><a href="#持久化安装" class="headerlink" title="持久化安装"></a>持久化安装</h2><p>如果需要进行持久化安装, 需要使用持久化路径, 如下方代码示例:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">!mkdir /home/aistudio/external-libraries</span><br><span class="line">!pip install beautifulsoup4 -t /home/aistudio/external-libraries</span><br></pre></td></tr></table></figure>

<p>同时添加如下代码, 这样每次环境(kernel)启动的时候只要运行下方代码即可:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line">sys.path.append(<span class="string">&#x27;/home/aistudio/external-libraries&#x27;</span>)</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="使用git命令来同步代码-暂时需要Paddle-1-4-1以上"><a href="#使用git命令来同步代码-暂时需要Paddle-1-4-1以上" class="headerlink" title="使用git命令来同步代码 (暂时需要Paddle 1.4.1以上)"></a>使用git命令来同步代码 (暂时需要Paddle 1.4.1以上)</h3><p>例如:</p>
<p>In [1]</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">%<span class="built_in">cd</span> work/</span><br><span class="line">/home/aistudio/work</span><br></pre></td></tr></table></figure>

<p>In [3]</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">!git <span class="built_in">clone</span> https://github.com/PaddlePaddle/Paddle.git  <span class="comment">#Paddle官方模型</span></span><br></pre></td></tr></table></figure>

<p>可以看到同步后work目录下出现一个Models文件夹</p>
<p><img src="https://ai-studio-static-online.cdn.bcebos.com/fd9217b5f6e74885b2dca27ac6cfb564f3165a5c181f4205a183ce63d7689eb2" alt="img"></p>
<p>也可以活用Git命令进行本地代码管理.</p>
<blockquote>
<p>注意: Paddle的Git体积过大, 同步会非常迟缓. 建议使用浏览器插件, 对指定目录进行下载, 然后上传至AI Studio的项目空间中. <a href="https://chrome.google.com/webstore/detail/gitzip-for-github/ffabmkklhbepgcgfonabamgnfafbdlkn">Chrome版</a></p>
</blockquote>
<hr>
<h2 id="文件下载"><a href="#文件下载" class="headerlink" title="文件下载"></a>文件下载</h2><p>文件下载分为”文件夹打包下载”和”单一文件下载”, 两者操作按钮在同一位置:</p>
<p><img src="https://ai-studio-static-online.cdn.bcebos.com/c95f71b5d89140dc8ce3eac0951fb2a467aa844c070642f5bf2d6a1311ae140c" alt="img"></p>
<p>但文件夹下载可能耗时比较久, 每次只能下载一个文件夹内容, 也可能需要较长时间等待.</p>
<h1 id="Python代码执行与调试"><a href="#Python代码执行与调试" class="headerlink" title="Python代码执行与调试"></a>Python代码执行与调试</h1><p>Notebook执行Python代码的原理和传统IDE略有不同.</p>
<ol>
<li>传统IDE, 当点击Run按钮时, 编译器/解释器开始构建一个进程. 用户通过单步执行/设置断点进行代码调试和变量监控. 当代码出错, 或用户点击Stop按钮时, 进程被杀死, 资源回收.</li>
</ol>
<p>而Notebook, 一旦启动, 就是开始创建一个”进程”(kernel). 每一个Cell, 都是一个天然的断点. 当代码出错, 或用户点击Stop按钮时, “进程”通常也不会被杀死.</p>
<p>因此如果代码陷入死循环等情况, 需要用户手动关闭并重启该”进程”.</p>
<ol>
<li>此外, Notebook的Cell是可以随意颠倒顺序来执行的. 这点和传统IDE有很大不同.</li>
<li>作为前端的Notebook, 与后端的进程(kernel), 建立有一个Session. 未来本平台将支持terminal功能. 也就可以同时支持多个Session来控制kernel.</li>
</ol>
<h1 id="变量监控"><a href="#变量监控" class="headerlink" title="变量监控"></a>变量监控</h1><p>因为Notebook的Cell是可以随意颠倒顺序来执行的, 因此本平台自带”变量监控”和”运行历史”. 方便用户了解当前代码运行状态.</p>
<p>通过重启环境并清空输出, 可以消除已生成的变量监控.</p>
<p><img src="https://ai-studio-static-online.cdn.bcebos.com/17c78273f5e144a49eec0fecb0fa6667be12e9bb063e4daf92ccd73d99b1ca49" alt="img"></p>
<hr>
<h2 id="2-Magic命令"><a href="#2-Magic命令" class="headerlink" title="2. Magic命令"></a>2. <strong>Magic命令</strong></h2><p>Magic命令是Notebook的高级用法了. 可以运行一些特殊的指令. Magic 命令的前面带有一个或两个百分号（% 或 %%），分别代表行 Magic 命令和单元格 Magic 命令。行 Magic 命令仅应用于编写 Magic 命令时所在的行，而单元格 Magic 命令应用于整个单元格。</p>
<p>举个例子:</p>
<p>In [7]</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#显示全部可用的Magic命令</span></span><br><span class="line"></span><br><span class="line">%lsmagic</span><br><span class="line">Available line magics:</span><br><span class="line">%<span class="built_in">alias</span>  %alias_magic  %autoawait  %autocall  %automagic  %autosave  %bookmark  %cat  %<span class="built_in">cd</span>  %clear  %colors  %config  %connect_info  %cp  %debug  %dhist  %<span class="built_in">dirs</span>  %doctest_mode  %ed  %edit  %env  %gui  %hist  %<span class="built_in">history</span>  %killbgscripts  %ldir  %less  %lf  %lk  %ll  %load  %load_ext  %loadpy  %logoff  %logon  %logstart  %logstate  %logstop  %ls  %lsmagic  %lx  %macro  %magic  %man  %matplotlib  %mkdir  %more  %mv  %notebook  %page  %pastebin  %pdb  %pdef  %pdoc  %pfile  %pinfo  %pinfo2  %<span class="built_in">popd</span>  %pprint  %precision  %prun  %psearch  %psource  %<span class="built_in">pushd</span>  %<span class="built_in">pwd</span>  %pycat  %pylab  %qtconsole  %quickref  %recall  %rehashx  %reload_ext  %rep  %rerun  %reset  %reset_selective  %rm  %rmdir  %run  %save  %sc  %set_env  %store  %sx  %system  %tb  %time  %timeit  %<span class="built_in">unalias</span>  %unload_ext  %who  %who_ls  %whos  %xdel  %xmode</span><br><span class="line"></span><br><span class="line">Available cell magics:</span><br><span class="line">%%!  %%HTML  %%SVG  %%bash  %%capture  %%debug  %%file  %%html  %%javascript  %%js  %%latex  %%markdown  %%perl  %%prun  %%pypy  %%python  %%python2  %%python3  %%ruby  %%script  %%sh  %%svg  %%sx  %%system  %%time  %%timeit  %%writefile</span><br><span class="line"></span><br><span class="line">Automagic is ON, % prefix IS NOT needed <span class="keyword">for</span> line magics.</span><br></pre></td></tr></table></figure>

<p>In [8]</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#使用Magic命令来统计运行时长</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> random</span><br></pre></td></tr></table></figure>

<p>In [9]</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">%%timeit</span><br><span class="line"></span><br><span class="line">prize = <span class="number">0</span> </span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100</span>):</span><br><span class="line">    roll = random.randint(<span class="number">1</span>, <span class="number">6</span>)</span><br><span class="line">    <span class="keyword">if</span> roll%<span class="number">2</span> == <span class="number">0</span>:</span><br><span class="line">        prize += roll</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        prize -= <span class="number">1</span></span><br><span class="line">        </span><br><span class="line"><span class="number">175</span> µs ± <span class="number">2.12</span> µs per loop (mean ± std. dev. of <span class="number">7</span> runs, <span class="number">10000</span> loops each)</span><br></pre></td></tr></table></figure>

<hr>
<p><strong>甚至还可以直接嵌入可视化内容, 例如%matplotlib inline:</strong></p>
<p>In [12]</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">%matplotlib inline</span><br><span class="line">%config InlineBackend.figure_format = <span class="string">&#x27;retina&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">x = np.linspace(<span class="number">0</span>,<span class="number">1</span>,<span class="number">300</span>)</span><br><span class="line"><span class="keyword">for</span> w <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>,<span class="number">6</span>,<span class="number">2</span>):</span><br><span class="line">    plt.plot(x, np.sin(np.pi*x)*np.sin(<span class="number">2</span>*w*np.pi*x))</span><br></pre></td></tr></table></figure>

<p><img src="data:image/png;base64,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ixp57kW8XouzzKyrc+54K455psE+IiLZwQxO/RicshD2roaqchh6qlKdiogIkAY9CRGb5N+vb/iEc64a2IIXGI1t5TG7gXJguJl1j7apIiJpwAwGnwwj36cAQURE6mVbT0Jv/760iefrHu/TxmMK/f2ONXdyM3uziacmN3eciIiIiEg6iaQnwcyK/bSlrb3dF8V5RUREREQkelH1JGzCSznaWrsiOm9Ddb0BvZt4vu7xww2OKfKfa2z50ZZ6Guo552Y29rjfwzCjpeNFRERERNJBJEGCc+68KOqJwDrgdGAikDD0x8xygTFANbC5wTFF/jGvNDhmCN5Qox3OuWaHGomIiIiIZItsm7j8nH9/QSPPnQ10B5aFMhu1dMyFDfYREREREcl6GRkkmFlvM5vsf9Mf9hBwAFhoZqeH9i8AbvOLv2hwzF3AceBz/sJqdcf0Bb7qF38ZXetFRERERNJbWmQ3MrN/I8gAdKp/f72Zvd/fftk595vQIR/B+3B/D3Bd3YPOuTIz+wResLDEzO7HW0l5AV6q04eAB8Lnds5tMbNbgZ8Ay83sAaAKb2G24cAPnHMJw5BERERERLJZWgQJeEN9zmnw2Fn+rc5vaAXn3KNmdg7wNeAKoADYCHwJ+IlzzjVyzB1mVgx8Bfg4Xg/LGuDrzrl72vZSREREREQyW1oECc65uW3c/27g7maeXwpc1MY6nwCeaMsxIiIiIiLZKCPnJIiIiIiISOooSBARERERkQQKEkREREREJIGCBBERERERSaAgQUREREREEihIEBERERGRBAoSREREREQkgTWytphEzMwOduvWrd+UKVPiboqIiIiIZLH33nuPioqKEudc//bUoyChA5jZFqAXUNzBp57s36/t4PNKx9J17hx0nTsHXefsp2vcOcR5nUcDZc65Me2pREFCFjOzNwGcczPjboukjq5z56Dr3DnoOmc/XePOIRuus+YkiIiIiIhIAgUJIiIiIiKSQEGCiIiIiIgkUJAgIiIiIiIJFCSIiIiIiEgCZTcSEREREZEE6kkQEREREZEEChJERERERCSBggQREREREUmgIEFERERERBIoSBARERERkQQKEkREREREJIGCBBERERERSaAgIcOY2XAzu9PMdpnZcTMrNrMfmVnfNtbTzz+u2K9nl1/v8FS1XVqvvdfZzArN7Goz+4OZrTWzcjM7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" alt="img"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;Figure size 432x288 with 1 Axes&gt;</span><br></pre></td></tr></table></figure>

<p>这里需要注意的是, 当前技术架构局限, 一个Cell里面只能输出<strong>一张图片</strong>. 如果输出多张图片, 可能会有显示异常的问题</p>
<hr>
<h3 id="env：设置环境变量"><a href="#env：设置环境变量" class="headerlink" title="%env：设置环境变量"></a>%env：设置环境变量</h3><p>使用该命令, 可以在不必重启Kernel的情况下管理notebook的环境变量</p>
<p>In [4]</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Running %env without any arguments</span></span><br><span class="line"><span class="comment"># lists all environment variables</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># The line below sets the environment</span></span><br><span class="line"><span class="comment"># variable OMP_NUM_THREADS</span></span><br><span class="line">%env OMP_NUM_THREADS=4</span><br><span class="line">env: OMP_NUM_THREADS=4</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="run-运行python代码"><a href="#run-运行python代码" class="headerlink" title="%run: 运行python代码"></a>%run: 运行python代码</h3><p>使用%run 可以运行.py格式的python代码</p>
<p>当然是用!python也是可以的</p>
<p>我在项目空间中上传了一个.py文件, 里面只有一行print代码. 我们执行一下看看.</p>
<p><img src="https://ai-studio-static-online.cdn.bcebos.com/5a0d9d3487374946881f7843b40e544caa6ce50aeef14ad88c067abc46c348fb" alt="img"></p>
<p>In [5]</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">%run work/SampleOfRun.py</span><br><span class="line">It<span class="string">&#x27;s a demo code written in file SampleOfRun.py</span></span><br></pre></td></tr></table></figure>

<p>In [6]</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">!python work/SampleOfRun.py</span><br><span class="line">It<span class="string">&#x27;s a demo code written in file SampleOfRun.py</span></span><br></pre></td></tr></table></figure>

<hr>
<h3 id="writefile-and-pycat-导出cell内容-显示外部脚本的内容"><a href="#writefile-and-pycat-导出cell内容-显示外部脚本的内容" class="headerlink" title="%%writefile and %pycat: 导出cell内容/显示外部脚本的内容"></a><strong>%%writefile and %pycat: 导出cell内容/显示外部脚本的内容</strong></h3><p>AI Studio当前支持一定格式文件的预览和处理, 如果您的格式比较特殊, 尚未支持的话, 不妨试试这两个命令.</p>
<p>%%writefile magic可以把cell的内容保存到外部文件里。 而%pycat则可把外部文件展示在Cell中</p>
<p>In [13]</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">%%writefile SaveToPythonCode.py</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> math <span class="keyword">import</span> sqrt</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>,<span class="number">10</span>):</span><br><span class="line">    flag=<span class="number">1</span></span><br><span class="line">    k=<span class="built_in">int</span>(sqrt(i))</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>,k+<span class="number">1</span>):</span><br><span class="line">        <span class="keyword">if</span> i%j==<span class="number">0</span>:</span><br><span class="line">            flag=<span class="number">0</span></span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">if</span>(flag):</span><br><span class="line">            <span class="built_in">print</span>(i)</span><br><span class="line">Writing SaveToPythonCode.py</span><br></pre></td></tr></table></figure>

<p>因为没有指定路径, 所以文件被保存到了根目录下. 但至少it works.</p>
<p><img src="https://ai-studio-static-online.cdn.bcebos.com/c4c44796af06452295e018e7b0edc6b59f988337bc534d1fa888fe471c43b439" alt="img"></p>
<p>我们再来尝试从中读文件内容</p>
<p>In [15]</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">%pycat SaveToPythonCode.py</span><br></pre></td></tr></table></figure>

<p>更多Magic命令可以点击这里查询 <a href="https://ipython.readthedocs.io/en/stable/interactive/magics.html">Magic命令</a></p>
<hr>
<h2 id="关于快速查看某个对象-方法-接口的用法"><a href="#关于快速查看某个对象-方法-接口的用法" class="headerlink" title="关于快速查看某个对象/方法/接口的用法"></a>关于快速查看某个对象/方法/接口的用法</h2><p>在要查询的对象前输入?或??并执行即可. 单问号是普通信息, 双问号是详细信息.</p>
<p>前提: 该对象方法已经被正确导入(import)</p>
<p>示例:</p>
<p>In [2]</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> paddle</span><br><span class="line"><span class="keyword">import</span> paddle.fluid</span><br></pre></td></tr></table></figure>

<p>In [5]</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">?paddle.fluid.layers.conv3d</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="关于变量监控"><a href="#关于变量监控" class="headerlink" title="关于变量监控"></a>关于变量监控</h2><p>你可以通过修改内核选项ast_note_interactivity，使得Jupyter对独占一行的所有变量或者语句都自动显示，这样你就可以马上看到多个语句的运行结果了。</p>
<p>In [2]</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">!pip install pydataset</span><br></pre></td></tr></table></figure>

<p>In [3]</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> IPython.core.interactiveshell <span class="keyword">import</span> InteractiveShell</span><br><span class="line">InteractiveShell.ast_node_interactivity = <span class="string">&quot;all&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> pydataset <span class="keyword">import</span> data</span><br><span class="line"></span><br><span class="line">quakes = data(<span class="string">&#x27;quakes&#x27;</span>)</span><br><span class="line">quakes.head()</span><br><span class="line">quakes.tail()</span><br><span class="line">initiated datasets repo at: /home/aistudio/.pydataset/</span><br><span class="line">     lat    long  depth  mag  stations</span><br><span class="line"><span class="number">1</span> -<span class="number">20.42</span>  <span class="number">181.62</span>    <span class="number">562</span>  <span class="number">4.8</span>        <span class="number">41</span></span><br><span class="line"><span class="number">2</span> -<span class="number">20.62</span>  <span class="number">181.03</span>    <span class="number">650</span>  <span class="number">4.2</span>        <span class="number">15</span></span><br><span class="line"><span class="number">3</span> -<span class="number">26.00</span>  <span class="number">184.10</span>     <span class="number">42</span>  <span class="number">5.4</span>        <span class="number">43</span></span><br><span class="line"><span class="number">4</span> -<span class="number">17.97</span>  <span class="number">181.66</span>    <span class="number">626</span>  <span class="number">4.1</span>        <span class="number">19</span></span><br><span class="line"><span class="number">5</span> -<span class="number">20.42</span>  <span class="number">181.96</span>    <span class="number">649</span>  <span class="number">4.0</span>        <span class="number">11</span></span><br><span class="line">        lat    long  depth  mag  stations</span><br><span class="line"><span class="number">996</span>  -<span class="number">25.93</span>  <span class="number">179.54</span>    <span class="number">470</span>  <span class="number">4.4</span>        <span class="number">22</span></span><br><span class="line"><span class="number">997</span>  -<span class="number">12.28</span>  <span class="number">167.06</span>    <span class="number">248</span>  <span class="number">4.7</span>        <span class="number">35</span></span><br><span class="line"><span class="number">998</span>  -<span class="number">20.13</span>  <span class="number">184.20</span>    <span class="number">244</span>  <span class="number">4.5</span>        <span class="number">34</span></span><br><span class="line"><span class="number">999</span>  -<span class="number">17.40</span>  <span class="number">187.80</span>     <span class="number">40</span>  <span class="number">4.5</span>        <span class="number">14</span></span><br><span class="line"><span class="number">1000</span> -<span class="number">21.59</span>  <span class="number">170.56</span>    <span class="number">165</span>  <span class="number">6.0</span>       <span class="number">119</span></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="关于调试代码"><a href="#关于调试代码" class="headerlink" title="关于调试代码"></a>关于调试代码</h2><p>Notebook自带一个调试器, 叫The Python Debugger (pdb)，我们来看看它是如何工作的.</p>
<p>In [23]</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 对, 它也是依赖Magic命令启动的.</span></span><br><span class="line"><span class="comment"># 理论上pdb是可以通过脚本形式来启动. 但是在Notebook中不行, 会造成阻断</span></span><br><span class="line"></span><br><span class="line">%pdb</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">reverse</span>(<span class="params">x: <span class="built_in">int</span></span>) -&gt; <span class="built_in">int</span>:</span></span><br><span class="line">    inputnumber = x.__str__()</span><br><span class="line">    reversedStr = inputnumber[::-<span class="number">1</span>]</span><br><span class="line">    strOriLen = <span class="built_in">len</span>(reversedStr)</span><br><span class="line">    result = <span class="built_in">list</span>()</span><br><span class="line">    flag = <span class="number">1</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, strOriLen):</span><br><span class="line">        <span class="keyword">if</span> i == (strOriLen -<span class="number">1</span>) <span class="keyword">and</span> reversedStr[i] == <span class="string">&#x27;-&#x27;</span> :</span><br><span class="line">            flag = -<span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            result.append(reversedStr[i])</span><br><span class="line">    outputs = <span class="string">&#x27;&#x27;</span>.join(result)</span><br><span class="line">    outputInt = <span class="built_in">int</span>(outputs)        </span><br><span class="line">     </span><br><span class="line">    outputInt = outputInt * flag</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">if</span> outputInt &gt; <span class="built_in">pow</span>(<span class="number">2</span>,<span class="number">31</span>)-<span class="number">1</span>  <span class="keyword">or</span> outputInt &lt; -<span class="number">1</span> * <span class="built_in">pow</span>(<span class="number">2</span>,<span class="number">31</span>):</span><br><span class="line">        outputInt = <span class="number">0</span></span><br><span class="line">        </span><br><span class="line">    <span class="keyword">return</span> outputInt</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(reverse(<span class="number">134</span>))</span><br><span class="line">Automatic pdb calling has been turned OFF</span><br><span class="line"><span class="number">431</span></span><br></pre></td></tr></table></figure>

<p>原文地址：<a href="https://aistudio.baidu.com/aistudio/projectdetail/417073?pV=76627">https://aistudio.baidu.com/aistudio/projectdetail/417073?pV=76627</a></p>
<p>下一节将重点讲一下PDB的用法</p>
]]></content>
      <categories>
        <category>centos</category>
        <category>PaddleOCR</category>
        <category>Python</category>
      </categories>
      <tags>
        <tag>centos</tag>
        <tag>PaddleOCR</tag>
        <tag>Python</tag>
      </tags>
  </entry>
</search>
